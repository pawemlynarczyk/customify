<!doctype html>
<html
  class="no-js{% if request.design_mode %} shopify-design-mode{% endif %}"
  lang="{{ request.locale.iso_code }}"
>
  <head>
    {%- render 'stylesheets' -%}

    {%- if settings.favicon != blank -%}
      <link
        rel="icon"
        type="image/png"
        href="{{ settings.favicon | image_url: width: 32, height: 32 }}"
      >
    {%- endif -%}

    <link
      rel="expect"
      href="#MainContent"
      blocking="render"
      id="view-transition-render-blocker"
    >

    {%- render 'meta-tags' -%}
    {%- render 'fonts' -%}
    {%- render 'scripts' -%}
    {%- render 'theme-styles-variables' -%}
    {%- render 'color-schemes' -%}

    {% if request.design_mode %}
      {%- render 'theme-editor' -%}
    {% endif %}

    {{ content_for_header }}
    
    <!-- Customify - Minimal CSS -->
    <style>
      /* KOMPLETNY NAG≈Å√ìWEK SHOPIFY */
      .header-main {
        background: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .header-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 80px;
        gap: 30px;
      }

      /* Logo */
      .header-logo {
        flex-shrink: 0;
      }

      .logo-link {
        text-decoration: none;
        color: #000;
      }

      .logo-image {
        height: 50px;
        width: auto;
        object-fit: contain;
      }

      .logo-text {
        font-size: 28px;
        font-weight: 700;
        color: #000;
      }

      /* Wyszukiwarka */
      .header-search {
        flex: 1;
        max-width: 500px;
      }

      .search-form {
        width: 100%;
      }

      .search-wrapper {
        display: flex;
        align-items: center;
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 0;
        overflow: hidden;
        height: 48px;
      }

      .search-categories {
        background: #f8f9fa;
        border: none;
        padding: 0 15px;
        font-size: 14px;
        color: #666;
        cursor: pointer;
        min-width: 150px;
        height: 100%;
      }

      .search-input {
        flex: 1;
        border: none;
        padding: 0 15px;
        font-size: 16px;
        color: #000;
        background: white;
        height: 100%;
      }

      .search-input:focus {
        outline: none;
      }

      .search-button {
        background: #ff6b35;
        border: none;
        color: white;
        padding: 0 20px;
        cursor: pointer;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
      }

      .search-button:hover {
        background: #e55a2b;
      }

      /* Linki u≈ºytkownika */
      .header-user {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-shrink: 0;
      }

      .user-link {
        color: #000;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: color 0.2s ease;
      }

      .user-link:hover {
        color: #ff6b35;
      }

      /* Koszyk */
      .header-cart {
        flex-shrink: 0;
      }

      .cart-link {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #000;
        text-decoration: none;
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 0;
        transition: all 0.2s ease;
      }

      .cart-link:hover {
        border-color: #ff6b35;
        color: #ff6b35;
      }

      .cart-icon-wrapper {
        position: relative;
      }

      .cart-icon {
        width: 24px;
        height: 24px;
      }

      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background: #ff6b35;
        color: white;
        font-size: 12px;
        font-weight: 600;
        min-width: 18px;
        height: 18px;
        border-radius: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .cart-text {
        font-size: 14px;
        font-weight: 500;
      }

      /* Menu g≈Ç√≥wne */
      .header-nav {
        background: white;
        border-top: 1px solid #e9ecef;
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        height: 60px;
      }

      .nav-item {
        position: relative;
        margin-right: 30px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        gap: 5px;
        color: #000;
        text-decoration: none;
        font-size: 16px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 15px 0;
        transition: color 0.2s ease;
      }

      .nav-link:hover {
        color: #ff6b35;
      }

      .dropdown-arrow {
        width: 12px;
        height: 12px;
      }

      /* Dropdown menu */
      .nav-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-radius: 0;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1001;
        min-width: 200px;
      }

      .nav-item:hover .nav-dropdown {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-content {
        padding: 15px 0;
      }

      .dropdown-link {
        display: block;
        color: #000;
        text-decoration: none;
        font-size: 14px;
        font-weight: 400;
        padding: 10px 20px;
        transition: background-color 0.2s ease;
      }

      .dropdown-link:hover {
        background: #f8f9fa;
        color: #ff6b35;
      }

      /* Breadcrumbs */
      .breadcrumbs {
        background: #f8f9fa;
        padding: 15px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .breadcrumbs-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
      }

      .breadcrumb-link {
        color: #666;
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .breadcrumb-link:hover {
        color: #ff6b35;
      }

      .breadcrumb-separator {
        color: #999;
        margin: 0 5px;
      }

      .breadcrumb-current {
        color: #000;
        font-weight: 500;
      }

      /* Responsywno≈õƒá nag≈Ç√≥wka */
      @media (max-width: 1024px) {
        .header-container {
          padding: 0 15px;
          gap: 20px;
        }
        
        .header-search {
          max-width: 400px;
        }
        
        .search-categories {
          min-width: 120px;
        }
      }

      @media (max-width: 768px) {
        .header-container {
          flex-wrap: wrap;
          height: auto;
          padding: 15px;
          gap: 15px;
        }
        
        .header-search {
          order: 3;
          max-width: 100%;
          width: 100%;
        }
        
        .header-user {
          order: 2;
        }
        
        .nav-container {
          flex-wrap: wrap;
          height: auto;
          padding: 10px 15px;
        }
        
        .nav-item {
          margin-right: 20px;
          margin-bottom: 10px;
        }
        
        .nav-link {
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        .header-user {
          display: none;
        }
        
        .search-categories {
          display: none;
        }
        
        .search-wrapper {
          height: 44px;
        }
        
        .cart-text {
          display: none;
        }
      }

      /* NIE UKRYWAJ ELEMENT√ìW PRODUKTU - tylko dodaj style dla Customify */

      /* Clear floats */
      .product-page-layout::after {
        content: "";
        display: table;
        clear: both;
      }

      /* KONTROLA PROPORCJI G≈Å√ìWNEGO LAYOUTU */
      .product-information__grid {
        display: grid !important;
        grid-template-columns: 35% 65% !important; /* Obrazek 35%, Aplikacja 65% */
        gap: 24px !important;
        align-items: start !important;
        width: 100% !important;
        background: #f8f9fa !important; /* SZARE T≈ÅO dla grid */
        padding: 20px !important;
        border-radius: 0 !important;
      }

      /* SZARE T≈ÅO STRONY, BIA≈ÅE ELEMENTY */
      body {
        background: #f8f9fa !important; /* Szare t≈Ço ca≈Çej strony */
      }
      
      .page-width, .main-content, .content-for-layout, 
      .product-page, .product-template, .product-single,
      .product__media-wrapper, .product__info-wrapper,
      .product-information, .product-details-wrapper {
        background: transparent !important; /* Przezroczyste t≈Ço dla kontener√≥w */
      }

      /* USU≈É BIA≈ÅE T≈ÅO Z ELEMENT√ìW KT√ìRE POWINNY BYƒÜ PRZEZROCZYSTE */
      .product__media, .product__info, .product-details,
      .product-information__wrapper, .product-content {
        background: transparent !important;
      }

      /* Sekcja obrazk√≥w - zawsze w pierwszej kolumnie */
      .product-information__media {
        grid-column: 1 !important;
        width: 100% !important;
        box-sizing: border-box !important;
        background: white !important; /* Bia≈Çy panel dla zdjƒôƒá */
        padding: 20px !important;
        border-radius: 0 !important; /* Ostre kƒÖty */
        box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
      }

      /* Sekcja detali - zawsze w drugiej kolumnie */
      #ProductInformation-template--26351135293765__main,
      .product-details {
        grid-column: 2 !important;
        width: 100% !important;
        box-sizing: border-box !important;
        display: flex !important;
        flex-direction: column !important;
        background: white !important; /* BIA≈ÅE T≈ÅO dla sekcji detali */
        padding: 20px !important; /* Padding jak w sekcji obrazk√≥w */
        border-radius: 0 !important; /* Ostre kƒÖty */
        box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important; /* Cie≈Ñ jak w sekcji obrazk√≥w */
      }
      
      /* Aplikacja na g√≥rze kolumny detali */
      #customify-app-container {
        order: 1 !important; /* Po tytule i cenie */
        width: 100% !important;
        margin: 0 0 20px 0 !important;
        box-sizing: border-box !important;
        background: white !important; /* Bia≈Çe t≈Ço */
        border: none !important;
        border-radius: 0 !important; /* Ostre kƒÖty */
        padding: 0 20px 20px 20px !important; /* Usu≈Ñ padding na g√≥rze - bƒôdzie pod tytu≈Çem */
        min-height: 300px !important;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
      }
      
      /* Tytu≈Ç i cena - BIA≈ÅY PANEL Z CZARNYMI NAPISAMI */
      .group-block[data-testid="group-block"] {
        order: -1 !important; /* Przenie≈õ na g√≥rƒô */
        width: 100% !important;
        margin: 0 !important; /* Usu≈Ñ wszystkie marginesy */
        background: transparent !important; /* Przezroczyste t≈Ço - bƒôdzie na tym samym panelu co aplikacja */
        padding: 20px 20px 15px 20px !important; /* Padding jak w aplikacji */
        border-radius: 0 !important; /* Ostre kƒÖty */
        box-sizing: border-box !important;
        box-shadow: none !important; /* Bez cienia */
        border-bottom: 1px solid #e9ecef !important; /* Linia oddzielajƒÖca od aplikacji */
        position: relative !important; /* Dodaj pozycjonowanie */
        z-index: 1 !important; /* Ustaw z-index */
        --padding-block-start: 20px !important; /* Ustaw padding na g√≥rze */
        --padding-block-end: 15px !important; /* Ustaw padding na dole */
        --padding-inline-start: 20px !important; /* Ustaw padding po bokach */
        --padding-inline-end: 20px !important;
      }

      /* CZARNE NAPISY W PANELU PRODUKTU */
      .group-block[data-testid="group-block"] h1,
      .group-block[data-testid="group-block"] h2,
      .group-block[data-testid="group-block"] h3,
      .group-block[data-testid="group-block"] .view-product-title,
      .group-block[data-testid="group-block"] .view-product-title a,
      .group-block[data-testid="group-block"] .view-product-title p,
      .group-block[data-testid="group-block"] .price,
      .group-block[data-testid="group-block"] product-price,
      .group-block[data-testid="group-block"] .text-block,
      .group-block[data-testid="group-block"] .text-block p {
        color: #000 !important; /* Czarne napisy */
      }

      /* CZARNE NAPISY W PRZYCISKACH */
      .group-block[data-testid="group-block"] .button,
      .group-block[data-testid="group-block"] .add-to-cart-button,
      .group-block[data-testid="group-block"] .shopify-payment-button__button {
        color: #000 !important; /* Czarne napisy w przyciskach */
      }

      /* BIA≈ÅE T≈ÅO DLA WSZYSTKICH ELEMENT√ìW W PANELU */
      .group-block[data-testid="group-block"] * {
        background: transparent !important; /* Przezroczyste t≈Ço dla element√≥w wewnƒôtrznych */
      }

      /* NAPRAW POZYCJONOWANIE ELEMENT√ìW W GROUP-BLOCK */
      .group-block[data-testid="group-block"] .group-block-content {
        position: relative !important;
        z-index: 2 !important;
        margin: 0 !important;
        padding: 0 !important;
        background: transparent !important;
      }

      .group-block[data-testid="group-block"] .layout-panel-flex {
        display: flex !important;
        flex-direction: column !important;
        gap: 16px !important;
        margin: 0 !important;
        padding: 0 !important;
        background: transparent !important;
      }

      /* ELEMENTY POD TYTU≈ÅEM - GWIAZDKI I OKAZJA */
      .product-badges {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 15px;
        position: relative;
        z-index: 3;
      }

      .discount-badge {
        background: #28a745;
        color: white;
        padding: 6px 12px;
        border-radius: 0;
        font-size: 14px;
        font-weight: 600;
        display: inline-block;
        width: fit-content;
      }

      .rating-section {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .stars {
        display: flex;
        gap: 2px;
      }

      .star {
        color: #ffc107;
        font-size: 16px;
      }

      .review-count {
        color: #666;
        font-size: 14px;
        font-weight: 500;
      }

      /* POPRAWKA UK≈ÅADU TYTU≈ÅU Z GWIAZDKAMI */
      .group-block[data-testid="group-block"] .view-product-title {
        margin: 0 0 16px 0 !important; /* Ustaw marginesy */
        padding: 0 !important;
        position: relative !important;
        z-index: 4 !important;
        background: transparent !important;
      }

      .group-block[data-testid="group-block"] .view-product-title a {
        display: block !important;
        margin: 0 !important;
        padding: 0 !important;
        background: transparent !important;
      }

      .group-block[data-testid="group-block"] .product-badges {
        margin: 0 0 16px 0 !important; /* Ustaw marginesy */
        padding: 0 !important;
        position: relative !important;
        z-index: 5 !important;
        background: transparent !important;
      }

      /* ZWIƒòKSZ ODSTƒòPY W BADGE'ACH */
      .group-block[data-testid="group-block"] .product-badges {
        gap: 12px !important; /* Zwiƒôksz odstƒôp miƒôdzy okazjƒÖ a gwiazdkami */
      }

      /* NAPRAW ELEMENTY CENY */
      .group-block[data-testid="group-block"] product-price {
        margin: 0 0 20px 0 !important;
        padding: 0 !important;
        position: relative !important;
        z-index: 6 !important;
        background: transparent !important;
        display: block !important;
      }

      .group-block[data-testid="group-block"] product-price .price {
        margin: 0 !important;
        padding: 0 !important;
        background: transparent !important;
      }

      /* NAPRAW PRZYCISKI */
      .group-block[data-testid="group-block"] .buy-buttons-block {
        margin: 20px 0 0 0 !important;
        padding: 0 !important;
        position: relative !important;
        z-index: 7 !important;
        background: transparent !important;
        clear: both !important;
      }

      /* USU≈É WSZYSTKIE DIVIDERY W GROUP-BLOCK */
      .group-block[data-testid="group-block"] .divider,
      .group-block[data-testid="group-block"] .divider__line,
      .group-block .divider,
      .group-block .divider__line,
      .divider,
      .divider__line {
        display: none !important;
      }

      /* USU≈É RAMKƒò I CIE≈É Z TYTU≈ÅU */
      .group-block[data-testid="group-block"] .view-product-title,
      .group-block[data-testid="group-block"] .view-product-title a,
      .group-block[data-testid="group-block"] .view-product-title p,
      .group-block[data-testid="group-block"] .text-block,
      .group-block[data-testid="group-block"] .text-block p {
        text-shadow: none !important;
        box-shadow: none !important;
        border: none !important;
        outline: none !important;
        background: transparent !important;
        position: relative !important;
        z-index: auto !important;
      }

      /* DODATKOWE NAPRAWY DLA WSZYSTKICH ELEMENT√ìW W GROUP-BLOCK */
      .group-block[data-testid="group-block"] * {
        box-sizing: border-box !important;
        max-width: 100% !important;
      }

      /* USTAWIENIA CLEARFIX DLA GROUP-BLOCK */
      .group-block[data-testid="group-block"]::before,
      .group-block[data-testid="group-block"]::after {
        content: "" !important;
        display: table !important;
        clear: both !important;
      }

      /* NAPRAW POZYCJONOWANIE ELEMENT√ìW TEKSTOWYCH */
      .group-block[data-testid="group-block"] .text-block {
        margin: 0 0 10px 0 !important;
        padding: 0 !important;
        position: relative !important;
        background: transparent !important;
      }

      
      /* Mobile - stack wertykalnie */
      @media (max-width: 768px) {
        .product-information__grid {
          grid-template-columns: 1fr !important;
          gap: 20px !important;
        }
        
        .product-information__media,
        #ProductInformation-template--26351135293765__main {
          grid-column: 1 !important;
        }
      }

      /* SEKCJA OPINII KLIENT√ìW */
      .customer-reviews-section {
        margin-top: 40px;
        padding: 30px 0;
        border-top: 2px solid #e9ecef;
        background: #f8f9fa;
      }

      .reviews-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .reviews-title {
        font-size: 2rem;
        font-weight: 700;
        color: #000;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
      }

      .reviews-link {
        color: #007bff;
        text-decoration: none;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .reviews-link:hover {
        text-decoration: underline;
      }

      .stars-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        margin-bottom: 15px;
      }

      .star {
        color: #ffc107;
        font-size: 1.2rem;
      }

      .reviews-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .review-card {
        background: white;
        border-radius: 0;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border: 1px solid #e9ecef;
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .review-author {
        font-weight: 600;
        color: #000;
        font-size: 1.1rem;
      }

      .review-date {
        color: #666;
        font-size: 0.9rem;
      }

      .review-stars {
        display: flex;
        gap: 2px;
        margin-bottom: 10px;
      }

      .review-text {
        color: #333;
        line-height: 1.6;
        font-size: 0.95rem;
      }

      .review-style {
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 8px;
        border-radius: 0;
        font-size: 0.8rem;
        font-weight: 500;
        display: inline-block;
        margin-top: 10px;
      }
      
      /* Ukryj formularz dodawania do koszyka */
      .product-form-buttons {
        display: none !important;
      }

      /* Customify Styles */
      .customify-embed {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 0;
        padding: 20px;
        margin: 20px 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      .customify-header {
        text-align: center;
        margin-bottom: 20px;
      }

      .customify-header h3 {
        color: #000;
        margin-bottom: 8px;
        font-size: 1.4rem;
      }

      .customify-upload-area {
        border: 2px dashed #dee2e6;
        border-radius: 0;
        padding: 20px; /* Zmniejszony padding */
        text-align: center;
        margin-bottom: 15px; /* Zmniejszona przestrze≈Ñ na dole */
        cursor: pointer;
        transition: all 0.3s ease;
        background: white; /* Bia≈Çe t≈Ço */
      }

      .customify-upload-area:hover {
        border-color: #007bff;
        background-color: white;
      }

      .customify-upload-area.dragover {
        border-color: #007bff;
        background-color: white;
      }

      .customify-upload-text {
        font-size: 1.4rem;
        color: #333;
        margin-bottom: 8px;
        font-weight: 600;
        text-align: center;
      }

      .customify-file-input {
        display: none;
      }

      .customify-preview {
        display: none;
        margin-top: 20px;
        background: white;
        border-radius: 0;
        padding: 24px 0;
        box-shadow: none;
        border: none;
        border-top: 1px solid #e9ecef;
      }

      .customify-preview h4 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #000;
        margin: 0 0 20px 0;
        text-align: center;
      }

      .customify-preview img {
        max-width: 100% !important;
        max-height: 500px !important;
        width: auto !important;
        height: auto !important;
        object-fit: contain !important;
        border-radius: 0; /* Ostre kƒÖty */
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        margin: 0 auto;
        display: block;
        border: 3px solid white;
      }

      .customify-styles {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 20px;
      }

      .customify-style-btn {
        padding: 10px;
        border: 2px solid #dee2e6;
        border-radius: 0;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 0.9rem;
      }

      .customify-style-btn:hover {
        border-color: #e55a2b;
        background-color: #fff5f0;
      }

      .customify-style-btn.active {
        border-color: #ff6b35;
        background: white;
        color: #000;
      }

      .customify-size-selector {
        display: none;
        margin-bottom: 24px;
        background: white;
        border-radius: 0;
        padding: 20px 0;
        border: none;
        border-top: 1px solid #e9ecef;
      }

      .customify-size-selector h4 {
        font-size: 1.2rem;
        font-weight: 600;
        color: #000;
        margin: 0 0 16px 0;
        text-align: center;
      }

      .customify-size-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
      }

      .customify-size-btn {
        padding: 16px 12px;
        border: 2px solid #dee2e6;
        border-radius: 0;
        background: white;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 0.95rem;
        font-weight: 500;
        color: #333;
        box-shadow: none;
      }

      .customify-size-btn:hover {
        border-color: #e55a2b;
        background-color: #fff5f0;
        transform: none;
        box-shadow: none;
      }

      .customify-size-btn.active {
        border-color: #ff6b35;
        background: white;
        color: #000;
        transform: none;
        box-shadow: none;
      }

      .customify-actions {
        display: flex;
        gap: 16px;
        justify-content: center;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .customify-btn {
        padding: 16px 32px;
        border: 2px solid #000;
        border-radius: 0;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: all 0.2s ease;
        min-width: 160px;
        background: white;
        color: #000;
        text-transform: none;
        letter-spacing: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-family: inherit;
      }

      .customify-btn:hover {
        background: #000;
        color: white;
      }

      .customify-btn:active {
        transform: none;
      }

      .customify-btn-primary {
        background: #ff6b35;
        color: white;
        border: 2px solid #ff6b35;
      }

      .customify-btn-primary:hover {
        background: #e55a2b;
        border-color: #e55a2b;
        color: white;
      }

      .customify-btn-secondary {
        background: white;
        color: #000;
        border: 2px solid #000;
      }

      .customify-btn-secondary:hover {
        background: #000;
        color: white;
        border-color: #000;
      }

      .customify-loading {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .customify-spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #007bff;
        border-radius: 0;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .customify-result {
        margin-top: 20px;
        display: none;
        background: white;
        border-radius: 0;
        padding: 24px 0;
        box-shadow: none;
        border: none;
        border-top: 1px solid #e9ecef;
      }

      .customify-result h4 {
        font-size: 1.5rem;
        font-weight: 700;
        color: #000;
        margin: 0 0 20px 0;
        text-align: center;
      }

      .customify-result img {
        max-width: 100% !important;
        max-height: 500px !important;
        width: auto !important;
        height: auto !important;
        object-fit: contain !important;
        border-radius: 0; /* Ostre kƒÖty */
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        margin: 0 auto;
        display: block;
        border: 3px solid white;
      }

      .customify-error {
        background-color: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 0; /* Ostre kƒÖty */
        margin: 10px 0;
        display: none;
      }

      .customify-success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        padding: 16px 20px;
        border-radius: 0; /* Ostre kƒÖty */
        margin: 20px 0;
        display: none;
        border: 1px solid #c3e6cb;
        box-shadow: 0 4px 16px rgba(21, 87, 36, 0.1);
        font-weight: 500;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .customify-success::before {
        content: '‚úÖ';
        margin-right: 8px;
        font-size: 1.2rem;
      }

      @media (max-width: 768px) {
        /* Mobile: tylko Customify, nie dotykaj element√≥w produktu */
        #customify-app-container {
          width: 100% !important;
          float: none !important;
          margin-right: 0 !important;
        }
      }

    </style>
  </head>

  <body class="page-width-{{ settings.page_width }} card-hover-effect-{{ settings.card_hover_effect }}">
    {% render 'skip-to-content-link', href: '#MainContent', text: 'accessibility.skip_to_text' %}
    <!-- KOMPLETNY NAG≈Å√ìWEK CUSTOMIFY -->
    <header class="header-main">
      <div class="header-container">
        
        <!-- Logo -->
        <div class="header-logo">
          <a href="{{ routes.root_url }}" class="logo-link">
            {% if settings.logo != blank %}
              <img src="{{ settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" class="logo-image">
            {% else %}
              <span class="logo-text">{{ shop.name }}</span>
            {% endif %}
          </a>
    </div>

        <!-- Wyszukiwarka -->
        <div class="header-search">
          <form action="{{ routes.search_url }}" method="get" class="search-form">
            <div class="search-wrapper">
              <select name="type" class="search-categories">
                <option value="">Wszystkie kategorie</option>
                <option value="product">Produkty</option>
                <option value="article">Artyku≈Çy</option>
                <option value="page">Strony</option>
              </select>
              <input 
                type="search" 
                name="q" 
                placeholder="Szukaj..." 
                class="search-input"
                value="{{ search.terms | escape }}"
              >
              <button type="submit" class="search-button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M21 21L16.514 16.506M19 10.5C19 15.194 15.194 19 10.5 19S2 15.194 2 10.5 5.806 2 10.5 2 19 5.806 19 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
          </form>
        </div>

        <!-- Linki u≈ºytkownika -->
        <div class="header-user">
          {% if customer %}
            <a href="{{ routes.account_url }}" class="user-link">Moje konto</a>
            <a href="{{ routes.account_logout_url }}" class="user-link">Wyloguj siƒô</a>
          {% else %}
            <a href="{{ routes.account_login_url }}" class="user-link">Zaloguj siƒô</a>
            <a href="{{ routes.account_register_url }}" class="user-link">Zarejestruj siƒô</a>
          {% endif %}
        </div>

        <!-- Koszyk -->
        <div class="header-cart">
          <a href="{{ routes.cart_url }}" class="cart-link">
            <div class="cart-icon-wrapper">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="cart-icon">
                <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V17C17 18.1 16.1 19 15 19H9C7.9 19 7 18.1 7 17V13M17 13H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              {% if cart.item_count > 0 %}
                <span class="cart-count">{{ cart.item_count }}</span>
              {% endif %}
            </div>
            <span class="cart-text">Koszyk</span>
          </a>
        </div>

      </div>

      <!-- Menu g≈Ç√≥wne -->
      <nav class="header-nav">
        <div class="nav-container">
          {% for link in linklists.main-menu.links %}
            <div class="nav-item">
              <a href="{{ link.url }}" class="nav-link">
                {{ link.title }}
                {% if link.links.size > 0 %}
                  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" class="dropdown-arrow">
                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                {% endif %}
              </a>
              
              <!-- Dropdown menu -->
              {% if link.links.size > 0 %}
                <div class="nav-dropdown">
                  <div class="dropdown-content">
                    {% for child_link in link.links %}
                      <a href="{{ child_link.url }}" class="dropdown-link">
                        {{ child_link.title }}
                      </a>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </nav>

    </header>

    <!-- Breadcrumbs -->
    {% if template contains 'product' or template contains 'collection' or template contains 'blog' %}
      <div class="breadcrumbs">
        <div class="breadcrumbs-container">
          <a href="{{ routes.root_url }}" class="breadcrumb-link">Home</a>
          {% if template contains 'product' %}
            <span class="breadcrumb-separator">/</span>
            <a href="{{ routes.collections_url }}" class="breadcrumb-link">Personalizowane prezenty</a>
            <span class="breadcrumb-separator">/</span>
            <a href="{{ routes.collections_url }}" class="breadcrumb-link">Prezent dla Rodzic√≥w</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ product.title | truncate: 50 }}</span>
          {% elsif template contains 'collection' %}
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ collection.title }}</span>
          {% elsif template contains 'blog' %}
            <span class="breadcrumb-separator">/</span>
            <a href="{{ blog.url }}" class="breadcrumb-link">{{ blog.title }}</a>
            {% if article %}
              <span class="breadcrumb-separator">/</span>
              <span class="breadcrumb-current">{{ article.title | truncate: 30 }}</span>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endif %}

    <script
      src="{{ 'critical.js' | asset_url }}"
      type="module"
      async
      blocking="render"
    ></script>

    <main
      id="MainContent"
      class="content-for-layout"
      role="main"
      data-page-transition-enabled="{{ settings.page_transition_enabled }}"
      data-product-transition="{{ settings.transition_to_main_product }}"
      data-template="{{ template }}"
    >
      {{ content_for_layout }}
    </main>

    <!-- SEKCJA OPINII KLIENT√ìW - POWY≈ªEJ STOPKI -->
    <div class="customer-reviews-section">
      <div class="reviews-header">
        <h2 class="reviews-title">
          ‚≠ê Opinie klient√≥w
          <a href="#customer-reviews" class="reviews-link">Zobacz wszystkie opinie</a>
        </h2>
        <div class="stars-rating">
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span style="margin-left: 10px; color: #6c757d; font-weight: 600;">4.9/5 (127 opinii)</span>
        </div>
      </div>
      
      <div class="reviews-grid" id="customer-reviews">
        <!-- Przyk≈Çadowe opinie -->
        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Anna K.</div>
            <div class="review-date">15.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Niesamowite! Moje zdjƒôcie w stylu anime wyglƒÖda jak prawdziwe dzie≈Ço sztuki. Jako≈õƒá druku na p≈Ç√≥tnie jest doskona≈Ça, kolory sƒÖ ≈ºywe i wyra≈∫ne. Polecam ka≈ºdemu!"
          </div>
          <div class="review-style">Styl: Anime</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Marcin W.</div>
            <div class="review-date">12.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Zam√≥wi≈Çem portret w stylu Van Gogh dla ≈ºony na rocznicƒô. By≈Ça zachwycona! AI doskonale odtworzy≈Ço styl malarza. Szybka realizacja i ≈õwietna jako≈õƒá."
          </div>
          <div class="review-style">Styl: Van Gogh</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Katarzyna M.</div>
            <div class="review-date">10.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Cyberpunk style to by≈Ç strza≈Ç w dziesiƒÖtkƒô! Moje zdjƒôcie wyglƒÖda jak z filmu sci-fi. P≈Ç√≥tno jest wysokiej jako≈õci, a kolory sƒÖ niesamowicie intensywne."
          </div>
          <div class="review-style">Styl: Cyberpunk</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Piotr L.</div>
            <div class="review-date">08.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Akwarela wysz≈Ça przepiƒôknie! Delikatne kolory i miƒôkki styl idealnie pasujƒÖ do naszego salonu. ≈ªona ju≈º planuje kolejne zam√≥wienia."
          </div>
          <div class="review-style">Styl: Akwarela</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Magdalena S.</div>
            <div class="review-date">05.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Monet style to czysta magia! Moje zdjƒôcie wyglƒÖda jak impresjonistyczne dzie≈Ço sztuki. Jako≈õƒá wykonania i szybko≈õƒá realizacji na najwy≈ºszym poziomie."
          </div>
          <div class="review-style">Styl: Monet</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Tomasz K.</div>
            <div class="review-date">03.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Picasso style to prawdziwe dzie≈Ço sztuki! Abstrakcyjne formy i wyraziste kolory tworzƒÖ niesamowity efekt. Polecam ka≈ºdemu mi≈Ço≈õnikowi sztuki."
          </div>
          <div class="review-style">Styl: Picasso</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Agnieszka R.</div>
            <div class="review-date">01.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Renesans to absolutnie niesamowity styl! Moje zdjƒôcie wyglƒÖda jak prawdziwy portret z epoki renesansu. Dramatyczne ≈õwiat≈Ço i szczeg√≥≈Çy sƒÖ imponujƒÖce!"
          </div>
          <div class="review-style">Styl: Renesans</div>
        </div>
      </div>
    </div>

    {% sections 'footer-group' %}

    {% render 'search-modal' %}

    {% if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add-modal' %}
    {% endif %}

{% if template contains 'cart' %}
<!-- Customify AI - Wy≈õwietlanie miniaturek w koszyku -->
<style>
  .cart-item__ai-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 0;
    border: 2px solid #e0e0e0;
    margin-right: 15px;
  }
  
  .cart-item__content-wrapper {
    display: flex;
    gap: 15px;
    align-items: start;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Znajd≈∫ wszystkie elementy koszyka z AI obrazkami
  const cartItems = document.querySelectorAll('.cart-item, .cart-items__row');
  
  cartItems.forEach(item => {
    // Znajd≈∫ ukryte property z AI obrazkiem
    const aiImageProperty = item.querySelector('dd[data-property="_AI_Image_URL"], .cart-items__properties dd');
    
    if (aiImageProperty && aiImageProperty.textContent.includes('replicate.delivery')) {
      const imageUrl = aiImageProperty.textContent.trim();
      
      // Ukryj surowy URL
      const propertyDiv = aiImageProperty.closest('.cart-items__properties');
      if (propertyDiv) {
        propertyDiv.style.display = 'none';
      }
      
      // Dodaj miniaturkƒô
      const imageCell = item.querySelector('.cart-items__image, .cart-item__image-wrapper');
      if (imageCell && !imageCell.querySelector('.cart-item__ai-image')) {
        const aiImage = document.createElement('img');
        aiImage.src = imageUrl;
        aiImage.alt = 'AI Transformed Image';
        aiImage.className = 'cart-item__ai-image';
        aiImage.style.cssText = 'width: 80px; height: 80px; object-fit: cover; border-radius: 0; border: 2px solid #e0e0e0;';
        
        // Wstaw miniaturkƒô jako g≈Ç√≥wny obrazek lub obok
        const existingImage = imageCell.querySelector('img');
        if (existingImage) {
          existingImage.replaceWith(aiImage);
        } else {
          imageCell.appendChild(aiImage);
        }
      }
    }
  });
});
</script>
{% endif %}

{% if template contains 'product' %}
    <!-- Customify AI Photo Customization - CZYSTA WERSJA -->
<!-- Aplikacja bƒôdzie wstrzykiwana JavaScript do kolumny 2 -->
    <div id="customify-app-container" class="customify-shopify-container" style="display: none;">
      <h3 class="customify-title" style="margin: 30px 0px 20px 0px; padding: 0px 0px 0px 0px; background: white; color: #000; border: none; border-radius: 0; font-size: 1.4rem; font-weight: 600; text-align: left;">Dodaj zdjecie- wybierz styl- wybierz rozmiar - zamow</h3>
      <div class="customify-inline-wrapper">
        <div class="customify-embed" id="customifyEmbed">
          <div class="customify-upload-area" id="uploadArea">
            <div class="customify-upload-icon"></div>
            <div class="customify-upload-text">Wgraj swoje zdjƒôcie tutaj</div>
            <div class="customify-upload-hint">Maksymalnie 10MB, formaty: JPG, PNG, GIF</div>
            <input type="file" id="fileInput" class="customify-file-input" accept="image/*">
          </div>

          <div class="customify-preview" id="previewArea">
          <h4>Twoje zdjƒôcie:</h4>
            <img id="previewImage" alt="PodglƒÖd zdjƒôcia">
          </div>

          <div class="customify-styles" id="stylesArea" style="display: none;">
            <h4>Wybierz styl AI:</h4>
            <div class="customify-style-buttons">
              <div class="customify-style-btn" data-style="van gogh">Van Gogh (+50 z≈Ç)</div>
              <div class="customify-style-btn" data-style="picasso">Picasso (+75 z≈Ç)</div>
              <div class="customify-style-btn" data-style="monet">Monet (+60 z≈Ç)</div>
              <div class="customify-style-btn" data-style="anime">Anime (+40 z≈Ç)</div>
              <div class="customify-style-btn" data-style="cyberpunk">Cyberpunk (+80 z≈Ç)</div>
              <div class="customify-style-btn" data-style="watercolor">Akwarela (+45 z≈Ç)</div>
              <div class="customify-style-btn" data-style="pixar">Pixar (+85 z≈Ç)</div>
            </div>
          </div>


          <div class="customify-actions" id="actionsArea" style="display: none;">
            <button class="customify-btn customify-btn-primary" id="transformBtn">
              Przekszta≈Çƒá z AI
            </button>
            <button class="customify-btn customify-btn-secondary" id="resetBtn">
              Wgraj inne zdjƒôcie
            </button>
          </div>

          <div class="customify-loading" id="loadingArea">
            <div class="customify-spinner"></div>
            <div>Przetwarzanie z AI...</div>
          </div>

          <div class="customify-result" id="resultArea">
            <h4>Wynik transformacji AI:</h4>
            <img id="resultImage" alt="Wynik AI">
            
            <!-- Rozmiary pod zdjƒôciem wynikowym -->
            <div class="customify-size-selector" id="sizeArea" style="display: none;">
              <h4>Wybierz rozmiar:</h4>
              <div class="customify-size-buttons">
                <div class="customify-size-btn" data-size="small">Ma≈Çy (+0 z≈Ç)</div>
                <div class="customify-size-btn" data-size="medium">≈öredni (+25 z≈Ç)</div>
                <div class="customify-size-btn" data-size="large">Du≈ºy (+50 z≈Ç)</div>
                <div class="customify-size-btn" data-size="xlarge">Bardzo du≈ºy (+100 z≈Ç)</div>
              </div>
            </div>
            
            <div class="customify-actions" style="margin-top: 15px;">
              <button class="customify-btn customify-btn-primary" id="addToCartBtn">
                Dodaj do koszyka
              </button>
              <button class="customify-btn customify-btn-secondary" id="tryAgainBtn">
                Spr√≥buj ponownie
              </button>
            </div>
          </div>

          <div class="customify-error" id="errorMessage"></div>
          <div class="customify-success" id="successMessage"></div>
        </div>
      </div>
    </div>


    <script>
      // Customify JavaScript - Z MINIATURKƒÑ W KOSZYKU
      class CustomifyEmbed {
        constructor() {
          this.uploadArea = document.getElementById('uploadArea');
          this.fileInput = document.getElementById('fileInput');
          this.previewArea = document.getElementById('previewArea');
          this.previewImage = document.getElementById('previewImage');
          this.stylesArea = document.getElementById('stylesArea');
          this.sizeArea = document.getElementById('sizeArea');
          this.actionsArea = document.getElementById('actionsArea');
          this.loadingArea = document.getElementById('loadingArea');
          this.resultArea = document.getElementById('resultArea');
          this.resultImage = document.getElementById('resultImage');
          this.errorMessage = document.getElementById('errorMessage');
          this.successMessage = document.getElementById('successMessage');
          
          this.uploadedFile = null;
          this.selectedStyle = null;
          this.selectedSize = null;
          this.transformedImage = null;
          
          this.init();
        }

        init() {
          if (!document.getElementById('uploadArea')) {
            return; // Je≈õli nie ma element√≥w, nie r√≥b nic
          }
          this.setupEventListeners();
          this.positionApp();
        }

        // WSTRZYJ APLIKACJƒò DO KOLUMNY 2
        positionApp() {
          if (!window.location.pathname.includes('/products/')) {
            return;
          }

          const appContainer = document.getElementById('customify-app-container');
          if (!appContainer) return;

          // Znajd≈∫ kolumnƒô 2 (detale produktu)
          const productDetails = document.querySelector('#ProductInformation-template--26351135293765__main') || 
                                document.querySelector('.product-details') ||
                                document.querySelector('.product__info');

          if (productDetails) {
            console.log('üéØ [CUSTOMIFY] Found product details column, inserting app at top');
            
            // Dodaj elementy pod tytu≈Çem
            this.addProductBadges();
            
            // Poka≈º aplikacjƒô
            appContainer.style.display = 'block';
            
            // Wstaw na g√≥rƒô kolumny 2
            productDetails.insertBefore(appContainer, productDetails.firstChild);
          } else {
            console.warn('‚ö†Ô∏è [CUSTOMIFY] Could not find product details column');
          }
        }

        // DODAJ GWIAZDKI I OKAZJƒò POD TYTU≈ÅEM
        addProductBadges() {
          // Znajd≈∫ tytu≈Ç produktu
          const titleElement = document.querySelector('h1, .product-title, .view-product-title');
          if (!titleElement) return;

          // Sprawd≈∫ czy ju≈º nie ma badge'√≥w
          if (document.querySelector('.product-badges')) return;

          // Stw√≥rz kontener dla badge'√≥w
          const badgesContainer = document.createElement('div');
          badgesContainer.className = 'product-badges';

          // Dodaj badge z okazjƒÖ
          const discountBadge = document.createElement('div');
          discountBadge.className = 'discount-badge';
          discountBadge.textContent = 'Oszczƒôdzasz 30%';

          // Dodaj sekcjƒô z gwiazdkami
          const ratingSection = document.createElement('div');
          ratingSection.className = 'rating-section';

          const stars = document.createElement('div');
          stars.className = 'stars';
          for (let i = 0; i < 5; i++) {
            const star = document.createElement('span');
            star.className = 'star';
            star.innerHTML = '‚òÖ';
            stars.appendChild(star);
          }

          const reviewCount = document.createElement('span');
          reviewCount.className = 'review-count';
          reviewCount.textContent = '(43)';

          ratingSection.appendChild(stars);
          ratingSection.appendChild(reviewCount);

          // Dodaj do kontenera
          badgesContainer.appendChild(discountBadge);
          badgesContainer.appendChild(ratingSection);

          // Wstaw po tytule
          titleElement.parentNode.insertBefore(badgesContainer, titleElement.nextSibling);
        }

        setupEventListeners() {
          this.uploadArea.addEventListener('click', () => this.fileInput.click());
          this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e.target.files[0]));
          
          this.uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            this.uploadArea.classList.add('dragover');
          });
          
          this.uploadArea.addEventListener('dragleave', () => {
            this.uploadArea.classList.remove('dragover');
          });
          
          this.uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            this.uploadArea.classList.remove('dragover');
            this.handleFileSelect(e.dataTransfer.files[0]);
          });

          this.stylesArea.addEventListener('click', (e) => {
            if (e.target.classList.contains('customify-style-btn')) {
              this.selectStyle(e.target);
            }
          });

        // Event listener dla rozmiar√≥w - sprawd≈∫ zar√≥wno g≈Ç√≥wny jak i w resultArea
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('customify-size-btn')) {
              this.selectSize(e.target);
            }
          });

          document.getElementById('transformBtn').addEventListener('click', () => this.transformImage());
          document.getElementById('resetBtn').addEventListener('click', () => this.reset());
          document.getElementById('addToCartBtn').addEventListener('click', () => this.addToCart());
          document.getElementById('tryAgainBtn').addEventListener('click', () => this.tryAgain());
        }

        handleFileSelect(file) {
          if (!file) return;
          if (!file.type.startsWith('image/')) {
            this.showError('Proszƒô wybraƒá plik obrazu (JPG, PNG, GIF)');
            return;
          }
          if (file.size > 10 * 1024 * 1024) {
            this.showError('Plik jest za du≈ºy. Maksymalny rozmiar to 10MB');
            return;
          }

          this.uploadedFile = file;
          this.showPreview(file);
          this.showStyles();
          this.hideError();
        }

        showPreview(file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            this.previewImage.src = e.target.result;
            this.previewArea.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }

        showStyles() {
          this.stylesArea.style.display = 'block';
          this.sizeArea.style.display = 'none'; // Ukryj wymiary na poczƒÖtku
          this.actionsArea.style.display = 'flex';
        }

        selectStyle(styleBtn) {
          this.stylesArea.querySelectorAll('.customify-style-btn').forEach(btn => btn.classList.remove('active'));
          styleBtn.classList.add('active');
          this.selectedStyle = styleBtn.dataset.style;
        }

        selectSize(sizeBtn) {
          this.sizeArea.querySelectorAll('.customify-size-btn').forEach(btn => btn.classList.remove('active'));
          sizeBtn.classList.add('active');
          this.selectedSize = sizeBtn.dataset.size;
        }

        async transformImage() {
          if (!this.uploadedFile || !this.selectedStyle) {
            this.showError('Proszƒô wybraƒá zdjƒôcie i styl');
            return;
          }

          this.showLoading();
          this.hideError();

          try {
            const base64 = await this.fileToBase64(this.uploadedFile);
            const response = await fetch('https://customify-s56o.vercel.app/api/transform', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                imageData: base64,
                prompt: `Transform this image in ${this.selectedStyle} style`
              })
            });

            const result = await response.json();
            if (result.success) {
              this.transformedImage = result.transformedImage;
              this.showResult(result.transformedImage);
              this.showSuccess('Zdjƒôcie zosta≈Ço pomy≈õlnie przekszta≈Çcone!');
            } else {
              this.showError('B≈ÇƒÖd podczas transformacji: ' + (result.error || 'Nieznany b≈ÇƒÖd'));
            }
          } catch (error) {
            this.showError('B≈ÇƒÖd po≈ÇƒÖczenia z serwerem');
          } finally {
            this.hideLoading();
          }
        }

        showResult(imageUrl) {
          console.log('üéØ [CUSTOMIFY] showResult called, hiding actionsArea and stylesArea');
          this.resultImage.src = imageUrl;
          this.resultArea.style.display = 'block';
          
          // Poka≈º rozmiary pod zdjƒôciem wynikowym
          const sizeAreaInResult = this.resultArea.querySelector('#sizeArea');
          if (sizeAreaInResult) {
            sizeAreaInResult.style.display = 'block';
            console.log('üéØ [CUSTOMIFY] Size area shown under result image');
          }
          
          // UKRYJ przyciski "Przekszta≈Çƒá z AI" i "Resetuj" (g≈Ç√≥wne actionsArea)
          this.actionsArea.style.display = 'none';
          console.log('üéØ [CUSTOMIFY] actionsArea hidden:', this.actionsArea.style.display);
          
          // UKRYJ style po przekszta≈Çceniu
          this.stylesArea.style.display = 'none';
          console.log('üéØ [CUSTOMIFY] stylesArea hidden:', this.stylesArea.style.display);
          
          // UKRYJ pole upload po przekszta≈Çceniu
          this.uploadArea.style.display = 'none';
          console.log('üéØ [CUSTOMIFY] uploadArea hidden:', this.uploadArea.style.display);
        }


        // NAPRAWIONA FUNKCJA: STW√ìRZ NOWY PRODUKT Z OBRAZKIEM AI (UKRYTY W KATALOGU)
        async addToCart() {
          console.log('üõí [CUSTOMIFY] addToCart called with:', {
            transformedImage: !!this.transformedImage,
            selectedStyle: this.selectedStyle,
            selectedSize: this.selectedSize
          });
          
          if (!this.transformedImage) {
            this.showError('Brak przekszta≈Çconego obrazu');
            return;
          }
          
          if (!this.selectedStyle) {
            this.showError('Wybierz styl');
            return;
          }
          
          if (!this.selectedSize) {
            this.showError('Wybierz rozmiar');
            return;
          }

          this.hideError();
          console.log('üõí [CUSTOMIFY] Starting addToCart process...');

          try {
            const productData = {
              originalImage: await this.fileToBase64(this.uploadedFile),
              transformedImage: this.transformedImage,
              style: this.selectedStyle,
              size: this.selectedSize,
              originalProductTitle: document.querySelector('h1, .product-title, .view-product-title')?.textContent?.trim() || 'Produkt'
            };

            console.log('üõí [CUSTOMIFY] Creating product with data:', productData);
            
            // Stw√≥rz nowy produkt z obrazkiem AI jako g≈Ç√≥wnym obrazem
            const response = await fetch('https://customify-s56o.vercel.app/api/products', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(productData)
            });

            console.log('üõí [CUSTOMIFY] API response status:', response.status);
            const result = await response.json();
            console.log('üõí [CUSTOMIFY] API response:', result);

            if (result.success) {
              this.showSuccess('‚úÖ ' + (result.message || 'Produkt zosta≈Ç utworzony!'));
              console.log('‚úÖ [CUSTOMIFY] Product created:', result.product);
              
              // Obraz AI jest ju≈º g≈Ç√≥wnym obrazem produktu
              
              if (result.variantId) {
                console.log('üõí [CUSTOMIFY] Attempting to add to cart with Variant ID:', result.variantId);
                console.log('üõí [CUSTOMIFY] Product ID:', result.productId);
                console.log('üõí [CUSTOMIFY] Variant ID type:', typeof result.variantId);
                console.log('üõí [CUSTOMIFY] Variant ID length:', result.variantId.toString().length);
                
                // Create form and submit to add to cart
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/cart/add';
                form.style.display = 'none';
                
                // Add variant ID
                const variantInput = document.createElement('input');
                variantInput.type = 'hidden';
                variantInput.name = 'id';
                variantInput.value = result.variantId;
                form.appendChild(variantInput);
                
                console.log('üõí [CUSTOMIFY] Form variant ID:', result.variantId);
                console.log('üõí [CUSTOMIFY] Form action:', form.action);
                
                // Add quantity
                const quantityInput = document.createElement('input');
                quantityInput.type = 'hidden';
                quantityInput.name = 'quantity';
                quantityInput.value = '1';
                form.appendChild(quantityInput);
                
                // DODAJ W≈ÅA≈öCIWO≈öCI (obraz jest ju≈º g≈Ç√≥wnym obrazem produktu)
                const properties = {
                  'AI Style': this.selectedStyle,
                  'Size': this.selectedSize,
                  'Original Product': productData.originalProductTitle,
                  'Customization Type': 'AI Generated',
                  '_AI_Image_URL': result.imageUrl || this.transformedImage  // Prefix _ ukrywa przed klientem
                };
                
                Object.entries(properties).forEach(([key, value]) => {
                  const propInput = document.createElement('input');
                  propInput.type = 'hidden';
                  propInput.name = `properties[${key}]`;
                  propInput.value = value;
                  form.appendChild(propInput);
                });
                
                console.log('üõí [CUSTOMIFY] Submitting form with variantId:', result.variantId);
                document.body.appendChild(form);
                form.submit();
              }
            } else {
              console.error('‚ùå [CUSTOMIFY] Product creation failed:', result);
              this.showError('‚ùå B≈ÇƒÖd podczas tworzenia produktu: ' + (result.error || 'Nieznany b≈ÇƒÖd'));
            }
          } catch (error) {
            console.error('‚ùå [CUSTOMIFY] Add to cart error:', error);
            this.showError('‚ùå B≈ÇƒÖd po≈ÇƒÖczenia z serwerem: ' + error.message);
          }
        }

        fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
          });
        }

        reset() {
          this.uploadedFile = null;
          this.selectedStyle = null;
          this.selectedSize = null;
          this.transformedImage = null;
          
          this.fileInput.value = '';
          this.uploadArea.style.display = 'block'; // Poka≈º pole upload z powrotem
          this.previewArea.style.display = 'none';
          this.stylesArea.style.display = 'none';
          this.sizeArea.style.display = 'none';
          this.actionsArea.style.display = 'none';
          this.resultArea.style.display = 'none';
          this.hideError();
          this.hideSuccess();
          
          this.stylesArea.querySelectorAll('.customify-style-btn').forEach(btn => btn.classList.remove('active'));
          this.sizeArea.querySelectorAll('.customify-size-btn').forEach(btn => btn.classList.remove('active'));
        }

        tryAgain() {
          console.log('üîÑ [CUSTOMIFY] tryAgain called - returning to style selection');
          
          // Ukryj wynik AI
          this.resultArea.style.display = 'none';
          
          // Poka≈º style AI i przyciski
          this.stylesArea.style.display = 'block';
          this.actionsArea.style.display = 'flex';
          
          // Poka≈º pole upload (je≈õli by≈Ço ukryte)
          this.uploadArea.style.display = 'block';
          
          // Zresetuj wybrane style i rozmiary
          this.selectedStyle = null;
          this.selectedSize = null;
          this.transformedImage = null;
          
          // Usu≈Ñ aktywne style
          this.stylesArea.querySelectorAll('.customify-style-btn').forEach(btn => btn.classList.remove('active'));
          
          // Usu≈Ñ aktywne rozmiary
          this.sizeArea.querySelectorAll('.customify-size-btn').forEach(btn => btn.classList.remove('active'));
          
          // Ukryj wiadomo≈õci
          this.hideSuccess();
          this.hideError();
          
          console.log('üîÑ [CUSTOMIFY] tryAgain completed - user can select new style');
        }

        showLoading() {
          this.loadingArea.style.display = 'block';
          this.actionsArea.style.display = 'none';
        }

        hideLoading() {
          this.loadingArea.style.display = 'none';
          // NIE pokazuj actionsArea je≈õli mamy ju≈º wynik AI
          console.log('üéØ [CUSTOMIFY] hideLoading called, transformedImage:', !!this.transformedImage);
          if (!this.transformedImage) {
          this.actionsArea.style.display = 'flex';
            console.log('üéØ [CUSTOMIFY] actionsArea shown because no transformedImage');
          } else {
            console.log('üéØ [CUSTOMIFY] actionsArea NOT shown because transformedImage exists');
          }
        }

        showError(message) {
          this.errorMessage.textContent = message;
          this.errorMessage.style.display = 'block';
        }

        hideError() {
          this.errorMessage.style.display = 'none';
        }

        showSuccess(message) {
          this.successMessage.textContent = message;
          this.successMessage.style.display = 'block';
        }

        hideSuccess() {
          this.successMessage.style.display = 'none';
        }
      }

      // Initialize when DOM is loaded
      document.addEventListener('DOMContentLoaded', () => {
        new CustomifyEmbed();
      });
    </script>

    {% endif %}
  </body>
</html>

