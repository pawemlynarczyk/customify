<!-- Cache buster: 20250121180000 -->
<!doctype html>
<html
  class="no-js{% if request.design_mode %} shopify-design-mode{% endif %}"
  lang="{{ request.locale.iso_code }}"
>
  <head>
    {%- render 'stylesheets' -%}

    {%- if settings.favicon != blank -%}
      <link
        rel="icon"
        type="image/png"
        href="{{ settings.favicon | image_url: width: 32, height: 32 }}"
      >
    {%- endif -%}

    {% comment %} This a way to wait for main content to load when navigating to a new page so that the view transitions can work consistently {% endcomment %}
    <link
      rel="expect"
      href="#MainContent"
      blocking="render"
      id="view-transition-render-blocker"
    >

    {%- render 'meta-tags' -%}
    {%- render 'fonts' -%}
    {%- render 'scripts' -%}
    {%- render 'theme-styles-variables' -%}
    {%- render 'color-schemes' -%}

    {% if request.design_mode %}
      {%- render 'theme-editor' -%}
    {% endif %}

    <!-- Hotjar Tracking Code (Site ID: 6546658) -->
    <script>
      (function(h,o,t,j,a,r){
        if (h.hj) return;
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:6546658,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
    <!-- End Hotjar -->

    <!-- CUSTOMIFY INTEGRATION -->
    <link rel="stylesheet" href="{{ 'customify.css' | asset_url }}">
    
    <!-- FIX: Preload obrazk√≥w produktu - eliminuje skakanie -->
    {% if template contains 'product' %}
      {% if product.featured_image %}
        <link rel="preload" as="image" href="{{ product.featured_image | image_url: width: 800 }}">
      {% endif %}
      {% for media in product.media limit: 3 %}
        {% if media.media_type == 'image' %}
          <link rel="preload" as="image" href="{{ media | image_url: width: 800 }}">
        {% endif %}
      {% endfor %}
    {% endif %}
    
    
    <!-- Shopify Customer Info for Customify -->
    <script>
      {% if customer %}
        // METODA 1: Shopify Liquid (customer object detected)
        window.ShopifyCustomer = {
          loggedIn: true,
          id: {{ customer.id | json }},
          email: {{ customer.email | json }},
          firstName: {{ customer.first_name | json }},
          lastName: {{ customer.last_name | json }}
        };
        console.log('‚úÖ [CUSTOMIFY LIQUID] Zalogowany u≈ºytkownik:', window.ShopifyCustomer);
      {% else %}
        // U≈ºytkownik niezalogowany
        window.ShopifyCustomer = null;
        console.log('üë§ [CUSTOMIFY LIQUID] U≈ºytkownik niezalogowany');
      {% endif %}
    </script>
    
    <script src="{{ 'customify.js' | asset_url }}" defer></script>
    <script>
      (function() {
        function applyCustomifyCartOverride() {
          const instance = window.__customify;
          if (!instance) {
            return false;
          }

          const proto = Object.getPrototypeOf(instance);
          if (!proto) {
            return false;
          }

          if (proto.__customifyHiddenPropsPatched) {
            return true;
          }

          proto.__customifyHiddenPropsPatched = true;

          proto.updateCartNoteAttributes = async function(noteAttributes) {
            console.log('üìù [CUSTOMIFY] Pomijam /cart/update.js ‚Äì atrybuty lƒÖdujƒÖ jako ukryte properties:', noteAttributes);
            return noteAttributes || {};
          };

          /**
           * Pobiera bazowƒÖ cenƒô produktu z window.ShopifyProduct (niezmienione ≈∫r√≥d≈Ço)
           */
          proto.getBasePriceFromShopify = function() {
            if (window.ShopifyProduct && window.ShopifyProduct.variants && window.ShopifyProduct.variants.length > 0) {
              // variants[0].price jest w groszach, konwertuj na z≈Çot√≥wki
              const priceInGrosz = parseFloat(window.ShopifyProduct.variants[0].price);
              const priceInZl = priceInGrosz / 100;
              console.log(`üí∞ [BASE-PRICE] Pobrano z window.ShopifyProduct: ${priceInZl} z≈Ç (${priceInGrosz} groszy)`);
              return priceInZl;
            }
            console.warn('‚ö†Ô∏è [BASE-PRICE] window.ShopifyProduct.variants nie dostƒôpne, u≈ºywam fallback');
            return null;
          };

          // üö® ROLLBACK: START - Nadpisanie updateProductPrice() dla produktu cyfrowego
          proto.updateProductPrice = function() {
            try {
              const isDigitalProduct = this.selectedProductType === 'digital';
              
              // Dla produktu cyfrowego: ZAWSZE 69 z≈Ç, NIE sumuj z cenƒÖ bazowƒÖ
              if (isDigitalProduct) {
                const digitalProductPrice = 69.00; // üö® ROLLBACK: Sta≈Ça cena produktu cyfrowego
                this.applyProductPriceDisplay(digitalProductPrice);
                this.schedulePriceConsistency(digitalProductPrice);
                console.log('üí∞ [PRICE] Digital product - fixed price: 69.00 z≈Ç (ignoring base price)');
                return;
              }
              
              // Dla produkt√≥w fizycznych: u≈ºyj oryginalnej logiki
              const priceElement = this.getPriceElement();
              if (!priceElement) {
                console.warn('‚ö†Ô∏è [PRICE] Price element not found with any selector');
                return;
              }

              console.log('‚úÖ [PRICE] Found price element:', priceElement, 'Text:', priceElement.textContent);

              // Pobierz oryginalnƒÖ bazowƒÖ cenƒô (zapamiƒôtaj przy pierwszym wywo≈Çaniu)
              if (!this.originalBasePrice) {
                // ‚úÖ U≈ºyj window.ShopifyProduct (niezmienione ≈∫r√≥d≈Ço) zamiast DOM
                this.originalBasePrice = this.getBasePriceFromShopify();
                
                if (this.originalBasePrice === null) {
                  // Fallback: spr√≥buj z DOM je≈õli window.ShopifyProduct nie dostƒôpne
                  const basePriceText = priceElement.textContent;
                  this.originalBasePrice = this.extractBasePrice(basePriceText);
                  
                  if (this.originalBasePrice === null) {
                    console.warn('‚ö†Ô∏è [PRICE] Could not get base price from Shopify or DOM, using fallback');
                    this.originalBasePrice = 49.00;
                    console.log(`üí∞ [PRICE] Using fallback base price: ${this.originalBasePrice} z≈Ç`);
                  } else {
                    console.log(`üí∞ [PRICE] Base price from DOM (fallback): ${this.originalBasePrice} z≈Ç`);
                  }
                } else {
                  console.log(`üí∞ [PRICE] Original base price saved: ${this.originalBasePrice} z≈Ç`);
                }
              }

              // Pobierz cenƒô rozmiaru
              const sizePrice = this.getSizePrice(this.selectedSize);
              
              // Dop≈Çata za ramkƒô (tylko plakat i wybrany kolor != none)
              const frameSelected = (this.selectedProductType === 'plakat') && (window.CustomifyFrame && window.CustomifyFrame.color && window.CustomifyFrame.color !== 'none');
              const frameSurcharge = frameSelected && this.selectedSize ? (this.framePricing[this.selectedSize] || 29) : 0;
              
              // Oblicz ko≈ÑcowƒÖ cenƒô (oryginalna cena + rozmiar + ramka)
              const finalPrice = this.originalBasePrice + sizePrice + frameSurcharge;
              
              // Aktualizuj cenƒô na stronie
              this.applyProductPriceDisplay(finalPrice);
              this.schedulePriceConsistency(finalPrice);
              
              console.log(`üí∞ [PRICE] Updated: base ${this.originalBasePrice} + size ${sizePrice} + frame ${frameSurcharge} = ${finalPrice} z≈Ç`);
            } catch (error) {
              console.error('‚ùå [PRICE] Error updating product price:', error);
            }
          };
          // üö® ROLLBACK: END - Nadpisanie updateProductPrice()

          // üö® ROLLBACK: START - Nadpisanie updateCartPrice() dla produktu cyfrowego
          proto.updateCartPrice = function() {
            try {
              const isDigitalProduct = this.selectedProductType === 'digital';
              
              // Dla produktu cyfrowego: ZAWSZE 69 z≈Ç, NIE sumuj z cenƒÖ bazowƒÖ
              if (isDigitalProduct) {
                const digitalProductPrice = 69.00; // üö® ROLLBACK: Sta≈Ça cena produktu cyfrowego
                const cartPriceElement = document.getElementById('cartPriceValue');
                
                if (cartPriceElement) {
                  cartPriceElement.textContent = `${digitalProductPrice.toFixed(2)} z≈Ç`;
                  console.log('‚úÖ [CART-PRICE] Digital product - fixed price: 69.00 z≈Ç (ignoring base price)');
                  this.showCartPrice();
                } else {
                  console.warn('‚ö†Ô∏è [CART-PRICE] Cart price element not found');
                }
                return;
              }
              
              // Dla produkt√≥w fizycznych: u≈ºyj oryginalnej logiki
              // Sprawd≈∫ czy mamy wybrany rozmiar
              if (!this.selectedSize) {
                console.log('üîç [CART-PRICE] No selectedSize, hiding cart price');
                this.hideCartPrice();
                return;
              }

              // Pobierz oryginalnƒÖ bazowƒÖ cenƒô
              if (!this.originalBasePrice) {
                this.originalBasePrice = 49.00; // Fallback
                console.log(`üí∞ [CART-PRICE] Using fallback base price: ${this.originalBasePrice} z≈Ç`);
              }

              // Pobierz cenƒô rozmiaru
              const sizePrice = this.getSizePrice(this.selectedSize);
              
              // Dop≈Çata za ramkƒô (tylko plakat i wybrany kolor != none)
              const frameSelected = (this.selectedProductType === 'plakat') && (window.CustomifyFrame && window.CustomifyFrame.color && window.CustomifyFrame.color !== 'none');
              const frameSurcharge = frameSelected && this.selectedSize ? (this.framePricing[this.selectedSize] || 29) : 0;
              
              // Oblicz ko≈ÑcowƒÖ cenƒô (bazowa + rozmiar + ramka)
              const finalPrice = this.originalBasePrice + sizePrice + frameSurcharge;

              // Znajd≈∫ element ceny w koszyku
              const cartPriceElement = document.getElementById('cartPriceValue');

              if (cartPriceElement) {
                cartPriceElement.textContent = `${finalPrice.toFixed(2)} z≈Ç`;
                console.log('‚úÖ [CART-PRICE] Cart price updated:', finalPrice.toFixed(2), 'z≈Ç');
                console.log('üñºÔ∏è [FRAME] Cart price components:', {
                  base: this.originalBasePrice,
                  sizePrice,
                  frameSelected,
                  frame: window.CustomifyFrame?.color || 'none',
                  frameSurcharge
                });

                // Poka≈º element ceny
                this.showCartPrice();
              } else {
                console.warn('‚ö†Ô∏è [CART-PRICE] Cart price element not found');
              }
            } catch (error) {
              console.error('‚ùå [CART-PRICE] Error updating cart price:', error);
            }
          };
          // üö® ROLLBACK: END - Nadpisanie updateCartPrice()

          // üö® ROLLBACK: START - Nadpisanie showResult() dla produktu cyfrowego (ukryj rozmiary)
          proto.showResult = async function(imageUrl) {
            console.log('üéØ [CUSTOMIFY] showResult called, hiding actionsArea and stylesArea');
            
            const isDigitalProduct = this.selectedProductType === 'digital';
            
            // ‚úÖ ZABEZPIECZENIE: Sprawd≈∫ czy resultImage istnieje, je≈õli nie - znajd≈∫ ponownie
            if (!this.resultImage) {
              console.warn('‚ö†Ô∏è [CUSTOMIFY] resultImage not found, searching again...');
              this.resultImage = document.getElementById('resultImage');
              if (!this.resultImage) {
                console.error('‚ùå [CUSTOMIFY] resultImage element not found in DOM!');
                return; // Nie kontynuuj je≈õli element nie istnieje
              }
            }
            
            // WATERMARK W≈ÅƒÑCZONY
            try {
              const watermarkedImage = await this.addWatermark(imageUrl);
              if (this.resultImage) {
                this.resultImage.src = watermarkedImage;
              }
              
              // ‚úÖ ZAPISZ OBRAZEK Z WATERMARKIEM (do u≈ºycia w koszyku)
              this.watermarkedImage = watermarkedImage;
              console.log('üé® [CUSTOMIFY] Watermark dodany do podglƒÖdu i zapisany');
            } catch (error) {
              console.error('‚ùå [CUSTOMIFY] Watermark error:', error);
              if (this.resultImage) {
                this.resultImage.src = imageUrl;
              }
              this.watermarkedImage = null;
            }
            
            this.resultArea.style.display = 'block';
            
            // üö® ROLLBACK: START - Ukryj rozmiary dla produktu cyfrowego
            if (isDigitalProduct) {
              this.sizeArea.style.display = 'none';
              console.log('üì¶ [DIGITAL] Size area hidden in showResult() for digital product');
            } else {
              this.sizeArea.style.display = 'block';
              console.log('üéØ [CUSTOMIFY] Size area visible on top (outside resultArea)');
            }
            // üö® ROLLBACK: END - Ukryj rozmiary dla produktu cyfrowego
            
            // UKRYJ przyciski "Przekszta≈Çƒá z AI" i "Resetuj" (g≈Ç√≥wne actionsArea)
            this.actionsArea.style.display = 'none';
            console.log('üéØ [CUSTOMIFY] actionsArea hidden:', this.actionsArea.style.display);
            
            // UKRYJ style po przekszta≈Çceniu
            this.stylesArea.style.display = 'none';
            console.log('üéØ [CUSTOMIFY] stylesArea hidden:', this.stylesArea.style.display);
            
            // Zmie≈Ñ kolory przycisk√≥w po wygenerowaniu AI
            this.swapButtonColors();
            
            // UKRYJ pole upload po przekszta≈Çceniu
            this.uploadArea.style.display = 'none';
            console.log('üéØ [CUSTOMIFY] uploadArea hidden:', this.uploadArea.style.display);
            
            // ‚úÖ POKA≈ª CENƒò NAD PRZYCISKIEM po wygenerowaniu AI
            this.updateCartPrice();
          };
          // üö® ROLLBACK: END - Nadpisanie showResult()

          proto.addToCart = async function() {
            console.log('üõí [CUSTOMIFY] addToCart called with:', {
              transformedImage: !!this.transformedImage,
              selectedStyle: this.selectedStyle,
              selectedSize: this.selectedSize,
              selectedProductType: this.selectedProductType
            });

            // üö® ROLLBACK: START - Pomijaj rozmiar dla produktu cyfrowego
            const isDigitalProduct = this.selectedProductType === 'digital';
            
            if (!isDigitalProduct) {
              console.log('üîç [CUSTOMIFY] Checking selectedSize:', this.selectedSize);
              if (!this.selectedSize) {
                console.log('‚ùå [CUSTOMIFY] No selectedSize, showing error');
                this.showError('Nie wybra≈Çe≈õ rozmiaru');
                return;
              }
              console.log('‚úÖ [CUSTOMIFY] selectedSize OK, proceeding with price calculation');
            } else {
              console.log('‚úÖ [CUSTOMIFY] Digital product - skipping size requirement');
            }
            // üö® ROLLBACK: END - Pomijaj rozmiar dla produktu cyfrowego

            // üö® ROLLBACK: START - Cena dla produktu cyfrowego (STA≈ÅA 69 z≈Ç, NIE sumuje siƒô z cenƒÖ bazowƒÖ)
            const isDigitalProductForPrice = this.selectedProductType === 'digital';
            const digitalProductPrice = 69.00; // üö® ROLLBACK: Sta≈Ça cena produktu cyfrowego
            
            let finalPrice;
            if (isDigitalProductForPrice) {
              // Produkt cyfrowy: ZAWSZE 69 z≈Ç, NIE zale≈ºy od ceny bazowej produktu
              finalPrice = digitalProductPrice;
              console.log('üí∞ [CUSTOMIFY] Digital product - using fixed price: 69.00 z≈Ç (ignoring base price)');
            } else {
              // Produkt fizyczny: cena bazowa + rozmiar + ramka
              const basePrice = this.originalBasePrice || 49.00;
              const sizePrice = this.getSizePrice(this.selectedSize);
              const frameSelected = (this.selectedProductType === 'plakat') && (window.CustomifyFrame && window.CustomifyFrame.color && window.CustomifyFrame.color !== 'none');
              console.log('üîç [CUSTOMIFY] Frame debug:', { 
                frameSelected, 
                selectedSize: this.selectedSize, 
                framePricing: this.framePricing,
                framePricingValue: this.framePricing?.[this.selectedSize]
              });
              const frameSurcharge = frameSelected && this.selectedSize ? (this.framePricing?.[this.selectedSize] || 29) : 0;
              finalPrice = basePrice + sizePrice + frameSurcharge;
              console.log('üí∞ [CUSTOMIFY] Physical product - price calculation:', { basePrice, sizePrice, frameSurcharge, finalPrice });
            }
            // üö® ROLLBACK: END - Cena dla produktu cyfrowego

            console.log('üí∞ [CUSTOMIFY] Price calculation:', {
              isDigitalProduct: isDigitalProductForPrice,
              originalBasePrice: this.originalBasePrice,
              finalPrice: finalPrice,
              size: this.selectedSize,
              productType: this.selectedProductType
            });

            if (!this.transformedImage) {
              this.showError('Brak przekszta≈Çconego obrazu');
              return;
            }

            if (!this.selectedStyle) {
              this.showError('Wybierz styl');
              return;
            }

            console.log('üõí [CUSTOMIFY] Starting addToCart process...');
            this.hideError();
            this.showCartLoading();

            try {
              const productId =
                document.querySelector('[data-product-id]')?.getAttribute('data-product-id') ||
                document.querySelector('form[action*="/cart/add"] input[name="id"]')?.value ||
                window.ShopifyAnalytics?.meta?.product?.id ||
                null;

              console.log('üÜî [CUSTOMIFY] Original product ID:', productId);

              if (!finalPrice || finalPrice <= 0) {
                console.error('‚ùå [CUSTOMIFY] Invalid finalPrice:', finalPrice);
                this.showError('B≈ÇƒÖd obliczania ceny. Spr√≥buj ponownie.');
                return;
              }

              let originalImage;
              if (this.uploadedFile) {
                originalImage = await this.fileToBase64(this.uploadedFile);
              } else if (this.originalImageFromGallery) {
                originalImage = this.originalImageFromGallery;
              } else {
                originalImage = this.transformedImage;
                console.warn('‚ö†Ô∏è [CUSTOMIFY] No original image available, using transformed image as fallback');
              }

              let watermarkedImageUrl = null;
              if (this.watermarkedImage) {
                console.log('üì§ [CUSTOMIFY] Uploading watermarked image to Vercel Blob...');
                try {
                  const watermarkUploadResponse = await fetch('https://customify-s56o.vercel.app/api/upload-temp-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      imageData: this.watermarkedImage,
                      filename: `watermarked-${Date.now()}.jpg`
                    })
                  });

                  console.log('üì§ [CUSTOMIFY] Upload response status:', watermarkUploadResponse.status);
                  const watermarkUploadResult = await watermarkUploadResponse.json();
                  console.log('üì§ [CUSTOMIFY] Upload result:', watermarkUploadResult);

                  if (watermarkUploadResult.success) {
                    watermarkedImageUrl = watermarkUploadResult.url;
                    console.log('‚úÖ [CUSTOMIFY] Watermarked image uploaded:', watermarkedImageUrl);
                    console.log('‚úÖ [CUSTOMIFY] URL length:', watermarkedImageUrl.length);
                  } else {
                    console.error('‚ùå [CUSTOMIFY] Failed to upload watermarked image:', watermarkUploadResult.error);
                  }
                } catch (error) {
                  console.error('‚ùå [CUSTOMIFY] Error uploading watermarked image:', error);
                }
              } else {
                console.warn('‚ö†Ô∏è [CUSTOMIFY] No watermarked image available - this.watermarkedImage is null/undefined');
              }

              const productData = {
                originalImage: originalImage,
                transformedImage: this.transformedImage,
                watermarkedImage: watermarkedImageUrl,
                style: this.selectedStyle,
                size: isDigitalProduct ? 'digital' : this.selectedSize, // üö® ROLLBACK: Dla produktu cyfrowego u≈ºyj 'digital'
                productType: this.selectedProductType || 'canvas',
                originalProductTitle: document.querySelector('h1, .product-title, .view-product-title')?.textContent?.trim() || 'Produkt',
                originalProductId: productId,
                finalPrice: finalPrice
              };

              console.log('üõí [CUSTOMIFY] Creating product with data:', productData);
              console.log('üõí [CUSTOMIFY] transformedImage type:', typeof this.transformedImage);
              console.log('üõí [CUSTOMIFY] transformedImage length:', this.transformedImage?.length);
              console.log('üõí [CUSTOMIFY] transformedImage is base64?', this.transformedImage?.startsWith('data:'));
              console.log('üõí [CUSTOMIFY] transformedImage is URL?', this.transformedImage?.startsWith('http'));
              console.log('üõí [CUSTOMIFY] transformedImage preview:', this.transformedImage?.substring(0, 200));

              const response = await fetch('https://customify-s56o.vercel.app/api/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(productData)
              });

              console.log('üõí [CUSTOMIFY] API response status:', response.status);
              const result = await response.json();
              console.log('üõí [CUSTOMIFY] API response:', result);

              if (result.success) {
                this.showSuccess('‚úÖ ' + (result.message || 'Produkt zosta≈Ç utworzony!'));
                console.log('‚úÖ [CUSTOMIFY] Product created:', result.product);

                if (result.variantId) {
                  console.log('üõí [CUSTOMIFY] Attempting to add to cart with Variant ID:', result.variantId);
                  console.log('üõí [CUSTOMIFY] Product ID:', result.productId);
                  console.log('üõí [CUSTOMIFY] Variant ID type:', typeof result.variantId);
                  console.log('üõí [CUSTOMIFY] Variant ID length:', result.variantId.toString().length);

                  // üö® ROLLBACK: START - Nazwa typu produktu z obs≈ÇugƒÖ cyfrowego
                  const productTypeName = this.selectedProductType === 'plakat' 
                    ? 'Plakat' 
                    : this.selectedProductType === 'digital'
                      ? 'Produkt cyfrowy'
                      : 'Obraz na p≈Ç√≥tnie';
                  // üö® ROLLBACK: END - Nazwa typu produktu
                  const selectedFrame = (this.selectedProductType === 'plakat' && window.CustomifyFrame && window.CustomifyFrame.color)
                    ? window.CustomifyFrame.color
                    : 'none';
                  const frameLabelMap = { none: 'brak', black: 'czarna', white: 'bia≈Ça', wood: 'drewno' };
                  const frameLabel = frameLabelMap[selectedFrame] || 'brak';

                  console.log('üñºÔ∏è [CUSTOMIFY FRAME DEBUG]:', {
                    selectedProductType: this.selectedProductType,
                    'window.CustomifyFrame': window.CustomifyFrame,
                    selectedFrame: selectedFrame,
                    frameLabel: frameLabel
                  });

                  const shortOrderId = result.shortOrderId || (result.orderId ? result.orderId.split('-').pop() : Date.now().toString());

                  // üö® ROLLBACK: START - Properties dla produktu cyfrowego
                  const visibleProperties = {
                    'Rozmiar': isDigitalProduct ? 'Plik do pobrania' : this.getSizeDimension(this.selectedSize),
                    'Rodzaj wydruku': productTypeName,
                    'Ramka': isDigitalProduct ? 'brak' : `ramka - ${frameLabel}`,
                    'Order ID': shortOrderId
                  };
                  // üö® ROLLBACK: END - Properties dla produktu cyfrowego

                  const hiddenProperties = {
                    'Styl AI': this.selectedStyle  // ‚úÖ Ukryty - tylko dla admina, nie pokazywany w koszyku
                  };

                  if (result.orderId) {
                    hiddenProperties['_Order ID Full'] = result.orderId;
                  }
                  if (result.vercelBlobUrl) {
                    hiddenProperties['_AI_Image_Vercel'] = result.vercelBlobUrl;
                  } else if (result.permanentImageUrl) {
                    hiddenProperties['_AI_Image_Vercel'] = result.permanentImageUrl;
                  }
                  if (watermarkedImageUrl) {
                    hiddenProperties['_AI_Image_Watermarked'] = watermarkedImageUrl;
                  }

                  const cartProperties = Object.assign({}, visibleProperties, hiddenProperties);

                  console.log('üõí [CUSTOMIFY CART PROPERTIES VISIBLE]:', visibleProperties);
                  console.log('üîí [CUSTOMIFY CART PROPERTIES HIDDEN]:', hiddenProperties);

                  const params = new URLSearchParams();
                  params.append('id', result.variantId);
                  params.append('quantity', '1');

                  Object.entries(cartProperties).forEach(([key, value]) => {
                    if (value != null) {
                      params.append(`properties[${key}]`, value);
                    }
                  });

                  const cartUrl = `/cart/add?${params.toString()}`;
                  const fullUrl = window.location.origin + cartUrl;
                  console.log('üõí [CUSTOMIFY] Cart URL length:', cartUrl.length, 'chars');
                  console.log('üõí [CUSTOMIFY] Cart URL:', cartUrl.substring(0, 200), '...');
                  console.log('üõí [CUSTOMIFY] Full URL length:', fullUrl.length, 'chars');

                  if (fullUrl.length > 2048) {
                    console.error('‚ùå [CUSTOMIFY] URL TOO LONG:', fullUrl.length, 'chars (max 2048)');
                    console.error('‚ùå [CUSTOMIFY] Properties:', cartProperties);
                    this.hideCartLoading();
                    this.showError('URL zbyt d≈Çugi - usu≈Ñ niekt√≥re w≈Ça≈õciwo≈õci lub skontaktuj siƒô z supportem');
                    return;
                  }

                  console.log('‚úÖ [CUSTOMIFY] Adding to cart via direct navigation');
                  this.hideCartLoading();
                  window.location.href = cartUrl;
                }
              } else {
                console.error('‚ùå [CUSTOMIFY] Product creation failed:', result);
                this.hideCartLoading();
                this.showError('‚ùå B≈ÇƒÖd podczas tworzenia produktu: ' + (result.error || 'Nieznany b≈ÇƒÖd'));
              }
            } catch (error) {
              console.error('‚ùå [CUSTOMIFY] Add to cart error:', error);
              this.hideCartLoading();

              let errorMessage = '‚ùå B≈ÇƒÖd po≈ÇƒÖczenia z serwerem';

              if (error.name === 'AbortError') {
                errorMessage = '‚ùå Przekroczono limit czasu. Spr√≥buj ponownie.';
              } else if (error.message.includes('Failed to fetch')) {
                errorMessage = '‚ùå B≈ÇƒÖd sieci. Sprawd≈∫ po≈ÇƒÖczenie internetowe.';
              } else if (error.message.includes('NetworkError')) {
                errorMessage = '‚ùå B≈ÇƒÖd sieci. Spr√≥buj ponownie za chwilƒô.';
              } else {
                errorMessage = '‚ùå B≈ÇƒÖd: ' + error.message;
              }

              this.showError(errorMessage);
            }
          };

          return true;
        }

        function initOverride() {
          if (!applyCustomifyCartOverride()) {
            setTimeout(initOverride, 50);
          }
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initOverride);
        } else {
          initOverride();
        }
      })();
    </script>
  
        <!-- ‚úÖ JAVASCRIPT: Ukryj produkty AI na stronach kolekcji i rekomendacji -->
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            // Ukryj produkty z "rozmiar" w URL (kolekcje)
            const rozmiarProducts = document.querySelectorAll('.custom-collection-card[href*="rozmiar"]');
            rozmiarProducts.forEach(product => {
              product.style.display = 'none';
            });
            
            // Ukryj produkty z "cyfrowy" w URL (kolekcje)
            const cyfrowyProducts = document.querySelectorAll('.custom-collection-card[href*="cyfrowy"]');
            cyfrowyProducts.forEach(product => {
              product.style.display = 'none';
            });
            
            const recommendationsRozmiar = document.querySelectorAll('.product-recommendations a[href*="rozmiar"]');
            recommendationsRozmiar.forEach(product => {
              product.style.display = 'none';
            });
            
            // Ukryj produkty z "cyfrowy" w rekomendacjach
            const recommendationsCyfrowy = document.querySelectorAll('.product-recommendations a[href*="cyfrowy"]');
            recommendationsCyfrowy.forEach(product => {
              product.style.display = 'none';
            });
            
            const totalHidden = rozmiarProducts.length + cyfrowyProducts.length + recommendationsRozmiar.length + recommendationsCyfrowy.length;
            console.log('üîí [PRODUCT HIDING] Ukryto', totalHidden, 'produkt√≥w AI (kolekcje + rekomendacje)');
            
            // ‚úÖ NOWE: Dla produktu akwarela (ID: 15475649675589 lub handle zawiera 'akwarela') - ukryj wszystkie style opr√≥cz akwareli
            if (window.ShopifyProduct && (window.ShopifyProduct.id === 15475649675589 || window.ShopifyProduct.id === '15475649675589' || (window.ShopifyProduct.handle && window.ShopifyProduct.handle.includes('akwarela')) || window.location.pathname.includes('akwarela'))) {
              console.log('üé® [WATERCOLOR] Produkt akwarela wykryty (ID:', window.ShopifyProduct.id, 'handle:', window.ShopifyProduct.handle, ') - ukrywanie wszystkich styl√≥w opr√≥cz akwareli');
              const allStyleCards = document.querySelectorAll('.customify-style-card');
              allStyleCards.forEach(card => {
                const styleName = card.getAttribute('data-style');
                if (styleName && styleName !== 'akwarela') {
                  card.style.display = 'none';
                  console.log('üîí [WATERCOLOR] Ukryto styl:', styleName);
                } else if (styleName === 'akwarela') {
                  console.log('‚úÖ [WATERCOLOR] Pozostawiono styl akwareli widoczny');
                }
              });
            }
          });
        </script>
    
    <!-- FIX: CSS dla galerii - TYLKO JEDEN MIEJSCE -->
    <style>
      /* TYLKO JEDEN MIEJSCE - bez duplikat√≥w */
      .media-gallery__grid {
        grid-template-rows: 400px 120px !important;
        grid-template-columns: 120px 120px !important;
        height: 524px !important;
      }
      
      /* OGRANICZ ROZMIAR MODALA ZDJƒòƒÜ */
      .product-media-container__zoom-button {
        /* Usu≈Ñ full screen - poka≈º mniejszy modal */
      }
      
      /* Modal z ograniczonym rozmiarem */
      .media-gallery__modal,
      .product-media-modal,
      [data-modal],
      .modal {
        max-width: 80vw !important;
        max-height: 80vh !important;
        width: auto !important;
        height: auto !important;
        margin: auto !important;
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        z-index: 9999 !important;
        background: white !important;
        border-radius: 8px !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
        overflow: hidden !important;
      }
      
      /* Obraz w modalu - WYPE≈ÅNIA CA≈ÅY KONTENER BEZ BIA≈ÅYCH P√ìL */
      .media-gallery__modal img,
      .product-media-modal img,
      [data-modal] img,
      .modal img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        object-position: center !important;
      }
      
      /* FIX: Zdjƒôcia w galerii - WYPE≈ÅNIAJƒÑ CA≈ÅY KONTENER */
      .product-media__image {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        object-position: center !important;
        max-height: none !important;
      }
      
      /* FIX: Kontener zdjƒôcia */
      .product-media {
        width: 100% !important;
        height: 100% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }
      
      /* Overlay */
      .media-gallery__overlay,
      .product-media-overlay,
      [data-overlay],
      .modal-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        background: rgba(0,0,0,0.8) !important;
        z-index: 9998 !important;
      }
      
      /* OGRANICZ SZEROKO≈öƒÜ TYLKO STRON PRODUKT√ìW - DESKTOP ONLY */
      @media (min-width: 769px) {
        .product-information__grid {
          max-width: 1400px !important;
          margin: 0 auto !important;
          padding: 0 20px !important;
          /* FIX: Stabilny grid layout - eliminuje skakanie */
          display: grid !important;
          grid-template-columns: 35% 65% !important; /* Obrazek 35%, Aplikacja 65% */
          gap: 24px !important;
          align-items: start !important;
          width: 100% !important;
          background: #f3f5f6 !important; /* SZARE T≈ÅO dla grid */
          padding: 20px !important;
          border-radius: 0 !important;
          min-height: 600px !important; /* Stabilna wysoko≈õƒá */
        }
      }
      
      /* FIX: Stabilne wymiary dla kontener√≥w - DESKTOP ONLY */
      @media (min-width: 769px) {
        .product-information__media {
          grid-column: 1 !important;
          width: 100% !important;
          min-height: 500px !important; /* Stabilna wysoko≈õƒá zdjƒôƒá */
          box-sizing: border-box !important;
          background: white !important;
          padding: 20px !important;
          border-radius: 0 !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
        
        .product-details {
          grid-column: 2 !important;
          min-height: 500px !important; /* Stabilna wysoko≈õƒá aplikacji */
          background: white !important;
          padding: 20px !important;
          border-radius: 0 !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
      }
      
      /* MOBILE: Elastyczne wymiary */
      @media (max-width: 768px) {
        .product-information__media,
        .product-details {
          grid-column: 1 !important;
          width: 100% !important;
          min-height: auto !important; /* Elastyczna wysoko≈õƒá na mobile */
          box-sizing: border-box !important;
          background: white !important;
          padding: 15px !important;
          border-radius: 0 !important;
          box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
          margin-bottom: 15px !important;
        }
      }
      
      /* FIX: Stabilne wymiary dla zdjƒôƒá produktu - DESKTOP ONLY */
      @media (min-width: 769px) {
        .product__media img,
        .product__media .product__media-item img,
        .media-gallery__image img {
          width: 100% !important;
          height: 100% !important;
          min-height: 400px !important; /* Stabilna wysoko≈õƒá obrazk√≥w */
          object-fit: cover !important;
          object-position: center !important;
          background: #f8f9fa !important; /* Placeholder podczas ≈Çadowania */
        }
      }
      
      /* MOBILE: Elastyczne wymiary zdjƒôƒá */
      @media (max-width: 768px) {
        .product__media img,
        .product__media .product__media-item img,
        .media-gallery__image img {
          width: 100% !important;
          height: auto !important; /* Elastyczna wysoko≈õƒá na mobile */
          min-height: 200px !important; /* Mniejsza minimalna wysoko≈õƒá */
          max-height: 400px !important; /* Maksymalna wysoko≈õƒá */
          object-fit: cover !important;
          object-position: center !important;
          background: #f8f9fa !important;
        }
      }
      
      /* FIX: Stabilne wymiary dla ceny produktu - DESKTOP ONLY */
      @media (min-width: 769px) {
        .product-price,
        product-price,
        .price,
        [class*="price"] {
          min-height: 60px !important; /* Stabilna wysoko≈õƒá ceny */
          display: flex !important;
          align-items: center !important;
          font-size: 1.4rem !important;
          font-weight: 700 !important;
          color: #000000 !important; /* CZARNY KOLOR */
          margin: 8px 0 !important; /* ZMNIEJSZONO: z 20px na 8px */
        }
      }
      
      /* MOBILE: Elastyczne wymiary ceny */
      @media (max-width: 768px) {
        .product-price,
        product-price,
        .price,
        [class*="price"] {
          min-height: auto !important; /* Elastyczna wysoko≈õƒá na mobile */
          display: flex !important;
          align-items: center !important;
          font-size: 1.2rem !important; /* Mniejszy font na mobile */
          font-weight: 700 !important;
          color: #000000 !important; /* CZARNY KOLOR */
          margin: 5px 0 !important; /* Mniejsze marginesy na mobile */
        }
      }
      
      /* FIX: Zmniejsz pionowe rozmiary dla ceny w aplikacji Customify - DESKTOP ONLY */
      @media (min-width: 769px) {
        #customify-app-container product-price,
        #customify-app-container .product-price,
        #customify-app-container .price,
        #customify-app-container [class*="price"] {
          margin: 4px 0 !important; /* Jeszcze mniejsze marginesy w aplikacji */
          min-height: 40px !important; /* Mniejsza wysoko≈õƒá w aplikacji */
          text-align: left !important; /* WYJUSTOWANIE DO LEWEJ */
        }
      }
      
      /* MOBILE: Elastyczne wymiary ceny w aplikacji */
      @media (max-width: 768px) {
        #customify-app-container product-price,
        #customify-app-container .product-price,
        #customify-app-container .price,
        #customify-app-container [class*="price"] {
          margin: 2px 0 !important; /* Jeszcze mniejsze marginesy na mobile */
          min-height: auto !important; /* Elastyczna wysoko≈õƒá na mobile */
          font-size: 1.1rem !important; /* Mniejszy font na mobile */
          text-align: left !important; /* WYJUSTOWANIE DO LEWEJ NA MOBILE */
        }
      }
      
      /* INFORMACJA O NAJNI≈ªSZEJ CENIE - DODANA POD CENƒÑ */
      product-price::after {
        content: 'Najni≈ºsza cena z ostatnich 30 dni';
        display: block;
        color: #2d5a27 !important; /* CIEMNO ZIELONY KOLOR */
        font-size: 0.75rem !important; /* MNIEJSZA CZCIONKA */
        font-weight: 400 !important;
        margin-top: 4px !important;
      }
      
      /* FIX: Wewnƒôtrzny kontener ceny - wyr√≥wnanie do lewej */
      #customify-app-container product-price [ref="priceContainer"] {
        text-align: left !important;
        width: 100% !important;
        justify-self: flex-start !important;
        align-self: flex-start !important;
      }
      
      /* FIX: Skeleton loaders - eliminuje skakanie podczas ≈Çadowania */
      .product-information__media.loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%) !important;
        background-size: 200% 100% !important;
        animation: loading-shimmer 1.5s infinite !important;
      }
      
      .product-details.loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%) !important;
        background-size: 200% 100% !important;
        animation: loading-shimmer 1.5s infinite !important;
      }
      
      .product__media img.loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%) !important;
        background-size: 200% 100% !important;
        animation: loading-shimmer 1.5s infinite !important;
      }
      
      @keyframes loading-shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }
      
      /* FIX: Ukryj skeleton po za≈Çadowaniu */
      .product-information__media:not(.loading),
      .product-details:not(.loading),
      .product__media img:not(.loading) {
        animation: none !important;
        background: white !important;
      }
      
      /* Responsive - tablet */
      @media (max-width: 768px) {
        .product-information__grid {
          max-width: 768px !important;
          padding: 0 15px !important;
          grid-template-columns: 1fr !important; /* Jedna kolumna na mobile */
          min-height: auto !important;
          background: #f3f5f6 !important;
          gap: 15px !important;
        }
      }
      
      /* Responsive - mobile */
      @media (max-width: 480px) {
        .product-information__grid {
          max-width: 100% !important;
          padding: 0 10px !important;
        }
        
        .product-information__media,
        .product-details {
          min-height: 250px !important;
        }
        
        /* FIX: Bardzo ma≈Çe ekrany - jeszcze bardziej zwarte */
        #customify-app-container {
          padding: 10px !important;
        }
        
        .customify-title {
          font-size: 1rem !important;
          margin: 10px 0 !important;
        }
        
        .customify-size-buttons {
          grid-template-columns: 1fr 1fr !important;
          gap: 6px !important;
        }
        
        .customify-size-btn {
          font-size: 0.8rem !important;
          padding: 6px 4px !important;
          min-height: 40px !important;
        }
        
        .customify-style-grid {
          grid-template-columns: 1fr 1fr !important;
          gap: 8px !important;
        }
        
        .customify-btn {
          font-size: 0.9rem !important;
          padding: 12px 16px !important;
        }
      }
      
      /* Drag & Drop Zone - dzia≈Ça na wszystkich urzƒÖdzeniach */
      .customify-drop-zone {
        border: 2px dashed #9ca3af !important; /* ZMNIEJSZONA RAMKA: z 3px na 2px */
        border-radius: 8px !important;
        background: transparent !important; /* USUNIƒòTO SZARE T≈ÅO */
        padding: 20px 30px !important; /* ZMNIEJSZONO PADDING PIONOWY: z 50px na 20px */
        text-align: center !important;
        transition: all 0.3s ease !important;
        cursor: pointer !important;
        min-height: 100px !important; /* ZMNIEJSZONO WYSOKO≈öƒÜ: z 150px na 100px */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }
      
      .customify-drop-zone:hover {
        border-color: #6c757d !important;
        background: transparent !important; /* USUNIƒòTO SZARE T≈ÅO Z HOVER */
      }
      
      /* Usage Counter Styles */
      .usage-counter {
        padding: 12px 16px !important;
        border-radius: 8px !important;
        margin: 15px 0 !important;
        font-size: 0.95rem !important;
        font-weight: 600 !important;
        text-align: center !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      }
      
      .usage-counter-green {
        background: #d4edda !important;
        color: #155724 !important;
        border: 1px solid #c3e6cb !important;
      }
      
      .usage-counter-blue {
        background: #d1ecf1 !important;
        color: #0c5460 !important;
        border: 1px solid #bee5eb !important;
      }
      
      .usage-counter-red {
        background: #f8d7da !important;
        color: #721c24 !important;
        border: 1px solid #f5c6cb !important;
      }
      
      .customify-drop-zone.dragover {
        border-color: #6c757d !important;
        background: transparent !important; /* USUNIƒòTO SZARE T≈ÅO Z DRAGOVER */
      }
      
      .drop-zone-content {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 12px !important;
      }
      
      .drop-zone-text {
        font-size: 1.1rem !important;
        color: #374151 !important;
        font-weight: 500 !important;
        margin: 0 !important;
      }
      
      .drop-zone-separator {
        font-size: 0.9rem !important;
        color: #9ca3af !important;
        margin: 0 !important;
      }
      
      .customify-upload-btn {
        background: #9ca3af !important; /* JA≈öNIEJSZY KOLOR */
        color: white !important;
        border: none !important;
        padding: 10px 20px !important;
        border-radius: 6px !important;
        font-size: 0.9rem !important;
        font-weight: 500 !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        margin: 0 !important;
      }
      
      .customify-upload-btn:hover {
        background: #6b7280 !important; /* CIEMNIEJSZY HOVER */
        transform: translateY(-1px) !important;
      }
      
      /* FIX: Mobile styles dla aplikacji Customify - wyr√≥wnanie do lewej */
      @media (max-width: 768px) {
        /* Aplikacja Customify na mobile */
        #customify-app-container {
          text-align: left !important;
          padding: 15px !important;
        }
        
        /* Rozmiary - wyr√≥wnanie do lewej */
        .customify-size-selector {
          text-align: left !important;
          margin-bottom: 15px !important;
        }
        
        .customify-size-selector h4 {
          text-align: left !important;
          margin: 0 0 10px 0 !important;
        }
        
        .customify-size-buttons {
          justify-content: flex-start !important;
          grid-template-columns: repeat(3, 1fr) !important;
          gap: 8px !important;
        }
        
        /* Tytu≈Ç aplikacji - wyr√≥wnanie do lewej */
        .customify-title {
          text-align: left !important;
          font-size: 1.1rem !important;
          margin: 15px 0 !important;
        }
        
        /* Upload area - wyr√≥wnanie do lewej */
        .customify-upload-area {
          text-align: left !important;
          padding-top: 0 !important; /* USUNIƒòTO G√ìRNY PADDING */
        }
        
        .customify-upload-hint {
          text-align: left !important;
          margin: 8px 0 0 0 !important;
          font-size: 0.75rem !important; /* ZMNIEJSZONA CZCIONKA */
          color: #666 !important;
          line-height: 1.3 !important;
        }
        
        /* Style grid - wyr√≥wnanie do lewej */
        .customify-style-grid {
          grid-template-columns: repeat(2, 1fr) !important;
          gap: 10px !important;
          justify-content: flex-start !important;
        }
        
        .customify-style-card {
          text-align: left !important;
        }
        
        .style-info {
          text-align: left !important;
        }
        
        /* Wynik - wyr√≥wnanie do lewej */
        .customify-result {
          text-align: left !important;
        }
        
        .customify-result h4 {
          text-align: left !important;
        }
        
        .customify-result img {
          width: 100% !important;
          height: auto !important;
        }
        
        /* Cena - wyr√≥wnanie do lewej */
        .customify-cart-price {
          text-align: left !important;
          margin: 10px 0 !important;
        }
        
        /* Komunikat b≈Çƒôdu transformacji - pe≈Çna szeroko≈õƒá nad przyciskami */
        #errorMessageTransform {
          width: 100% !important;
          margin-bottom: 10px !important;
        }
        
        /* Ukryj t≈Ço i margines gdy element jest ukryty */
        .customify-error[style*="display: none"],
        .customify-error[style*="display:none"],
        .customify-error[style*="display:none;"],
        .customify-error[style*="display: none;"] {
          background-color: transparent !important;
          margin: 0 !important;
          padding: 0 !important;
          height: 0 !important;
          overflow: hidden !important;
          border: none !important;
        }
        
        /* Dodatkowa ochrona - ukryj wszystkie ukryte elementy b≈Çƒôd√≥w */
        .customify-error:not(:has(*)) {
          /* Je≈õli element jest pusty i ukryty, usu≈Ñ wszystkie style */
        }
        
        /* Gdy element ma display: none, usu≈Ñ wszystkie style wizualne */
        .customify-error {
          transition: all 0.2s ease;
        }
        
        .customify-error[style*="display: none"] *,
        .customify-error[style*="display:none"] * {
          display: none !important;
        }
        
        /* Przyciski - wyr√≥wnanie do lewej */
        .customify-actions {
          text-align: left !important;
          margin-top: 15px !important;
        }
        
        .customify-btn {
          width: 100% !important;
          margin: 5px 0 !important;
        }
        
        /* Accordion - wyr√≥wnanie do lewej */
        .product-details-accordion {
          text-align: left !important;
        }
        
        .accordion-header {
          text-align: left !important;
        }
        
        .accordion-content {
          text-align: left !important;
        }
        
        /* Loading states - wyr√≥wnanie do lewej */
        .customify-cart-loading {
          text-align: left !important;
        }
        
        .loading-text,
        .loading-stage {
          text-align: left !important;
        }
      }
      
      /* FIX: POKA≈ª WSZYSTKIE ELEMENTY STOPKI ZAMIAST POPOVER */
      .terms-policies-popover {
        position: static !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        transform: none !important;
        box-shadow: none !important;
        border: none !important;
        background: transparent !important;
        padding: 0 !important;
        margin: 0 !important;
        max-width: none !important;
        width: auto !important;
        height: auto !important;
        z-index: auto !important;
      }
      
      .policy_list {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 15px !important;
        margin: 0 !important;
        padding: 0 !important;
        list-style: none !important;
      }
      
      .policy_list li {
        margin: 0 !important;
        padding: 0 !important;
      }
      
      .policy_list a {
        color: inherit !important;
        text-decoration: none !important;
        font-size: 0.75rem !important;
        transition: opacity 0.2s ease !important;
      }
      
      .policy_list a:hover {
        opacity: 0.7 !important;
      }
      
      /* UKRYJ PRZYCISK POPOVER - POKA≈ª TYLKO LISTƒò */
      .policy-list-trigger {
        display: none !important;
      }
      
      /* RESPONSIVE - MOBILE */
      @media (max-width: 768px) {
        .policy_list {
          flex-direction: column !important;
          gap: 8px !important;
        }
      }

      /* EXPANDABLE DESCRIPTION USUNIƒòTE - opisy produkt√≥w sƒÖ teraz pe≈Çne */

      /* ACCORDION POD PRZYCISKAMI - STYL MINIMALISTYCZNY */
      .product-details-accordion {
        display: block !important;
        margin-top: 24px;
        border-top: none;
        padding-top: 0;
      }

      .accordion-item {
        border-bottom: none;
        margin-bottom: 0;
      }

      .accordion-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        cursor: pointer;
        font-weight: 400;
        color: #000;
        font-size: 1rem;
        transition: all 0.2s ease;
        user-select: none;
        background: transparent;
        border-bottom: 1px solid #e5e5e5;
        margin-bottom: 0;
        width: 100%;
        box-sizing: border-box;
      }

      .accordion-header:hover {
        color: #000;
      }

      .accordion-title {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
      }

      .accordion-icon {
        font-size: 1.5rem;
        font-weight: 300;
        transition: transform 0.3s ease;
        color: #000;
        flex-shrink: 0;
        line-height: 1;
        display: inline-block;
      }

      .accordion-item.expanded .accordion-icon {
        transform: rotate(45deg);
        color: #000;
      }

      .accordion-item.expanded .accordion-header {
        border-bottom-color: #e5e5e5;
        color: #000;
      }

      .accordion-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease;
        color: #666;
        font-size: 0.9rem;
        line-height: 1.6;
        padding: 0 20px;
      }

      .accordion-item.expanded .accordion-content {
        max-height: 2000px;
        padding: 16px 0;
        background: transparent;
        border: none;
        margin-bottom: 0;
        overflow: visible;
      }

      .accordion-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .accordion-content li {
        margin: 6px 0;
      }

      .accordion-content strong {
        color: #333;
        font-weight: 600;
      }

      .accordion-step {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        margin: 12px 0;
        padding: 12px;
        background: #f9f9f9;
        border-radius: 8px;
      }

      .accordion-step-number {
        background: #d32f2f;
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 0.9rem;
        flex-shrink: 0;
      }

      .accordion-step-content {
        flex: 1;
      }

      .accordion-size-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 12px;
      }

      .accordion-size-item {
        background: #f9f9f9;
        padding: 12px;
        border-radius: 8px;
        border: 2px solid #e5e5e5;
        transition: all 0.2s ease;
      }

      .accordion-size-item:hover {
        border-color: #d32f2f;
        background: #fff;
      }

      .accordion-size-name {
        font-weight: 700;
        color: #333;
        font-size: 1rem;
      }

      .accordion-size-dimensions {
        color: #666;
        font-size: 0.85rem;
        margin: 4px 0;
      }

      .accordion-size-price {
        color: #000000; /* CZARNY KOLOR */
        font-weight: 700;
        font-size: 1.1rem;
      }

      .accordion-size-description {
        color: #999;
        font-size: 0.8rem;
        margin-top: 4px;
      }

      /* Style dla obrazk√≥w wizualizacyjnych w akordeon */
      .accordion-product-visual {
        display: flex;
        justify-content: center;
        margin: 16px auto;
        max-width: 400px;
      }

      .accordion-visual-item {
        background: #fff;
        border: 2px solid #e5e5e5;
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        width: 100%;
      }

      .accordion-visual-item:hover {
        border-color: #d32f2f;
        box-shadow: 0 4px 12px rgba(211, 47, 47, 0.15);
        transform: translateY(-2px);
      }

      .accordion-visual-image {
        width: 100%;
        height: auto;
        display: block;
      }


      .accordion-visual-label {
        padding: 12px;
        text-align: center;
        font-weight: 600;
        color: #333;
        font-size: 0.95rem;
        background: #f8f9fa;
        border-top: 2px solid #e5e5e5;
      }

      @media (max-width: 768px) {
        .product-details-accordion {
          margin-top: 16px;
        }

        .accordion-product-visual {
          max-width: 100%;
        }

        .accordion-header {
          font-size: 1.05rem; /* üö® ROLLBACK: Zwiƒôkszono rozmiar czcionki dla nazw sekcji (mobile) */
          padding: 14px 16px;
        }

        .accordion-content {
          font-size: 0.85rem;
          padding: 0 16px;
        }

        .accordion-item.expanded .accordion-content {
          max-height: 2000px; /* üö® ROLLBACK: Zwiƒôkszono dla produktu cyfrowego (mobile) */
          padding: 14px 16px;
          overflow: visible; /* üö® ROLLBACK: Pozw√≥l na pe≈Çne wy≈õwietlenie tre≈õci */
        }

        .accordion-title {
          gap: 10px;
        }

        .accordion-size-grid {
          grid-template-columns: 1fr;
        }

        .accordion-step {
          padding: 10px;
        }
      }
      
      /* ANIMOWANE STRZA≈ÅKI WSKAZUJƒÑCE W D√ì≈Å */
      .arrow-down {
        text-align: center;
        margin: 0; /* USUNIƒòTO WSZYSTKIE MARGINESY */
        animation: bounce-arrows 4s infinite; /* WOLNIEJ: z 2s na 4s */
      }
      
      .arrow-down span {
        font-size: 2rem;
        color: #dc3545;
        font-weight: bold;
        display: inline-block;
        animation: bounce-individual 3s infinite ease-in-out; /* WOLNIEJ: z 1.5s na 3s */
      }
      
      .arrow-down span:nth-child(1) {
        animation-delay: 0s;
      }
      
      .arrow-down span:nth-child(2) {
        animation-delay: 0.2s;
      }
      
      .arrow-down span:nth-child(3) {
        animation-delay: 0.4s;
      }
      
      @keyframes bounce-arrows {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(-5px); /* MNIEJ: z -10px na -5px */
        }
        60% {
          transform: translateY(-2px); /* MNIEJ: z -5px na -2px */
        }
      }
      
      @keyframes bounce-individual {
        0%, 20%, 50%, 80%, 100% {
          transform: translateY(0);
          opacity: 1;
        }
        40% {
          transform: translateY(-8px); /* MNIEJ: z -15px na -8px */
          opacity: 0.9; /* MNIEJ: z 0.8 na 0.9 */
        }
        60% {
          transform: translateY(-4px); /* MNIEJ: z -8px na -4px */
          opacity: 0.95; /* MNIEJ: z 0.9 na 0.95 */
        }
      }
      
      /* Mobile - mniejsze strza≈Çki */
      @media (max-width: 768px) {
        .arrow-down {
          margin: 0; /* USUNIƒòTO WSZYSTKIE MARGINESY NA MOBILE */
        }
        
        .arrow-down span {
          font-size: 1.5rem;
        }
      }
    </style>
    
    
    <style>
      /* Ukryj produkty Customify z nowymi nazwami rozmiar√≥w (A5/A4/A3/A2) i "cyfrowy" */
      .product-card:has([data-product-title*="A5"]),
      .product-card:has([data-product-title*="A4"]),
      .product-card:has([data-product-title*="A3"]),
      .product-card:has([data-product-title*="A2"]),
      .product-card:has([data-product-title*="cyfrowy" i]),
      .product-card:has([href*="A5"]),
      .product-card:has([href*="A4"]),
      .product-card:has([href*="A3"]),
      .product-card:has([href*="A2"]) {
        display: none !important;
      }
      
        /* ‚úÖ NAPRAWIONE: Ukryj produkty z "rozmiar" w URL */
        .custom-collection-card[href*="rozmiar"] {
          display: none !important;
        }
        
        /* ‚úÖ Ukryj produkty z "cyfrowy" w URL */
        .custom-collection-card[href*="cyfrowy"] {
          display: none !important;
        }
        
        /* ‚úÖ NOWE: Ukryj produkty AI w sekcji rekomendacji produkt√≥w */
        .product-recommendations a[href*="rozmiar"] {
          display: none !important;
        }
        
        .product-recommendations a[href*="cyfrowy"] {
          display: none !important;
        }
      
      
      /* Zachowaj g≈Ç√≥wny produkt Customify widoczny */
      .product-card:has([data-product-title*="Obraz ze zdjƒôcia w stylu Ghibli"]),
      .product-card:has([href*="custom"]) {
        display: block !important;
      }
      
      /* Ukryj TYLKO 2 przyciski Shopify - dodaj do koszyka i kup teraz */
      button#BuyButtons-ProductSubmitButton,
      button[id^="BuyButtons-ProductSubmitButton"],
      .shopify-payment-button {
        display: none !important;
      }
      
      /* Ukryj quantity selector na stronie produktu */
      #BuyButtons-ProductForm-template--26707455672645__main > div > quantity-selector-component {
        display: none !important;
      }
      
      /* Ukryj sekcjƒô z koszyka */
      #shopify-section-sections--26707450822981__section_fV4L9Q > div.section.section--page-width.color-scheme-1 > div.border-style.custom-section-content {
        display: none !important;
      }
    </style>
    
    {% if template contains 'collection' %}
    <style>
      /* Nadpisz ukrywanie produkt√≥w na stronach kolekcji (pokazuj wszystkie karty) */
      .product-card:has([data-product-title*="rozmiar"]),
      .product-card:has([href*="spersonalizowany"]) {
        display: block !important;
      }

      /* Ukryj nag≈Ç√≥wek "Produkty" na stronie kolekcji */
      #shopify-section-template--26450137481541__section {
        display: none !important;
      }
    </style>
    {% endif %}
    
    <!-- FIX: Poprawne proporcje galerii - JavaScript wymusza zmiany -->
    <script>
      // FIX: Przenie≈õ aplikacjƒô NATYCHMIAST - eliminuje skakanie
      document.addEventListener('DOMContentLoaded', function() {
        const app = document.getElementById('customify-app-container');
        const prodInfo = document.querySelector('[id^="ProductInformation-"]');
        const placeholder = document.getElementById('customify-placeholder');
        
        if (app && prodInfo) {
          // Dodaj na koniec ProductInformation NATYCHMIAST
          prodInfo.appendChild(app);
          
          // Ukryj placeholder je≈õli istnieje
          if (placeholder) {
            placeholder.remove();
          }
        } else {
          // Fallback: je≈õli nie ma ProductInformation, spr√≥buj ponownie po kr√≥tkim czasie
          setTimeout(function() {
            const app = document.getElementById('customify-app-container');
            const prodInfo = document.querySelector('[id^="ProductInformation-"]');
            const placeholder = document.getElementById('customify-placeholder');
            
            if (app && prodInfo) {
              prodInfo.appendChild(app);
              if (placeholder) {
                placeholder.remove();
              }
            }
          }, 50);
        }
      });
      
      // FUNKCJA NAPRAWY POWIƒòKSZONEGO ZDJƒòCIA W DIALOGU
      function fixDialogImages() {
        const dialog = document.querySelector('dialog[open]');
        if (!dialog) return;
        
        // Znajd≈∫ wszystkie zdjƒôcia w dialogu
        const allImages = dialog.querySelectorAll('img');
        let largestImg = null;
        let largestWidth = 0;
        
        allImages.forEach(img => {
          const width = img.clientWidth;
          if (width > largestWidth) {
            largestWidth = width;
            largestImg = img;
          }
        });
        
        if (!largestImg) return;
        
        // Wymu≈õ poprawne style - WYPE≈ÅNIA CA≈ÅY KONTENER
        largestImg.style.setProperty('object-fit', 'cover', 'important');
        largestImg.style.setProperty('max-height', 'none', 'important');
        largestImg.style.setProperty('height', '100%', 'important');
        largestImg.style.setProperty('width', '100%', 'important');
        largestImg.style.setProperty('object-position', 'center', 'important');
        
        // Styluj kontener
        if (largestImg.parentElement) {
          largestImg.parentElement.style.setProperty('height', '100%', 'important');
        }
        
      }
      
      // FUNKCJA UKRYWANIA STAREJ SEKCJI POLITYK
      function hideOldPolicySection() {
        // Ukryj ca≈Çy popover z politykami
        const policyPopover = document.querySelector('.footer-utilities__group--left anchored-popover-component');
        if (policyPopover) {
          policyPopover.style.display = 'none';
          policyPopover.style.visibility = 'hidden';
          policyPopover.style.opacity = '0';
          policyPopover.style.height = '0';
          policyPopover.style.overflow = 'hidden';
        }
        
        // Ukryj element "Preferencje dotyczƒÖce plik√≥w cookie"
        const cookieLink = document.querySelector('a[href="/policies/#shopifyReshowConsentBanner"]');
        if (cookieLink) {
          cookieLink.style.display = 'none';
          cookieLink.style.visibility = 'hidden';
          cookieLink.style.opacity = '0';
          cookieLink.style.height = '0';
          cookieLink.style.overflow = 'hidden';
          
          const parentLi = cookieLink.closest('li');
          if (parentLi) {
            parentLi.style.display = 'none';
            parentLi.style.visibility = 'hidden';
            parentLi.style.opacity = '0';
            parentLi.style.height = '0';
            parentLi.style.overflow = 'hidden';
          }
          
        }
      }

      // FUNKCJA DODAWANIA NAWIGACJI NA STRONACH POLITYK
      function addPolicyNavigation() {
        // Dodaj nawigacjƒô do stopki (przed popoverem)
        const footerLeft = document.querySelector('.footer-utilities__group--left');
        if (!footerLeft) {
          return;
        }
        
        const policyPopover = footerLeft.querySelector('anchored-popover-component');
        if (!policyPopover) {
          return;
        }
        
        // Sprawdzam czy nawigacja ju≈º istnieje
        if (document.querySelector('.policy-nav-container-footer')) {
          return;
        }
        
        // Stw√≥rz aktywnƒÖ nawigacjƒô
        const navContainer = document.createElement('div');
        navContainer.className = 'policy-nav-container-footer';
          navContainer.style.cssText = `
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px 20px;
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
          `;
          
          const navTitle = document.createElement('div');
          navTitle.textContent = 'üîó Szybka nawigacja:';
          navTitle.style.cssText = `
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
          `;
          
          const navLinks = document.createElement('div');
          navLinks.className = 'policy-nav-links';
          navLinks.style.cssText = `
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
          `;
          
          const links = [
            { text: 'Polityka Prywatno≈õci', url: '/policies/privacy-policy' },
            { text: 'Polityka Zwrot√≥w', url: '/policies/refund-policy' },
            { text: 'Dane Kontaktowe', url: '/pages/kontakt' },
            { text: 'Warunki Us≈Çug', url: '/policies/terms-of-service' },
            { text: 'Polityka Wysy≈Çki', url: '/policies/shipping-policy' }
          ];
          
          links.forEach(link => {
            const linkEl = document.createElement('a');
            linkEl.href = link.url;
            linkEl.textContent = link.text;
            linkEl.style.cssText = `
              color: #666;
              text-decoration: none;
              font-weight: 500;
              padding: 8px 16px;
              border-radius: 6px;
              transition: all 0.3s ease;
              display: inline-block;
              border: 1px solid transparent;
            `;
            
            linkEl.addEventListener('mouseenter', function() {
              this.style.color = '#333';
              this.style.backgroundColor = '#fff';
              this.style.borderColor = '#666';
              this.style.transform = 'translateY(-2px)';
              this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
            });
            
            linkEl.addEventListener('mouseleave', function() {
              this.style.color = '#666';
              this.style.backgroundColor = 'transparent';
              this.style.borderColor = 'transparent';
              this.style.transform = 'translateY(0)';
              this.style.boxShadow = 'none';
            });
            
            navLinks.appendChild(linkEl);
          });
          
          navContainer.appendChild(navTitle);
          navContainer.appendChild(navLinks);
          
          // Wstaw nawigacjƒô przed popoverem w stopce
          footerLeft.insertBefore(navContainer, policyPopover);
          
      }

      function fixGalleryProportions() {
        const galleryGrid = document.querySelector('.media-gallery__grid');
        if (!galleryGrid) return;
        
        // ZAWSZE uruchamiaj galeriƒô w stylu Etsy na stronach produktu
        createEtsyGallery(galleryGrid);
      }
      
      // ETSY-STYLE GALLERY (miniaturki poni≈ºej)
      function createEtsyGallery(galleryGrid) {
        // Sprawd≈∫ czy ju≈º utworzono
        if (galleryGrid.classList.contains('etsy-gallery-initialized')) {
          return;
        }
        
        // Wymu≈õ layout flexbox pionowy (g√≥ra-d√≥≈Ç)
        galleryGrid.style.setProperty('display', 'flex', 'important');
        galleryGrid.style.setProperty('flex-direction', 'column', 'important');
        galleryGrid.style.setProperty('gap', '16px', 'important');
        galleryGrid.style.setProperty('height', 'auto', 'important');
        galleryGrid.style.setProperty('width', '100%', 'important');
        
        // Pobierz wszystkie elementy listy (oryginalne media)
        const allImages = Array.from(galleryGrid.querySelectorAll('li'));
        if (allImages.length === 0) return;
        
        // Zapisz URL wszystkich obrazk√≥w PRZED usuniƒôciem element√≥w
        const imageUrls = allImages.map(li => {
          const img = li.querySelector('img');
          if (!img) return null;
          // Spr√≥buj wyciƒÖgnƒÖƒá URL z currentSrc, src lub srcset
          const direct = img.currentSrc || img.src || '';
          if (direct) return direct;
          const srcset = img.getAttribute('srcset') || '';
          if (srcset) {
            // We≈∫ najwiƒôkszy URL z srcset
            const candidates = srcset.split(',').map(s => s.trim().split(' ')[0]).filter(Boolean);
            return candidates[candidates.length - 1] || null;
          }
          return null;
        }).filter(url => url !== null && url !== '');
        
        if (imageUrls.length === 0) {
          console.warn('‚è≥ [ETSY] Brak gotowych obraz√≥w (lazy-load). Spr√≥bujƒô ponownie p√≥≈∫niej.');
          return; // Nie usuwaj oryginalnych element√≥w dop√≥ki nie mamy URLi
        }
        
        
        // Zmienna do ≈õledzenia aktualnego indexu (globalna dla ca≈Çej galerii)
        let currentIndex = 0;
        
        // NAJPIERW stw√≥rz kontener dla g≈Ç√≥wnego obrazu (bƒôdzie potrzebny w event listenerach)
        let mainImageContainer = galleryGrid.querySelector('.etsy-main-image');
        if (!mainImageContainer) {
          mainImageContainer = document.createElement('div');
          mainImageContainer.className = 'etsy-main-image';
          mainImageContainer.style.cssText = `
            width: 100%;
            position: relative;
            aspect-ratio: 1 / 1;
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
          `;
          
          // Dodaj g≈Ç√≥wny obraz
          const firstImage = allImages[0]?.querySelector('img');
          if (firstImage) {
            const mainImg = document.createElement('img');
            mainImg.src = firstImage.src;
            mainImg.alt = 'G≈Ç√≥wne zdjƒôcie produktu';
            mainImg.style.cssText = `
              width: 100%;
              height: 100%;
              object-fit: cover;
              cursor: default;
            `;
            
            // Wy≈ÇƒÖcz zoom/modal na g≈Ç√≥wnym obrazie
            mainImg.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
            }, true);
            
            mainImageContainer.appendChild(mainImg);
          }
          
          // Wy≈ÇƒÖcz r√≥wnie≈º klikniƒôcie w kontener (ale przepu≈õƒá klikniƒôcia strza≈Çek)
          mainImageContainer.addEventListener('click', (e) => {
            // Pozw√≥l na klikniƒôcia przycisk√≥w nawigacji
            if (e.target.closest && e.target.closest('.etsy-nav-btn')) {
              return;
            }
            e.preventDefault();
            e.stopPropagation();
          }, true);
          
          // Licznik zdjƒôƒá
          const counter = document.createElement('div');
          counter.className = 'etsy-counter';
          counter.textContent = `1 / ${imageUrls.length}`;
          counter.style.cssText = `
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
          `;
          mainImageContainer.appendChild(counter);
          
          // Strza≈Çka LEWA na g≈Ç√≥wnym obrazie
          const prevBtn = document.createElement('button');
          prevBtn.innerHTML = '‚Äπ';
          prevBtn.className = 'etsy-nav-btn prev';
          prevBtn.style.cssText = `
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 10;
          `;
          
          // Strza≈Çka PRAWA na g≈Ç√≥wnym obrazie
          const nextBtn = document.createElement('button');
          nextBtn.innerHTML = '‚Ä∫';
          nextBtn.className = 'etsy-nav-btn next';
          nextBtn.style.cssText = `
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 10;
          `;
          
          mainImageContainer.appendChild(prevBtn);
          mainImageContainer.appendChild(nextBtn);
        }
        
        // POTEM stw√≥rz kontener dla miniaturek z nawigacjƒÖ (poziomo poni≈ºej)
        let thumbsNavigationContainer = galleryGrid.querySelector('.etsy-thumbs-navigation');
        if (!thumbsNavigationContainer) {
          thumbsNavigationContainer = document.createElement('div');
          thumbsNavigationContainer.className = 'etsy-thumbs-navigation';
          thumbsNavigationContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
          `;
          
          // Strza≈Çka LEWA dla miniaturek
          const thumbsPrevBtn = document.createElement('button');
          thumbsPrevBtn.innerHTML = '‚Äπ';
          thumbsPrevBtn.style.cssText = `
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
          `;
          
          // Kontener miniaturek
          let thumbsRow = document.createElement('div');
          thumbsRow.className = 'etsy-thumbnails-row';
          thumbsRow.style.cssText = `
            display: flex;
            flex-direction: row;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
            flex: 1;
            scrollbar-width: none;
            -ms-overflow-style: none;
          `;
          thumbsRow.style.setProperty('-webkit-scrollbar', 'none');
          
          // Strza≈Çka PRAWA dla miniaturek
          const thumbsNextBtn = document.createElement('button');
          thumbsNextBtn.innerHTML = '‚Ä∫';
          thumbsNextBtn.style.cssText = `
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
          `;
          
          // Event listenery dla strza≈Çek miniaturek
          thumbsPrevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            thumbsRow.scrollBy({ left: -200, behavior: 'smooth' });
          });
          
          thumbsNextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            thumbsRow.scrollBy({ left: 200, behavior: 'smooth' });
          });
          
          // Hover effects
          [thumbsPrevBtn, thumbsNextBtn].forEach(btn => {
            btn.addEventListener('mouseenter', () => {
              btn.style.background = '#f5f5f5';
              btn.style.transform = 'scale(1.1)';
            });
            btn.addEventListener('mouseleave', () => {
              btn.style.background = 'white';
              btn.style.transform = 'scale(1)';
            });
          });
          
          // Przenie≈õ miniaturki
          allImages.forEach((img, index) => {
            const thumb = img.cloneNode(true);
            
            // Usu≈Ñ wszystkie atrybuty kt√≥re mogƒÖ powodowaƒá zoom/modal
            const links = thumb.querySelectorAll('a, button');
            links.forEach(link => {
              link.removeAttribute('href');
              link.removeAttribute('data-modal');
              link.removeAttribute('data-pswp-width');
              link.removeAttribute('data-pswp-height');
              link.style.pointerEvents = 'none'; // Wy≈ÇƒÖcz klikniƒôcia w linki
            });
            
            thumb.style.cssText = `
              width: 80px;
              height: 80px;
              border: 2px solid #e0e0e0;
              border-radius: 4px;
              cursor: pointer;
              transition: all 0.2s ease;
              flex-shrink: 0;
            `;
            
            // Dodaj active state
            if (index === 0) {
              thumb.style.borderColor = '#000';
            }
            
            // Klikniƒôcie zmienia g≈Ç√≥wny obraz (BEZ ZOOM/MODAL)
            thumb.addEventListener('click', (e) => {
              e.preventDefault(); // Zatrzymaj domy≈õlne zachowanie Shopify
              e.stopPropagation(); // Zatrzymaj propagacjƒô (zoom/modal)
              
              // Aktualizuj currentIndex (dla synchronizacji ze strza≈Çkami)
              currentIndex = index;
              
              // Usu≈Ñ active ze wszystkich
              thumbsRow.querySelectorAll('li').forEach(t => {
                t.style.borderColor = '#e0e0e0';
              });
              // Dodaj active
              thumb.style.borderColor = '#000';
              
              // Zmie≈Ñ g≈Ç√≥wny obraz u≈ºywajƒÖc zapisanego URL
              const mainImg = mainImageContainer.querySelector('img');
              if (mainImg && imageUrls[index]) {
                mainImg.src = imageUrls[index];
                // Aktualizuj licznik
                const counter = mainImageContainer.querySelector('.etsy-counter');
                if (counter) {
                  counter.textContent = `${index + 1} / ${imageUrls.length}`;
                }
              }
            }, true); // useCapture = true (przechwytuj PRZED Shopify)
            
            thumbsRow.appendChild(thumb);
          });
          
          // Sk≈Çadaj nawigacjƒô miniaturek
          thumbsNavigationContainer.appendChild(thumbsPrevBtn);
          thumbsNavigationContainer.appendChild(thumbsRow);
          thumbsNavigationContainer.appendChild(thumbsNextBtn);
          
          // Dodaj NAJPIERW g≈Ç√≥wny obraz (g√≥ra)
          galleryGrid.appendChild(mainImageContainer);
          
          // POTEM miniaturki z nawigacjƒÖ (d√≥≈Ç)
          galleryGrid.appendChild(thumbsNavigationContainer);
        }
        
        // Event listenery dla strza≈Çek g≈Ç√≥wnego obrazu (NA ZEWNƒÑTRZ if'a - dzia≈ÇajƒÖ zawsze)
        const prevBtn = mainImageContainer.querySelector('.etsy-nav-btn.prev');
        const nextBtn = mainImageContainer.querySelector('.etsy-nav-btn.next');
        const counter = mainImageContainer.querySelector('.etsy-counter');
        const mainImg = mainImageContainer.querySelector('img');
        const thumbsRow = galleryGrid.querySelector('.etsy-thumbnails-row');
        
        console.log('üîß [ETSY GALLERY] Elementy znalezione:', {
          prevBtn: !!prevBtn,
          nextBtn: !!nextBtn,
          mainImg: !!mainImg,
          thumbsRow: !!thumbsRow,
          counter: !!counter
        });
        
        if (prevBtn && nextBtn && mainImg && thumbsRow) {
          // Usu≈Ñ stare event listenery (klonuj przyciski)
          const newPrevBtn = prevBtn.cloneNode(true);
          const newNextBtn = nextBtn.cloneNode(true);
          prevBtn.replaceWith(newPrevBtn);
          nextBtn.replaceWith(newNextBtn);
          
          newPrevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            currentIndex = currentIndex === 0 ? imageUrls.length - 1 : currentIndex - 1;
            
            // Zmie≈Ñ obraz u≈ºywajƒÖc zapisanego URL
            if (mainImg && imageUrls[currentIndex]) {
              mainImg.src = imageUrls[currentIndex];
              counter.textContent = `${currentIndex + 1} / ${imageUrls.length}`;
              
              // Aktualizuj active state miniaturek
              if (thumbsRow) {
                thumbsRow.querySelectorAll('li').forEach((t, i) => {
                  t.style.borderColor = i === currentIndex ? '#000' : '#e0e0e0';
                });
              }
              
            }
          });
          
          newNextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            currentIndex = currentIndex === imageUrls.length - 1 ? 0 : currentIndex + 1;
            
            // Zmie≈Ñ obraz u≈ºywajƒÖc zapisanego URL
            if (mainImg && imageUrls[currentIndex]) {
              mainImg.src = imageUrls[currentIndex];
              counter.textContent = `${currentIndex + 1} / ${imageUrls.length}`;
              
              // Aktualizuj active state miniaturek
              if (thumbsRow) {
                thumbsRow.querySelectorAll('li').forEach((t, i) => {
                  t.style.borderColor = i === currentIndex ? '#000' : '#e0e0e0';
                });
              }
              
            }
          });
          
          // Hover effects dla strza≈Çek g≈Ç√≥wnego obrazu
          [newPrevBtn, newNextBtn].forEach(btn => {
            btn.addEventListener('mouseenter', () => {
              btn.style.background = 'white';
              btn.style.transform = 'translateY(-50%) scale(1.1)';
            });
            btn.addEventListener('mouseleave', () => {
              btn.style.background = 'rgba(255, 255, 255, 0.9)';
              btn.style.transform = 'translateY(-50%) scale(1)';
            });
          });
          
        } else {
          console.error('‚ùå [ETSY] Brak element√≥w:', { prevBtn, nextBtn, mainImg, thumbsRow });
        }
        
        // Usu≈Ñ oryginalne elementy
        allImages.forEach(img => img.remove());
        
        galleryGrid.classList.add('etsy-gallery-initialized');
      }
      
      // STANDARD CAROUSEL (dla innych produkt√≥w)
      function createStandardCarousel(galleryGrid) {
        // UKRYJ SLIDESHOW-COMPONENT NA MOBILE (powoduje duplikacjƒô g≈Ç√≥wnego zdjƒôcia)
        if (window.innerWidth <= 749) {
          const slideshow = document.querySelector('slideshow-component');
          if (slideshow) {
            slideshow.style.setProperty('display', 'none', 'important');
            slideshow.style.setProperty('visibility', 'hidden', 'important');
            slideshow.style.setProperty('opacity', '0', 'important');
            slideshow.style.setProperty('height', '0', 'important');
            slideshow.style.setProperty('overflow', 'hidden', 'important');
          }
        }
        
        // Dodaj aktywnƒÖ nawigacjƒô na stronach polityk
        if (window.location.pathname.includes('/policies/')) {
          addPolicyNavigation();
        }
        
        // Wymu≈õ nowe wymiary przez JavaScript - KARUZELA
        galleryGrid.style.setProperty('display', 'flex', 'important');
        galleryGrid.style.setProperty('flex-direction', 'column', 'important');
        galleryGrid.style.setProperty('height', 'auto', 'important');
        galleryGrid.style.setProperty('width', '100%', 'important');
        
        // Stw√≥rz kontener dla miniaturek z nawigacjƒÖ
        let thumbnailsContainer = galleryGrid.querySelector('.thumbnails-container');
        if (!thumbnailsContainer) {
          // Kontener z nawigacjƒÖ
          const navigationContainer = document.createElement('div');
          navigationContainer.className = 'thumbnails-navigation';
          navigationContainer.style.cssText = `
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
          `;
          
                // Przycisk lewo
                const leftBtn = document.createElement('button');
                leftBtn.innerHTML = '‚Üê';
                leftBtn.className = 'thumbnails-nav-btn left';
                leftBtn.style.cssText = `
                  background: white;
                  color: #333;
                  border: 1px solid #e0e0e0;
                  border-radius: 50%;
                  width: 36px;
                  height: 36px;
                  cursor: pointer;
                  font-size: 16px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  flex-shrink: 0;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                  transition: all 0.2s ease;
                `;
          
          // Kontener miniaturek
          thumbnailsContainer = document.createElement('div');
          thumbnailsContainer.className = 'thumbnails-container';
          thumbnailsContainer.style.cssText = `
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            flex: 1;
            scrollbar-width: none;
            -ms-overflow-style: none;
          `;
          thumbnailsContainer.style.webkitScrollbar = 'none';
          
                // Przycisk prawo
                const rightBtn = document.createElement('button');
                rightBtn.innerHTML = '‚Üí';
                rightBtn.className = 'thumbnails-nav-btn right';
                rightBtn.style.cssText = `
                  background: white;
                  color: #333;
                  border: 1px solid #e0e0e0;
                  border-radius: 50%;
                  width: 36px;
                  height: 36px;
                  cursor: pointer;
                  font-size: 16px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  flex-shrink: 0;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                  transition: all 0.2s ease;
                `;
          
          // Przenie≈õ miniaturki do kontenera
          const thumbnails = Array.from(galleryGrid.querySelectorAll('li:not(:first-child)'));
          thumbnails.forEach(thumb => {
            thumbnailsContainer.appendChild(thumb);
          });
          
          // Sk≈Çadaj nawigacjƒô
          navigationContainer.appendChild(leftBtn);
          navigationContainer.appendChild(thumbnailsContainer);
          navigationContainer.appendChild(rightBtn);
          
          galleryGrid.appendChild(navigationContainer);
          
                // Event listeners dla przycisk√≥w
                leftBtn.addEventListener('click', () => {
                  thumbnailsContainer.scrollBy({ left: -100, behavior: 'smooth' });
                });
                
                rightBtn.addEventListener('click', () => {
                  thumbnailsContainer.scrollBy({ left: 100, behavior: 'smooth' });
                });
                
                // Hover effects
                leftBtn.addEventListener('mouseenter', () => {
                  leftBtn.style.background = '#f5f5f5';
                  leftBtn.style.borderColor = '#ccc';
                  leftBtn.style.transform = 'scale(1.05)';
                });
                
                leftBtn.addEventListener('mouseleave', () => {
                  leftBtn.style.background = 'white';
                  leftBtn.style.borderColor = '#e0e0e0';
                  leftBtn.style.transform = 'scale(1)';
                });
                
                rightBtn.addEventListener('mouseenter', () => {
                  rightBtn.style.background = '#f5f5f5';
                  rightBtn.style.borderColor = '#ccc';
                  rightBtn.style.transform = 'scale(1.05)';
                });
                
                rightBtn.addEventListener('mouseleave', () => {
                  rightBtn.style.background = 'white';
                  rightBtn.style.borderColor = '#e0e0e0';
                  rightBtn.style.transform = 'scale(1)';
                });
        }
        
        // G≈Ç√≥wne zdjƒôcie - WYPE≈ÅNIA CA≈ÅƒÑ SZEROKO≈öƒÜ
        const mainImage = galleryGrid.querySelector('li:first-child');
        if (mainImage) {
          // Usu≈Ñ klasy kt√≥re ograniczajƒÖ wymiary
          mainImage.classList.remove('constrain-height', 'media-fit-contain');
          mainImage.classList.add('media-fit'); // Dodaj klasƒô kt√≥ra wype≈Çnia
          
          mainImage.style.setProperty('height', 'auto', 'important'); // RESPONSIVE
          mainImage.style.setProperty('width', '100%', 'important');
          mainImage.style.setProperty('aspect-ratio', '1 / 1', 'important'); // KWADRAT RESPONSIVE
          mainImage.style.setProperty('grid-row', '1 / 2', 'important');
          mainImage.style.setProperty('grid-column', '1 / 4', 'important'); // WSZYSTKIE 3 KOLUMNY
          mainImage.style.setProperty('margin', '0', 'important');
          mainImage.style.setProperty('max-height', 'none', 'important');
          
          const mainImg = mainImage.querySelector('img');
          if (mainImg) {
            mainImg.style.setProperty('height', '100%', 'important'); // RESPONSIVE
            mainImg.style.setProperty('width', '100%', 'important');
            mainImg.style.setProperty('object-fit', 'cover', 'important');
            mainImg.style.setProperty('object-position', 'center', 'important');
            mainImg.style.setProperty('aspect-ratio', 'inherit', 'important'); // Dziedzicz z kontenera
          }
        }
        
        // Miniaturki - KARUZELA
        const thumbnails = thumbnailsContainer.querySelectorAll('li');
        thumbnails.forEach((thumb) => {
          // Usu≈Ñ inline styles kt√≥re blokujƒÖ
          thumb.removeAttribute('style');
          
          // Ustaw nowe wymiary - KARUZELA
          thumb.style.setProperty('height', '90px', 'important');
          thumb.style.setProperty('width', '90px', 'important');
          thumb.style.setProperty('aspect-ratio', '1 / 1', 'important');
          thumb.style.setProperty('flex-shrink', '0', 'important'); // Nie kurcz siƒô
          
          // Styluj kontener product-media
          const productMedia = thumb.querySelector('.product-media');
          if (productMedia) {
            productMedia.style.setProperty('width', '100%', 'important');
            productMedia.style.setProperty('height', '100%', 'important');
            productMedia.style.setProperty('aspect-ratio', '1 / 1', 'important');
          }
          
          const thumbImg = thumb.querySelector('img');
          if (thumbImg) {
            thumbImg.style.setProperty('object-fit', 'cover', 'important');
            thumbImg.style.setProperty('width', '100%', 'important');
            thumbImg.style.setProperty('height', '100%', 'important');
          }
        });
        
      }

      // Uruchom naprawƒô galerii po za≈Çadowaniu strony
      document.addEventListener('DOMContentLoaded', function() {
        // Czekaj a≈º galeria siƒô za≈Çaduje
        setTimeout(fixGalleryProportions, 1500);
        
        // Uruchom ponownie co 500ms ≈ºeby nadpisaƒá style Shopify
        setInterval(fixGalleryProportions, 500);
        
        // Dodaj nawigacjƒô w stopce (na wszystkich stronach)
        addPolicyNavigation();
        
        // Ukryj starƒÖ sekcjƒô polityk
        hideOldPolicySection();
        
        // NAPRAWA POWIƒòKSZONYCH ZDJƒòƒÜ W DIALOGU
        // Event listener dla klikniƒôƒá w przyciski powiƒôkszenia
        document.addEventListener('click', function(e) {
          const zoomButton = e.target.closest('.product-media-container__zoom-button, button[class*="zoom"]');
          if (zoomButton) {
            setTimeout(fixDialogImages, 100);  // Czekaj a≈º dialog siƒô otworzy
            setTimeout(fixDialogImages, 300);  // Ponownie po za≈Çadowaniu
            setTimeout(fixDialogImages, 600);  // I jeszcze raz dla pewno≈õci
          }
        });
        
        // Regularnie sprawdzaj czy dialog jest otwarty i naprawiaj
        setInterval(fixDialogImages, 300);
      });
    </script>
    

    {{ content_for_header }}
  </head>

  <body class="page-width-{{ settings.page_width }} card-hover-effect-{{ settings.card_hover_effect }}">
    {% render 'skip-to-content-link', href: '#MainContent', text: 'accessibility.skip_to_text' %}
    
    <!-- TRACK LOGIN/REGISTER SUCCESS -->
    <script>
      (function() {
        const isLoggedIn = {{ customer.id | json }} !== null;
        if (!isLoggedIn) {
          return;
        }
        try {
          const authIntent = localStorage.getItem('customify_auth_intent');
          if (!authIntent) {
            return;
          }
          const timestampRaw = localStorage.getItem('customify_auth_intent_timestamp');
          const timestamp = timestampRaw ? parseInt(timestampRaw, 10) : null;
          const authSource = localStorage.getItem('customify_auth_source');
          const MAX_AGE_MS = 30 * 60 * 1000; // 30 minut na wys≈Çanie zdarzenia
          if (timestamp && (Date.now() - timestamp) > MAX_AGE_MS) {
            localStorage.removeItem('customify_auth_intent');
            localStorage.removeItem('customify_auth_intent_timestamp');
            localStorage.removeItem('customify_auth_source');
            return;
          }
          const isRegisterIntent = authIntent.startsWith('register');
          const eventType = isRegisterIntent ? 'login_modal_register_success' : 'login_modal_login_success';
          fetch('https://customify-s56o.vercel.app/api/admin/login-modal-stats', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              eventType,
              productUrl: authSource || localStorage.getItem('customify_return_url') || window.location.pathname,
              timestamp: new Date().toISOString(),
              sourcePage: window.location.pathname
            })
          }).catch(function(err) {
            console.warn('üìä [AUTH SUCCESS] Failed to send event:', err);
          }).finally(function() {
            localStorage.removeItem('customify_auth_intent');
            localStorage.removeItem('customify_auth_intent_timestamp');
            localStorage.removeItem('customify_auth_source');
          });
        } catch (error) {
          console.warn('üìä [AUTH SUCCESS] Tracking error:', error);
        }
      })();
    </script>
    
    <!-- DODAJ LINK "MOJE OBRAZY" DO MENU KONTA KLIENTA -->
    <script>
      (function() {
        // Funkcja dodajƒÖca link "Moje obrazy" do menu konta klienta
        function addMyImagesLink() {
          // Sprawd≈∫ czy jeste≈õmy na stronie konta klienta (Shopify Customer Account API)
          const isAccountPage = window.location.hostname.includes('account.') || 
                                window.location.pathname.startsWith('/account') ||
                                document.querySelector('[data-customer-account]');
          
          if (!isAccountPage) {
            return;
          }

          // Sprawd≈∫ czy link ju≈º istnieje
          const existingLink = document.querySelector('a[href="/pages/my-generations"], a[href*="my-generations"]');
          if (existingLink) {
            console.log('‚úÖ [ACCOUNT-MENU] Link "Moje obrazy" ju≈º istnieje');
            return true;
          }

          // R√≥≈ºne selektory dla menu konta klienta w Shopify Customer Account API
          const menuSelectors = [
            'nav[aria-label*="Account"]',
            'nav[aria-label*="Konto"]',
            'nav[role="navigation"]',
            'nav ul',
            'aside nav',
            'aside nav ul',
            '[role="navigation"] ul',
            'nav > ul',
            'ul[role="list"]'
          ];

          let menuElement = null;
          let ordersLink = null;

          // Szukaj menu i linku "Zam√≥wienia" jednocze≈õnie
          for (const selector of menuSelectors) {
            const elements = document.querySelectorAll(selector);
            for (const el of elements) {
              // Sprawd≈∫ czy to menu (zawiera linki)
              const links = el.querySelectorAll('a');
              if (links.length === 0) continue;

              // Szukaj linku "Zam√≥wienia" w tym menu
              for (const link of links) {
                const text = link.textContent.trim().toLowerCase();
                if (text.includes('zam√≥wienia') || text.includes('orders') || text.includes('order')) {
                  menuElement = el;
                  ordersLink = link;
                  break;
                }
              }
              
              if (menuElement && ordersLink) break;
            }
            if (menuElement && ordersLink) break;
          }

          // Alternatywnie: szukaj bezpo≈õrednio linku "Zam√≥wienia" i znajd≈∫ jego menu
          if (!menuElement || !ordersLink) {
            const allLinks = document.querySelectorAll('nav a, aside a');
            for (const link of allLinks) {
              const text = link.textContent.trim().toLowerCase();
              if (text.includes('zam√≥wienia') || text.includes('orders') || text.includes('order')) {
                ordersLink = link;
                menuElement = link.closest('ul') || link.closest('nav') || link.parentElement;
                break;
              }
            }
          }

          if (!menuElement || !ordersLink) {
            console.log('üîç [ACCOUNT-MENU] Menu lub link "Zam√≥wienia" nie znalezione');
            return false;
          }

          const ordersListItem = ordersLink.closest('li') || ordersLink.parentElement;
          if (!ordersListItem) {
            console.log('üîç [ACCOUNT-MENU] Nie mo≈ºna znale≈∫ƒá elementu listy dla "Zam√≥wienia"');
            return false;
          }

          // Utw√≥rz nowy element listy z linkiem "Moje obrazy"
          const newListItem = document.createElement('li');
          if (ordersListItem.className) {
            newListItem.className = ordersListItem.className;
          }
          
          const newLink = document.createElement('a');
          newLink.href = '/pages/my-generations';
          newLink.textContent = 'Moje obrazy';
          if (ordersLink.className) {
            newLink.className = ordersLink.className;
          }
          // Skopiuj style z linku "Zam√≥wienia"
          if (ordersLink.style.cssText) {
            newLink.style.cssText = ordersLink.style.cssText;
          }
          
          newListItem.appendChild(newLink);

          // Dodaj link po "Zam√≥wienia"
          const parent = ordersListItem.parentElement;
          if (parent) {
            if (ordersListItem.nextSibling) {
              parent.insertBefore(newListItem, ordersListItem.nextSibling);
            } else {
              parent.appendChild(newListItem);
            }
            console.log('‚úÖ [ACCOUNT-MENU] Link "Moje obrazy" dodany do menu konta klienta');
            return true;
          }

          return false;
        }

        // Pr√≥buj dodaƒá link wielokrotnie (dla dynamicznych stron Shopify Customer Account API)
        function tryAddLink() {
          const maxAttempts = 10;
          let attempts = 0;
          
          const interval = setInterval(function() {
            attempts++;
            if (addMyImagesLink() || attempts >= maxAttempts) {
              clearInterval(interval);
            }
          }, 500);
        }

        // Start gdy DOM ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            tryAddLink();
          });
        } else {
          tryAddLink();
        }

        // Obserwuj zmiany w DOM (dla dynamicznych menu Shopify Customer Account API)
        const observer = new MutationObserver(function(mutations) {
          addMyImagesLink();
        });

        setTimeout(function() {
          const accountSection = document.querySelector('main') || document.querySelector('body');
          if (accountSection) {
            observer.observe(accountSection, {
              childList: true,
              subtree: true
            });
          }
        }, 1000);
      })();
    </script>
    
    <!-- KOMPLETNY NAG≈Å√ìWEK CUSTOMIFY -->
    <header class="header-main">
      <!-- G√ìRA HEADERA: Logo + Linki u≈ºytkownika + Koszyk -->
      <div class="header-top">
        <div class="header-container">
          <!-- Logo (≈õrodek) -->
          <div class="header-logo">
            <a href="{{ routes.root_url }}" class="logo-link">
              {% if settings.logo != blank %}
                <img src="{{ settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" class="logo-image">
              {% else %}
                <span class="logo-text">{{ shop.name }}</span>
              {% endif %}
            </a>
          </div>
          
          <!-- Linki u≈ºytkownika + Koszyk (po prawej) -->
          <div class="header-right">
            <div class="header-user">
              {% if customer %}
                <div class="user-section">
                  <a href="{{ routes.account_url }}" class="user-icon-wrapper">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="user-icon">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </a>
                  <div class="user-links">
                    <a href="{{ routes.account_url }}" class="user-text-link">Moje konto</a>
                    <a href="/pages/my-generations" class="user-text-link">Moje generacje</a>
                    <a href="{{ routes.account_logout_url }}" class="user-text-link">Wyloguj siƒô</a>
                  </div>
                </div>
              {% else %}
                <div class="user-section">
                  <a href="{{ routes.account_login_url }}" class="user-icon-wrapper">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="user-icon">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </a>
                  <div class="user-links">
                    <a href="{{ routes.account_login_url }}?return_url={{ '/pages/my-generations?country=PL' | url_encode }}" class="user-text-link">Zaloguj</a>
                    <a href="{{ routes.account_register_url }}?return_url={{ '/pages/my-generations?country=PL' | url_encode }}" class="user-text-link">Zarejestruj</a>
                  </div>
                </div>
              {% endif %}
            </div>

            <div class="header-cart">
              <a href="{{ routes.cart_url }}" class="cart-link">
                <div class="cart-icon-wrapper">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="cart-icon">
                    <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V17C17 18.1 16.1 19 15 19H9C7.9 19 7 18.1 7 17V13M17 13H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {% if cart.item_count > 0 %}
                    <span class="cart-count">{{ cart.item_count }}</span>
                  {% endif %}
                </div>
                <span class="cart-text">Koszyk</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- D√ì≈Å HEADERA: Menu nawigacji -->
      <div class="header-bottom">
        <div class="header-container">
          <nav class="header-nav">
            {% comment %} TYLKO MENU Z SHOPIFY - main-menu-1 {% endcomment %}
            {% if linklists['main-menu-1'] and linklists['main-menu-1'].links.size > 0 %}
              {% for link in linklists['main-menu-1'].links %}
                <div class="nav-item">
                  <a href="{{ link.url }}" class="nav-link">{{ link.title }}</a>
                </div>
              {% endfor %}
            {% endif %}
          </nav>
        </div>
      </div>

    </header>

    <!-- Breadcrumbs -->
    {% if template contains 'product' or template contains 'collection' or template contains 'blog' %}
      <div class="breadcrumbs">
        <div class="breadcrumbs-container">
          <a href="{{ routes.root_url }}" class="breadcrumb-link">Home</a>
          {% if template contains 'product' %}
              <span class="breadcrumb-separator">/</span>
            <a href="/collections/all" class="breadcrumb-link">Produkty</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ product.title | truncate: 50 }}</span>
          {% elsif template contains 'collection' %}
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ collection.title }}</span>
          {% elsif template contains 'blog' %}
            <span class="breadcrumb-separator">/</span>
            <a href="{{ blog.url }}" class="breadcrumb-link">{{ blog.title }}</a>
            {% if article %}
              <span class="breadcrumb-separator">/</span>
              <span class="breadcrumb-current">{{ article.title | truncate: 30 }}</span>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endif %}

    <script
      src="{{ 'critical.js' | asset_url }}"
      type="module"
      async
      blocking="render"
    ></script>

    <main
      id="MainContent"
      class="content-for-layout"
      role="main"
      data-page-transition-enabled="{{ settings.page_transition_enabled }}"
      data-product-transition="{{ settings.transition_to_main_product }}"
      data-template="{{ template }}"
    >
      {{ content_for_layout }}

      {% if template contains 'collection' %}
        <div class="custom-collection-wrapper">
          <h1 class="custom-collection-title">{{ collection.title }}</h1>
          {% if collection.description != blank %}
            <div class="custom-collection-description">{{ collection.description }}</div>
          {% endif %}
          {% if collection.products_count > 0 %}
            {% paginate collection.products by 250 %}
              <div class="custom-collection-grid">
                {% for product in collection.products %}
                  <a href="{{ product.url }}" class="custom-collection-card">
                    <div class="custom-collection-image">
                      {% if product.featured_image %}
                        <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title }}">
                      {% endif %}
                    </div>
                    <div class="custom-collection-meta">
                      <div class="custom-collection-card-title">{{ product.title }}</div>
                      {% if product.price %}
                        <div class="custom-collection-price">{{ product.price | money }}</div>
                      {% endif %}
                    </div>
                  </a>
                {% endfor %}
              </div>
              {% if paginate.pages > 1 %}
                <div class="custom-collection-pagination" style="margin-top: 30px; text-align: center;">
                  {% if paginate.previous %}
                    <a href="{{ paginate.previous.url }}" class="pagination-link" style="margin: 0 10px; padding: 8px 16px; background: #f5f5f5; border-radius: 4px; text-decoration: none; color: #333;">‚Üê Poprzednia</a>
                  {% endif %}
                  <span style="margin: 0 10px; padding: 8px 16px;">Strona {{ paginate.current_page }} z {{ paginate.pages }}</span>
                  {% if paginate.next %}
                    <a href="{{ paginate.next.url }}" class="pagination-link" style="margin: 0 10px; padding: 8px 16px; background: #f5f5f5; border-radius: 4px; text-decoration: none; color: #333;">Nastƒôpna ‚Üí</a>
                  {% endif %}
                </div>
              {% endif %}
            {% endpaginate %}
          {% else %}
            <div class="custom-collection-empty">Brak produkt√≥w do wy≈õwietlenia.</div>
          {% endif %}
        </div>
        <style>
          .custom-collection-wrapper { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
          .custom-collection-title { font-size: 1.8rem; margin: 10px 0 15px; }
          .custom-collection-description { color: #666; margin-bottom: 15px; }
          .custom-collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
          .custom-collection-card { display: block; border: 1px solid #e5e5e5; border-radius: 8px; overflow: hidden; background: #fff; text-decoration: none; color: inherit; transition: box-shadow .2s ease, transform .2s ease; }
          .custom-collection-card:hover { box-shadow: 0 6px 18px rgba(0,0,0,.08); transform: translateY(-2px); }
          .custom-collection-image { aspect-ratio: 1 / 1; background: #f8f9fa; display: flex; align-items: center; justify-content: center; }
          .custom-collection-image img { width: 100%; height: 100%; object-fit: cover; }
          .custom-collection-meta { padding: 10px 12px; }
          .custom-collection-card-title { font-weight: 600; font-size: .95rem; margin-bottom: 6px; }
          .custom-collection-price { color: #000000; font-weight: 700; } /* CZARNY KOLOR */
          .custom-collection-empty { color: #666; padding: 20px 0; }
        </style>
      {% endif %}
    </main>

    {% render 'search-modal' %}

    {% if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add-modal' %}
    {% endif %}

    {% comment %} CUSTOMIFY AI PHOTO CUSTOMIZATION {% endcomment %}
    {% if template contains 'product' %}
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const app = document.getElementById('customify-app-container');
          const placeholder = document.getElementById('customify-placeholder');
          if (app && placeholder) {
            placeholder.appendChild(app);
          }
          
        });
      </script>
      
      <script>
        // Przeka≈º dane produktu do JavaScript
        {% if product %}
        window.ShopifyProduct = {
          id: {{ product.id }},
          title: {{ product.title | json }},
          handle: {{ product.handle | json }},
          variants: {{ product.variants | json }},
          options: {{ product.options | json }},
          price: {{ product.price | money | json }}
        };
        console.log('üì¶ [SHOPIFY PRODUCT] Product data loaded:', window.ShopifyProduct);
        {% endif %}
      </script>
      
      <div id="customify-app-container" class="customify-shopify-container">
        <!-- Wyb√≥r rodzaju wydruku - NAD sekcjƒÖ rozmiar√≥w -->
        <div class="customify-product-type-selector" id="productTypeArea" style="display: block; margin-bottom: 10px;">
          <h4 style="text-align: left; font-size: 0.95rem; font-weight: 600;">Rodzaj wydruku:</h4>
          <div class="customify-product-type-buttons">
            <div class="customify-product-type-btn active" data-product-type="plakat">
              Plakat (dodaj ramkƒô)
            </div>
            <div class="customify-product-type-btn" data-product-type="canvas">
              Obraz na p≈Ç√≥tnie
            </div>
            <!-- üö® ROLLBACK: START - Opcja produktu cyfrowego -->
            <div class="customify-product-type-btn" data-product-type="digital">
              Produkt cyfrowy
            </div>
            <!-- üö® ROLLBACK: END - Opcja produktu cyfrowego -->
          </div>
          <!-- Wysuwane menu wyboru koloru ramki (tylko dla opcji plakat) -->
          <div class="frame-color-selector" id="frameSelector" aria-expanded="false">
            <button type="button" class="frame-toggle" id="frameToggle">
              Ramka: <span id="frameCurrentLabel">Brak ramki</span>
              <span class="frame-caret">‚ñº</span>
            </button>
            <div class="frame-options" id="frameOptions" style="display: none;">
              <div class="frame-option" data-frame="none" aria-selected="true">Brak ramki</div>
              <div class="frame-option" data-frame="black">Czarna</div>
              <div class="frame-option" data-frame="white">Bia≈Ça</div>
              <div class="frame-option" data-frame="wood">Drewno</div>
            </div>
          </div>
        </div>
        
        <!-- Rozmiary - POD sekcjƒÖ rodzaju wydruku -->
        <div class="customify-size-selector" id="sizeArea" style="display: block; margin-bottom: 10px;">
          <h4 style="text-align: left;">Rozmiar (cm):</h4>
          <div class="customify-size-buttons">
                <div class="customify-size-btn" data-size="a4">20√ó30</div>
                <div class="customify-size-btn" data-size="a3">30√ó40</div>
                <div class="customify-size-btn" data-size="a2">40√ó60</div>
                <div class="customify-size-btn" data-size="a1">60√ó85</div>
              </div>
        </div>
        <div id="type-size-original-placeholder" style="display: contents;"></div>
        
        <h3 class="customify-title">Wgraj zdjƒôcie i zobacz efekt od razu</h3>
        
        <!-- Animowane strza≈Çki wskazujƒÖce w d√≥≈Ç -->
        <div class="arrow-down">
          <span>‚Üì</span>
          <span>‚Üì</span>
          <span>‚Üì</span>
        </div>
        <div class="customify-inline-wrapper">
          <div class="customify-embed" id="customifyEmbed">
          <div class="customify-upload-area" id="uploadArea">
            <div class="customify-drop-zone" id="dropZone">
              <div class="drop-zone-content">
                <button class="customify-upload-btn" id="uploadBtn">
                  Dodaj zdjƒôcie
                </button>
              </div>
            </div>
            <input type="file" id="fileInput" class="customify-file-input" accept="image/*">
            <!-- Komunikat b≈Çƒôdu - od razu pod uploadem -->
            <div class="customify-error" id="errorMessage" style="display: none;"></div>
          </div>

            <div class="customify-preview" id="previewArea">
              <h4>Twoje zdjƒôcie:</h4>
              <img id="previewImage" alt="PodglƒÖd zdjƒôcia">
            </div>

            <div class="customify-styles" id="stylesArea" style="display: block;">
              <h4>Wybierz styl</h4>
              <div class="customify-style-grid">
                {% comment %} LOGIKA SERVER-SIDE: Filtruj style per produkt {% endcomment %}
                                {% if product.handle == 'karykatura-z-twojego-zdjecia-obraz' %}
                  {% comment %} TYLKO STYLE KARYKATURY dla produktu karykatura - u≈ºywa Segmind API {% endcomment %}                                                   
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/caricature.png'); background-size: cover; background-position: center;"></div>                                                
                    <div class="style-info">
                      <div class="style-name">Karykatura</div>
                    </div>
                  </div>
                {% elsif product.handle == 'karykatura-prezent-na-rocznice-prezent-ze-zdjecia' %}
                  {% comment %} TYLKO STYLE KARYKATURY dla produktu karykatura-prezent - u≈ºywa Segmind API {% endcomment %}                                                   
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/caricature_2.png'); background-size: cover; background-position: center;"></div>                                                
                    <div class="style-info">
                      <div class="style-name">Karykatura</div>
                    </div>
                  </div>
                {% elsif product.handle == 'personalizowany-portret-w-stylu-boho' %}
                  {% comment %} NOWE STYLE BOHO dla produktu boho {% endcomment %}
                  <div class="customify-style-card" data-style="minimalistyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/boho/minimal.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-name">Minimalistyczny</div>
                  </div>
                  
                  <div class="customify-style-card" data-style="realistyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/boho/detail.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-name">Realistyczny</div>
                  </div>
                {% elsif product.handle == 'krol-portret-personalizowany' %}
                  {% comment %} TYLKO STYLE KR√ìLA dla produktu kr√≥l {% endcomment %}
                  <div class="customify-style-card" data-style="krol-krolewski">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Kr√≥lewski</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-majestatyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-2.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Majestatyczny</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-triumfalny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-3.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Triumfalny</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-imponujacy">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol_4.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l ImponujƒÖcy</div>
                    </div>
                  </div>
                {% elsif product.id == 15389095297349 or product.handle == 'krolowa' or product.handle contains 'krolowa' %}
                  {% comment %} TYLKO STYLE KR√ìLOWEJ dla produktu kr√≥lowa {% endcomment %}
                  <div class="customify-style-card" data-style="krolowa-styl-1">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 1</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-2">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-2.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 2</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-3">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-3.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 3</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-4">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa_sitting.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Sitting</div>
                    </div>
                  </div>
                {% elsif product.handle == 'koty-krolewskie-zwierzeta-w-koronach' %}
                  {% comment %} TYLKO STYLE KOT√ìW dla produktu kot√≥w {% endcomment %}
                  <div class="customify-style-card" data-style="krolewski">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/krolewski.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Kr√≥lewski Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="na-tronie">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/na_tronie.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Kot na Tronie</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="wojenny">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/wojenny.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Wojenny Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="wiktorianski">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/wiktorianski.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Wiktoria≈Ñski Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="renesansowy">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/renesansowy.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Renesansowy Kot</div>
                  </div>
                </div>
                {% elsif product.id == 15306975215941 %}
                  {% comment %} TYLKO STYL PIXAR dla produktu zabawne-style (ID: 15306975215941) {% endcomment %}
                  <div class="customify-style-card" data-style="pixar">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/pixar/pixar-styl.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Pixar</div>
                    </div>
                  </div>
                {% elsif product.id == 15475649675589 or product.handle contains 'akwarela' %}
                  {% comment %} TYLKO STYL AKWARELE dla produktu akwarela - u≈ºywa Segmind Become-Image API {% endcomment %}
                  <div class="customify-style-card" data-style="akwarela">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/akwarela/watercolor-style.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Akwarela</div>
                    </div>
                  </div>
                {% else %}
                  {% comment %} WSZYSTKIE STYLE NORMALNE dla innych produkt√≥w {% endcomment %}
                  <div class="customify-style-card" data-style="van gogh">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.01.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Van Gogh</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="picasso">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.14.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Picasso</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="monet">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/pixar/pixar-styl.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Monet</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="anime">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.52.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Anime</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="cyberpunk">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.01.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Cyberpunk</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="watercolor">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.14.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Akwarela</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="pixar">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/pixar/pixar-styl.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Pixar</div>
                    </div>
                  </div>
                {% endif %}
              </div>
        </div>


            <!-- Komunikat b≈Çƒôdu - tu≈º nad przyciskiem "Zobacz PodglƒÖd" -->
            <div class="customify-error" id="errorMessageTransform" style="display: none;"></div>
            
            <div class="customify-actions" id="actionsArea" style="display: none;">
              <button class="customify-btn customify-btn-red" id="transformBtn">
                Zobacz PodglƒÖd
              </button>
              <button class="customify-btn customify-btn-secondary" id="resetBtn" style="display: none;">
                Wgraj inne zdjƒôcie
              </button>
              <button class="customify-btn customify-btn-primary" id="addToCartBtnMain" style="display: none;">
                Dodaj do koszyka
              </button>
      </div>

            <div class="customify-loading" id="loadingArea">
              <!-- Animowane strza≈Çki wskazujƒÖce w d√≥≈Ç -->
              <div class="arrow-down">
                <span>‚Üì ‚Üì ‚Üì</span>
              </div>
              <div class="customify-spinner"></div>
              <div class="loading-text">Generowanie mo≈ºe potrwaƒá nawet 2 minuty - zaczekaj</div>
              <div class="loading-progress">
                <div class="loading-progress-bar" id="progressBar"></div>
              </div>
              <div class="loading-stage" id="loadingStage">Przesy≈Çanie zdjƒôcia...</div>
            </div>

            <div class="customify-result" id="resultArea">
              <h4>Tw√≥j obraz:</h4>
              <img id="resultImage" alt="Wynik AI">
              <p style="font-size: 0.85rem; color: #666; text-align: center; margin: 8px 0 0 0; font-style: italic;">Znak√≥w wodnych nie bƒôdzie na ko≈Ñcowym produkcie</p>
              
              <!-- Komunikat sukcesu -->
              <div class="customify-success" id="successMessage"></div>
              
              <!-- Slot do przeniesienia sekcji typu i rozmiaru nad cenƒô -->
              <div id="type-size-inline-slot"></div>
              
              <!-- Cena nad przyciskiem -->
              <div class="customify-cart-price" id="cartPriceDisplay" style="display: none; margin: 15px 0; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                <span class="cart-price-label" style="font-weight: 600; color: #333; margin-right: 12px;">Cena:</span>
                <span class="cart-price-value" id="cartPriceValue" style="font-size: 1.2rem; font-weight: 700; color: #e55a2b;">0.00 z≈Ç</span>
              </div>
              
              <!-- Komunikat b≈Çƒôdu - tu≈º nad przyciskiem "Dodaj do koszyka" -->
              <div class="customify-error" id="errorMessageBottom" style="display: none;"></div>
              
              <div class="customify-actions" style="margin-top: 15px;">
                <button class="customify-btn customify-btn-primary customify-btn-red" id="addToCartBtn">
                  Dodaj do koszyka
                </button>
                <button class="customify-btn customify-btn-secondary" id="tryAgainBtn">
                  Spr√≥buj ponownie
                </button>
              </div>
            
            <!-- Pasek postƒôpu dla dodawania do koszyka -->
            <div class="customify-cart-loading" id="cartLoadingArea" style="display: none;">
              <div class="customify-spinner"></div>
              <div class="loading-text">Dodawanie do koszyka...</div>
              <div class="loading-progress">
                <div class="loading-progress-bar" id="cartProgressBar"></div>
              </div>
              <div class="loading-stage" id="cartLoadingStage">Tworzenie produktu...</div>
            </div>
            </div>

            <!-- ACCORDION: SZCZEG√ì≈ÅY PRODUKTU (NA SAMYM DOLE APLIKACJI) -->
            <div class="product-details-accordion">
              
              <!-- 1. Szczeg√≥≈Çy produktu -->
              <div class="accordion-item" data-accordion="details">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>O produkcie</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <p><strong>Obraz na p≈Ç√≥tnie</strong> - wydrukowane na grubym, premium p≈Ç√≥tnie canvas z naturalnƒÖ teksturƒÖ. NaciƒÖgniƒôte na drewnianƒÖ antyramƒô</p>
                  
                  <!-- Wizualizacja: Obraz na p≈Ç√≥tnie -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/obraz.png" alt="Obraz na p≈Ç√≥tnie" class="accordion-visual-image">
                    </div>
                  </div>
                  
                  <br>
                  <p><strong>Plakat</strong> - wydruk na papierze fotograficznym, kt√≥ry wysy≈Çamy zwiniƒôty w eleganckiej tubie. Mo≈ºesz wybraƒá ramkƒô. W√≥wczas wydruk bƒôdzie w ramce za szk≈Çem.</p>
                  
                  <!-- Wizualizacja: Plakat -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/plakat.png" alt="Plakat" class="accordion-visual-image">
                    </div>
                  </div>
                  
                  <br>
                  <p><strong>Produkt cyfrowy</strong> ‚Äì plik w wysokiej jako≈õci, bez znak√≥w wodnych, do natychmiastowego pobrania (bez wysy≈Çki fizycznego obrazu).</p>
                  
                  <ul>
                    <li>Otrzymujesz plik w wysokiej rozdzielczo≈õci, bez znak√≥w wodnych.</li>
                    <li>Link do pobrania wysy≈Çamy natychmiast po op≈Çaceniu zam√≥wienia ‚Äì zero czekania na kuriera.</li>
                    <li>Idealny do druku w domu lub fotolabie, jako tapeta na telefon/komputer albo do udostƒôpniania w social mediach.</li>
                  </ul>
                  
                  <p><strong>To jest produkt cyfrowy ‚Äì nie wysy≈Çamy fizycznego obrazu.</strong></p>
                  
                  <!-- Wizualizacja: Produkt cyfrowy -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/icon_digital.png" alt="Produkt cyfrowy" class="accordion-visual-image">
                    </div>
                  </div>
                </div>
              </div>

              <!-- 2. Wysy≈Çka i dostawa -->
              <div class="accordion-item" data-accordion="shipping">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Wysy≈Çka i dostawa</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <ul>
                    <li><strong>‚ö° Szybka realizacja:</strong> 3-5 dni roboczych od akceptacji projektu</li>
                    <li><strong>üì¶ Bezpieczne opakowanie:</strong> Karton wzmocniony + folia bƒÖbelkowa - gwarancja bezpiecznej dostawy</li>
                    <li><strong>üáµüá± Wysy≈Çka:</strong> InPost Paczkomaty, InPost Kurier</li>
                    <li><strong>üìç ≈öledzenie przesy≈Çki:</strong> Numer trackingowy wysy≈Çany mailem - zawsze wiesz gdzie jest Twoja przesy≈Çka</li>
                    <li><strong>üöö Darmowa dostawa:</strong> Przy zam√≥wieniach powy≈ºej 400 z≈Ç</li>
                    <li><strong>‚è∞ Czas dostawy:</strong> 1-3 dni robocze (w zale≈ºno≈õci od wybranej opcji)</li>
                  </ul>
                </div>
              </div>

              <!-- 3. Dostƒôpne rozmiary -->
              <div class="accordion-item" data-accordion="sizes">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Dostƒôpne rozmiary</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <!-- Wizualizacja: Rozmiary -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/wymiary.png" alt="Dostƒôpne rozmiary" class="accordion-visual-image">
                      <div class="accordion-visual-label">üìè Dostƒôpne rozmiary</div>
                    </div>
                  </div>
                  
                  <div class="accordion-size-grid">
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">20 √ó 30 cm</div>
                      <div class="accordion-size-description">≈öwietny do ma≈Çych pokoi</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">30 √ó 40 cm</div>
                      <div class="accordion-size-description">Doskona≈Çy do ≈õrednich pomieszcze≈Ñ</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">40 √ó 60 cm</div>
                      <div class="accordion-size-description">Efektowny na du≈ºe ≈õciany w salonie</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">60 √ó 85 cm</div>
                      <div class="accordion-size-description">ImponujƒÖcy na ca≈ÇƒÖ ≈õcianƒô</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 4. Jak to dzia≈Ça -->
              <div class="accordion-item" data-accordion="howto">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Jak to dzia≈Ça?</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <div class="accordion-step">
                    <div class="accordion-step-number">1</div>
                    <div class="accordion-step-content">
                      <strong>Wgraj swoje zdjƒôcie</strong><br>
                      JPG, PNG lub GIF do 10MB. Najlepiej w wysokiej rozdzielczo≈õci.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">2</div>
                    <div class="accordion-step-content">
                      <strong>Wybierz styl artystyczny</strong><br>
                      Dostƒôpne style do wyboru w zak≈Çadce powy≈ºej.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">3</div>
                    <div class="accordion-step-content">
                      <strong>Wybierz rozmiar wydruku</strong><br>
                      Wybierz idealny rozmiar dla Twojej przestrzeni.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">4</div>
                    <div class="accordion-step-content">
                      <strong>AI przekszta≈Çci Twoje zdjƒôcie</strong><br>
                      Najnowocze≈õniejsza technologia sztucznej inteligencji w 30-60 sekund.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">5</div>
                    <div class="accordion-step-content">
                      <strong>Drukujemy i wysy≈Çamy</strong><br>
                      Wysokiej jako≈õci druk na p≈Ç√≥tnie premium, bezpiecznie zapakowany.
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <!-- KONIEC ACCORDION (NA SAMYM DOLE) -->

              </div>
          </div>
        </div>
      </div>
      
      <style>
        /* Kolor nag≈Ç√≥wka nad uploaderem */
        .customify-title {
          color: #dc3545 !important;
        }
        /* Wysuwane menu ramki */
        .frame-color-selector {
          margin-top: 8px;
          max-width: 450px;
        }
        .frame-toggle {
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 8px;
          padding: 6px 10px;
          border: 1px solid #666666 !important;
          background: #ffffff;
          color: #333;
          font-size: 0.85rem;
          cursor: pointer;
        }
        .frame-caret { font-size: 0.8rem; color: #666; }
        .frame-options {
          border: 1px solid #e0e0e0;
          border-top: none;
          background: #fff;
        }
        .frame-option {
          padding: 6px 10px;
          cursor: pointer;
          font-size: 0.85rem;
          border-top: 1px solid #f2f2f2;
        }
        .frame-option:hover { background: #fff9db; }
        .frame-option[aria-selected="true"] {
          background: #fff7cc;
          color: #b7791f;
        }
        .frame-color-selector.disabled {
          opacity: 0.5;
          pointer-events: none;
        }
        /* Marginesy po przeniesieniu sekcji typu i rozmiaru nad cenƒô */
        #type-size-inline-slot > .customify-product-type-selector,
        #type-size-inline-slot > .customify-size-selector {
          margin: 10px 0 10px 0;
        }
        /* GRID STYL√ìW AI - TYLKO STYLE, NIE DOTYKAM PROPORCJI */
        .customify-style-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 15px;
          margin-bottom: 20px;
        }

        .customify-style-card {
          border: 2px solid #dee2e6;
          border-radius: 8px;
          background: white;
          cursor: pointer;
          transition: all 0.3s ease;
          overflow: hidden;
        }

        .customify-style-card:hover {
          border-color: #c82333;
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .customify-style-card.active {
          border-color: #dc3545 !important;
          box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.2) !important;
          transform: scale(1.02) !important;
        }

        .style-image {
          width: 100%;
          aspect-ratio: 3 / 4; /* üéØ WSZYSTKIE style - jednolity pionowy format portret */
          background-size: contain;
          background-position: center;
          background-repeat: no-repeat;
        }

        /* Gradienty usuniƒôte - u≈ºywamy obrazk√≥w */

        .style-info {
          padding: 8px;
          text-align: center;
        }

        .style-name {
          font-weight: 600;
          font-size: 0.9rem;
          color: #333;
          margin-bottom: 2px;
        }

        /* Ceny styl√≥w usuniƒôte - style nie wp≈ÇywajƒÖ na cenƒô */

        @media (max-width: 768px) {
          .customify-style-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
          }
        }

        /* MOBILE HEADER STYLES */
        @media (max-width: 768px) {
          /* G√ìRA HEADERA: Logo + Ikony w jednej linii */
          .header-top .header-container {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            justify-content: space-between !important;
            padding: 15px !important;
            gap: 15px !important;
          }
          
          /* LOGO NA MOBILE */
          .header-logo {
            flex-grow: 1 !important;
            text-align: center !important;
          }
          
          /* ZMNIEJSZ LOGO NA MOBILE */
          .header-logo img {
            max-width: 120px !important;
            height: auto !important;
          }
          
          /* IKONKI PO PRAWEJ */
          .header-right {
            display: flex !important;
            align-items: center !important;
            gap: 15px !important;
          }
          
          /* D√ì≈Å HEADERA: Menu poni≈ºej */
          .header-bottom {
            width: 100% !important;
            background-color: #f8f9fa !important;
            border-top: 1px solid #dee2e6 !important;
          }
          
          .header-bottom .header-container {
            padding: 10px 15px !important;
          }
          
          .header-nav {
            display: flex !important;
            justify-content: center !important;
            flex-wrap: wrap !important;
            gap: 15px !important;
          }
          
          .nav-item {
            margin-right: 0 !important;
            margin-bottom: 0 !important;
          }
          
          .nav-link {
            font-size: 14px !important;
            padding: 8px 12px !important;
            color: #495057 !important;
            text-decoration: none !important;
            border-radius: 4px !important;
            transition: background-color 0.2s !important;
          }
          
          .nav-link:hover {
            background-color: #e9ecef !important;
            color: #dc3545 !important;
          }
          
          /* UKRYJ NAPISY "ZALOGUJ" I "ZAREJESTRUJ" NA MOBILE */
          .user-text-link {
            display: none !important;
          }
          
          /* ZOSTAW TYLKO IKONKƒò OSOBY */
          .user-section {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 0 !important;
          }
          
          /* ZMIE≈É IKONKƒò OSOBY NA BARDZIEJ POPULARNƒÑ I MNIEJ KOLOROWƒÑ */
          .user-icon-wrapper {
            width: 36px !important;
            height: 36px !important;
            border-radius: 50% !important;
            background-color: #f8f9fa !important;
            border: 1px solid #dee2e6 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            text-decoration: none !important;
            cursor: pointer !important;
          }
          
          .user-icon {
            width: 20px !important;
            height: 20px !important;
            color: #6c757d !important;
          }
          
          /* HOVER EFFECT DLA IKONKI */
          .user-section:hover .user-icon-wrapper {
            border-color: #dc3545 !important;
            background-color: #fff5f5 !important;
          }
          
          .user-section:hover .user-icon {
            color: #dc3545 !important;
          }
        }


        /* CSS dla rozmiar√≥w */
        .customify-size-selector {
          display: block;
          margin-bottom: 24px;
          background: white;
          border-radius: 0;
          padding: 8px 0; /* ZMNIEJSZONO: z 20px na 8px */
          border: none;
          border-top: 1px solid #e9ecef;
        }

        .customify-size-selector h4 {
          font-size: 1.2rem;
          font-weight: 600;
          color: #000;
          margin: 0 0 16px 0;
          text-align: center;
        }

        .customify-size-buttons {
          display: grid;
          grid-template-columns: repeat(4, 70px);
          gap: 8px;
          justify-content: start;
        }

        .customify-size-btn {
          padding: 1px 6px;
          border: 1px solid #666666 !important;
          border-radius: 0;
          background: white;
          cursor: pointer;
          transition: all 0.3s ease;
          text-align: center;
          font-size: 0.85rem;
          font-weight: 500;
          color: #333;
          box-shadow: none;
          line-height: 1.3;
          min-height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .customify-size-btn:hover {
          border-color: #f0ad00;
          background-color: #fff9db;
          transform: none;
          box-shadow: none;
        }

        .customify-size-btn.active {
          border: 2px solid #f0ad00 !important;
          background: #fff7cc !important;
          color: #b7791f !important;
          font-weight: 600 !important;
          transform: none !important;
          box-shadow: none !important;
        }

        .customify-size-btn.disabled {
          pointer-events: none;
          opacity: 0.5;
          cursor: not-allowed;
          border: 1px solid #d0d0d0 !important;
          color: #999999 !important;
          background: #f8f9fa !important;
        }

        .customify-size-btn.disabled:hover {
          background-color: #f8f9fa !important;
          border: 1px solid #d0d0d0 !important;
          transform: none !important;
          box-shadow: none !important;
        }

        /* ===== UKRYJ NATYWNE WARIANTY SHOPIFY ===== */
        .variant-picker__form,
        fieldset.variant-option,
        .variant-option--buttons {
          display: none !important;
        }
        
        /* ===== PRZYCISKI WYBORU TYPU PRODUKTU (Plakat vs Canvas vs Digital) ===== */
        /* üö® ROLLBACK: START - CSS dla 3 przycisk√≥w (dodano produkt cyfrowy) */
        .customify-product-type-buttons {
          display: grid;
          grid-template-columns: repeat(3, 1fr); /* üö® ROLLBACK: Zmieniono z 2 na 3 */
          gap: 8px;
          justify-content: start;
          margin-top: 8px;
          max-width: 600px; /* üö® ROLLBACK: Zwiƒôkszono szeroko≈õƒá dla 3 przycisk√≥w */
        }
        /* üö® ROLLBACK: END - CSS dla 3 przycisk√≥w */

        .customify-product-type-btn {
          padding: 1px 6px;
          border: 1px solid #666666 !important;
          border-radius: 0;
          background: white;
          cursor: pointer;
          transition: all 0.3s ease;
          text-align: center;
          font-size: 0.85rem;
          font-weight: 500;
          color: #333;
          box-shadow: none;
          line-height: 1.3;
          min-height: 36px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .customify-product-type-btn:hover {
          border-color: #f0ad00;
          background-color: #fff9db;
          transform: none;
          box-shadow: none;
        }

        .customify-product-type-btn.active {
          border: 2px solid #f0ad00 !important;
          background: #fff7cc !important;
          color: #b7791f !important;
          font-weight: 600 !important;
          transform: none !important;
          box-shadow: none !important;
        }

        /* Responsive dla typu produktu */
        /* üö® ROLLBACK: START - Responsive dla 3 przycisk√≥w */
        @media (max-width: 768px) {
          .customify-product-type-btn {
            font-size: 0.8rem !important;
            padding: 1px 4px !important;
            min-height: 32px !important;
          }
          .customify-product-type-buttons {
            grid-template-columns: repeat(3, 1fr) !important; /* üö® ROLLBACK: 3 kolumny na mobile */
            gap: 6px !important;
          }
        }
        /* üö® ROLLBACK: END - Responsive dla 3 przycisk√≥w */

        /* Style dla ceny produktu - NAPRAWIONY SELEKTOR */
        product-price > div,
        product-price div {
          font-size: 1.4rem !important;
          font-weight: 700 !important;
          color: #000000 !important; /* CZARNY KOLOR */
          margin: 0 !important;
          padding: 0 !important;
          line-height: 1.1 !important;
        }
        
        /* Dodatkowe selektory dla ceny produktu */
        .price,
        [class*="price"] {
          font-size: 1.4rem !important;
          font-weight: 700 !important;
          color: #000000 !important; /* CZARNY KOLOR */
        }
        
        /* Minimalne odstƒôpy w komponencie ceny */
        product-price {
          display: inline-block !important;
          margin: 0 !important;
          padding: 0 !important;
          line-height: 1.1 !important;
          --padding-block-start: 0px !important;
          --padding-block-end: 0px !important;
        }
        
        /* OCHRONA: Nowa cena nad przyciskiem NIE wp≈Çywa na oryginalnƒÖ cenƒô */
        .customify-cart-price {
          /* Nowa cena ma w≈Çasne style - nie wp≈Çywa na oryginalnƒÖ cenƒô */
        }
        
        /* Upewnij siƒô ≈ºe oryginalna cena produktu ma priorytet */
        product-price,
        product-price > div,
        product-price div,
        .price,
        [class*="price"] {
          font-size: 1.4rem !important;
          font-weight: 700 !important;
          color: #000000 !important; /* CZARNY KOLOR */
          text-decoration: none !important;
        }
      </style>
      <script>
        // Dynamiczne przenoszenie sekcji rodzaju i rozmiaru nad cenƒô, gdy widoczny jest wynik AI
        document.addEventListener('DOMContentLoaded', function() {
          var resultArea = document.getElementById('resultArea');
          var inlineSlot = document.getElementById('type-size-inline-slot');
          var originalPlaceholder = document.getElementById('type-size-original-placeholder');
          var productTypeArea = document.getElementById('productTypeArea');
          var sizeArea = document.getElementById('sizeArea');
          // Elemente ramki
          var frameSelector = document.getElementById('frameSelector');
          var frameToggle = document.getElementById('frameToggle');
          var frameOptions = document.getElementById('frameOptions');
          var frameCurrentLabel = document.getElementById('frameCurrentLabel');

          if (!resultArea || !inlineSlot || !originalPlaceholder || !productTypeArea || !sizeArea) {
            return;
          }

          function isVisible(el) {
            if (!el) return false;
            var style = window.getComputedStyle(el);
            return style.display !== 'none' && style.visibility !== 'hidden' && el.offsetParent !== null;
          }

          function moveToResult() {
            if (!inlineSlot.contains(productTypeArea)) {
              inlineSlot.appendChild(productTypeArea);
            }
            if (!inlineSlot.contains(sizeArea)) {
              inlineSlot.appendChild(sizeArea);
            }
          }

          function moveBack() {
            if (productTypeArea && productTypeArea.parentElement !== originalPlaceholder.parentElement) {
              originalPlaceholder.parentNode.insertBefore(productTypeArea, originalPlaceholder);
            }
            if (sizeArea && sizeArea.parentElement !== originalPlaceholder.parentElement) {
              originalPlaceholder.parentNode.insertBefore(sizeArea, originalPlaceholder);
            }
          }

          function syncPosition() {
            if (isVisible(resultArea)) {
              moveToResult();
            } else {
              moveBack();
            }
          }

          // Obserwuj zmiany widoczno≈õci
          var observer = new MutationObserver(syncPosition);
          observer.observe(resultArea, { attributes: true, attributeFilter: ['style', 'class'], subtree: false });

          // Polling jako fallback (np. zmiany przez skrypty zewnƒôtrzne)
          setInterval(syncPosition, 500);

          // Pierwsza synchronizacja
          syncPosition();

          // ============ LOGIKA RAMKI ============
          // Stan globalny (wsp√≥≈Çdzielony miƒôdzy lokalizacjami)
          window.CustomifyFrame = window.CustomifyFrame || { color: 'none' };

          function setFrame(color) {
            window.CustomifyFrame.color = color;
            // Aktualizuj UI
            if (frameCurrentLabel) {
              frameCurrentLabel.textContent =
                color === 'black' ? 'Czarna' :
                color === 'white' ? 'Bia≈Ça' :
                color === 'wood'  ? 'Drewno' : 'Brak ramki';
            }
            if (frameOptions) {
              var opts = frameOptions.querySelectorAll('.frame-option');
              opts.forEach(function(opt){
                opt.setAttribute('aria-selected', opt.getAttribute('data-frame') === color ? 'true' : 'false');
              });
            }
          }

          function toggleOptions() {
            if (!frameOptions) return;
            var isOpen = frameOptions.style.display !== 'none';
            frameOptions.style.display = isOpen ? 'none' : 'block';
            if (frameSelector) frameSelector.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
          }

          function closeOptions() {
            if (frameOptions) {
              frameOptions.style.display = 'none';
              if (frameSelector) frameSelector.setAttribute('aria-expanded', 'false');
            }
          }

          function isPlakatSelected() {
            var active = productTypeArea && productTypeArea.querySelector('.customify-product-type-btn.active');
            return active && active.getAttribute('data-product-type') === 'plakat';
          }

          // üö® ROLLBACK: START - Funkcje dla produktu cyfrowego
          function isDigitalProductSelected() {
            var active = productTypeArea && productTypeArea.querySelector('.customify-product-type-btn.active');
            return active && active.getAttribute('data-product-type') === 'digital';
          }

          function updateDigitalProductUI() {
            var isDigital = isDigitalProductSelected();
            var sizeArea = document.getElementById('sizeArea');
            
            // Ukryj/poka≈º rozmiary
            if (sizeArea) {
              if (isDigital) {
                sizeArea.style.display = 'none';
                console.log('üì¶ [DIGITAL] Size area hidden for digital product');
              } else {
                sizeArea.style.display = 'block';
                console.log('üì¶ [DIGITAL] Size area shown for physical product');
              }
            }
          }
          // üö® ROLLBACK: END - Funkcje dla produktu cyfrowego

          function updateFrameAvailability() {
            var enabled = isPlakatSelected();
            // üö® ROLLBACK: START - Ukryj ramkƒô dla produktu cyfrowego
            var isDigital = isDigitalProductSelected();
            if (isDigital) {
              enabled = false; // Produkt cyfrowy nie ma ramki
            }
            // üö® ROLLBACK: END - Ukryj ramkƒô dla produktu cyfrowego
            
            if (frameSelector) {
              if (enabled) {
                frameSelector.classList.remove('disabled');
              } else {
                frameSelector.classList.add('disabled');
                closeOptions();
              }
            }
          }

          // Inicjalizacja UI ramki
          setFrame(window.CustomifyFrame.color || 'none');
          updateFrameAvailability();
          // üö® ROLLBACK: START - Inicjalizacja UI produktu cyfrowego
          updateDigitalProductUI();
          // üö® ROLLBACK: END - Inicjalizacja UI produktu cyfrowego

          // Zdarzenia UI
          if (frameToggle) {
            frameToggle.addEventListener('click', function(e){
              if (frameSelector && frameSelector.classList.contains('disabled')) return;
              toggleOptions();
            });
          }
          if (frameOptions) {
            frameOptions.addEventListener('click', function(e){
              var target = e.target.closest('.frame-option');
              if (!target) return;
              if (frameSelector && frameSelector.classList.contains('disabled')) return;
              var color = target.getAttribute('data-frame');
              setFrame(color);
              closeOptions();
              if (window.__customify && typeof window.__customify.updateCartPrice === 'function') {
                window.__customify.updateCartPrice();
                if (typeof window.__customify.updateProductPrice === 'function') {
                  window.__customify.updateProductPrice();
                }
              }
            });
          }
          document.addEventListener('click', function(e){
            if (!frameSelector) return;
            if (!frameSelector.contains(e.target)) closeOptions();
          });

          // Nas≈Çuchiwanie na zmianƒô typu produktu (Plakat/Canvas/Digital)
          var typeBtns = productTypeArea ? productTypeArea.querySelectorAll('.customify-product-type-btn') : [];
          typeBtns.forEach(function(btn){
            btn.addEventListener('click', function(){
              // Daj czas istniejƒÖcym handlerom na ustawienie .active
              setTimeout(function(){
                updateFrameAvailability();
                // üö® ROLLBACK: START - Aktualizuj UI produktu cyfrowego
                updateDigitalProductUI();
                // üö® ROLLBACK: END - Aktualizuj UI produktu cyfrowego
              }, 0);
            });
          });
        });
      </script>
    {% endif %}

    {% comment %} CUSTOMIFY CART INTEGRATION {% endcomment %}
    {% if template contains 'cart' %}
      <style>
        .cart-item__ai-image {
          width: 80px;
          height: 80px;
          object-fit: cover;
          border-radius: 0;
          border: 2px solid #e0e0e0;
          margin-right: 15px;
        }
        
        .cart-item__content-wrapper {
          display: flex;
          gap: 15px;
          align-items: start;
        }
        
        /* Lightbox dla powiƒôkszonych obrazk√≥w AI */
        .customify-lightbox {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          background: rgba(0, 0, 0, 0.9);
          z-index: 99999;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: zoom-out;
          animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        .customify-lightbox img {
          max-width: 95vw;
          max-height: 95vh;
          width: auto;
          height: auto;
          object-fit: contain;
          image-rendering: -webkit-optimize-contrast;
          image-rendering: crisp-edges;
          border-radius: 8px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
          animation: zoomIn 0.2s ease;
        }
        
        @keyframes zoomIn {
          from { transform: scale(0.9); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
        
        .customify-lightbox-close {
          position: absolute;
          top: 20px;
          right: 20px;
          width: 40px;
          height: 40px;
          background: white;
          border: none;
          border-radius: 50%;
          cursor: pointer;
          font-size: 24px;
          font-weight: bold;
          color: #333;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
          transition: all 0.2s ease;
        }
        
        .customify-lightbox-close:hover {
          background: #f5f5f5;
          transform: scale(1.1);
        }
      </style>
      
      <script>
        /**
         * CUSTOMIFY: Wy≈ÇƒÖcz linki do wszystkich produkt√≥w w koszyku
         * Klikniƒôcie miniaturki pokazuje powiƒôkszony obraz zamiast prowadziƒá do produktu
         * Wszystkie produkty w sklepie sƒÖ AI - nie ma potrzeby filtrowania
         */
        (function() {
          console.log('üõí [CUSTOMIFY CART] Inicjalizacja wy≈ÇƒÖczania link√≥w produkt√≥w AI');
          
          // Funkcja dodawania watermarku do obrazka
          async function addWatermarkToImage(imageUrl) {
            return new Promise((resolve, reject) => {
              const img = new Image();
              img.crossOrigin = 'anonymous';
              
              img.onload = () => {
                try {
                  const canvas = document.createElement('canvas');
                  const ctx = canvas.getContext('2d');
                  
                  canvas.width = img.width;
                  canvas.height = img.height;
                  
                  // Rysuj oryginalny obraz
                  ctx.drawImage(img, 0, 0);
                  
                  // ===== WZ√ìR DIAGONALNY - "Lumly.pl" i "PodglƒÖd" NA PRZEMIAN =====
                  ctx.save();
                  
                  // ‚úÖ ZWIƒòKSZONY FONT I OPACITY DLA LEPSZEJ WIDOCZNO≈öCI
                  const fontSize = Math.max(40, Math.min(canvas.width, canvas.height) * 0.08); // Min 40px, max 8% obrazu
                  
                  // ‚úÖ FIX: U≈ºyj systemowego fontu z fallbackami (Arial mo≈ºe nie byƒá dostƒôpny w Canvas)
                  // U≈ºyj fontu kt√≥ry ZAWSZE jest dostƒôpny w przeglƒÖdarce
                  const fontFamily = 'sans-serif'; // Systemowy font - zawsze dostƒôpny
                  ctx.font = `bold ${fontSize}px ${fontFamily}`;
                  
                  // ‚úÖ SPRAWD≈π CZY FONT JEST ZA≈ÅADOWANY (test renderowania)
                  ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'; // ‚úÖ ZWIƒòKSZONA OPACITY (by≈Ço 0.5)
                  ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)'; // ‚úÖ ZWIƒòKSZONA OPACITY (by≈Ço 0.35)
                  ctx.lineWidth = 2; // ‚úÖ ZWIƒòKSZONA GRUBO≈öƒÜ (by≈Ço 1.5)
                  ctx.textAlign = 'center';
                  ctx.textBaseline = 'middle';
                  
                  // ‚úÖ TEST: Sprawd≈∫ czy tekst siƒô renderuje (je≈õli nie - u≈ºyj innego fontu)
                  const testText = 'Test';
                  const testMetrics = ctx.measureText(testText);
                  if (testMetrics.width === 0) {
                    console.warn('‚ö†Ô∏è [WATERMARK] Font test failed, using fallback');
                    ctx.font = `bold ${fontSize}px monospace`; // Fallback na monospace
                  }
                  
                  // Obr√≥ƒá canvas
                  ctx.translate(canvas.width/2, canvas.height/2);
                  ctx.rotate(-30 * Math.PI / 180);
                  ctx.translate(-canvas.width/2, -canvas.height/2);
                  
                  // Rysuj watermarki w siatce - na przemian "Lumly.pl" i "PodglƒÖd"
                  const spacing = Math.max(200, Math.min(canvas.width, canvas.height) * 0.3); // ‚úÖ DYNAMICZNY SPACING
                  let textIndex = 0;
                  const texts = ['Lumly.pl', 'PodglƒÖd'];
                  
                  for(let y = -canvas.height; y < canvas.height * 2; y += spacing) {
                    for(let x = -canvas.width; x < canvas.width * 2; x += spacing * 1.5) {
                      const text = texts[textIndex % 2];
                      // ‚úÖ RYSUJ STROKE PRZED FILL (dla lepszej widoczno≈õci)
                      ctx.strokeText(text, x, y);
                      ctx.fillText(text, x, y);
                      textIndex++;
                    }
                    // Zmie≈Ñ wz√≥r co wiersz dla lepszego efektu
                    textIndex++;
                  }
                  
                  ctx.restore();
                  
                  // Zwr√≥ƒá obraz z watermarkiem jako Data URL
                  resolve(canvas.toDataURL('image/jpeg', 0.92));
                  console.log('‚úÖ [CUSTOMIFY CART] Watermark dodany do miniaturki');
                } catch (error) {
                  console.error('‚ùå [CUSTOMIFY CART] Watermark error:', error);
                  reject(error);
                }
              };
              
              img.onerror = (error) => {
                console.error('‚ùå [CUSTOMIFY CART] Image load error:', error);
                reject(error);
              };
              
              img.src = imageUrl;
            });
          }
          
          function showImageLightbox(imageUrl) {
            console.log('üîç [CUSTOMIFY CART] Pokazujƒô lightbox dla:', imageUrl);
            
            // Stw√≥rz overlay
            const overlay = document.createElement('div');
            overlay.className = 'customify-lightbox';
            
            // Dodaj powiƒôkszony obraz
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'Powiƒôkszony obraz AI';
            
            // Przycisk zamkniƒôcia
            const closeBtn = document.createElement('button');
            closeBtn.className = 'customify-lightbox-close';
            closeBtn.innerHTML = '√ó';
            closeBtn.setAttribute('aria-label', 'Zamknij');
            
            overlay.appendChild(img);
            overlay.appendChild(closeBtn);
            
            // Zamknij po klikniƒôciu overlay lub przycisku
            overlay.addEventListener('click', (e) => {
              if (e.target === overlay || e.target === closeBtn) {
                overlay.remove();
                console.log('üîç [CUSTOMIFY CART] Lightbox zamkniƒôty');
              }
            });
            
            // Zamknij po ESC
            const handleEsc = (e) => {
              if (e.key === 'Escape') {
                overlay.remove();
                document.removeEventListener('keydown', handleEsc);
                console.log('üîç [CUSTOMIFY CART] Lightbox zamkniƒôty (ESC)');
              }
            };
            document.addEventListener('keydown', handleEsc);
            
            document.body.appendChild(overlay);
          }
          
          function disableAIProductLinks() {
            console.log('üõí [CUSTOMIFY CART] Wy≈ÇƒÖczam linki dla wszystkich produkt√≥w w koszyku...');
            
            // Znajd≈∫ wszystkie elementy koszyka (r√≥≈ºne selektory dla r√≥≈ºnych motyw√≥w)
            const cartItems = document.querySelectorAll(
              '.cart-item, .cart-items__table-row, .cart-items__row, [data-line-item], .line-item, .cart__line-item, tr[role="row"]'
            );
            
            console.log('üõí [CUSTOMIFY CART] Znaleziono element√≥w koszyka:', cartItems.length);
            
            cartItems.forEach((item, index) => {
              // Znajd≈∫ wszystkie linki w tym elemencie (miniaturka + tytu≈Ç)
              const links = item.querySelectorAll('a[href*="/products/"]');
              console.log(`üîó [CUSTOMIFY CART] Element ${index} - znaleziono link√≥w: ${links.length}`);
              
              links.forEach(async (link, linkIndex) => {
                // Sprawd≈∫ czy ju≈º przetworzono ten link (unikaj wielokrotnego dodawania event listener√≥w)
                if (link.dataset.customifyProcessed === 'true') {
                  console.log(`‚è≠Ô∏è [CUSTOMIFY CART] Link ${linkIndex} ju≈º przetworzony - pomijam`);
                  return;
                }
                
                // Oznacz jako przetworzony
                link.dataset.customifyProcessed = 'true';
                
                // Znajd≈∫ obrazek w linku
                const img = link.querySelector('img');
                
                if (img) {
                  // To jest link z miniaturkƒÖ - sprawd≈∫ czy mamy URL z watermarkiem w cart properties
                  console.log(`üñºÔ∏è [CUSTOMIFY CART] Link ${linkIndex} ma obrazek`);
                  console.log(`   Obrazek src: ${img.src}`);
                  
                  // Znajd≈∫ cart properties dla tego produktu
                  const cartItem = link.closest('.cart-item, .cart-items__table-row, tr[role="row"]');
                  let watermarkedUrl = null;
                  
                  if (cartItem) {
                    const properties = cartItem.querySelectorAll('.cart-items__properties dd, dd[data-property]');
                    properties.forEach(prop => {
                      const dt = prop.previousElementSibling;
                      if (!dt) return;

                      const propertyName = dt.textContent.trim();
                      const normalizedName = propertyName.replace(/\s+/g, '').toLowerCase();

                      if (normalizedName.includes('ai_image_watermarked')) {
                        watermarkedUrl = prop.textContent.trim();
                        console.log('‚úÖ [CUSTOMIFY CART] Znaleziono URL z watermarkiem:', watermarkedUrl);
                      }

                      if (propertyName.startsWith('_') || normalizedName.includes('ai_image_') || normalizedName.includes('styl ai') || propertyName === 'Styl AI') {
                        dt.style.display = 'none';
                        prop.style.display = 'none';
                        console.log('üôà [CUSTOMIFY CART] Ukryto property:', propertyName);
                      }
                    });
                  }
                  
                  // ‚úÖ G≈Ç√≥wny obrazek produktu w Shopify jest ju≈º Z watermarkiem (uploadowany z watermarkedImage)
                  // ‚úÖ Miniaturka: ma≈Ça (250px) - Shopify automatycznie
                  // ‚úÖ Lightbox: DU≈ªA (1200px) - zmieniamy parametr width w URL
                  
                  let originalSrc = img.src;
                  console.log('üñºÔ∏è [CUSTOMIFY CART] Oryginalny src:', originalSrc);
                  
                  // Zmie≈Ñ URL Shopify na wiƒôkszy rozmiar dla lightbox (1200px zamiast 250px)
                  if (originalSrc.includes('cdn.shopify.com') || originalSrc.includes('lumly.pl/cdn/')) {
                    let largeImageSrc = originalSrc;
                    
                    if (largeImageSrc.includes('width=')) {
                      // Zmie≈Ñ istniejƒÖcy parametr width
                      largeImageSrc = largeImageSrc.replace(/width=\d+/, 'width=1200');
                    } else {
                      // Dodaj parametr width
                      largeImageSrc = largeImageSrc + (largeImageSrc.includes('?') ? '&' : '?') + 'width=1200';
                    }
                    
                    img.dataset.watermarkedSrc = largeImageSrc;
                    console.log('‚úÖ [CUSTOMIFY CART] Przygotowano wiƒôkszy obrazek (1200px):', largeImageSrc);
                  } else {
                    // Nie ma cdn.shopify.com - zostaw oryginalny
                    img.dataset.watermarkedSrc = originalSrc;
                    console.log('‚ö†Ô∏è [CUSTOMIFY CART] To nie jest Shopify CDN URL - u≈ºywam oryginalnego');
                  }
                  
                  link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üñºÔ∏è [CUSTOMIFY CART] Klikniƒôto miniaturkƒô - pokazujƒô lightbox');
                    
                    // U≈ºyj wiƒôkszego obrazka (1200px) przygotowanego wcze≈õniej
                    const imageToShow = img.dataset.watermarkedSrc || img.src;
                    console.log('üìè [CUSTOMIFY CART] Pokazujƒô obrazek:', imageToShow);
                    
                    showImageLightbox(imageToShow);
                  });
                  
                  // Zmie≈Ñ cursor na zoom-in
                  link.style.cursor = 'zoom-in';
                  link.title = 'Kliknij aby powiƒôkszyƒá';
                } else {
                  // To jest link z tytu≈Çem - wy≈ÇƒÖcz ca≈Çkowicie
                  console.log(`üìù [CUSTOMIFY CART] Link ${linkIndex} to tytu≈Ç - wy≈ÇƒÖczam`);
                  console.log(`   Link href: ${link.href}`);
                  console.log(`   Link text: ${link.textContent.trim()}`);
                  
                  link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üìù [CUSTOMIFY CART] Klikniƒôto tytu≈Ç - blokujƒô');
                  });
                  
                  link.style.cursor = 'default';
                  link.style.pointerEvents = 'none';
                  link.style.textDecoration = 'none';
                }
              });
            });
            
            console.log(`‚úÖ [CUSTOMIFY CART] Wy≈ÇƒÖczono linki dla ${cartItems.length} produkt√≥w`);
          }
          
          // Uruchom po za≈Çadowaniu DOM
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', disableAIProductLinks);
          } else {
            disableAIProductLinks();
          }
          
          // Uruchom ponownie po zmianach w koszyku (Ajax Cart)
          document.addEventListener('cart:updated', () => {
            console.log('üõí [CUSTOMIFY CART] Koszyk zaktualizowany - ponowne skanowanie');
            setTimeout(disableAIProductLinks, 500);
          });
          
          // Obserwuj zmiany w DOM (dla dynamicznych aktualizacji koszyka)
          const observer = new MutationObserver((mutations) => {
            // Sprawd≈∫ czy zmiana nie jest w lightbox (ignoruj zmiany w lightbox)
            const isLightboxChange = mutations.some(mutation => {
              return Array.from(mutation.addedNodes).some(node => {
                return node.classList && node.classList.contains('customify-lightbox');
              }) || Array.from(mutation.removedNodes).some(node => {
                return node.classList && node.classList.contains('customify-lightbox');
              });
            });
            
            if (isLightboxChange) {
              console.log('üõí [CUSTOMIFY CART] Zmiana w lightbox - ignorujƒô');
              return;
            }
            
            console.log('üõí [CUSTOMIFY CART] Wykryto zmiany w DOM - ponowne skanowanie');
            disableAIProductLinks();
          });
          
          // Obserwuj zmiany tylko w kontenerze koszyka (nie w ca≈Çym body)
          const cartContainer = document.querySelector('.cart-items, .cart, [data-cart-items]') || document.body;
          observer.observe(cartContainer, {
            childList: true,
            subtree: true
          });
          
          console.log('‚úÖ [CUSTOMIFY CART] Inicjalizacja zako≈Ñczona - obserwujƒô zmiany');
        })();
      </script>
    {% endif %}

    {% comment %} CUSTOMIFY CHECKOUT INTEGRATION - Wy≈ÇƒÖcz linki produkt√≥w {% endcomment %}
    <script>
      /**
       * CUSTOMIFY: Wy≈ÇƒÖcz linki do wszystkich produkt√≥w w checkout
       * Dzia≈Ça r√≥wnie≈º w checkout (Shopify Plus) i thank you page
       * Wszystkie produkty w sklepie sƒÖ AI - nie ma potrzeby filtrowania
       */
      (function() {
        // Sprawd≈∫ czy jeste≈õmy na checkout lub thank you page
        const isCheckout = window.location.pathname.includes('/checkout') || 
                          window.location.pathname.includes('/thank_you') ||
                          window.Shopify?.Checkout;
        
        if (!isCheckout) {
          console.log('üõí [CUSTOMIFY CHECKOUT] Nie jeste≈õmy na checkout - pomijam');
          return;
        }
        
        console.log('üõí [CUSTOMIFY CHECKOUT] Inicjalizacja wy≈ÇƒÖczania link√≥w produkt√≥w AI');
        
        function showImageLightbox(imageUrl) {
          console.log('üîç [CUSTOMIFY CHECKOUT] Pokazujƒô lightbox dla:', imageUrl);
          
          // Stw√≥rz overlay
          const overlay = document.createElement('div');
          overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: zoom-out;
            animation: fadeIn 0.2s ease;
          `;
          
          // Dodaj powiƒôkszony obraz
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = 'Powiƒôkszony obraz AI';
          img.style.cssText = `
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
          `;
          
          // Przycisk zamkniƒôcia
          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '√ó';
          closeBtn.setAttribute('aria-label', 'Zamknij');
          closeBtn.style.cssText = `
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
          `;
          
          overlay.appendChild(img);
          overlay.appendChild(closeBtn);
          
          // Zamknij po klikniƒôciu overlay lub przycisku
          overlay.addEventListener('click', (e) => {
            if (e.target === overlay || e.target === closeBtn) {
              overlay.remove();
              console.log('üîç [CUSTOMIFY CHECKOUT] Lightbox zamkniƒôty');
            }
          });
          
          // Zamknij po ESC
          const handleEsc = (e) => {
            if (e.key === 'Escape') {
              overlay.remove();
              document.removeEventListener('keydown', handleEsc);
              console.log('üîç [CUSTOMIFY CHECKOUT] Lightbox zamkniƒôty (ESC)');
            }
          };
          document.addEventListener('keydown', handleEsc);
          
          document.body.appendChild(overlay);
        }
        
        function disableAIProductLinks() {
          console.log('üõí [CUSTOMIFY CHECKOUT] Wy≈ÇƒÖczam linki dla wszystkich produkt√≥w w checkout...');
          
          // Znajd≈∫ wszystkie elementy checkout (r√≥≈ºne selektory dla Shopify checkout)
          const checkoutItems = document.querySelectorAll(
            '.product, .product-thumbnail, [data-product-table], .order-summary__section--product-list .product, .review-block__content .product'
          );
          
          console.log('üõí [CUSTOMIFY CHECKOUT] Znaleziono element√≥w checkout:', checkoutItems.length);
          
          checkoutItems.forEach((item, index) => {
            // Znajd≈∫ wszystkie linki w tym elemencie
            const links = item.querySelectorAll('a[href*="/products/"]');
            console.log(`üîó [CUSTOMIFY CHECKOUT] Element ${index} - znaleziono link√≥w: ${links.length}`);
            
            links.forEach((link, linkIndex) => {
              // Znajd≈∫ obrazek w linku
              const img = link.querySelector('img');
              
              if (img) {
                // To jest link z miniaturkƒÖ - wy≈ÇƒÖcz i dodaj lightbox
                console.log(`üñºÔ∏è [CUSTOMIFY CHECKOUT] Link ${linkIndex} ma obrazek - dodajƒô lightbox`);
                
                link.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  showImageLightbox(img.src);
                });
                
                // Zmie≈Ñ cursor na zoom-in
                link.style.cursor = 'zoom-in';
                link.title = 'Kliknij aby powiƒôkszyƒá';
              } else {
                // To jest link z tytu≈Çem - wy≈ÇƒÖcz ca≈Çkowicie
                console.log(`üìù [CUSTOMIFY CHECKOUT] Link ${linkIndex} to tytu≈Ç - wy≈ÇƒÖczam`);
                
                link.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                });
                
                link.style.cursor = 'default';
                link.style.pointerEvents = 'none';
                link.style.textDecoration = 'none';
              }
            });
          });
          
          console.log(`‚úÖ [CUSTOMIFY CHECKOUT] Wy≈ÇƒÖczono linki dla ${checkoutItems.length} produkt√≥w`);
        }
        
        // Uruchom po za≈Çadowaniu DOM
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', disableAIProductLinks);
        } else {
          disableAIProductLinks();
        }
        
        // Uruchom ponownie po zmianach (Shopify checkout mo≈ºe siƒô dynamicznie aktualizowaƒá)
        setTimeout(disableAIProductLinks, 1000);
        setTimeout(disableAIProductLinks, 2000);
        
        console.log('‚úÖ [CUSTOMIFY CHECKOUT] Inicjalizacja zako≈Ñczona');
      })();
    </script>

    {% comment %} CUSTOMIFY CUSTOMER REVIEWS {% endcomment %}
    {% if template contains 'product' %}
    <style>
      /* Style dla gwiazdek w opiniach - BARDZIEJ SPECYFICZNE */
      .customer-reviews-section .star,
      .stars-rating .star,
      .review-stars .star,
      .star {
        color: #ffc107 !important;
        font-size: 1.2rem !important;
        margin-right: 2px !important;
        display: inline-block !important;
        text-shadow: none !important;
        background: none !important;
        border: none !important;
      }
      
      .stars-rating {
        display: flex;
        align-items: center;
        gap: 5px;
        margin: 10px 0;
      }
      
      /* Style dla sekcji opinii klient√≥w */
      .customer-reviews-section {
        margin-top: 40px;
        padding: 30px 20px;
        background: #f8f9fa;
        border-radius: 12px;
        border: 1px solid #e9ecef;
      }
      
      .reviews-header {
        text-align: center;
        margin-bottom: 30px;
      }
      
      .reviews-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #333;
        margin: 0 0 15px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }
      
      .reviews-link {
        color: #007bff;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
      }
      
      .reviews-link:hover {
        text-decoration: underline;
      }
      
      .reviews-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      
      .review-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      
      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      
      .review-author {
        font-weight: 600;
        color: #333;
      }
      
      .review-date {
        color: #6c757d;
        font-size: 0.9rem;
      }
      
      .review-stars {
        margin-bottom: 15px;
      }
      
      .review-text {
        color: #555;
        line-height: 1.5;
        margin-bottom: 10px;
        font-style: italic;
      }
      
      .review-style {
        color: #007bff;
        font-weight: 600;
        font-size: 0.9rem;
      }
    </style>
    
    <div class="customer-reviews-section">
      <div class="reviews-header">
        <h2 class="reviews-title">
          ‚≠ê Opinie klient√≥w
          <a href="#customer-reviews" class="reviews-link">Zobacz wszystkie opinie</a>
        </h2>
        <div class="stars-rating">
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span style="margin-left: 10px; color: #6c757d; font-weight: 600;">4.9/5 (143 opinii)</span>
        </div>
      </div>
      
      <div class="reviews-grid" id="customer-reviews">
        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Anna K.</div>
            <div class="review-date">15.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Niesamowite! Moje zdjƒôcie w stylu anime wyglƒÖda jak prawdziwe dzie≈Ço sztuki. Jako≈õƒá druku na p≈Ç√≥tnie jest doskona≈Ça, kolory sƒÖ ≈ºywe i wyra≈∫ne. Polecam ka≈ºdemu!"
          </div>
          <div class="review-style">Styl: Anime</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Marcin W.</div>
            <div class="review-date">12.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Zam√≥wi≈Çem portret w stylu Van Gogh dla ≈ºony na rocznicƒô. By≈Ça zachwycona! AI doskonale odtworzy≈Ço styl malarza. Szybka realizacja i ≈õwietna jako≈õƒá."
          </div>
          <div class="review-style">Styl: Van Gogh</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Katarzyna M.</div>
            <div class="review-date">10.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Cyberpunk style to by≈Ç strza≈Ç w dziesiƒÖtkƒô! Moje zdjƒôcie wyglƒÖda jak z filmu sci-fi. P≈Ç√≥tno jest wysokiej jako≈õci, a kolory sƒÖ niesamowicie intensywne."
          </div>
          <div class="review-style">Styl: Cyberpunk</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Piotr L.</div>
            <div class="review-date">08.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Akwarela wysz≈Ça przepiƒôknie! Delikatne kolory i miƒôkki styl idealnie pasujƒÖ do naszego salonu. ≈ªona ju≈º planuje kolejne zam√≥wienia."
          </div>
          <div class="review-style">Styl: Akwarela</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Magdalena S.</div>
            <div class="review-date">05.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Monet style to czysta magia! Moje zdjƒôcie wyglƒÖda jak impresjonistyczne dzie≈Ço sztuki. Jako≈õƒá wykonania i szybko≈õƒá realizacji na najwy≈ºszym poziomie."
          </div>
          <div class="review-style">Styl: Monet</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Tomasz K.</div>
            <div class="review-date">03.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Picasso style to prawdziwe dzie≈Ço sztuki! Abstrakcyjne formy i wyraziste kolory tworzƒÖ niesamowity efekt. Polecam ka≈ºdemu mi≈Ço≈õnikowi sztuki."
          </div>
          <div class="review-style">Styl: Picasso</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Agnieszka R.</div>
            <div class="review-date">01.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Renesans to absolutnie niesamowity styl! Moje zdjƒôcie wyglƒÖda jak prawdziwy portret z epoki renesansu. Dramatyczne ≈õwiat≈Ço i szczeg√≥≈Çy sƒÖ imponujƒÖce!"
          </div>
          <div class="review-style">Styl: Renesans</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- ACCORDION FAQ NA STRONIE KOSZYKA -->
    {% if template == 'cart' %}
    <div class="page-width" style="margin: 60px auto; max-width: 1200px;">
      <div class="product-details-accordion">
        
        <!-- 1. Gwarancja satysfakcji (NAJWA≈ªNIEJSZE - zmniejsza niepewno≈õƒá) -->
        <div class="accordion-item" data-accordion="guarantee" style="border: 2px solid #4CAF50; border-radius: 8px; margin-bottom: 12px;">
          <div class="accordion-header" style="background: #E8F5E9;">
            <div class="accordion-title">
              <span style="font-weight: 700; color: #2E7D32;">Gwarancja satysfakcji</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div style="background: #F1F8F4; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
              <p style="font-size: 18px; font-weight: 600; color: #2E7D32; margin: 0 0 8px 0;">
                100% satysfakcji lub zwrot pieniƒôdzy
              </p>
              <p style="margin: 0; color: #555;">
                Je≈õli nie jeste≈õ zadowolony z jako≈õci wydruku, zwr√≥cimy 100% koszt√≥w. Bez pyta≈Ñ, bez problem√≥w.
              </p>
            </div>
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>30 dni na zwrot</strong> - pe≈Çny zwrot koszt√≥w</li>
              <li><strong>Wsparcie na biuro@lumly.pl</strong>, zawsze pomo≈ºemy rozwiƒÖzaƒá problem</li>
              <li><strong>4.8/5 ocena klient√≥w</strong> - ponad 5000 zadowolonych klient√≥w</li>
            </ul>
          </div>
        </div>

        <!-- 2. Szczeg√≥≈Çy produktu -->
        <div class="accordion-item" data-accordion="details">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>O produkcie</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <p><strong>Obraz na p≈Ç√≥tnie</strong> - wydrukowane na grubym, premium p≈Ç√≥tnie canvas z naturalnƒÖ teksturƒÖ. NaciƒÖgniƒôte na drewnianƒÖ antyramƒô</p>
            
            <!-- Wizualizacja: Obraz na p≈Ç√≥tnie -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/obraz.png" alt="Obraz na p≈Ç√≥tnie" class="accordion-visual-image">
              </div>
            </div>
            
            <br>
            <p><strong>Plakat</strong> - wydruk na papierze fotograficznym, kt√≥ry wysy≈Çamy zwiniƒôty w eleganckiej tubie. Mo≈ºesz wybraƒá ramkƒô. W√≥wczas wydruk bƒôdzie w ramce za szk≈Çem.</p>
            
            <!-- Wizualizacja: Plakat -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/plakat.png" alt="Plakat" class="accordion-visual-image">
              </div>
            </div>
            
            <br>
            <p><strong>Produkt cyfrowy</strong> ‚Äì plik w wysokiej jako≈õci, bez znak√≥w wodnych, do natychmiastowego pobrania (bez wysy≈Çki fizycznego obrazu).</p>
            
            <ul>
              <li>Otrzymujesz plik w wysokiej rozdzielczo≈õci, bez znak√≥w wodnych.</li>
              <li>Link do pobrania wysy≈Çamy natychmiast po op≈Çaceniu zam√≥wienia ‚Äì zero czekania na kuriera.</li>
              <li>Idealny do druku w domu lub fotolabie, jako tapeta na telefon/komputer albo do udostƒôpniania w social mediach.</li>
            </ul>
            
            <p><strong>To jest produkt cyfrowy ‚Äì nie wysy≈Çamy fizycznego obrazu.</strong></p>
            
            <!-- Wizualizacja: Produkt cyfrowy -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/icon_digital.png" alt="Produkt cyfrowy" class="accordion-visual-image">
              </div>
            </div>
          </div>
        </div>

        <!-- 3. Wysy≈Çka i dostawa -->
        <div class="accordion-item" data-accordion="shipping">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>Wysy≈Çka i dostawa</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div style="background: #E3F2FD; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
              <p style="margin: 0; font-weight: 600; color: #1976D2;">
                ‚ö° <strong>Szybka realizacja: 3-5 dni roboczych</strong> od akceptacji projektu
              </p>
            </div>
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>üì¶ Bezpieczne opakowanie:</strong> Karton wzmocniony + folia bƒÖbelkowa - gwarancja bezpiecznej dostawy</li>
              <li><strong>üáµüá± Wysy≈Çka:</strong> InPost Paczkomaty, InPost Kurier</li>
              <li><strong>üìç ≈öledzenie przesy≈Çki:</strong> Numer trackingowy wysy≈Çany mailem - zawsze wiesz gdzie jest Twoja przesy≈Çka</li>
              <li><strong>üöö Darmowa dostawa:</strong> Przy zam√≥wieniach powy≈ºej 400 z≈Ç</li>
              <li><strong>‚è∞ Czas dostawy:</strong> 1-3 dni robocze (w zale≈ºno≈õci od wybranej opcji)</li>
            </ul>
          </div>
        </div>

        <!-- 4. Bezpiecze≈Ñstwo i zaufanie -->
        <div class="accordion-item" data-accordion="security">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>üîí</span>
              <span>Bezpiecze≈Ñstwo i zaufanie</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>üîê Bezpieczne p≈Çatno≈õci:</strong> SSL szyfrowanie, obs≈Çuga kart, BLIK, Przelewy24</li>
              <li><strong>üõ°Ô∏è Ochrona danych:</strong> Twoje zdjƒôcia sƒÖ bezpieczne - nie udostƒôpniamy ich osobom trzecim</li>
              <li><strong>üì∏ Usuwanie zdjƒôƒá:</strong> Po realizacji zam√≥wienia mo≈ºesz poprosiƒá o usuniƒôcie swoich zdjƒôƒá</li>
              <li><strong>‚úÖ Certyfikaty:</strong> Dzia≈Çamy zgodnie z RODO i przepisami UE</li>
              <li><strong>üí≥ Bezpieczne p≈Çatno≈õci:</strong> Wszystkie transakcje chronione przez Shopify Payments</li>
            </ul>
            <div style="margin-top: 16px; padding: 12px; background: #F5F5F5; border-radius: 8px; text-align: center;">
              <p style="margin: 0; font-size: 14px; color: #666;">
                üîí <strong>Bezpieczne zakupy</strong> - Twoje dane sƒÖ chronione
              </p>
            </div>
          </div>
        </div>

        <!-- 3. Dostƒôpne rozmiary -->
        <div class="accordion-item" data-accordion="sizes">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>Dostƒôpne rozmiary</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <!-- Wizualizacja: Rozmiary -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/wymiary.png" alt="Dostƒôpne rozmiary" class="accordion-visual-image">
                <div class="accordion-visual-label">üìè Dostƒôpne rozmiary</div>
              </div>
            </div>
            
            <div class="accordion-size-grid">
              <div class="accordion-size-item">
                <div class="accordion-size-name">20 √ó 30 cm</div>
                <div class="accordion-size-description">≈öwietny do ma≈Çych pokoi</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">30 √ó 40 cm</div>
                <div class="accordion-size-description">Doskona≈Çy do ≈õrednich pomieszcze≈Ñ</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">40 √ó 60 cm</div>
                <div class="accordion-size-description">Efektowny na du≈ºe ≈õciany w salonie</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">60 √ó 85 cm</div>
                <div class="accordion-size-description">ImponujƒÖcy na ca≈ÇƒÖ ≈õcianƒô</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 5. Jak to dzia≈Ça -->
        <div class="accordion-item" data-accordion="howto">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>üí°</span>
              <span>Jak to dzia≈Ça?</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div class="accordion-step">
              <div class="accordion-step-number">1</div>
              <div class="accordion-step-content">
                <strong>Wgraj swoje zdjƒôcie</strong><br>
                JPG, PNG lub GIF do 10MB. Najlepiej w wysokiej rozdzielczo≈õci.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">2</div>
              <div class="accordion-step-content">
                <strong>Wybierz styl artystyczny</strong><br>
                Dostƒôpne style do wyboru w zak≈Çadce powy≈ºej.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">3</div>
              <div class="accordion-step-content">
                <strong>Wybierz rozmiar wydruku</strong><br>
                Wybierz idealny rozmiar dla Twojej przestrzeni.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">4</div>
              <div class="accordion-step-content">
                <strong>AI przekszta≈Çci Twoje zdjƒôcie</strong><br>
                Najnowocze≈õniejsza technologia sztucznej inteligencji w 30-60 sekund.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">5</div>
              <div class="accordion-step-content">
                <strong>Drukujemy i wysy≈Çamy</strong><br>
                Wysokiej jako≈õci druk na p≈Ç√≥tnie premium, bezpiecznie zapakowany.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    
    <!-- JavaScript dla accordion na stronie koszyka -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üõí [CART] Initializing cart accordion...');
        
        // Znajd≈∫ wszystkie accordion items na stronie koszyka
        const accordionItems = document.querySelectorAll('.accordion-item');
        
        if (!accordionItems || accordionItems.length === 0) {
          console.log('‚ö†Ô∏è [CART] No accordion items found');
          return;
        }
        
        console.log('‚úÖ [CART] Found', accordionItems.length, 'accordion items');
        
        // Dodaj event listener do ka≈ºdego accordion header
        accordionItems.forEach((item, index) => {
          const header = item.querySelector('.accordion-header');
          
          if (!header) {
            console.log('‚ö†Ô∏è [CART] No header found for item', index);
            return;
          }
          
          // Event listener - toggle klasy expanded
          header.addEventListener('click', () => {
            const isExpanded = item.classList.contains('expanded');
            
            if (isExpanded) {
              // Zwi≈Ñ
              item.classList.remove('expanded');
              console.log('üîΩ [CART] Collapsed:', item.dataset.accordion);
            } else {
              // Rozwi≈Ñ
              item.classList.add('expanded');
              console.log('üîº [CART] Expanded:', item.dataset.accordion);
            }
          });
          
          console.log('‚úÖ [CART] Accordion item', index, 'setup complete');
        });
        
        console.log('‚úÖ [CART] Cart accordion setup complete!');
      });
    </script>
    {% endif %}
    <!-- KONIEC ACCORDION FAQ NA STRONIE KOSZYKA -->

    {% sections 'footer-group' %}

    <!-- FORMULARZ KONTAKTOWY NA STRONIE CONTACT-INFORMATION -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Sprawd≈∫ czy jeste≈õmy na stronie kontakt
        if (window.location.pathname.includes('/pages/kontakt') || window.location.pathname.includes('/policies/contact-information')) {
          // Czekaj chwilƒô, ≈ºeby DOM siƒô za≈Çadowa≈Ç
          setTimeout(function() {
            // Znajd≈∫ g≈Ç√≥wnƒÖ tre≈õƒá strony - szukaj po r√≥≈ºnych selektorach
            let targetElement = null;
            
            // Pr√≥buj znale≈∫ƒá g≈Ç√≥wnƒÖ sekcjƒô z tre≈õciƒÖ
            const selectors = [
              '#MainContent',
              'main',
              '.main-content',
              '.page-content',
              '.rte',
              '.page__content',
              '.page-content-wrapper',
              '[class*="policy"]',
              '[class*="content"]',
              'article',
              '.content-for-layout',
              '[class*="page"]'
            ];
            
            for (const selector of selectors) {
              const element = document.querySelector(selector);
              if (element && element.offsetHeight > 0) {
                targetElement = element;
                break;
              }
            }
            
            // Je≈õli nie znaleziono, szukaj po nag≈Ç√≥wku h1
            if (!targetElement) {
              const h1 = document.querySelector('h1');
              if (h1) {
                // Znajd≈∫ najbli≈ºszy kontener z tre≈õciƒÖ
                targetElement = h1.closest('div, section, article, main') || h1.parentElement;
              }
            }
            
            // Ostatecznie u≈ºyj body, ale znajd≈∫ miejsce przed footerem
            if (!targetElement) {
              const footer = document.querySelector('footer, [class*="footer"]');
              if (footer) {
                targetElement = footer;
              } else {
                targetElement = document.body;
              }
            }
            
            if (targetElement) {
              // Utw√≥rz formularz kontaktowy
              const contactFormHTML = `
                <div id="contact-form-container" style="
                  max-width: 600px;
                  margin: 40px auto;
                  padding: 30px;
                  background: #fff;
                  border-radius: 8px;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                ">
                  <h2 style="
                    font-size: 24px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    color: #333;
                  ">Wy≈õlij wiadomo≈õƒá</h2>
                  
                  <form id="contactForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                      <label for="contactName" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Imiƒô i nazwisko *
                      </label>
                      <input 
                        type="text" 
                        id="contactName" 
                        name="name" 
                        required
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactEmail" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Email *
                      </label>
                      <input 
                        type="email" 
                        id="contactEmail" 
                        name="email" 
                        required
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactSubject" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Temat
                      </label>
                      <input 
                        type="text" 
                        id="contactSubject" 
                        name="subject"
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactMessage" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Wiadomo≈õƒá *
                      </label>
                      <textarea 
                        id="contactMessage" 
                        name="message" 
                        required
                        rows="6"
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          font-family: inherit;
                          box-sizing: border-box;
                          resize: vertical;
                        "
                      ></textarea>
                    </div>
                    
                    <button 
                      type="submit"
                      style="
                        background: #000;
                        color: #fff;
                        padding: 14px 28px;
                        border: none;
                        border-radius: 4px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: background 0.2s;
                      "
                      onmouseover="this.style.background='#333'"
                      onmouseout="this.style.background='#000'"
                    >
                      Wy≈õlij wiadomo≈õƒá
                    </button>
                    
                    <div id="contactFormMessage" style="
                      margin-top: 12px;
                      padding: 12px;
                      border-radius: 4px;
                      display: none;
                    "></div>
                  </form>
                </div>
              `;
              
              // Je≈õli targetElement to footer, dodaj przed nim
              if (targetElement.tagName === 'FOOTER' || targetElement.className.includes('footer')) {
                targetElement.insertAdjacentHTML('beforebegin', contactFormHTML);
              } else {
                // W przeciwnym razie dodaj na ko≈Ñcu elementu
                targetElement.insertAdjacentHTML('beforeend', contactFormHTML);
              }
              
              // Obs≈Çuga formularza
              const form = document.getElementById('contactForm');
              const messageDiv = document.getElementById('contactFormMessage');
              
              if (form) {
                form.addEventListener('submit', async function(e) {
              e.preventDefault();
              
              const formData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                subject: document.getElementById('contactSubject').value || 'Kontakt ze strony',
                message: document.getElementById('contactMessage').value
              };
              
              // Wy≈ÇƒÖcz przycisk podczas wysy≈Çania
              const submitBtn = form.querySelector('button[type="submit"]');
              submitBtn.disabled = true;
              submitBtn.textContent = 'Wysy≈Çanie...';
              
              try {
                const response = await fetch('https://customify-s56o.vercel.app/api/contact-form', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                  messageDiv.style.display = 'block';
                  messageDiv.style.background = '#E8F5E9';
                  messageDiv.style.color = '#2E7D32';
                  messageDiv.textContent = '‚úÖ ' + result.message;
                  form.reset();
                } else {
                  throw new Error(result.error || 'B≈ÇƒÖd wysy≈Çania wiadomo≈õci');
                }
              } catch (error) {
                messageDiv.style.display = 'block';
                messageDiv.style.background = '#FFEBEE';
                messageDiv.style.color = '#C62828';
                messageDiv.textContent = '‚ùå B≈ÇƒÖd: ' + error.message;
              } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Wy≈õlij wiadomo≈õƒá';
              }
                }); // Zamknij addEventListener
              } // Zamknij if (form)
            } // Zamknij if (targetElement)
          }, 500); // Czekaj 500ms na za≈Çadowanie DOM
        }
      });
    </script>

    <!-- REDIRECT AFTER LOGIN - Przekieruj u≈ºytkownika na /pages/my-generations PO LOGOWANIU -->
    <script>
      (function() {
        // Obs≈Çuga dla account.lumly.pl (Customer Account API) - sprawd≈∫ parametr new_login
        if (window.location.hostname.includes('account.') && 
            new URLSearchParams(window.location.search).get('new_login') === '1') {
          // Przekieruj na lumly.pl/pages/my-generations
          window.location.href = 'https://lumly.pl/pages/my-generations?country=PL';
          return;
        }
        
        // Obs≈Çuga dla lumly.pl (g≈Ç√≥wna domena)
        {% if customer %}
          // Sprawd≈∫ czy to pierwsze za≈Çadowanie po zalogowaniu
          if (sessionStorage.getItem('justLoggedIn') === 'true') {
            sessionStorage.removeItem('justLoggedIn');
            window.location.href = '/pages/my-generations?country=PL';
          }
        {% else %}
          // Ustaw flagƒô przed logowaniem
          if (window.location.pathname.includes('/account/login') || 
              window.location.pathname.includes('/account/register')) {
            sessionStorage.setItem('justLoggedIn', 'true');
          }
        {% endif %}
      })();
    </script>

  </body>
</html>{% comment %} Cache bust: 1761686705 {% endcomment %}
