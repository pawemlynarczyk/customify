<!-- Cache buster: 20250121180000 -->
<!doctype html>
<html
  class="no-js{% if request.design_mode %} shopify-design-mode{% endif %}"
  lang="{{ request.locale.iso_code }}"
>
  <head>
    {%- render 'stylesheets' -%}

    {%- if settings.favicon != blank -%}
      <link
        rel="icon"
        type="image/png"
        href="{{ settings.favicon | image_url: width: 32, height: 32 }}"
      >
    {%- endif -%}

    {% comment %} This a way to wait for main content to load when navigating to a new page so that the view transitions can work consistently {% endcomment %}
    <link
      rel="expect"
      href="#MainContent"
      blocking="render"
      id="view-transition-render-blocker"
    >

    {%- render 'meta-tags' -%}
    {%- render 'fonts' -%}
    <!-- Google Fonts for text overlay preview -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preload najczƒô≈õciej u≈ºywanych czcionek dla szybszego ≈Çadowania -->
    <link rel="preload" href="https://fonts.gstatic.com/s/montserrat/v26/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCtr6Hw5aXpsog.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/dancingscript/v25/If2cXTr6YS-zF4S-kcSWSVi_sxjsohD9F50Ruu7BMSo3Sup8.woff2" as="font" type="font/woff2" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Dancing+Script:wght@700&family=Pacifico&family=Satisfy&family=Great+Vibes&family=Indie+Flower&family=Bebas+Neue&family=Rye&family=Creepster&family=Bungee:wght@400&family=Rubik+Wet+Paint&family=Bonheur+Royale&display=swap" rel="stylesheet">
    {%- render 'scripts' -%}
    {%- render 'theme-styles-variables' -%}
    {%- render 'color-schemes' -%}

    {% if request.design_mode %}
      {%- render 'theme-editor' -%}
    {% endif %}

    <!-- Hotjar Tracking Code (Site ID: 6546658) -->
    <script>
      (function(h,o,t,j,a,r){
        if (h.hj) return;
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:6546658,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
    <!-- End Hotjar -->

    <!-- GLFX.JS - Instant image filters (WebGL) -->
    {% if product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
    <script src="https://cdn.jsdelivr.net/npm/glfx@0.0.4/glfx.min.js"></script>
    {% endif %}

    <!-- SENTRY ERROR TRACKING -->
    <script src="https://browser.sentry-cdn.com/8.40.0/bundle.min.js" crossorigin="anonymous"></script>
    <script>
      // ‚úÖ Inicjalizuj Sentry po za≈Çadowaniu skryptu (synchronicznie)
      (function() {
        // Poczekaj a≈º Sentry bƒôdzie dostƒôpny (max 5 sekund)
        let attempts = 0;
        const maxAttempts = 50; // 50 pr√≥b √ó 100ms = 5 sekund
        
        function tryInit() {
          attempts++;
          
          if (typeof Sentry !== 'undefined' && typeof Sentry.init === 'function') {
            try {
              {% if customer %}
                Sentry.init({
                  dsn: "https://562a1a160e90a597f0236fd8c6b13301@o4510439439925248.ingest.de.sentry.io/4510439517257808",
                  environment: "production",
                  tracesSampleRate: 0.1,
                  beforeSend(event, hint) {
                    // ‚úÖ FILTRUJ B≈ÅƒòDY VIEW TRANSITION - nie loguj do Sentry (tylko animacje, nie wp≈ÇywajƒÖ na funkcjonalno≈õƒá)
                    if (event.exception && event.exception.values) {
                      const firstException = event.exception.values[0];
                      const errorMessage = firstException?.value || '';
                      const errorType = firstException?.type || '';
                      
                      const isViewTransitionError = 
                        errorMessage.includes('view transition') ||
                        errorMessage.includes('ViewTransition') ||
                        errorMessage.includes('Skipping view transition') ||
                        errorMessage.includes('skipTransition') ||
                        (errorType === 'AbortError' && errorMessage.includes('transition')) ||
                        (errorType === 'AbortError' && errorMessage.toLowerCase().includes('skip'));
                      
                      if (isViewTransitionError) {
                        console.debug('üîá [SENTRY] Ignorujƒô b≈ÇƒÖd view transition:', errorMessage);
                        return null; // Nie wysy≈Çaj do Sentry
                      }
                    }
                    
                    // ‚úÖ Dodaj tag customify do wszystkich b≈Çƒôd√≥w
                    if (event.tags) {
                      event.tags.customify = 'true';
                    } else {
                      event.tags = { customify: 'true' };
                    }
                    if (event.user) {
                      event.user.id = {{ customer.id | json }};
                      event.user.email = {{ customer.email | json }};
                    }
                    return event;
                  }
                });
                
                Sentry.setUser({
                  id: {{ customer.id | json }},
                  email: {{ customer.email | json }}
                });
              {% else %}
                Sentry.init({
                  dsn: "https://562a1a160e90a597f0236fd8c6b13301@o4510439439925248.ingest.de.sentry.io/4510439517257808",
                  environment: "production",
                  tracesSampleRate: 0.1,
                  beforeSend(event, hint) {
                    // ‚úÖ FILTRUJ B≈ÅƒòDY VIEW TRANSITION - nie loguj do Sentry (tylko animacje, nie wp≈ÇywajƒÖ na funkcjonalno≈õƒá)
                    if (event.exception && event.exception.values) {
                      const firstException = event.exception.values[0];
                      const errorMessage = firstException?.value || '';
                      const errorType = firstException?.type || '';
                      
                      const isViewTransitionError = 
                        errorMessage.includes('view transition') ||
                        errorMessage.includes('ViewTransition') ||
                        errorMessage.includes('Skipping view transition') ||
                        errorMessage.includes('skipTransition') ||
                        (errorType === 'AbortError' && errorMessage.includes('transition')) ||
                        (errorType === 'AbortError' && errorMessage.toLowerCase().includes('skip'));
                      
                      if (isViewTransitionError) {
                        console.debug('üîá [SENTRY] Ignorujƒô b≈ÇƒÖd view transition:', errorMessage);
                        return null; // Nie wysy≈Çaj do Sentry
                      }
                    }
                    
                    // ‚úÖ Dodaj tag customify do wszystkich b≈Çƒôd√≥w
                    if (event.tags) {
                      event.tags.customify = 'true';
                    } else {
                      event.tags = { customify: 'true' };
                    }
                    return event;
                  }
                });
              {% endif %}
              
              console.log('‚úÖ [SENTRY] Initialized successfully');
              window.__sentryInitialized = true;
            } catch (error) {
              console.error('‚ùå [SENTRY] Initialization error:', error);
            }
          } else if (attempts < maxAttempts) {
            // Spr√≥buj ponownie za 100ms
            setTimeout(tryInit, 100);
          } else {
            console.warn('‚ö†Ô∏è [SENTRY] Failed to load after ' + maxAttempts + ' attempts. Check Network tab for browser.sentry-cdn.com');
          }
        }
        
        // Rozpocznij pr√≥by inicjalizacji natychmiast
        tryInit();
      })();
    </script>
    <!-- End Sentry -->

    <!-- ‚úÖ GLOBAL ERROR HANDLER - Przechwytuje b≈Çƒôdy z motywu Shopify -->
    <script>
      (function() {
        // ‚úÖ Przechwytuj nieobs≈Çu≈ºone b≈Çƒôdy JavaScript
        window.addEventListener('error', function(event) {
          const error = event.error || event;
          const errorMessage = error.message || event.message || 'Unknown error';
          const errorStack = error.stack || '';
          
          // ‚úÖ Sprawd≈∫ czy to b≈ÇƒÖd z motywu Shopify (aspectRatioHelper, processNewElements)
          const isThemeError = 
            errorMessage.includes('aspectRatioHelper') ||
            errorMessage.includes('processNewElements') ||
            errorMessage.includes('#aspectRatioHelper') ||
            errorStack.includes('aspectRatioHelper') ||
            errorStack.includes('processNewElements');
          
          if (isThemeError) {
            // ‚úÖ Zapobiegaj crashowi - loguj do Sentry ale nie przerywaj dzia≈Çania
            console.warn('‚ö†Ô∏è [THEME-ERROR-HANDLER] Przechwycono b≈ÇƒÖd z motywu Shopify:', errorMessage);
            
            // ‚úÖ Loguj do Sentry z pe≈Çnym kontekstem
            if (typeof Sentry !== 'undefined' && window.__sentryInitialized) {
              Sentry.withScope((scope) => {
                scope.setTag('customify', 'true');
                scope.setTag('error_type', 'theme_error');
                scope.setTag('error_source', 'shopify_theme');
                scope.setTag('theme_component', 'aspectRatioHelper');
                scope.setContext('theme_error', {
                  errorMessage: errorMessage,
                  errorStack: errorStack.substring(0, 1000), // Max 1000 chars
                  url: window.location.href,
                  userAgent: navigator.userAgent,
                  timestamp: new Date().toISOString()
                });
                Sentry.captureException(error);
              });
            }
            
            // ‚úÖ Zapobiegaj domy≈õlnemu zachowaniu (nie pokazuj w konsoli jako nieobs≈Çu≈ºony b≈ÇƒÖd)
            event.preventDefault();
            return false;
          }
          
          // ‚úÖ Dla innych b≈Çƒôd√≥w - pozw√≥l Sentry je obs≈Çu≈ºyƒá normalnie
          return true;
        }, true); // useCapture = true (przechwytuj PRZED innymi handlerami)
        
        // ‚úÖ Przechwytuj nieobs≈Çu≈ºone promise rejections
        window.addEventListener('unhandledrejection', function(event) {
          const error = event.reason || event;
          const errorMessage = error?.message || String(error) || 'Unknown promise rejection';
          const errorStack = error?.stack || '';
          
          // ‚úÖ Sprawd≈∫ czy to b≈ÇƒÖd z motywu Shopify
          const isThemeError = 
            errorMessage.includes('aspectRatioHelper') ||
            errorMessage.includes('processNewElements') ||
            errorMessage.includes('#aspectRatioHelper') ||
            errorStack.includes('aspectRatioHelper') ||
            errorStack.includes('processNewElements');
          
          if (isThemeError) {
            console.warn('‚ö†Ô∏è [THEME-ERROR-HANDLER] Przechwycono promise rejection z motywu Shopify:', errorMessage);
            
            // ‚úÖ Loguj do Sentry
            if (typeof Sentry !== 'undefined' && window.__sentryInitialized) {
              Sentry.withScope((scope) => {
                scope.setTag('customify', 'true');
                scope.setTag('error_type', 'theme_promise_rejection');
                scope.setTag('error_source', 'shopify_theme');
                scope.setTag('theme_component', 'aspectRatioHelper');
                scope.setContext('theme_error', {
                  errorMessage: errorMessage,
                  errorStack: errorStack.substring(0, 1000),
                  url: window.location.href,
                  timestamp: new Date().toISOString()
                });
                Sentry.captureException(error);
              });
            }
            
            // ‚úÖ Zapobiegaj domy≈õlnemu zachowaniu
            event.preventDefault();
          }
        });
        
        console.log('‚úÖ [THEME-ERROR-HANDLER] Global error handler zainstalowany');
        
        // ‚úÖ VIEW TRANSITION ERROR HANDLER - Ignoruj b≈Çƒôdy animacji (nieistotne)
        // B≈Çƒôdy view transition to tylko animacje przej≈õƒá miƒôdzy stronami - nie wp≈ÇywajƒÖ na funkcjonalno≈õƒá
        window.addEventListener('error', function(event) {
          const error = event.error || event;
          const errorMessage = error.message || event.message || '';
          
          // ‚úÖ Sprawd≈∫ czy to b≈ÇƒÖd view transition
          const isViewTransitionError = 
            errorMessage.includes('view transition') ||
            errorMessage.includes('ViewTransition') ||
            errorMessage.includes('skipTransition') ||
            errorMessage.includes('Skipping view transition') ||
            error.name === 'AbortError' && errorMessage.includes('transition');
          
          if (isViewTransitionError) {
            // ‚úÖ Ignoruj - to tylko animacje, nie wp≈ÇywajƒÖ na funkcjonalno≈õƒá
            console.debug('üîá [VIEW-TRANSITION] Ignorujƒô b≈ÇƒÖd animacji:', errorMessage);
            event.preventDefault();
            return false; // Nie loguj do Sentry
          }
        }, true);
        
        // ‚úÖ VIEW TRANSITION PROMISE REJECTION HANDLER
        window.addEventListener('unhandledrejection', function(event) {
          const error = event.reason || event;
          const errorMessage = error?.message || String(error) || '';
          
          const isViewTransitionError = 
            errorMessage.includes('view transition') ||
            errorMessage.includes('ViewTransition') ||
            errorMessage.includes('skipTransition') ||
            errorMessage.includes('Skipping view transition') ||
            (error?.name === 'AbortError' && errorMessage.includes('transition'));
          
          if (isViewTransitionError) {
            // ‚úÖ Ignoruj - to tylko animacje
            console.debug('üîá [VIEW-TRANSITION] Ignorujƒô promise rejection animacji:', errorMessage);
            event.preventDefault();
          }
        });
        
        console.log('‚úÖ [VIEW-TRANSITION-HANDLER] View transition error handler zainstalowany');
      })();
    </script>
    <!-- End Global Error Handler -->

    <!-- CUSTOMIFY INTEGRATION -->
    <link rel="stylesheet" href="{{ 'customify.css' | asset_url }}">
    {% if product and product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' or product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
      <link rel="stylesheet" href="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.css">
    {% endif %}
    
    <!-- FIX: Preload obrazk√≥w produktu - eliminuje skakanie -->
    {% if template contains 'product' %}
      {% if product.featured_image %}
        <link rel="preload" as="image" href="{{ product.featured_image | image_url: width: 800 }}">
      {% endif %}
      {% for media in product.media limit: 3 %}
        {% if media.media_type == 'image' %}
          <link rel="preload" as="image" href="{{ media | image_url: width: 800 }}">
        {% endif %}
      {% endfor %}
    {% endif %}
    
    
    <!-- Shopify Customer Info for Customify -->
    <script>
      {% if customer %}
        // METODA 1: Shopify Liquid (customer object detected)
        window.ShopifyCustomer = {
          loggedIn: true,
          id: {{ customer.id | json }},
          email: {{ customer.email | json }},
          firstName: {{ customer.first_name | json }},
          lastName: {{ customer.last_name | json }}
        };
        console.log('‚úÖ [CUSTOMIFY LIQUID] Zalogowany u≈ºytkownik:', window.ShopifyCustomer);
      {% else %}
        // U≈ºytkownik niezalogowany
        window.ShopifyCustomer = null;
        console.log('üë§ [CUSTOMIFY LIQUID] U≈ºytkownik niezalogowany');
      {% endif %}
    </script>
    
    <script src="{{ 'customify.js' | asset_url }}" defer></script>
    {% if product and product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' or product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
      <script src="https://unpkg.com/cropperjs@1.6.2/dist/cropper.min.js" defer></script>
      {% if product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
      <script>
        // üì± Etui - wymu≈õ poprawne proporcje kontenera (559:1154)
        document.addEventListener('DOMContentLoaded', function() {
          function fixPhoneCaseAspectRatio() {
            const containers = document.querySelectorAll('#customify-app-container .phone-case-inner');
            console.log('üì± [PHONE-CASE] Found containers:', containers.length);
            containers.forEach((container, index) => {
              const parent = container.closest('.phone-case-preview');
              const previewArea = container.closest('#previewArea');
              const appContainer = container.closest('#customify-app-container');
              console.log(`üì± [PHONE-CASE] Container ${index} parent widths:`);
              console.log(`  - container: ${container.offsetWidth}px`);
              console.log(`  - phoneCasePreview: ${parent ? parent.offsetWidth + 'px' : 'N/A'}`);
              console.log(`  - previewArea: ${previewArea ? previewArea.offsetWidth + 'px' : 'N/A'}`);
              console.log(`  - appContainer: ${appContainer ? appContainer.offsetWidth + 'px' : 'N/A'}`);
              const width = container.offsetWidth;
              if (width > 0) {
                const correctHeight = width * (1154 / 559);
                console.log(`üì± [PHONE-CASE] Setting height: ${correctHeight}px (was: ${container.offsetHeight}px)`);
                container.style.height = correctHeight + 'px';
                container.style.paddingTop = '0';
                console.log(`üì± [PHONE-CASE] After fix: width=${container.offsetWidth}px, height=${container.offsetHeight}px`);
              } else {
                console.warn(`üì± [PHONE-CASE] Container ${index} has width=0, skipping`);
              }
            });
          }
          console.log('üì± [PHONE-CASE] Initializing aspect ratio fix...');
          fixPhoneCaseAspectRatio();
          window.addEventListener('resize', fixPhoneCaseAspectRatio);
          // Retry po za≈Çadowaniu obrazk√≥w
          setTimeout(fixPhoneCaseAspectRatio, 500);
          setTimeout(fixPhoneCaseAspectRatio, 1000);
        });
      </script>
      {% endif %}
    {% endif %}
    {% if product and product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
      <script>
        // üéµ Spotify Text Overlay - aktualizacja tekstu w czasie rzeczywistym
        document.addEventListener('DOMContentLoaded', function() {
          const titleInput = document.getElementById('spotifyTitle');
          const artistInput = document.getElementById('spotifyArtist');
          // Teksty w preview
          const titleDisplayPreview = document.getElementById('spotifyTextTitlePreview');
          const artistDisplayPreview = document.getElementById('spotifyTextArtistPreview');
          // Teksty w result
          const titleDisplayResult = document.getElementById('spotifyTextTitle');
          const artistDisplayResult = document.getElementById('spotifyTextArtist');
          // Liczniki
          const titleCounter = document.getElementById('spotifyTitleCounter');
          const artistCounter = document.getElementById('spotifyArtistCounter');
          
          function updateSpotifyText() {
            const titleText = titleInput ? titleInput.value : '';
            const artistText = artistInput ? artistInput.value : '';
            
            // Aktualizuj tekst na ramce (preview)
            if (titleDisplayPreview) titleDisplayPreview.textContent = titleText;
            if (artistDisplayPreview) artistDisplayPreview.textContent = artistText;
            // Aktualizuj tekst na ramce (result)
            if (titleDisplayResult) titleDisplayResult.textContent = titleText;
            if (artistDisplayResult) artistDisplayResult.textContent = artistText;
            
            // Aktualizuj liczniki
            if (titleCounter && titleInput) {
              titleCounter.textContent = titleInput.value.length + '/' + titleInput.maxLength;
            }
            if (artistCounter && artistInput) {
              artistCounter.textContent = artistInput.value.length + '/' + artistInput.maxLength;
            }
          }
          
          // Nas≈Çuchuj zmian w polach
          if (titleInput) titleInput.addEventListener('input', updateSpotifyText);
          if (artistInput) artistInput.addEventListener('input', updateSpotifyText);
          
          // Inicjalizuj
          updateSpotifyText();
          console.log('üéµ [SPOTIFY TEXT] Initialized');
        });
      </script>
    {% endif %}
        <script>
          document.addEventListener('DOMContentLoaded', function() {
            // Ukryj produkty z "rozmiar" w URL (kolekcje)
            const rozmiarProducts = document.querySelectorAll('.custom-collection-card[href*="rozmiar"]');
            rozmiarProducts.forEach(product => {
              product.style.display = 'none';
            });
            
            // Ukryj produkty z "cyfrowy" w URL (kolekcje)
            const cyfrowyProducts = document.querySelectorAll('.custom-collection-card[href*="cyfrowy"]');
            cyfrowyProducts.forEach(product => {
              product.style.display = 'none';
            });
            
            const recommendationsRozmiar = document.querySelectorAll('.product-recommendations a[href*="rozmiar"]');
            recommendationsRozmiar.forEach(product => {
              product.style.display = 'none';
            });
            
            // Ukryj produkty z "cyfrowy" w rekomendacjach
            const recommendationsCyfrowy = document.querySelectorAll('.product-recommendations a[href*="cyfrowy"]');
            recommendationsCyfrowy.forEach(product => {
              product.style.display = 'none';
            });
            
            const totalHidden = rozmiarProducts.length + cyfrowyProducts.length + recommendationsRozmiar.length + recommendationsCyfrowy.length;
            console.log('üîí [PRODUCT HIDING] Ukryto', totalHidden, 'produkt√≥w AI (kolekcje + rekomendacje)');
            
            // ‚úÖ NOWE: Dla produktu akwarela (ID: 15475649675589 lub handle zawiera 'akwarela') - ukryj wszystkie style opr√≥cz akwareli
            if (window.ShopifyProduct && (window.ShopifyProduct.id === 15475649675589 || window.ShopifyProduct.id === '15475649675589' || (window.ShopifyProduct.handle && window.ShopifyProduct.handle.includes('akwarela')) || window.location.pathname.includes('akwarela'))) {
              console.log('üé® [WATERCOLOR] Produkt akwarela wykryty (ID:', window.ShopifyProduct.id, 'handle:', window.ShopifyProduct.handle, ') - ukrywanie wszystkich styl√≥w opr√≥cz akwareli');
              const allStyleCards = document.querySelectorAll('.customify-style-card');
              allStyleCards.forEach(card => {
                const styleName = card.getAttribute('data-style');
                if (styleName && styleName !== 'akwarela') {
                  card.style.display = 'none';
                  console.log('üîí [WATERCOLOR] Ukryto styl:', styleName);
                } else if (styleName === 'akwarela') {
                  console.log('‚úÖ [WATERCOLOR] Pozostawiono styl akwareli widoczny');
                }
              });
            }
          });
        </script>
    
    <!-- FIX: CSS dla galerii - TYLKO JEDEN MIEJSCE -->
    {{ 'products.css' | asset_url | stylesheet_tag }}
    {{ 'hide-products.css' | asset_url | stylesheet_tag }}
    
    {% if template contains 'collection' %}
    {{ 'collection.css' | asset_url | stylesheet_tag }}
    {% endif %}
    
    <!-- FIX: Poprawne proporcje galerii - JavaScript wymusza zmiany -->
    <script>
      // FIX: Przenie≈õ aplikacjƒô NATYCHMIAST - eliminuje skakanie
      document.addEventListener('DOMContentLoaded', function() {
        const app = document.getElementById('customify-app-container');
        const prodInfo = document.querySelector('[id^="ProductInformation-"]');
        const placeholder = document.getElementById('customify-placeholder');
        
        if (app && prodInfo) {
          // Dodaj na koniec ProductInformation NATYCHMIAST
          prodInfo.appendChild(app);
          
          // Ukryj placeholder je≈õli istnieje
          if (placeholder) {
            placeholder.remove();
          }
        } else {
          // Fallback: je≈õli nie ma ProductInformation, spr√≥buj ponownie po kr√≥tkim czasie
          setTimeout(function() {
            const app = document.getElementById('customify-app-container');
            const prodInfo = document.querySelector('[id^="ProductInformation-"]');
            const placeholder = document.getElementById('customify-placeholder');
            
            if (app && prodInfo) {
              prodInfo.appendChild(app);
              if (placeholder) {
                placeholder.remove();
              }
            }
          }, 50);
        }
      });
      
      // FUNKCJA NAPRAWY POWIƒòKSZONEGO ZDJƒòCIA W DIALOGU
      function fixDialogImages() {
        const dialog = document.querySelector('dialog[open]');
        if (!dialog) return;
        
        // Znajd≈∫ wszystkie zdjƒôcia w dialogu
        const allImages = dialog.querySelectorAll('img');
        let largestImg = null;
        let largestWidth = 0;
        
        allImages.forEach(img => {
          const width = img.clientWidth;
          if (width > largestWidth) {
            largestWidth = width;
            largestImg = img;
          }
        });
        
        if (!largestImg) return;
        
        // Wymu≈õ poprawne style - WYPE≈ÅNIA CA≈ÅY KONTENER
        largestImg.style.setProperty('object-fit', 'cover', 'important');
        largestImg.style.setProperty('max-height', 'none', 'important');
        largestImg.style.setProperty('height', '100%', 'important');
        largestImg.style.setProperty('width', '100%', 'important');
        largestImg.style.setProperty('object-position', 'center', 'important');
        
        // Styluj kontener
        if (largestImg.parentElement) {
          largestImg.parentElement.style.setProperty('height', '100%', 'important');
        }
        
      }
      
      // FUNKCJA UKRYWANIA STAREJ SEKCJI POLITYK
      function hideOldPolicySection() {
        // Ukryj ca≈Çy popover z politykami
        const policyPopover = document.querySelector('.footer-utilities__group--left anchored-popover-component');
        if (policyPopover) {
          policyPopover.style.display = 'none';
          policyPopover.style.visibility = 'hidden';
          policyPopover.style.opacity = '0';
          policyPopover.style.height = '0';
          policyPopover.style.overflow = 'hidden';
        }
        
        // Ukryj element "Preferencje dotyczƒÖce plik√≥w cookie"
        const cookieLink = document.querySelector('a[href="/policies/#shopifyReshowConsentBanner"]');
        if (cookieLink) {
          cookieLink.style.display = 'none';
          cookieLink.style.visibility = 'hidden';
          cookieLink.style.opacity = '0';
          cookieLink.style.height = '0';
          cookieLink.style.overflow = 'hidden';
          
          const parentLi = cookieLink.closest('li');
          if (parentLi) {
            parentLi.style.display = 'none';
            parentLi.style.visibility = 'hidden';
            parentLi.style.opacity = '0';
            parentLi.style.height = '0';
            parentLi.style.overflow = 'hidden';
          }
          
        }
      }

      // FUNKCJA DODAWANIA NAWIGACJI NA STRONACH POLITYK
      function addPolicyNavigation() {
        // Dodaj nawigacjƒô do stopki (przed popoverem)
        const footerLeft = document.querySelector('.footer-utilities__group--left');
        if (!footerLeft) {
          return;
        }
        
        const policyPopover = footerLeft.querySelector('anchored-popover-component');
        if (!policyPopover) {
          return;
        }
        
        // Sprawdzam czy nawigacja ju≈º istnieje
        if (document.querySelector('.policy-nav-container-footer')) {
          return;
        }
        
        // Stw√≥rz aktywnƒÖ nawigacjƒô
        const navContainer = document.createElement('div');
        navContainer.className = 'policy-nav-container-footer';
          navContainer.style.cssText = `
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px 20px;
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
          `;
          
          const navTitle = document.createElement('div');
          navTitle.textContent = 'üîó Szybka nawigacja:';
          navTitle.style.cssText = `
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
          `;
          
          const navLinks = document.createElement('div');
          navLinks.className = 'policy-nav-links';
          navLinks.style.cssText = `
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
          `;
          
          const links = [
            { text: 'Polityka Prywatno≈õci', url: '/policies/privacy-policy' },
            { text: 'Polityka Zwrot√≥w', url: '/policies/refund-policy' },
            { text: 'Dane Kontaktowe', url: '/pages/kontakt' },
            { text: 'Warunki Us≈Çug', url: '/policies/terms-of-service' },
            { text: 'Polityka Wysy≈Çki', url: '/policies/shipping-policy' }
          ];
          
          links.forEach(link => {
            const linkEl = document.createElement('a');
            linkEl.href = link.url;
            linkEl.textContent = link.text;
            linkEl.style.cssText = `
              color: #666;
              text-decoration: none;
              font-weight: 500;
              padding: 8px 16px;
              border-radius: 6px;
              transition: all 0.3s ease;
              display: inline-block;
              border: 1px solid transparent;
            `;
            
            linkEl.addEventListener('mouseenter', function() {
              this.style.color = '#333';
              this.style.backgroundColor = '#fff';
              this.style.borderColor = '#666';
              this.style.transform = 'translateY(-2px)';
              this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
            });
            
            linkEl.addEventListener('mouseleave', function() {
              this.style.color = '#666';
              this.style.backgroundColor = 'transparent';
              this.style.borderColor = 'transparent';
              this.style.transform = 'translateY(0)';
              this.style.boxShadow = 'none';
            });
            
            navLinks.appendChild(linkEl);
          });
          
          navContainer.appendChild(navTitle);
          navContainer.appendChild(navLinks);
          
          // Wstaw nawigacjƒô przed popoverem w stopce
          footerLeft.insertBefore(navContainer, policyPopover);
          
      }

      function fixGalleryProportions() {
        const galleryGrid = document.querySelector('.media-gallery__grid');
        if (!galleryGrid) return;
        
        // ZAWSZE uruchamiaj galeriƒô w stylu Etsy na stronach produktu
        createEtsyGallery(galleryGrid);
      }
      
      // ETSY-STYLE GALLERY (miniaturki poni≈ºej)
      function createEtsyGallery(galleryGrid) {
        // Sprawd≈∫ czy ju≈º utworzono
        if (galleryGrid.classList.contains('etsy-gallery-initialized')) {
          return;
        }
        
        // Wymu≈õ layout flexbox pionowy (g√≥ra-d√≥≈Ç)
        galleryGrid.style.setProperty('display', 'flex', 'important');
        galleryGrid.style.setProperty('flex-direction', 'column', 'important');
        galleryGrid.style.setProperty('gap', '16px', 'important');
        galleryGrid.style.setProperty('height', 'auto', 'important');
        galleryGrid.style.setProperty('width', '100%', 'important');
        
        // Pobierz wszystkie elementy listy (oryginalne media)
        const allImages = Array.from(galleryGrid.querySelectorAll('li'));
        if (allImages.length === 0) return;
        
        // Zapisz URL wszystkich obrazk√≥w PRZED usuniƒôciem element√≥w
        const imageUrls = allImages.map(li => {
          const img = li.querySelector('img');
          if (!img) return null;
          // Spr√≥buj wyciƒÖgnƒÖƒá URL z currentSrc, src lub srcset
          const direct = img.currentSrc || img.src || '';
          if (direct) return direct;
          const srcset = img.getAttribute('srcset') || '';
          if (srcset) {
            // We≈∫ najwiƒôkszy URL z srcset
            const candidates = srcset.split(',').map(s => s.trim().split(' ')[0]).filter(Boolean);
            return candidates[candidates.length - 1] || null;
          }
          return null;
        }).filter(url => url !== null && url !== '');
        
        if (imageUrls.length === 0) {
          console.warn('‚è≥ [ETSY] Brak gotowych obraz√≥w (lazy-load). Spr√≥bujƒô ponownie p√≥≈∫niej.');
          return; // Nie usuwaj oryginalnych element√≥w dop√≥ki nie mamy URLi
        }
        
        
        // Zmienna do ≈õledzenia aktualnego indexu (globalna dla ca≈Çej galerii)
        let currentIndex = 0;
        
        // NAJPIERW stw√≥rz kontener dla g≈Ç√≥wnego obrazu (bƒôdzie potrzebny w event listenerach)
        let mainImageContainer = galleryGrid.querySelector('.etsy-main-image');
        if (!mainImageContainer) {
          mainImageContainer = document.createElement('div');
          mainImageContainer.className = 'etsy-main-image';
          mainImageContainer.style.cssText = `
            width: 100%;
            position: relative;
            aspect-ratio: 1 / 1;
            background: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
          `;
          
          // Dodaj g≈Ç√≥wny obraz
          const firstImage = allImages[0]?.querySelector('img');
          if (firstImage) {
            const mainImg = document.createElement('img');
            mainImg.src = firstImage.src;
            mainImg.alt = 'G≈Ç√≥wne zdjƒôcie produktu';
            mainImg.style.cssText = `
              width: 100%;
              height: 100%;
              object-fit: cover;
              cursor: default;
            `;
            
            // Wy≈ÇƒÖcz zoom/modal na g≈Ç√≥wnym obrazie
            mainImg.addEventListener('click', (e) => {
              e.preventDefault();
              e.stopPropagation();
            }, true);
            
            mainImageContainer.appendChild(mainImg);
          }
          
          // Wy≈ÇƒÖcz r√≥wnie≈º klikniƒôcie w kontener (ale przepu≈õƒá klikniƒôcia strza≈Çek)
          mainImageContainer.addEventListener('click', (e) => {
            // Pozw√≥l na klikniƒôcia przycisk√≥w nawigacji
            if (e.target.closest && e.target.closest('.etsy-nav-btn')) {
              return;
            }
            e.preventDefault();
            e.stopPropagation();
          }, true);
          
          // Licznik zdjƒôƒá
          const counter = document.createElement('div');
          counter.className = 'etsy-counter';
          counter.textContent = `1 / ${imageUrls.length}`;
          counter.style.cssText = `
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 14px;
          `;
          mainImageContainer.appendChild(counter);
          
          // Strza≈Çka LEWA na g≈Ç√≥wnym obrazie
          const prevBtn = document.createElement('button');
          prevBtn.innerHTML = '‚Äπ';
          prevBtn.className = 'etsy-nav-btn prev';
          prevBtn.style.cssText = `
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 10;
          `;
          
          // Strza≈Çka PRAWA na g≈Ç√≥wnym obrazie
          const nextBtn = document.createElement('button');
          nextBtn.innerHTML = '‚Ä∫';
          nextBtn.className = 'etsy-nav-btn next';
          nextBtn.style.cssText = `
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            z-index: 10;
          `;
          
          mainImageContainer.appendChild(prevBtn);
          mainImageContainer.appendChild(nextBtn);
        }
        
        // POTEM stw√≥rz kontener dla miniaturek z nawigacjƒÖ (poziomo poni≈ºej)
        let thumbsNavigationContainer = galleryGrid.querySelector('.etsy-thumbs-navigation');
        let thumbsRow = null;
        let thumbsPrevBtn = null;
        let thumbsNextBtn = null;
        
        if (!thumbsNavigationContainer) {
          thumbsNavigationContainer = document.createElement('div');
          thumbsNavigationContainer.className = 'etsy-thumbs-navigation';
          thumbsNavigationContainer.style.cssText = `
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
          `;
          
          // Strza≈Çka LEWA dla miniaturek
          thumbsPrevBtn = document.createElement('button');
          thumbsPrevBtn.innerHTML = '‚Äπ';
          thumbsPrevBtn.style.cssText = `
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
          `;
          
          // Kontener miniaturek
          thumbsRow = document.createElement('div');
          thumbsRow.className = 'etsy-thumbnails-row';
          thumbsRow.style.cssText = `
            display: flex;
            flex-direction: row;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 10px 0;
            flex: 1;
            scrollbar-width: none;
            -ms-overflow-style: none;
          `;
          thumbsRow.style.setProperty('-webkit-scrollbar', 'none');
          
          // Strza≈Çka PRAWA dla miniaturek
          thumbsNextBtn = document.createElement('button');
          thumbsNextBtn.innerHTML = '‚Ä∫';
          thumbsNextBtn.style.cssText = `
            width: 36px;
            height: 36px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
          `;
          
          // Event listenery dla strza≈Çek miniaturek
          if (thumbsRow) {
            thumbsPrevBtn.addEventListener('click', (e) => {
              e.preventDefault();
              thumbsRow.scrollBy({ left: -200, behavior: 'smooth' });
            });
            
            thumbsNextBtn.addEventListener('click', (e) => {
              e.preventDefault();
              thumbsRow.scrollBy({ left: 200, behavior: 'smooth' });
            });
          }
          
          // Hover effects
          [thumbsPrevBtn, thumbsNextBtn].forEach(btn => {
            if (btn) {
              btn.addEventListener('mouseenter', () => {
                btn.style.background = '#f5f5f5';
                btn.style.transform = 'scale(1.1)';
              });
              btn.addEventListener('mouseleave', () => {
                btn.style.background = 'white';
                btn.style.transform = 'scale(1)';
              });
            }
          });
          
          // Przenie≈õ miniaturki
          if (thumbsRow) {
            allImages.forEach((img, index) => {
              const thumb = img.cloneNode(true);
              
              // Usu≈Ñ wszystkie atrybuty kt√≥re mogƒÖ powodowaƒá zoom/modal
              const links = thumb.querySelectorAll('a, button');
              links.forEach(link => {
                link.removeAttribute('href');
                link.removeAttribute('data-modal');
                link.removeAttribute('data-pswp-width');
                link.removeAttribute('data-pswp-height');
                link.style.pointerEvents = 'none'; // Wy≈ÇƒÖcz klikniƒôcia w linki
              });
              
              thumb.style.cssText = `
                width: 80px;
                height: 80px;
                border: 2px solid #e0e0e0;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.2s ease;
                flex-shrink: 0;
              `;
              
              // Dodaj active state
              if (index === 0) {
                thumb.style.borderColor = '#000';
              }
              
              // Klikniƒôcie zmienia g≈Ç√≥wny obraz (BEZ ZOOM/MODAL)
              thumb.addEventListener('click', (e) => {
                e.preventDefault(); // Zatrzymaj domy≈õlne zachowanie Shopify
                e.stopPropagation(); // Zatrzymaj propagacjƒô (zoom/modal)
                
                // Aktualizuj currentIndex (dla synchronizacji ze strza≈Çkami)
                currentIndex = index;
                
                // Usu≈Ñ active ze wszystkich
                thumbsRow.querySelectorAll('li').forEach(t => {
                  t.style.borderColor = '#e0e0e0';
                });
                // Dodaj active
                thumb.style.borderColor = '#000';
                
                // Zmie≈Ñ g≈Ç√≥wny obraz u≈ºywajƒÖc zapisanego URL
                const mainImg = mainImageContainer.querySelector('img');
                if (mainImg && imageUrls[index]) {
                  mainImg.src = imageUrls[index];
                  // Aktualizuj licznik
                  const counter = mainImageContainer.querySelector('.etsy-counter');
                  if (counter) {
                    counter.textContent = `${index + 1} / ${imageUrls.length}`;
                  }
                }
              }, true); // useCapture = true (przechwytuj PRZED Shopify)
              
              thumbsRow.appendChild(thumb);
            });
          }
          
          // Sk≈Çadaj nawigacjƒô miniaturek (tylko je≈õli wszystkie elementy istniejƒÖ)
          if (thumbsNavigationContainer && thumbsPrevBtn && thumbsRow && thumbsNextBtn) {
            thumbsNavigationContainer.appendChild(thumbsPrevBtn);
            thumbsNavigationContainer.appendChild(thumbsRow);
            thumbsNavigationContainer.appendChild(thumbsNextBtn);
            
            // Dodaj NAJPIERW g≈Ç√≥wny obraz (g√≥ra)
            if (mainImageContainer && !galleryGrid.querySelector('.etsy-main-image')) {
              galleryGrid.appendChild(mainImageContainer);
            }
            
            // POTEM miniaturki z nawigacjƒÖ (d√≥≈Ç)
            galleryGrid.appendChild(thumbsNavigationContainer);
          } else {
            console.warn('‚ö†Ô∏è [ETSY GALLERY] Nie mo≈ºna utworzyƒá galerii - brakuje element√≥w:', {
              thumbsNavigationContainer: !!thumbsNavigationContainer,
              thumbsPrevBtn: !!thumbsPrevBtn,
              thumbsRow: !!thumbsRow,
              thumbsNextBtn: !!thumbsNextBtn
            });
          }
        }
        
        // Event listenery dla strza≈Çek g≈Ç√≥wnego obrazu (NA ZEWNƒÑTRZ if'a - dzia≈ÇajƒÖ zawsze)
        const prevBtn = mainImageContainer.querySelector('.etsy-nav-btn.prev');
        const nextBtn = mainImageContainer.querySelector('.etsy-nav-btn.next');
        const counter = mainImageContainer.querySelector('.etsy-counter');
        const mainImg = mainImageContainer.querySelector('img');
        // ‚úÖ U≈ºyj istniejƒÖcej zmiennej thumbsRow (zadeklarowanej wcze≈õniej) - NIE deklaruj ponownie!
        if (!thumbsRow) {
          thumbsRow = galleryGrid.querySelector('.etsy-thumbnails-row');
        }
        
        console.log('üîß [ETSY GALLERY] Elementy znalezione:', {
          prevBtn: !!prevBtn,
          nextBtn: !!nextBtn,
          mainImg: !!mainImg,
          thumbsRow: !!thumbsRow,
          counter: !!counter
        });
        
        if (prevBtn && nextBtn && mainImg && thumbsRow) {
          // Usu≈Ñ stare event listenery (klonuj przyciski)
          const newPrevBtn = prevBtn.cloneNode(true);
          const newNextBtn = nextBtn.cloneNode(true);
          prevBtn.replaceWith(newPrevBtn);
          nextBtn.replaceWith(newNextBtn);
          
          newPrevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            currentIndex = currentIndex === 0 ? imageUrls.length - 1 : currentIndex - 1;
            
            // Zmie≈Ñ obraz u≈ºywajƒÖc zapisanego URL
            if (mainImg && imageUrls[currentIndex]) {
              mainImg.src = imageUrls[currentIndex];
              counter.textContent = `${currentIndex + 1} / ${imageUrls.length}`;
              
              // Aktualizuj active state miniaturek
              if (thumbsRow) {
                thumbsRow.querySelectorAll('li').forEach((t, i) => {
                  t.style.borderColor = i === currentIndex ? '#000' : '#e0e0e0';
                });
              }
              
            }
          });
          
          newNextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            currentIndex = currentIndex === imageUrls.length - 1 ? 0 : currentIndex + 1;
            
            // Zmie≈Ñ obraz u≈ºywajƒÖc zapisanego URL
            if (mainImg && imageUrls[currentIndex]) {
              mainImg.src = imageUrls[currentIndex];
              counter.textContent = `${currentIndex + 1} / ${imageUrls.length}`;
              
              // Aktualizuj active state miniaturek
              if (thumbsRow) {
                thumbsRow.querySelectorAll('li').forEach((t, i) => {
                  t.style.borderColor = i === currentIndex ? '#000' : '#e0e0e0';
                });
              }
              
            }
          });
          
          // Hover effects dla strza≈Çek g≈Ç√≥wnego obrazu
          [newPrevBtn, newNextBtn].forEach(btn => {
            btn.addEventListener('mouseenter', () => {
              btn.style.background = 'white';
              btn.style.transform = 'translateY(-50%) scale(1.1)';
            });
            btn.addEventListener('mouseleave', () => {
              btn.style.background = 'rgba(255, 255, 255, 0.9)';
              btn.style.transform = 'translateY(-50%) scale(1)';
            });
          });
          
        } else {
          console.error('‚ùå [ETSY] Brak element√≥w:', { prevBtn, nextBtn, mainImg, thumbsRow });
        }
        
        // Usu≈Ñ oryginalne elementy
        allImages.forEach(img => img.remove());
        
        galleryGrid.classList.add('etsy-gallery-initialized');
      }
      
      // STANDARD CAROUSEL (dla innych produkt√≥w)
      function createStandardCarousel(galleryGrid) {
        // UKRYJ SLIDESHOW-COMPONENT NA MOBILE (powoduje duplikacjƒô g≈Ç√≥wnego zdjƒôcia)
        if (window.innerWidth <= 749) {
          const slideshow = document.querySelector('slideshow-component');
          if (slideshow) {
            slideshow.style.setProperty('display', 'none', 'important');
            slideshow.style.setProperty('visibility', 'hidden', 'important');
            slideshow.style.setProperty('opacity', '0', 'important');
            slideshow.style.setProperty('height', '0', 'important');
            slideshow.style.setProperty('overflow', 'hidden', 'important');
          }
        }
        
        // Dodaj aktywnƒÖ nawigacjƒô na stronach polityk
        if (window.location.pathname.includes('/policies/')) {
          addPolicyNavigation();
        }
        
        // Wymu≈õ nowe wymiary przez JavaScript - KARUZELA
        galleryGrid.style.setProperty('display', 'flex', 'important');
        galleryGrid.style.setProperty('flex-direction', 'column', 'important');
        galleryGrid.style.setProperty('height', 'auto', 'important');
        galleryGrid.style.setProperty('width', '100%', 'important');
        
        // Stw√≥rz kontener dla miniaturek z nawigacjƒÖ
        let thumbnailsContainer = galleryGrid.querySelector('.thumbnails-container');
        if (!thumbnailsContainer) {
          // Kontener z nawigacjƒÖ
          const navigationContainer = document.createElement('div');
          navigationContainer.className = 'thumbnails-navigation';
          navigationContainer.style.cssText = `
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
          `;
          
                // Przycisk lewo
                const leftBtn = document.createElement('button');
                leftBtn.innerHTML = '‚Üê';
                leftBtn.className = 'thumbnails-nav-btn left';
                leftBtn.style.cssText = `
                  background: white;
                  color: #333;
                  border: 1px solid #e0e0e0;
                  border-radius: 50%;
                  width: 36px;
                  height: 36px;
                  cursor: pointer;
                  font-size: 16px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  flex-shrink: 0;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                  transition: all 0.2s ease;
                `;
          
          // Kontener miniaturek
          thumbnailsContainer = document.createElement('div');
          thumbnailsContainer.className = 'thumbnails-container';
          thumbnailsContainer.style.cssText = `
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            scroll-behavior: smooth;
            flex: 1;
            scrollbar-width: none;
            -ms-overflow-style: none;
          `;
          thumbnailsContainer.style.webkitScrollbar = 'none';
          
                // Przycisk prawo
                const rightBtn = document.createElement('button');
                rightBtn.innerHTML = '‚Üí';
                rightBtn.className = 'thumbnails-nav-btn right';
                rightBtn.style.cssText = `
                  background: white;
                  color: #333;
                  border: 1px solid #e0e0e0;
                  border-radius: 50%;
                  width: 36px;
                  height: 36px;
                  cursor: pointer;
                  font-size: 16px;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  flex-shrink: 0;
                  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                  transition: all 0.2s ease;
                `;
          
          // Przenie≈õ miniaturki do kontenera
          const thumbnails = Array.from(galleryGrid.querySelectorAll('li:not(:first-child)'));
          thumbnails.forEach(thumb => {
            thumbnailsContainer.appendChild(thumb);
          });
          
          // Sk≈Çadaj nawigacjƒô
          navigationContainer.appendChild(leftBtn);
          navigationContainer.appendChild(thumbnailsContainer);
          navigationContainer.appendChild(rightBtn);
          
          galleryGrid.appendChild(navigationContainer);
          
                // Event listeners dla przycisk√≥w
                leftBtn.addEventListener('click', () => {
                  thumbnailsContainer.scrollBy({ left: -100, behavior: 'smooth' });
                });
                
                rightBtn.addEventListener('click', () => {
                  thumbnailsContainer.scrollBy({ left: 100, behavior: 'smooth' });
                });
                
                // Hover effects
                leftBtn.addEventListener('mouseenter', () => {
                  leftBtn.style.background = '#f5f5f5';
                  leftBtn.style.borderColor = '#ccc';
                  leftBtn.style.transform = 'scale(1.05)';
                });
                
                leftBtn.addEventListener('mouseleave', () => {
                  leftBtn.style.background = 'white';
                  leftBtn.style.borderColor = '#e0e0e0';
                  leftBtn.style.transform = 'scale(1)';
                });
                
                rightBtn.addEventListener('mouseenter', () => {
                  rightBtn.style.background = '#f5f5f5';
                  rightBtn.style.borderColor = '#ccc';
                  rightBtn.style.transform = 'scale(1.05)';
                });
                
                rightBtn.addEventListener('mouseleave', () => {
                  rightBtn.style.background = 'white';
                  rightBtn.style.borderColor = '#e0e0e0';
                  rightBtn.style.transform = 'scale(1)';
                });
        }
        
        // G≈Ç√≥wne zdjƒôcie - WYPE≈ÅNIA CA≈ÅƒÑ SZEROKO≈öƒÜ
        const mainImage = galleryGrid.querySelector('li:first-child');
        if (mainImage) {
          // Usu≈Ñ klasy kt√≥re ograniczajƒÖ wymiary
          mainImage.classList.remove('constrain-height', 'media-fit-contain');
          mainImage.classList.add('media-fit'); // Dodaj klasƒô kt√≥ra wype≈Çnia
          
          mainImage.style.setProperty('height', 'auto', 'important'); // RESPONSIVE
          mainImage.style.setProperty('width', '100%', 'important');
          mainImage.style.setProperty('aspect-ratio', '1 / 1', 'important'); // KWADRAT RESPONSIVE
          mainImage.style.setProperty('grid-row', '1 / 2', 'important');
          mainImage.style.setProperty('grid-column', '1 / 4', 'important'); // WSZYSTKIE 3 KOLUMNY
          mainImage.style.setProperty('margin', '0', 'important');
          mainImage.style.setProperty('max-height', 'none', 'important');
          
          const mainImg = mainImage.querySelector('img');
          if (mainImg) {
            mainImg.style.setProperty('height', '100%', 'important'); // RESPONSIVE
            mainImg.style.setProperty('width', '100%', 'important');
            mainImg.style.setProperty('object-fit', 'cover', 'important');
            mainImg.style.setProperty('object-position', 'center', 'important');
            mainImg.style.setProperty('aspect-ratio', 'inherit', 'important'); // Dziedzicz z kontenera
          }
        }
        
        // Miniaturki - KARUZELA
        const thumbnails = thumbnailsContainer.querySelectorAll('li');
        thumbnails.forEach((thumb) => {
          // Usu≈Ñ inline styles kt√≥re blokujƒÖ
          thumb.removeAttribute('style');
          
          // Ustaw nowe wymiary - KARUZELA
          thumb.style.setProperty('height', '90px', 'important');
          thumb.style.setProperty('width', '90px', 'important');
          thumb.style.setProperty('aspect-ratio', '1 / 1', 'important');
          thumb.style.setProperty('flex-shrink', '0', 'important'); // Nie kurcz siƒô
          
          // Styluj kontener product-media
          const productMedia = thumb.querySelector('.product-media');
          if (productMedia) {
            productMedia.style.setProperty('width', '100%', 'important');
            productMedia.style.setProperty('height', '100%', 'important');
            productMedia.style.setProperty('aspect-ratio', '1 / 1', 'important');
          }
          
          const thumbImg = thumb.querySelector('img');
          if (thumbImg) {
            thumbImg.style.setProperty('object-fit', 'cover', 'important');
            thumbImg.style.setProperty('width', '100%', 'important');
            thumbImg.style.setProperty('height', '100%', 'important');
          }
        });
        
      }

      // Uruchom naprawƒô galerii po za≈Çadowaniu strony
      document.addEventListener('DOMContentLoaded', function() {
        // Czekaj a≈º galeria siƒô za≈Çaduje
        setTimeout(fixGalleryProportions, 1500);
        
        // Uruchom ponownie co 500ms ≈ºeby nadpisaƒá style Shopify
        setInterval(fixGalleryProportions, 500);
        
        // Dodaj nawigacjƒô w stopce (na wszystkich stronach)
        addPolicyNavigation();
        
        // Ukryj starƒÖ sekcjƒô polityk
        hideOldPolicySection();
        
        // NAPRAWA POWIƒòKSZONYCH ZDJƒòƒÜ W DIALOGU
        // Event listener dla klikniƒôƒá w przyciski powiƒôkszenia
        document.addEventListener('click', function(e) {
          const zoomButton = e.target.closest('.product-media-container__zoom-button, button[class*="zoom"]');
          if (zoomButton) {
            setTimeout(fixDialogImages, 100);  // Czekaj a≈º dialog siƒô otworzy
            setTimeout(fixDialogImages, 300);  // Ponownie po za≈Çadowaniu
            setTimeout(fixDialogImages, 600);  // I jeszcze raz dla pewno≈õci
          }
        });
        
        // Regularnie sprawdzaj czy dialog jest otwarty i naprawiaj
        setInterval(fixDialogImages, 300);
      });
    </script>
    

    {{ content_for_header }}
  </head>

  <body class="page-width-{{ settings.page_width }} card-hover-effect-{{ settings.card_hover_effect }}">
    {% render 'skip-to-content-link', href: '#MainContent', text: 'accessibility.skip_to_text' %}
    
    <!-- TRACK LOGIN/REGISTER SUCCESS -->
    <script>
      (function() {
        const isLoggedIn = {{ customer.id | json }} !== null;
        if (!isLoggedIn) {
          return;
        }
        try {
          const authIntent = localStorage.getItem('customify_auth_intent');
          if (!authIntent) {
            return;
          }
          const timestampRaw = localStorage.getItem('customify_auth_intent_timestamp');
          const timestamp = timestampRaw ? parseInt(timestampRaw, 10) : null;
          const authSource = localStorage.getItem('customify_auth_source');
          const MAX_AGE_MS = 30 * 60 * 1000; // 30 minut na wys≈Çanie zdarzenia
          if (timestamp && (Date.now() - timestamp) > MAX_AGE_MS) {
            localStorage.removeItem('customify_auth_intent');
            localStorage.removeItem('customify_auth_intent_timestamp');
            localStorage.removeItem('customify_auth_source');
            return;
          }
          const isRegisterIntent = authIntent.startsWith('register');
          const eventType = isRegisterIntent ? 'login_modal_register_success' : 'login_modal_login_success';
          fetch('https://customify-s56o.vercel.app/api/admin/login-modal-stats', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              eventType,
              productUrl: authSource || localStorage.getItem('customify_return_url') || window.location.pathname,
              timestamp: new Date().toISOString(),
              sourcePage: window.location.pathname
            })
          }).catch(function(err) {
            console.warn('üìä [AUTH SUCCESS] Failed to send event:', err);
          }).finally(function() {
            localStorage.removeItem('customify_auth_intent');
            localStorage.removeItem('customify_auth_intent_timestamp');
            localStorage.removeItem('customify_auth_source');
          });
        } catch (error) {
          console.warn('üìä [AUTH SUCCESS] Tracking error:', error);
        }
      })();
    </script>
    
    <!-- DODAJ LINK "MOJE OBRAZY" DO MENU KONTA KLIENTA -->
    <script>
      (function() {
        // Funkcja dodajƒÖca link "Moje obrazy" do menu konta klienta
        function addMyImagesLink() {
          // Sprawd≈∫ czy jeste≈õmy na stronie konta klienta (Shopify Customer Account API)
          const isAccountPage = window.location.hostname.includes('account.') || 
                                window.location.pathname.startsWith('/account') ||
                                document.querySelector('[data-customer-account]');
          
          if (!isAccountPage) {
            return;
          }

          // Sprawd≈∫ czy link ju≈º istnieje
          const existingLink = document.querySelector('a[href="/pages/my-generations"], a[href*="my-generations"]');
          if (existingLink) {
            console.log('‚úÖ [ACCOUNT-MENU] Link "Moje obrazy" ju≈º istnieje');
            return true;
          }

          // R√≥≈ºne selektory dla menu konta klienta w Shopify Customer Account API
          const menuSelectors = [
            'nav[aria-label*="Account"]',
            'nav[aria-label*="Konto"]',
            'nav[role="navigation"]',
            'nav ul',
            'aside nav',
            'aside nav ul',
            '[role="navigation"] ul',
            'nav > ul',
            'ul[role="list"]'
          ];

          let menuElement = null;
          let ordersLink = null;

          // Szukaj menu i linku "Zam√≥wienia" jednocze≈õnie
          for (const selector of menuSelectors) {
            const elements = document.querySelectorAll(selector);
            for (const el of elements) {
              // Sprawd≈∫ czy to menu (zawiera linki)
              const links = el.querySelectorAll('a');
              if (links.length === 0) continue;

              // Szukaj linku "Zam√≥wienia" w tym menu
              for (const link of links) {
                const text = link.textContent.trim().toLowerCase();
                if (text.includes('zam√≥wienia') || text.includes('orders') || text.includes('order')) {
                  menuElement = el;
                  ordersLink = link;
                  break;
                }
              }
              
              if (menuElement && ordersLink) break;
            }
            if (menuElement && ordersLink) break;
          }

          // Alternatywnie: szukaj bezpo≈õrednio linku "Zam√≥wienia" i znajd≈∫ jego menu
          if (!menuElement || !ordersLink) {
            const allLinks = document.querySelectorAll('nav a, aside a');
            for (const link of allLinks) {
              const text = link.textContent.trim().toLowerCase();
              if (text.includes('zam√≥wienia') || text.includes('orders') || text.includes('order')) {
                ordersLink = link;
                menuElement = link.closest('ul') || link.closest('nav') || link.parentElement;
                break;
              }
            }
          }

          if (!menuElement || !ordersLink) {
            console.log('üîç [ACCOUNT-MENU] Menu lub link "Zam√≥wienia" nie znalezione');
            return false;
          }

          const ordersListItem = ordersLink.closest('li') || ordersLink.parentElement;
          if (!ordersListItem) {
            console.log('üîç [ACCOUNT-MENU] Nie mo≈ºna znale≈∫ƒá elementu listy dla "Zam√≥wienia"');
            return false;
          }

          // Utw√≥rz nowy element listy z linkiem "Moje obrazy"
          const newListItem = document.createElement('li');
          if (ordersListItem.className) {
            newListItem.className = ordersListItem.className;
          }
          
          const newLink = document.createElement('a');
          newLink.href = '/pages/my-generations';
          newLink.textContent = 'Moje obrazy';
          if (ordersLink.className) {
            newLink.className = ordersLink.className;
          }
          // Skopiuj style z linku "Zam√≥wienia"
          if (ordersLink.style.cssText) {
            newLink.style.cssText = ordersLink.style.cssText;
          }
          
          newListItem.appendChild(newLink);

          // Dodaj link po "Zam√≥wienia"
          const parent = ordersListItem.parentElement;
          if (parent) {
            if (ordersListItem.nextSibling) {
              parent.insertBefore(newListItem, ordersListItem.nextSibling);
            } else {
              parent.appendChild(newListItem);
            }
            console.log('‚úÖ [ACCOUNT-MENU] Link "Moje obrazy" dodany do menu konta klienta');
            return true;
          }

          return false;
        }

        // Pr√≥buj dodaƒá link wielokrotnie (dla dynamicznych stron Shopify Customer Account API)
        function tryAddLink() {
          const maxAttempts = 10;
          let attempts = 0;
          
          const interval = setInterval(function() {
            attempts++;
            if (addMyImagesLink() || attempts >= maxAttempts) {
              clearInterval(interval);
            }
          }, 500);
        }

        // Start gdy DOM ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', function() {
            tryAddLink();
          });
        } else {
          tryAddLink();
        }

        // Obserwuj zmiany w DOM (dla dynamicznych menu Shopify Customer Account API)
        const observer = new MutationObserver(function(mutations) {
          addMyImagesLink();
        });

        setTimeout(function() {
          const accountSection = document.querySelector('main') || document.querySelector('body');
          if (accountSection) {
            observer.observe(accountSection, {
              childList: true,
              subtree: true
            });
          }
        }, 1000);
      })();
    </script>
    
    <!-- KOMPLETNY NAG≈Å√ìWEK CUSTOMIFY -->
    <header class="header-main">
      <!-- G√ìRA HEADERA: Logo + Linki u≈ºytkownika + Koszyk -->
      <div class="header-top">
        <div class="header-container">
          <!-- Logo (≈õrodek) -->
          <div class="header-logo">
            <a href="{{ routes.root_url }}" class="logo-link">
              {% if settings.logo != blank %}
                <img src="{{ settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" class="logo-image">
              {% else %}
                <span class="logo-text">{{ shop.name }}</span>
              {% endif %}
            </a>
          </div>
          
          <!-- Linki u≈ºytkownika + Koszyk (po prawej) -->
          <div class="header-right">
            <div class="header-user">
              {% if customer %}
                <div class="user-section">
                  <a href="{{ routes.account_url }}" class="user-icon-wrapper">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="user-icon">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </a>
                  <div class="user-links">
                    <a href="{{ routes.account_url }}" class="user-text-link">Moje konto</a>
                    <a href="/pages/my-generations" class="user-text-link">Moje Obrazy</a>
                    <a href="{{ routes.account_logout_url }}" class="user-text-link">Wyloguj siƒô</a>
                  </div>
                </div>
              {% else %}
                <div class="user-section">
                  <a href="{{ routes.account_login_url }}" class="user-icon-wrapper">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="user-icon">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                  </a>
                  <div class="user-links">
                    <a href="{{ routes.account_login_url }}" class="user-text-link">Zaloguj</a>
                    <a href="{{ routes.account_register_url }}" class="user-text-link">Zarejestruj</a>
                  </div>
                </div>
              {% endif %}
            </div>

            <div class="header-cart">
              <a href="{{ routes.cart_url }}" class="cart-link">
                <div class="cart-icon-wrapper">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="cart-icon">
                    <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V17C17 18.1 16.1 19 15 19H9C7.9 19 7 18.1 7 17V13M17 13H7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  {% if cart.item_count > 0 %}
                    <span class="cart-count">{{ cart.item_count }}</span>
                  {% endif %}
                </div>
                <span class="cart-text">Koszyk</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- D√ì≈Å HEADERA: Menu nawigacji -->
      <div class="header-bottom">
        <div class="header-container">
          <nav class="header-nav">
            {% comment %} TYLKO MENU Z SHOPIFY - main-menu-1 {% endcomment %}
            {% if linklists['main-menu-1'] and linklists['main-menu-1'].links.size > 0 %}
              {% for link in linklists['main-menu-1'].links %}
                <div class="nav-item">
                  <a href="{{ link.url }}" class="nav-link">{{ link.title }}</a>
                </div>
                {% if customer and (link.title == 'Produkty' or link.url == '/collections/see_also') %}
                  <div class="nav-item">
                    <a href="/pages/my-generations" class="nav-link">Moje Obrazy</a>
                  </div>
                {% endif %}
              {% endfor %}
            {% endif %}
          </nav>
        </div>
      </div>

    </header>

    <!-- Breadcrumbs -->
    {% if template contains 'product' or template contains 'collection' or template contains 'blog' %}
      <div class="breadcrumbs">
        <div class="breadcrumbs-container">
          <a href="{{ routes.root_url }}" class="breadcrumb-link">Home</a>
          {% if template contains 'product' %}
              <span class="breadcrumb-separator">/</span>
            <a href="/collections/all" class="breadcrumb-link">Produkty</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ product.title | truncate: 50 }}</span>
          {% elsif template contains 'collection' %}
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ collection.title }}</span>
          {% elsif template contains 'blog' %}
            <span class="breadcrumb-separator">/</span>
            <a href="{{ blog.url }}" class="breadcrumb-link">{{ blog.title }}</a>
            {% if article %}
              <span class="breadcrumb-separator">/</span>
              <span class="breadcrumb-current">{{ article.title | truncate: 30 }}</span>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endif %}

    <script
      src="{{ 'critical.js' | asset_url }}"
      type="module"
      async
      blocking="render"
    ></script>

    <main
      id="MainContent"
      class="content-for-layout"
      role="main"
      data-page-transition-enabled="{{ settings.page_transition_enabled }}"
      data-product-transition="{{ settings.transition_to_main_product }}"
      data-template="{{ template }}"
    >
      {{ content_for_layout }}

      {% if template contains 'article' and article %}
        {% assign related_collection_handle = '' %}
        {% for tag in article.tags %}
          {% if tag contains 'kolekcja:' %}
            {% assign related_collection_handle = tag | split: ':' | last | strip | downcase %}
          {% endif %}
        {% endfor %}

        {% if related_collection_handle != '' and collections[related_collection_handle] %}
          {% assign related_collection = collections[related_collection_handle] %}
          {% if related_collection.products_count > 0 %}
            <section class="customify-article-collection">
              <div class="customify-article-collection__header">
                <h2 class="customify-article-collection__title">Powiazane produkty</h2>
                <a class="customify-article-collection__link" href="{{ related_collection.url }}">Zobacz cala kolekcje</a>
              </div>
              <div class="customify-article-collection__grid">
                {% for product in related_collection.products limit: 8 %}
                  <a class="customify-article-collection__card" href="{{ product.url }}">
                    <div class="customify-article-collection__image">
                      {% if product.featured_image %}
                        <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title }}">
                      {% endif %}
                    </div>
                    <div class="customify-article-collection__meta">
                      <div class="customify-article-collection__name">{{ product.title }}</div>
                      {% if product.price %}
                        <div class="customify-article-collection__price">{{ product.price | money }}</div>
                      {% endif %}
                    </div>
                  </a>
                {% endfor %}
              </div>
            </section>
            {{ 'article-collection.css' | asset_url | stylesheet_tag }}
          {% endif %}
        {% endif %}
      {% endif %}

      {% if template contains 'collection' %}
        <div class="custom-collection-wrapper">
          <h1 class="custom-collection-title">{{ collection.title }}</h1>
          {% if collection.description != blank %}
            <div class="custom-collection-description">{{ collection.description }}</div>
          {% endif %}
        {% if collection.products_count > 0 %}
          {% if collection.handle == 'all' %}
            {% paginate collection.products by 1000 %}
              <div class="custom-collection-grid">
                {% for product in collection.products %}
                  {% if collection.handle == 'see_also' %}
                    {% assign is_hidden_product = product.url contains 'rozmiar' or product.url contains 'cyfrowy' %}
                    {% if is_hidden_product %}
                      {% continue %}
                    {% endif %}
                  {% endif %}
                  <a href="{{ product.url }}" class="custom-collection-card">
                    <div class="custom-collection-image">
                      {% if product.featured_image %}
                        <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title }}">
                      {% endif %}
                    </div>
                    <div class="custom-collection-meta">
                      <div class="custom-collection-card-title">{{ product.title }}</div>
                      {% if product.price %}
                        <div class="custom-collection-price">{{ product.price | money }}</div>
                      {% endif %}
                    </div>
                  </a>
                {% endfor %}
              </div>
            {% endpaginate %}
          {% else %}
            {% paginate collection.products by 250 %}
              <div class="custom-collection-grid">
                {% for product in collection.products %}
                  <a href="{{ product.url }}" class="custom-collection-card">
                    <div class="custom-collection-image">
                      {% if product.featured_image %}
                        <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title }}">
                      {% endif %}
                    </div>
                    <div class="custom-collection-meta">
                      <div class="custom-collection-card-title">{{ product.title }}</div>
                      {% if product.price %}
                        <div class="custom-collection-price">{{ product.price | money }}</div>
                      {% endif %}
                    </div>
                  </a>
                {% endfor %}
              </div>
              {% if paginate.pages > 1 %}
                <div class="custom-collection-pagination" style="margin-top: 30px; text-align: center;">
                  {% if paginate.previous %}
                    <a href="{{ paginate.previous.url }}" class="pagination-link" style="margin: 0 10px; padding: 8px 16px; background: #f5f5f5; border-radius: 4px; text-decoration: none; color: #333;">‚Üê Poprzednia</a>
                  {% endif %}
                  <span style="margin: 0 10px; padding: 8px 16px;">Strona {{ paginate.current_page }} z {{ paginate.pages }}</span>
                  {% if paginate.next %}
                    <a href="{{ paginate.next.url }}" class="pagination-link" style="margin: 0 10px; padding: 8px 16px; background: #f5f5f5; border-radius: 4px; text-decoration: none; color: #333;">Nastƒôpna ‚Üí</a>
                  {% endif %}
                </div>
              {% endif %}
            {% endpaginate %}
          {% endif %}
        {% else %}
            <div class="custom-collection-empty">Brak produkt√≥w do wy≈õwietlenia.</div>
          {% endif %}
        </div>
        {{ 'collection-main.css' | asset_url | stylesheet_tag }}
          .custom-collection-wrapper { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
          .custom-collection-title { font-size: 1.8rem; margin: 10px 0 15px; }
          .custom-collection-description { color: #666; margin-bottom: 15px; }
          .custom-collection-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
          .custom-collection-card { display: block; border: 1px solid #e5e5e5; border-radius: 8px; overflow: hidden; background: #fff; text-decoration: none; color: inherit; transition: box-shadow .2s ease, transform .2s ease; }
          .custom-collection-card:hover { box-shadow: 0 6px 18px rgba(0,0,0,.08); transform: translateY(-2px); }
          .custom-collection-image { aspect-ratio: 1 / 1; background: #f8f9fa; display: flex; align-items: center; justify-content: center; }
          .custom-collection-image img { width: 100%; height: 100%; object-fit: cover; }
          .custom-collection-meta { padding: 10px 12px; }
          .custom-collection-card-title { font-weight: 600; font-size: .95rem; margin-bottom: 6px; }
          .custom-collection-price { color: #000000; font-weight: 700; } /* CZARNY KOLOR */
          .custom-collection-empty { color: #666; padding: 20px 0; }
        </style>
      {% endif %}
    </main>

            placeholder.appendChild(app);
          }
          
          // üì± Phone case: Hide cart price on page load
          if (window.location.pathname.toLowerCase().includes('etui')) {
            const priceEl = document.getElementById('phoneCaseCartPriceDisplay');
            const actionsEl = document.getElementById('phoneCaseCartActions');
            if (priceEl) priceEl.style.setProperty('display','none','important');
            if (actionsEl) actionsEl.style.setProperty('display','none','important');
          }
        });
      </script>
      
      <script>
        // Przeka≈º dane produktu do JavaScript
        {% if product %}
        window.ShopifyProduct = {
          id: {{ product.id }},
          title: {{ product.title | json }},
          handle: {{ product.handle | json }},
          url: {{ product.url | json }},
          imageUrl: {{ product.featured_image | image_url: width: 600 | json }},
          variants: {{ product.variants | json }},
          options: {{ product.options | json }},
          price: {{ product.price | money | json }}
        };
        console.log('üì¶ [SHOPIFY PRODUCT] Product data loaded:', window.ShopifyProduct);
        {% endif %}
      </script>

      <script>
        (function() {
          if (!window.ShopifyProduct || !window.ShopifyProduct.id) return;
          if (window.__customifyProductStatsInit) return;
          window.__customifyProductStatsInit = true;

          const TRACK_URL = 'https://customify-s56o.vercel.app/api/admin/product-performance-stats';
          const productMeta = {
            productId: window.ShopifyProduct.id,
            productHandle: window.ShopifyProduct.handle,
            productTitle: window.ShopifyProduct.title,
            productUrl: window.location.href.split('#')[0],
            imageUrl: window.ShopifyProduct.imageUrl || null
          };

          const sendEvent = async (eventType, extra = {}) => {
            try {
              await fetch(TRACK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  eventType,
                  timestamp: new Date().toISOString(),
                  ...productMeta,
                  ...extra
                })
              });
            } catch (error) {
              console.warn('‚ö†Ô∏è [PRODUCT-STATS] Failed to send event:', eventType, error?.message || error);
            }
          };
          window.__customifyProductStatsSendEvent = sendEvent;

          document.addEventListener('DOMContentLoaded', function() {
            sendEvent('product_view');
            const transformBtn = document.getElementById('transformBtn');
            if (transformBtn) {
              transformBtn.addEventListener('click', function() {
                sendEvent('generate_click');
              });
            }
          });

          if (typeof window.fetch === 'function' && !window.__customifyProductStatsFetchWrapped) {
            const originalFetch = window.fetch.bind(window);
            window.__customifyProductStatsFetchWrapped = true;
            window.fetch = async function(...args) {
              const url = typeof args[0] === 'string' ? args[0] : args[0]?.url;
              const isTransformCall = url && url.includes('/api/transform');
              if (!isTransformCall) {
                return originalFetch(...args);
              }
              try {
                const response = await originalFetch(...args);
                if (response?.ok) {
                  sendEvent('api_success', { status: response.status });
                } else {
                  sendEvent('api_error', { status: response?.status || null });
                }
                return response;
              } catch (error) {
                sendEvent('api_error', { error: error?.message || 'fetch_error' });
                throw error;
              }
            };
          }
        })();
      </script>
      
      <div id="customify-app-container" class="customify-shopify-container">
        <!-- Wyb√≥r rodzaju wydruku - NAD sekcjƒÖ rozmiar√≥w -->
        <div class="customify-product-type-selector" id="productTypeArea" style="display: block; margin-bottom: 10px;">
          <h4 style="text-align: left; font-size: 0.95rem; font-weight: 600;">Rodzaj wydruku:</h4>
          <div class="customify-product-type-buttons">
            {% comment %} FILTRUJ RODZAJE WYDRUKU PER PRODUKT {% endcomment %}
            {% if product.handle == 'karykatura-na-zamowienie-druk-na-szkle-akrylowym-ramka-z-podswietleniem' or product.handle == 'prezent-dla-babci-i-dziadka-portret-na-na-szkle-akrylowym-ze-zdjecia-karykatura' or product.handle == 'dziadkowie-krolowie-nadruk-na-szkle' or product.handle == 'portret-pary-personalizowany-obraz-na-szkle-akrylowym' %}
              {% comment %} TYLKO SZK≈ÅO dla produkt√≥w na szkle akrylowym {% endcomment %}
              <div class="customify-product-type-btn active" data-product-type="szklo">
                Nadruk na szkle (dodaj podstawkƒô)
              </div>
            {% elsif product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
              {% comment %} TYLKO SZK≈ÅO dla ramka-spotify {% endcomment %}
              <div class="customify-product-type-btn active" data-product-type="szklo">
                Nadruk na szkle (dodaj podstawkƒô)
              </div>
            {% else %}
              {% comment %} STANDARDOWE OPCJE dla innych produkt√≥w {% endcomment %}
              <div class="customify-product-type-btn active" data-product-type="plakat">
                Plakat (dodaj ramkƒô)
              </div>
              <div class="customify-product-type-btn" data-product-type="canvas">
                Obraz na p≈Ç√≥tnie
              </div>
              <!-- üÜï NOWY TYP: Nadruk na szkle -->
              <div class="customify-product-type-btn" data-product-type="szklo">
                Nadruk na szkle (dodaj podstawkƒô)
              </div>
              <!-- üö® ROLLBACK: START - Opcja produktu cyfrowego -->
              <div class="customify-product-type-btn" data-product-type="digital">
                Produkt cyfrowy
              </div>
              <!-- üö® ROLLBACK: END - Opcja produktu cyfrowego -->
            {% endif %}
          </div>
          <!-- Wysuwane menu wyboru koloru ramki (tylko dla opcji plakat) -->
          <div class="frame-color-selector" id="frameSelector" aria-expanded="false">
            <button type="button" class="frame-toggle" id="frameToggle">
              Ramka: <span id="frameCurrentLabel">Brak ramki</span>
              <span class="frame-caret">‚ñº</span>
            </button>
            <div class="frame-options" id="frameOptions" style="display: none;">
              <div class="frame-option" data-frame="none" aria-selected="true">Brak ramki</div>
              <div class="frame-option" data-frame="black">Czarna</div>
              <div class="frame-option" data-frame="white">Bia≈Ça</div>
              <div class="frame-option" data-frame="wood">Drewno</div>
            </div>
          </div>
          
          <!-- üÜï Wysuwane menu wyboru podstawki (tylko dla opcji szk≈Ço) -->
          <div class="stand-selector" id="standSelector" aria-expanded="false" style="display: none;">
            <button type="button" class="stand-toggle" id="standToggle">
              Podstawka: <span id="standCurrentLabel">Brak podstawki</span>
              <span class="stand-caret">‚ñº</span>
            </button>
            <div class="stand-options" id="standOptions" style="display: none;">
              <div class="stand-option" data-stand="none" aria-selected="true">
                <span class="stand-option-text">Brak podstawki</span>
              </div>
              <div class="stand-option" data-stand="wood">
                <img src="https://customify-s56o.vercel.app/akryl/podstawka.png" alt="Podstawka drewniana" class="stand-option-image">
                <span class="stand-option-text">Podstawka drewniana</span>
              </div>
              <div class="stand-option" data-stand="led">
                <img src="https://customify-s56o.vercel.app/akryl/podstawka_led.png" alt="Podstawka z LED" class="stand-option-image">
                <span class="stand-option-text">Podstawka drewniana z LED</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Rozmiary - POD sekcjƒÖ rodzaju wydruku -->
        <div class="customify-size-selector" id="sizeArea" style="display: block; margin-bottom: 10px;">
          <h4 style="text-align: left;">Rozmiar (cm):</h4>
          <div class="customify-size-buttons">
                <div class="customify-size-btn" data-size="a5" data-for-szklo="true">15√ó21</div>
                <div class="customify-size-btn" data-size="a4">20√ó30</div>
                <div class="customify-size-btn" data-size="a3">30√ó45</div>
                <div class="customify-size-btn" data-size="a2">40√ó60</div>
                <div class="customify-size-btn" data-size="a0">50√ó75</div>
                <div class="customify-size-btn" data-size="a1">60√ó90</div>
          </div>
        </div>
        <div id="type-size-original-placeholder" style="display: contents;"></div>
        
        <h3 class="customify-title">Wgraj zdjƒôcie i zobacz efekt od razu</h3>
        
        <!-- Animowane strza≈Çki wskazujƒÖce w d√≥≈Ç -->
        <div class="arrow-down">
          <span>‚Üì</span>
          <span>‚Üì</span>
          <span>‚Üì</span>
        </div>
        <div class="customify-inline-wrapper">
          <div class="customify-embed" id="customifyEmbed">
          <div class="customify-upload-area" id="uploadArea">
            <div class="customify-drop-zone" id="dropZone">
              <div class="drop-zone-content">
                <button class="customify-upload-btn" id="uploadBtn">
                  Dodaj zdjƒôcie
                </button>
              </div>
            </div>
            <input type="file" id="fileInput" class="customify-file-input" accept="image/*">
            <!-- Komunikat b≈Çƒôdu - od razu pod uploadem -->
            <div class="customify-error" id="errorMessage" style="display: none;"></div>
          </div>

            <div class="customify-preview" id="previewArea">
              <h4>Twoje zdjƒôcie:</h4>
              {% if product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
                <div class="spotify-frame-preview">
                  <div class="spotify-frame-inner">
                    <img id="previewImage" alt="PodglƒÖd zdjƒôcia">
                    <!-- Teksty na ramce Spotify (preview) -->
                    <div class="spotify-text-overlay">
                      <div class="spotify-text-title" id="spotifyTextTitlePreview"></div>
                      <div class="spotify-text-artist" id="spotifyTextArtistPreview"></div>
                    </div>
                  </div>
                </div>
              {% elsif product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
                <div class="phone-case-preview">
                  <div class="phone-case-inner">
                    <div class="phone-case-photo-bg" id="phoneCasePhotoBg"></div>
                    <img class="phone-case-overlay" src="https://customify-s56o.vercel.app/phone/phone_ok.png" alt="">
                    <img id="previewImage" alt="PodglƒÖd zdjƒôcia" style="display: none;">
                  </div>
                </div>
                <!-- üì± Phone case: Przycisk "Dodaj do koszyka" pod obrazkiem w previewArea -->
                <div class="customify-actions" id="phoneCaseCartActions" style="display: none; margin-top: 15px;">
                  <button class="customify-btn customify-btn-primary customify-btn-red" id="phoneCaseAddToCartBtn">
                    Dodaj do koszyka
                  </button>
                  <button class="customify-btn customify-btn-secondary" id="phoneCaseTryAgainBtn">
                    Spr√≥buj ponownie
                  </button>
                </div>
                <!-- üì± Phone case: Cena nad przyciskiem -->
                <div class="customify-cart-price" id="phoneCaseCartPriceDisplay" style="display: none; margin: 15px 0; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                  <span class="cart-price-label" style="font-weight: 600; color: #333; margin-right: 12px;">Cena:</span>
                  <span class="cart-price-value" id="phoneCaseCartPriceValue" style="font-size: 1.2rem; font-weight: 700; color: #e55a2b;">0.00 z≈Ç</span>
                </div>
              {% else %}
                <img id="previewImage" alt="PodglƒÖd zdjƒôcia">
              {% endif %}
            </div>

            {% if product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
            {% if product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
            <!-- üé® Panel filtr√≥w zdjƒôƒá (natychmiastowe, bez AI) - WY≈ªEJ, pod zdjƒôciem -->
            <div class="spotify-filters-panel" id="spotifyFiltersPanel" style="display: none;">
              <h3 class="spotify-panel-title">‚ú® Popraw zdjƒôcie</h3>
              <p style="font-size: 0.85rem; color: #666; margin-bottom: 12px;">Kliknij na filtr, ≈ºeby zobaczyƒá efekt natychmiast</p>
              <div class="spotify-filters-grid">
                <div class="spotify-filter-btn active" data-filter="none">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0);"></div>
                  <span>Orygina≈Ç</span>
                </div>
                <div class="spotify-filter-btn" data-filter="brighten">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #fff9c4, #fff59d);"></div>
                  <span>Rozja≈õnij</span>
                </div>
                <div class="spotify-filter-btn" data-filter="vivid">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #e91e63, #9c27b0);"></div>
                  <span>≈ªywe kolory</span>
                </div>
                <div class="spotify-filter-btn" data-filter="warm">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #ff9800, #ffb74d);"></div>
                  <span>Ciep≈Çy</span>
                </div>
                <div class="spotify-filter-btn" data-filter="bw">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #212121, #757575);"></div>
                  <span>Czarno-bia≈Çy</span>
                </div>
                <div class="spotify-filter-btn" data-filter="sharpen">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #37474f, #607d8b);"></div>
                  <span>Wyostrz</span>
                </div>
                <div class="spotify-filter-btn" data-filter="vintage">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #8d6e63, #bcaaa4);"></div>
                  <span>Vintage</span>
                </div>
                <div class="spotify-filter-btn" data-filter="dotScreen">
                  <div class="filter-preview" style="background: linear-gradient(135deg, #424242, #757575);"></div>
                  <span>Halftone</span>
                </div>
              </div>
            </div>
            
            <!-- Panel tekst√≥w dla zdjecie-na-szkle-ramka-spotify - PO sekcji filtr√≥w -->
            <div class="spotify-text-panel" id="spotifyTextPanel">
              <h3 class="spotify-panel-title">Dodaj napis</h3>
              <div class="spotify-text-field">
                <label class="spotify-text-label">Nag≈Ç√≥wek <span class="required">*</span></label>
                <div class="spotify-input-wrapper">
                  <input type="text" id="spotifyTitle" class="spotify-text-input spotify-text-input-large" placeholder="PRAWDZIWA MI≈ÅO≈öƒÜ" maxlength="30">
                  <span class="spotify-char-counter" id="spotifyTitleCounter">0/30</span>
                </div>
              </div>
              <div class="spotify-text-field">
                <label class="spotify-text-label">Podpis <span class="required">*</span></label>
                <div class="spotify-input-wrapper">
                  <input type="text" id="spotifyArtist" class="spotify-text-input spotify-text-input-large" placeholder="Sara i Janek" maxlength="40">
                  <span class="spotify-char-counter" id="spotifyArtistCounter">0/40</span>
                </div>
              </div>
            </div>
            {% endif %}
            
            {% if product.handle == 'ramka-spotify' %}
            <!-- Panel tekst√≥w dla ramka-spotify - widoczny zawsze -->
            <div class="spotify-text-panel" id="spotifyTextPanel">
              <h3 class="spotify-panel-title">Dodaj napis</h3>
              <div class="spotify-text-field">
                <label class="spotify-text-label">Nag≈Ç√≥wek <span class="required">*</span></label>
                <div class="spotify-input-wrapper">
                  <input type="text" id="spotifyTitle" class="spotify-text-input spotify-text-input-large" placeholder="PRAWDZIWA MI≈ÅO≈öƒÜ" maxlength="30">
                  <span class="spotify-char-counter" id="spotifyTitleCounter">0/30</span>
                </div>
              </div>
              <div class="spotify-text-field">
                <label class="spotify-text-label">Podpis <span class="required">*</span></label>
                <div class="spotify-input-wrapper">
                  <input type="text" id="spotifyArtist" class="spotify-text-input spotify-text-input-large" placeholder="Sara i Janek" maxlength="40">
                  <span class="spotify-char-counter" id="spotifyArtistCounter">0/40</span>
                </div>
              </div>
            </div>
            {% endif %}
            
            <!-- Slot dla element√≥w typu/rozmiaru dla "bez-zmian" -->
            <div id="spotify-type-size-slot" style="display: none;"></div>
            {% endif %}

            {% if product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
              <div id="spotifyCropModal" class="spotify-crop-modal" aria-hidden="true">
                <div class="spotify-crop-dialog">
                  <h4>Ustaw kadr zdjƒôcia</h4>
                  <div class="spotify-crop-canvas">
                    <img id="spotifyCropImage" alt="Kadrowanie zdjƒôcia">
                  </div>
                  <div class="spotify-crop-actions">
                    <button type="button" class="customify-btn customify-btn-secondary" id="spotifyCropCancelBtn">Anuluj</button>
                    <button type="button" class="customify-btn customify-btn-primary" id="spotifyCropConfirmBtn">Zapisz kadr</button>
                  </div>
                </div>
              </div>
            {% endif %}

            {% if product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem-karykatura' %}
              <div id="phoneCropModal" class="phone-crop-modal" aria-hidden="true">
                <div class="phone-crop-dialog">
                  <h4>Ustaw kadr zdjƒôcia</h4>
                  <div class="phone-crop-canvas">
                    <img id="phoneCropImage" alt="Kadrowanie zdjƒôcia">
                  </div>
                  <div class="phone-crop-actions">
                    <button type="button" class="customify-btn customify-btn-secondary" id="phoneCropCancelBtn">Anuluj</button>
                    <button type="button" class="customify-btn customify-btn-primary" id="phoneCropConfirmBtn">Zapisz kadr</button>
                  </div>
                </div>
              </div>
            {% endif %}
            
            {% if product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
              <div id="phonePhotoCropModal" class="phone-photo-crop-modal" aria-hidden="true">
                <div class="phone-photo-crop-dialog">
                  <h4>Ustaw kadr zdjƒôcia</h4>
                  <div class="phone-photo-crop-canvas">
                    <img id="phonePhotoCropImage" alt="Kadrowanie zdjƒôcia">
                    <div id="phonePhotoCropWatermark" class="phone-photo-crop-watermark" style="display: none;"></div>
                  </div>
                  <div class="phone-photo-crop-actions">
                    <button type="button" class="customify-btn customify-btn-secondary" id="phonePhotoCropCancelBtn">Anuluj</button>
                    <button type="button" class="customify-btn customify-btn-primary" id="phonePhotoCropConfirmBtn">Zapisz kadr</button>
                  </div>
                </div>
              </div>
            {% endif %}

            <div class="customify-styles" id="stylesArea" style="{% if product.handle == 'zdjecie-na-szkle-ramka-spotify' %}display: none;{% else %}display: block;{% endif %}">
              <h4>{% if product.handle == 'ramka-spotify' %}Popraw Obrazek{% else %}Wybierz styl i kliknij Utw√≥rz{% endif %}</h4>
              <div class="customify-style-grid">
                {% comment %} LOGIKA SERVER-SIDE: Filtruj style per produkt {% endcomment %}
                {% comment %} DEBUG: Product handle = {{ product.handle }}, ID = {{ product.id }} {% endcomment %}
                {% if product.handle == 'karykatura-z-twojego-zdjecia-obraz' %}
                  {% comment %} TYLKO STYLE KARYKATURY dla produktu karykatura - u≈ºywa Segmind API {% endcomment %}                                                   
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/caricature.png'); background-size: cover; background-position: center;"></div>                                                
                    <div class="style-info">
                      <div class="style-name">Karykatura</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="caricature-new" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/karykat_nowoczesna.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Nowoczesna</div>
                    </div>
                  </div>
                {% elsif product.handle == 'karykatura-prezent-na-rocznice-prezent-ze-zdjecia' or product.handle == 'portret-pary-personalizowany-obraz-na-szkle-akrylowym' %}
                  {% comment %} TYLKO STYLE KARYKATURY dla produktu karykatura-prezent - u≈ºywa Segmind API {% endcomment %}                                                   
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/caricature_2.png'); background-size: cover; background-position: center;"></div>                                                
                    <div class="style-info">
                      <div class="style-name">Karykatura</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="caricature-new" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/nowoczesna_2.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Nowoczesna</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="karykatura-olowek" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/olowek.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Szkic o≈Ç√≥wkiem</div>
                    </div>
                  </div>
                {% elsif product.handle == 'karykatura-na-zamowienie-druk-na-szkle-akrylowym-ramka-z-podswietleniem' %}
                  {% comment %} TYLKO STYLE KARYKATURY dla produktu karykatura-na-zamowienie - u≈ºywa Segmind API {% endcomment %}
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/caricature.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Karykatura</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="caricature-new" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/karykat_nowoczesna.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Nowoczesna</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="karykatura-olowek" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/olowek.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Szkic o≈Ç√≥wkiem</div>
                    </div>
                  </div>
                {% elsif product.handle == 'plakat-ze-zdjecia-w-stylu-komiks' %}
                  {% comment %} TEST: Styl karykatury szkic o≈Ç√≥wkiem tylko dla produktu komiks {% endcomment %}
                  <div class="customify-style-card" data-style="karykatura-olowek" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/olowek.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Szkic o≈Ç√≥wkiem</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="watercolor_ok" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/akwarela/watercolor_ok.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Watercolor OK</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="swieta" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/swieta/banka_ok.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Banka</div>
                    </div>
                  </div>
                {% elsif product.handle == 'personalizowany-portret-w-stylu-boho' %}
                  {% comment %} NOWE STYLE BOHO dla produktu boho {% endcomment %}
                  <div class="customify-style-card" data-style="minimalistyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/boho/minimal.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-name">Minimalistyczny</div>
                  </div>
                  
                  <div class="customify-style-card" data-style="realistyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/boho/detail.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-name">Realistyczny</div>
                  </div>
                {% elsif product.handle == 'portret-krola-polski-obraz-na-plotnie-z-twojego-zdjecia' %}
                  {% comment %} STYLE KR√ìL POLSKI dla produktu portret-krola-polski {% endcomment %}
                  <div class="customify-style-card" data-style="krol-polski">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-5.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Polski</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-polski-krolewski">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-7.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lewski</div>
                    </div>
                  </div>
                {% elsif product.handle == 'krol-portret-personalizowany' %}
                  {% comment %} TYLKO STYLE KR√ìLA dla produktu kr√≥l {% endcomment %}
                  <div class="customify-style-card" data-style="krol-krolewski">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Kr√≥lewski</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-majestatyczny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-2.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Majestatyczny</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-triumfalny">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol-styl-3.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l Triumfalny</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krol-imponujacy">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krol/krol_4.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥l ImponujƒÖcy</div>
                    </div>
                  </div>
                {% elsif product.id == 15389095297349 or product.handle == 'krolowa' or product.handle contains 'krolowa' %}
                  {% comment %} TYLKO STYLE KR√ìLOWEJ dla produktu kr√≥lowa {% endcomment %}
                  <div class="customify-style-card" data-style="krolowa-styl-1">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 1</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-2">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-2.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 2</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-3">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa-styl-3.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Styl 3</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolowa-styl-4">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa_sitting.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa - Sitting</div>
                    </div>
                  </div>
                {% elsif product.handle contains 'superbohater' and product.handle != 'portret-superbohater-obraz-na-plotnie-z-twojego-zdjecia-superman' %}
                  {% comment %} TYLKO STYL SUPERBOHATER dla produktu superbohater {% endcomment %}
                  <div class="customify-style-card" data-style="superhero_kid">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/superbohater/superhero_ok_1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Superbohater</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-dziecka-w-stroju-jednorozca-obraz-ze-zdjecia-dla-dziewczynki' %}
                  {% comment %} STYL JEDNORO≈ªCA dla produktu jednoro≈ºec {% endcomment %}
                  <div class="customify-style-card" data-style="jednorozec">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/jednoroz/jednorozec.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Jednoro≈ºec</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-dziecka-w-stroju-misia-uroczy-obraz-z-twojego-zdjecia' %}
                  {% comment %} STYL MISIA dla produktu mi≈õ {% endcomment %}
                  <div class="customify-style-card" data-style="mis">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/dziecko/dziecko_mis.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Mi≈õ</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-w-stylu-hip-hop-obraz-na-plotnie-z-twojego-zdjecia' %}
                  {% comment %} STYL HIP-HOP dla produktu hip-hop {% endcomment %}
                  <div class="customify-style-card" data-style="hiphop">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/hiphop.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Hip-Hop</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-ze-zdjecia-dla-dziewczynki-zimowa-ksiezniczka-obraz' %}
                  {% comment %} STYL ZIMOWA KSIƒò≈ªNICZKA dla produktu zimowa ksiƒô≈ºniczka {% endcomment %}
                  <div class="customify-style-card" data-style="zimowa-ksiezniczka">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/dziecko/zimowa.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Zimowa Ksiƒô≈ºniczka</div>
                    </div>
                  </div>
                {% elsif product.handle == 'obraz-ze-zdjecia-krolowa-sniegu-na-tronie-portret-r' %}
                  {% comment %} STYL KR√ìLOWA ≈öNIEGU dla produktu kr√≥lowa ≈õniegu {% endcomment %}
                  <div class="customify-style-card" data-style="krolowa-sniegu">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolowa/krolowa_sniegu.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lowa ≈öniegu</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-z-twojego-zdjecia-neon-lights-dla-dziewczyny-prezent' %}
                  {% comment %} STYL NEO dla produktu neon lights {% endcomment %}
                  <div class="customify-style-card" data-style="neo">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/kobieta/neon.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Neo</div>
                    </div>
                  </div>
                {% elsif product.handle == 'personalizowany-obraz-z-twojego-zdjecia-dla-mezczyzny-w-stylu-western-wanted' %}
                  {% comment %} STYL WANTED dla produktu western wanted {% endcomment %}
                  <div class="customify-style-card" data-style="wanted">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/wanted/wanted_1.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Wanted_Man</div>
                    </div>
                  </div>
                {% elsif product.handle == 'obraz-ze-zdjecia-dla-kobiety-w-stylu-western-wanted-poszukiwana' %}
                  {% comment %} STYL WANTED_K dla produktu western wanted (kobieta) {% endcomment %}
                  <div class="customify-style-card" data-style="wanted_k">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/wanted/wanted_2.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Wanted_K</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-superbohater-obraz-na-plotnie-z-twojego-zdjecia-superman' %}
                  {% comment %} STYL SUPERMAN dla produktu superman {% endcomment %}
                  <div class="customify-style-card" data-style="superman">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/superhero/superman.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">superman</div>
                    </div>
                  </div>
                {% elsif product.handle == 'koty-krolewskie-zwierzeta-w-koronach' %}
                  {% comment %} TYLKO STYLE KOT√ìW dla produktu kot√≥w {% endcomment %}
                  <div class="customify-style-card" data-style="krolewski">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/krolewski.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Kr√≥lewski Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="na-tronie">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/na_tronie.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Kot na Tronie</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="wojenny">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/wojenny.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Wojenny Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="wiktorianski">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/wiktorianski.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Wiktoria≈Ñski Kot</div>
                  </div>
                </div>
                <div class="customify-style-card" data-style="renesansowy">
                  <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/koty/renesansowy.png'); background-size: cover; background-position: center;"></div>
                  <div class="style-info">
                    <div class="style-name">Renesansowy Kot</div>
                  </div>
                </div>
                {% elsif product.id == 15306975215941 %}
                  {% comment %} TYLKO STYL PIXAR dla produktu zabawne-style (ID: 15306975215941) {% endcomment %}
                  <div class="customify-style-card" data-style="pixar">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/pixar/pixar-styl.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Pixar</div>
                    </div>
                  </div>
                {% elsif product.handle == 'obraz-ze-zdjecia-swiateczny-nastroj' %}
                  {% comment %} TYLKO STYL ≈öWIƒÑTECZNY (swieta) dla produktu ≈öwiƒÖteczny Nastr√≥j {% endcomment %}
                  <div class="customify-style-card" data-style="swieta" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/swieta/banka_ok.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Banka</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="swieta_2" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/swieta/swieta_1.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">≈öwiƒôta</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-pary-w-stylu-anime-obraz-ze-zdjecia' %}
                  {% comment %} TYLKO STYL ANIME dla produktu anime {% endcomment %}
                  <div class="customify-style-card" data-style="anime">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/para/anime.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Anime</div>
                    </div>
                  </div>
                {% elsif product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
                  {% comment %} STYLE SPOTIFY FRAME {% endcomment %}
                  <div class="customify-style-card" data-style="bez-zmian">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/ok.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Bez zmian</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="usun-tlo">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/para/background.jpeg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Usu≈Ñ t≈Ço</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="anime">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/para/anime.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Anime</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="sketch">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/para/sketch.jpeg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Sketch</div>
                    </div>
                  </div>
                {% elsif product.handle == 'obraz-ze-zdjecia-akwarela' %}
                  {% comment %} STYLOWANIE WATERCOLOUR OK - BEZ DODATKOWYCH WARUNK√ìW {% endcomment %}
                  <div class="customify-style-card" data-style="watercolor_ok" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/akwarela/watercolor_ok.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Watercolor</div>
                    </div>
                  </div>
                  <script>
                    // Fallback: upewnij siƒô, ≈ºe oba style sƒÖ widoczne na akwarela
                    document.addEventListener('DOMContentLoaded', function() {
                      if (window.location.pathname.includes('obraz-ze-zdjecia-akwarela')) {
                        ['watercolor_ok'].forEach(function(style) {
                          const el = document.querySelector('.customify-style-card[data-style="' + style + '"]');
                          if (el) { el.style.display = 'block'; el.style.setProperty('display', 'block', 'important'); }
                        });
                      }
                    });
                  </script>
                {% elsif product.id == 15475649675589 or product.handle contains 'akwarela' %}
                  {% comment %} TYLKO STYL AKWARELE dla produktu akwarela - u≈ºywa Segmind Become-Image API {% endcomment %}
                  <div class="customify-style-card" data-style="akwarela">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/akwarela/watercolor-style.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Akwarela</div>
                    </div>
                  </div>
                {% elsif product.id == 15548464693573 or product.handle == 'dziadkowie-krolowie-nadruk-na-szkle' %}
                  {% comment %} STYLE ZAMKOWY I KR√ìLEWSKI dla produktu (ID: 15548464693573) {% endcomment %}
                  <div class="customify-style-card" data-style="zamkowy">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/zamkowy/zamkowy-styl.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Zamkowy</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="krolewski-para">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/krolewski/krolewski-styl.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Kr√≥lewski</div>
                    </div>
                  </div>
                {% elsif product.handle == 'test-karikat' or product.handle contains 'test-karikat' %}
                  {% comment %} TYLKO STYL OPENAI ART dla produktu test-karikat - u≈ºywa OpenAI GPT-Image-1 API {% endcomment %}
                  {% comment %} DEBUG: Warunek spe≈Çniony! Handle = {{ product.handle }} {% endcomment %}
                  <div class="customify-style-card" data-style="openai-art" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/openai/openai-art-style.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">AI Art</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="caricature-new" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/karykat_nowoczesna.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Caricature New</div>
                    </div>
                  </div>
                  {% comment %} DEBUG: Koniec sekcji test-karikat {% endcomment %}
                {% elsif product.handle == 'portret-w-stylu-gta-obraz-na-plotnie-z-twojego-zdjecia-super-prezent' %}
                  {% comment %} STYLE GTA dla produktu GTA {% endcomment %}
                  <div class="customify-style-card" data-style="gta">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/GTA.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">GTA</div>
                    </div>
                  </div>
                {% elsif product.handle == 'prezent-dla-babci-i-dziadka-portret-na-na-szkle-akrylowym-ze-zdjecia-karykatura' %}
                  {% comment %} STYLE KARYKATURY dla produktu Prezent dla Babci i Dziadka {% endcomment %}
                  <div class="customify-style-card" data-style="karykatura">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/dziadki_2.jpeg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Klasyczna</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="caricature-new" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/dziadkowie.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Nowoczesna</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="karykatura-olowek" style="display: block !important;">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/karykat/olowek.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Szkic</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-zakochana-para-krolewska-prezent-na-walentynki-personalizowany' %}
                  {% comment %} STYL ROYAL LOVE dla produktu Portret Zakochana Para Kr√≥lewska - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="royal-love">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/royal_love.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Royal Love</div>
                    </div>
                  </div>
                {% elsif product.handle == 'obraz-na-plotnie-szalona-milosc-prezent-na-walentynki-z-twojego-zdjecia' %}
                  {% comment %} STYL CRAZY LOVE dla produktu Szalona Mi≈Ço≈õƒá - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="crazy-love">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/crazy_l.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Crazy Love</div>
                    </div>
                  </div>
                {% elsif product.handle == 'prezent-na-walentynki-obraz-na-plotnie-z-twojego-zdjecia' %}
                  {% comment %} STYL LOVE ROSE dla produktu Prezent na Walentynki - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="love-rose">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/love_rose.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Love Rose</div>
                    </div>
                  </div>
                {% elsif product.handle == 'prezent-na-walentynki-portret-rysunkowa-para-personalizowany-ze-zdjecia' %}
                  {% comment %} STYL SZKIC LOVE dla produktu Prezent na Walentynki Portret Rysunkowa Para - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="szkic-love">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/szkic_love.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Szkic Love</div>
                    </div>
                  </div>
                {% elsif product.handle == 'portret-para-przy-drzewie-prezent-na-walentynki-romantyczny-obraz-na-plotnie-z-twojego-zdjecia' %}
                  {% comment %} STYL JAK Z BAJKI dla produktu Portret Para przy Drzewie - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="jak-z-bajki">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/jak_bajka.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Jak z bajki</div>
                    </div>
                  </div>
                {% elsif product.handle == 'prezent-na-walentynki-superpara-obraz-na-plotnie-z-twojego-zdjecia' %}
                  {% comment %} STYL SUPERPARA dla produktu Prezent na Walentynki Superpara - OpenAI GPT Image 1.5 via Replicate {% endcomment %}
                  <div class="customify-style-card" data-style="superpara">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/style/superpara.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Superpara</div>
                    </div>
                  </div>
                {% else %}
                  {% comment %} WSZYSTKIE STYLE NORMALNE dla innych produkt√≥w {% endcomment %}
                  <div class="customify-style-card" data-style="watercolor">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/Screenshot%202025-09-29%20at%2022.17.14.png'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Akwarela</div>
                    </div>
                  </div>
                  <div class="customify-style-card" data-style="pixar">
                    <div class="style-image" style="background-image: url('https://customify-s56o.vercel.app/pixar/pixar-styl.jpg'); background-size: cover; background-position: center;"></div>
                    <div class="style-info">
                      <div class="style-name">Pixar</div>
                    </div>
                  </div>
                {% endif %}
              </div>
        </div>

            {% if product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
              <div id="spotifyFieldsPanel" class="customify-spotify-panel" style="display: none; margin: 12px 0 8px 0;">
                <h4 style="margin-bottom: 6px;">Tekst na ramce</h4>
                <div style="display: grid; gap: 8px;">
                  <label for="spotifyTitle" style="font-size: 0.9rem;">Tytu≈Ç utworu</label>
                  <input type="text" id="spotifyTitle" maxlength="60" placeholder="np. Only you" style="padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                  <label for="spotifyArtist" style="font-size: 0.9rem;">Artysta</label>
                  <input type="text" id="spotifyArtist" maxlength="60" placeholder="np. Wiktoria i Oskar" style="padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                </div>
              </div>
            {% endif %}


            <!-- Komunikat b≈Çƒôdu - tu≈º nad przyciskiem "Utw√≥rz Obraz" -->
            <div class="customify-error" id="errorMessageTransform" style="display: none;"></div>
            
            <div class="customify-actions" id="actionsArea" style="display: none;">
              <button class="customify-btn customify-btn-red" id="transformBtn">
                Utw√≥rz Obraz
              </button>
              <button class="customify-btn customify-btn-secondary" id="resetBtn" style="display: none;">
                Wgraj inne zdjƒôcie
              </button>
              <button class="customify-btn customify-btn-primary" id="addToCartBtnMain" style="display: none;">
                Dodaj do koszyka
              </button>
      </div>

            <div class="customify-loading" id="loadingArea">
              <!-- Animowane strza≈Çki wskazujƒÖce w d√≥≈Ç -->
              <div class="arrow-down">
                <span>‚Üì ‚Üì ‚Üì</span>
              </div>
              <div class="customify-spinner"></div>
              <div class="loading-text">Generowanie mo≈ºe potrwaƒá nawet 2 minuty - zaczekaj</div>
              <div class="loading-progress">
                <div class="loading-progress-bar" id="progressBar"></div>
              </div>
              <div class="loading-stage" id="loadingStage">Przesy≈Çanie zdjƒôcia...</div>
            </div>

            <div class="customify-result" id="resultArea">
              <h4>Tw√≥j obraz:</h4>
              {% if product.handle == 'ramka-spotify' or product.handle == 'zdjecie-na-szkle-ramka-spotify' %}
                <div class="spotify-frame-result">
                  <div class="spotify-frame-inner">
                    <img id="resultImage" alt="Wynik AI">
                    <!-- Teksty na ramce Spotify -->
                    <div class="spotify-text-overlay">
                      <div class="spotify-text-title" id="spotifyTextTitle"></div>
                      <div class="spotify-text-artist" id="spotifyTextArtist"></div>
                    </div>
                  </div>
                </div>
                
              {% elsif product.handle == 'personalizowane-etui-na-telefon-z-twoim-zdjeciem' %}
                <div class="phone-case-preview">
                  <div class="phone-case-inner">
                    <div class="phone-case-photo-bg" id="phoneCaseResultBg"></div>
                    <img class="phone-case-overlay" src="https://customify-s56o.vercel.app/phone/phone_ok.png" alt="">
                    <img id="resultImage" alt="Wynik AI" style="display: none;">
                  </div>
                </div>
              {% else %}
                <img id="resultImage" alt="Wynik AI">
              {% endif %}
              <p style="font-size: 0.85rem; color: #666; text-align: center; margin: 8px 0 0 0; font-style: italic;">Znak√≥w wodnych nie bƒôdzie na ko≈Ñcowym produkcie</p>
              
              <!-- Komunikat sukcesu -->
              <div class="customify-success" id="successMessage"></div>
              
              <div class="customify-text-overlay-toggle customify-product-type-buttons" style="margin-top:12px; display:flex; justify-content:center;">
                <div class="customify-product-type-btn" id="textOverlayToggleBtn" data-overlay-open="false">
                  Dodaƒá napis? Kliknij tutaj
                </div>
              </div>
              <div class="customify-text-overlay-panel" id="textOverlayPanel" style="display: none;">
                <div class="text-overlay-row">
                  <div class="text-overlay-input-wrapper" style="border:1px solid #d1d5db; border-radius:8px; padding:8px 10px; background:#f5f5f5; box-shadow: 0 0 0 1px rgba(0,0,0,0.03);">
                    <input class="text-overlay-input" type="text" id="textOverlayInput" maxlength="80" placeholder="Wpisz tekst" style="border:none; outline:none; background:transparent; width:100%; font-size:0.95rem; color:#111; box-sizing:border-box; min-height:26px;">
                  </div>
                  <span class="text-overlay-counter" id="textOverlayCounter" style="display:none;"></span>
                </div>
                <div class="text-overlay-group">
                  <select class="text-overlay-select" id="textOverlayColorSelect" style="border:1px solid #d1d5db; border-radius:8px; padding:10px; font-size:0.95rem; width:100%; background:#fff; color:#111; box-sizing:border-box; min-height:42px;">
                    <option value="" selected disabled>Kolor</option>
                    <option value="white">Bia≈Çy</option>
                    <option value="black">Czarny</option>
                    <option value="gold">Z≈Çoty</option>
                    <option value="brown">BrƒÖzowy</option>
                    <option value="red">Czerwony</option>
                    <option value="green">Zielony</option>
                    <option value="blue">Niebieski</option>
                    <option value="yellow">≈ª√≥≈Çty</option>
                    <option value="white-banner">Bia≈Çy na tle</option>
                    <option value="black-banner">Czarny na tle</option>
                    <option value="gold-banner">Z≈Çoty na tle</option>
                    <option value="brown-banner">BrƒÖzowy na tle</option>
                    <option value="red-banner">Czerwony na tle</option>
                    <option value="green-banner">Zielony na tle</option>
                    <option value="blue-banner">Niebieski na tle</option>
                    <option value="yellow-banner">≈ª√≥≈Çty na tle</option>
                  </select>
                </div>
                <div class="text-overlay-group">
                  <select class="text-overlay-select" id="textOverlayFontSelect" style="border:1px solid #d1d5db; border-radius:8px; padding:10px; font-size:0.95rem; width:100%; background:#fff; color:#111; box-sizing:border-box; min-height:42px;">
                    <option value="" selected disabled>Czcionka</option>
                    <option value="serif">Elegancka</option>
                    <option value="sans">Klasyczna</option>
                    <option value="script">Pisana</option>
                    <option value="script2">Pacifico</option>
                    <option value="script3">Pisana 3</option>
                    <option value="script4">Pisana 4</option>
                    <option value="script5">Indie Flower</option>
                    <option value="western_1">Westernowa 1 (Rye)</option>
                    <option value="western_2">Westernowa 2 (Creepster)</option>
                    <option value="hiphop">Graffiti (Rubik Wet Paint)</option>
                    <option value="royale">Kr√≥lewska (Bonheur Royale)</option>
                  </select>
                </div>
                <div class="text-overlay-group">
                  <select class="text-overlay-select" id="textOverlaySizeSelect" style="border:1px solid #d1d5db; border-radius:8px; padding:10px; font-size:0.95rem; width:100%; background:#fff; color:#111; box-sizing:border-box; min-height:42px;">
                    <option value="" selected disabled>Rozmiar</option>
                    <option value="small">Ma≈Çy</option>
                    <option value="medium">≈öredni</option>
                    <option value="large">Du≈ºy</option>
                  </select>
                </div>
                <div class="text-overlay-actions" style="display:flex; gap:10px; align-items:stretch;">
                  <button class="customify-btn customify-btn-primary" id="textOverlaySaveBtn" type="button" style="flex:1 1 0; min-width:0; display:inline-flex; justify-content:center; align-items:center; width:auto; margin:0;">
                    Zapisz
                  </button>
                </div>
                <div class="text-overlay-hint" id="textOverlayHint" style="display: none;"></div>
              </div>

              <!-- Slot do przeniesienia sekcji typu i rozmiaru nad cenƒô -->
              <div id="type-size-inline-slot"></div>
              
              <!-- Cena nad przyciskiem -->
              <div class="customify-cart-price" id="cartPriceDisplay" style="display: none; margin: 15px 0; text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                <span class="cart-price-label" style="font-weight: 600; color: #333; margin-right: 12px;">Cena:</span>
                <span class="cart-price-value" id="cartPriceValue" style="font-size: 1.2rem; font-weight: 700; color: #e55a2b;">0.00 z≈Ç</span>
              </div>
              
              <!-- Komunikat b≈Çƒôdu - tu≈º nad przyciskiem "Dodaj do koszyka" -->
              <div class="customify-error" id="errorMessageBottom" style="display: none;"></div>
              
              <div class="customify-actions" style="margin-top: 15px;">
                <button class="customify-btn customify-btn-primary customify-btn-red" id="addToCartBtn">
                  Dodaj do koszyka
                </button>
                <button class="customify-btn customify-btn-secondary" id="tryAgainBtn">
                  Spr√≥buj ponownie
                </button>
              </div>
            
            <!-- Pasek postƒôpu dla dodawania do koszyka -->
            <div class="customify-cart-loading" id="cartLoadingArea" style="display: none;">
              <div class="customify-spinner"></div>
              <div class="loading-text">Dodawanie do koszyka...</div>
              <div class="loading-progress">
                <div class="loading-progress-bar" id="cartProgressBar"></div>
              </div>
              <div class="loading-stage" id="cartLoadingStage">Tworzenie produktu...</div>
            </div>
            </div>

            <!-- ACCORDION: SZCZEG√ì≈ÅY PRODUKTU (NA SAMYM DOLE APLIKACJI) -->
            <div class="product-details-accordion">
              
              <!-- 1. Szczeg√≥≈Çy produktu -->
              <div class="accordion-item" data-accordion="details">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>O produkcie</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <p><strong>Obraz na p≈Ç√≥tnie</strong> - wydrukowane na grubym, premium p≈Ç√≥tnie canvas z naturalnƒÖ teksturƒÖ. NaciƒÖgniƒôte na drewnianƒÖ antyramƒô</p>
                  
                  <!-- Wizualizacja: Obraz na p≈Ç√≥tnie -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/obraz.png" alt="Obraz na p≈Ç√≥tnie" class="accordion-visual-image">
                    </div>
                  </div>
                  
                  <br>
                  <p><strong>Plakat</strong> - wydruk na papierze fotograficznym, kt√≥ry wysy≈Çamy zwiniƒôty w eleganckiej tubie. Mo≈ºesz wybraƒá ramkƒô. W√≥wczas wydruk bƒôdzie w ramce za szk≈Çem.</p>
                  
                  <!-- Wizualizacja: Plakat -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/plakat.png" alt="Plakat" class="accordion-visual-image">
                    </div>
                  </div>
                  
                  <br>
                  <p><strong>Nadruk na szkle akrylowym</strong> - personalizowany wydruk na szkle akrylowym (bezpieczne niet≈ÇukƒÖce siƒô). Dodaj podstawkƒô, by postawiƒá go na biurku, mo≈ºesz dodaƒá podstawkƒô z LED, kt√≥ra pod≈õwietla zdjƒôcie i zamienia je w nastrojowƒÖ lampkƒô nocnƒÖ lub dekoracjƒô pokoju.</p>
                  <p>Dostƒôpna jest w 2 rozmiarach: <strong>A5</strong> - najpopularniejszym i wiƒôkszym <strong>A4</strong>.</p>
                  <!-- Wizualizacja: Rozmiary ramek na szkle -->
                  <div class="accordion-product-visual" style="margin: 15px 0;">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/ramki_wymiary.webp" alt="Rozmiary ramek na szkle" class="accordion-visual-image">
                    </div>
                  </div>
                  <p>Przezroczysta pleksi nadaje zdjƒôciu elegancki po≈Çysk i g≈Çƒôbiƒô, dziƒôki czemu wyglƒÖda jak obraz za szk≈Çem. Produkt jest gotowy do wrƒôczenia jako prezent ‚Äî piƒôkny, nowoczesny i w pe≈Çni personalizowany.</p>
                  
                  <!-- Wizualizacja: Nadruk na szkle akrylowym -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/akryl/akryl.png" alt="Nadruk na szkle akrylowym" class="accordion-visual-image">
                    </div>
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/akryl/akryl_2.png" alt="Nadruk na szkle akrylowym z LED" class="accordion-visual-image">
                    </div>
                  </div>
                  
                  <br>
                  <p><strong>Produkt cyfrowy</strong> ‚Äì plik w wysokiej jako≈õci, bez znak√≥w wodnych, do natychmiastowego pobrania (bez wysy≈Çki fizycznego obrazu).</p>
                  
                  <ul>
                    <li>Otrzymujesz plik w wysokiej rozdzielczo≈õci, bez znak√≥w wodnych.</li>
                    <li>Link do pobrania wysy≈Çamy natychmiast po op≈Çaceniu zam√≥wienia ‚Äì zero czekania na kuriera.</li>
                    <li>Idealny do druku w domu lub fotolabie, jako tapeta na telefon/komputer albo do udostƒôpniania w social mediach.</li>
                  </ul>
                  
                  <p><strong>To jest produkt cyfrowy ‚Äì nie wysy≈Çamy fizycznego obrazu.</strong></p>
                  
                  <!-- Wizualizacja: Produkt cyfrowy -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/icon_digital.png" alt="Produkt cyfrowy" class="accordion-visual-image">
                    </div>
                  </div>
                </div>
              </div>

              <!-- 2. Wysy≈Çka i dostawa -->
              <div class="accordion-item" data-accordion="shipping">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Wysy≈Çka i dostawa</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <ul>
                    <li><strong>‚ö° Szybka realizacja:</strong> natychmiast po zleceniu projektu</li>
                    <li><strong>üì¶ Bezpieczne opakowanie:</strong> Karton wzmocniony + folia bƒÖbelkowa - gwarancja bezpiecznej dostawy</li>
                    <li><strong>üáµüá± Wysy≈Çka:</strong> InPost Paczkomaty, InPost Kurier</li>
                    <li><strong>üìç ≈öledzenie przesy≈Çki:</strong> Numer trackingowy wysy≈Çany mailem - zawsze wiesz gdzie jest Twoja przesy≈Çka</li>
                    <li><strong>üöö Darmowa dostawa:</strong> Przy zam√≥wieniach powy≈ºej 400 z≈Ç</li>
                    <li><strong>‚è∞ Czas dostawy:</strong> 1-3 dni robocze (w zale≈ºno≈õci od wybranej opcji)</li>
                  </ul>
                </div>
              </div>

              <!-- 3. Dostƒôpne rozmiary -->
              <div class="accordion-item" data-accordion="sizes">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Dostƒôpne rozmiary</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <!-- SEKCJA 1: Plakat / Obraz na p≈Ç√≥tnie -->
                  <h4 style="margin: 0 0 15px 0; font-size: 1.1rem; color: #111; border-bottom: 2px solid #1DB954; padding-bottom: 8px;">üñºÔ∏è Plakat / Obraz na p≈Ç√≥tnie</h4>
                  
                  <!-- Wizualizacja: Rozmiary -->
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/faq/wymiary.png" alt="Dostƒôpne rozmiary" class="accordion-visual-image">
                      <div class="accordion-visual-label">üìè Dostƒôpne rozmiary</div>
                    </div>
                  </div>
                  
                  <div class="accordion-size-grid">
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">20 √ó 30 cm</div>
                      <div class="accordion-size-description">≈öwietny do ma≈Çych pokoi</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">30 √ó 45 cm</div>
                      <div class="accordion-size-description">Doskona≈Çy do ≈õrednich pomieszcze≈Ñ</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">40 √ó 60 cm</div>
                      <div class="accordion-size-description">Efektowny na du≈ºe ≈õciany w salonie</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">50 √ó 75 cm</div>
                      <div class="accordion-size-description">Idealny do du≈ºych przestrzeni</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">60 √ó 90 cm</div>
                      <div class="accordion-size-description">ImponujƒÖcy na ca≈ÇƒÖ ≈õcianƒô</div>
                    </div>
                  </div>
                  
                  <!-- SEKCJA 2: Wydruk na szkle -->
                  <h4 style="margin: 30px 0 15px 0; font-size: 1.1rem; color: #111; border-bottom: 2px solid #1DB954; padding-bottom: 8px;">üî≤ Wydruk na szkle</h4>
                  
                  <div class="accordion-product-visual">
                    <div class="accordion-visual-item">
                      <img src="https://customify-s56o.vercel.app/ramki_wymiary.webp" alt="Rozmiary ramek na szkle" class="accordion-visual-image">
                      <div class="accordion-visual-label">üìè Rozmiary ramek na szkle</div>
                    </div>
                  </div>
                  
                  <div class="accordion-size-grid" style="margin-top: 15px;">
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">A5 (15 √ó 21 cm)</div>
                      <div class="accordion-size-description">Najpopularniejszy rozmiar</div>
                    </div>
                    <div class="accordion-size-item">
                      <div class="accordion-size-name">A4 (21 √ó 30 cm)</div>
                      <div class="accordion-size-description">Wiƒôkszy, bardziej efektowny</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 4. Jak to dzia≈Ça -->
              <div class="accordion-item" data-accordion="howto">
                <div class="accordion-header">
                  <div class="accordion-title">
                    <span>Jak to dzia≈Ça?</span>
                  </div>
                  <span class="accordion-icon">+</span>
                </div>
                <div class="accordion-content">
                  <div class="accordion-step">
                    <div class="accordion-step-number">1</div>
                    <div class="accordion-step-content">
                      <strong>Wgraj swoje zdjƒôcie</strong><br>
                      JPG, PNG lub GIF do 10MB. Najlepiej w wysokiej rozdzielczo≈õci.<br>
                      <em style="color: #666; font-size: 0.9em;">Nie musisz siƒô martwiƒá o jako≈õƒá - sprawdzamy ka≈ºde zdjƒôcie przed wydrukiem i poprawiamy je, aby by≈Ço idealne!</em>
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">2</div>
                    <div class="accordion-step-content">
                      <strong>Wybierz styl artystyczny</strong><br>
                      Dostƒôpne style do wyboru w zak≈Çadce powy≈ºej.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">3</div>
                    <div class="accordion-step-content">
                      <strong>Wybierz rozmiar wydruku</strong><br>
                      Wybierz idealny rozmiar dla Twojej przestrzeni.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">4</div>
                    <div class="accordion-step-content">
                      <strong>AI przekszta≈Çci Twoje zdjƒôcie</strong><br>
                      Najnowocze≈õniejsza technologia sztucznej inteligencji w 30-60 sekund.
                    </div>
                  </div>
                  <div class="accordion-step">
                    <div class="accordion-step-number">5</div>
                    <div class="accordion-step-content">
                      <strong>Drukujemy i wysy≈Çamy</strong><br>
                      Ka≈ºde zdjƒôcie jest sprawdzane i poprawiane przed wydrukiem. Wysokiej jako≈õci nadruk, bezpiecznie zapakowany.
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <!-- KONIEC ACCORDION (NA SAMYM DOLE) -->

              </div>
          </div>
        </div>
      </div>
      
      {{ 'customify.css' | asset_url | stylesheet_tag }}
      <script>
        // Dynamiczne przenoszenie sekcji rodzaju i rozmiaru nad cenƒô, gdy widoczny jest wynik AI
        document.addEventListener('DOMContentLoaded', function() {
          var resultArea = document.getElementById('resultArea');
          var inlineSlot = document.getElementById('type-size-inline-slot');
          var originalPlaceholder = document.getElementById('type-size-original-placeholder');
          var productTypeArea = document.getElementById('productTypeArea');
          var sizeArea = document.getElementById('sizeArea');
          // Elemente ramki
          var frameSelector = document.getElementById('frameSelector');
          var frameToggle = document.getElementById('frameToggle');
          var frameOptions = document.getElementById('frameOptions');
          var frameCurrentLabel = document.getElementById('frameCurrentLabel');

          if (!resultArea || !inlineSlot || !originalPlaceholder || !productTypeArea || !sizeArea) {
            return;
          }

          function isVisible(el) {
            if (!el) return false;
            var style = window.getComputedStyle(el);
            return style.display !== 'none' && style.visibility !== 'hidden' && el.offsetParent !== null;
          }

          function moveToResult() {
            if (!inlineSlot.contains(productTypeArea)) {
              inlineSlot.appendChild(productTypeArea);
            }
            if (!inlineSlot.contains(sizeArea)) {
              inlineSlot.appendChild(sizeArea);
            }
          }

          function moveBack() {
            if (productTypeArea && productTypeArea.parentElement !== originalPlaceholder.parentElement) {
              originalPlaceholder.parentNode.insertBefore(productTypeArea, originalPlaceholder);
            }
            if (sizeArea && sizeArea.parentElement !== originalPlaceholder.parentElement) {
              originalPlaceholder.parentNode.insertBefore(sizeArea, originalPlaceholder);
            }
          }

          function syncPosition() {
            // üéµ SPOTIFY: Nie przeno≈õ element√≥w gdy "bez-zmian" jest aktywny
            if (window.spotifyBezZmianActive) {
              return;
            }
            if (isVisible(resultArea)) {
              moveToResult();
            } else {
              moveBack();
            }
          }

          // Obserwuj zmiany widoczno≈õci
          var observer = new MutationObserver(syncPosition);
          observer.observe(resultArea, { attributes: true, attributeFilter: ['style', 'class'], subtree: false });

          // Polling jako fallback (np. zmiany przez skrypty zewnƒôtrzne)
          setInterval(syncPosition, 500);

          // Pierwsza synchronizacja
          syncPosition();

          // ============ LOGIKA RAMKI ============
          // Stan globalny (wsp√≥≈Çdzielony miƒôdzy lokalizacjami)
          window.CustomifyFrame = window.CustomifyFrame || { color: 'none' };

          function setFrame(color) {
            window.CustomifyFrame.color = color;
            // Aktualizuj UI
            if (frameCurrentLabel) {
              frameCurrentLabel.textContent =
                color === 'black' ? 'Czarna' :
                color === 'white' ? 'Bia≈Ça' :
                color === 'wood'  ? 'Drewno' : 'Brak ramki';
            }
            if (frameOptions) {
              var opts = frameOptions.querySelectorAll('.frame-option');
              opts.forEach(function(opt){
                opt.setAttribute('aria-selected', opt.getAttribute('data-frame') === color ? 'true' : 'false');
              });
            }
          }

          function toggleOptions() {
            if (!frameOptions) return;
            var isOpen = frameOptions.style.display !== 'none';
            frameOptions.style.display = isOpen ? 'none' : 'block';
            if (frameSelector) frameSelector.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
          }

          function closeOptions() {
            if (frameOptions) {
              frameOptions.style.display = 'none';
              if (frameSelector) frameSelector.setAttribute('aria-expanded', 'false');
            }
          }

          function isPlakatSelected() {
            var active = productTypeArea && productTypeArea.querySelector('.customify-product-type-btn.active');
            return active && active.getAttribute('data-product-type') === 'plakat';
          }

          // üö® ROLLBACK: START - Funkcje dla produktu cyfrowego
          function isDigitalProductSelected() {
            var active = productTypeArea && productTypeArea.querySelector('.customify-product-type-btn.active');
            return active && active.getAttribute('data-product-type') === 'digital';
          }

          function updateDigitalProductUI() {
            var isDigital = isDigitalProductSelected();
            var sizeArea = document.getElementById('sizeArea');
            
            // Ukryj/poka≈º rozmiary
            if (sizeArea) {
              if (isDigital) {
                sizeArea.style.display = 'none';
                console.log('üì¶ [DIGITAL] Size area hidden for digital product');
              } else {
                sizeArea.style.display = 'block';
                console.log('üì¶ [DIGITAL] Size area shown for physical product');
              }
            }
          }
          // üö® ROLLBACK: END - Funkcje dla produktu cyfrowego

          function updateFrameAvailability() {
            var enabled = isPlakatSelected();
            // üö® ROLLBACK: START - Ukryj ramkƒô dla produktu cyfrowego
            var isDigital = isDigitalProductSelected();
            if (isDigital) {
              enabled = false; // Produkt cyfrowy nie ma ramki
            }
            // üö® ROLLBACK: END - Ukryj ramkƒô dla produktu cyfrowego
            
            if (frameSelector) {
              if (enabled) {
                frameSelector.style.display = 'block';      // ‚úÖ Pokazuje ramkƒô
                frameSelector.classList.remove('disabled');
              } else {
                frameSelector.style.display = 'none';       // ‚úÖ Ca≈Çkowicie ukrywa ramkƒô
                frameSelector.classList.add('disabled');
                closeOptions();
              }
            }
          }

          // ============ üÜï LOGIKA PODSTAWKI (SZK≈ÅO) ============
          window.CustomifyStand = window.CustomifyStand || { type: 'none' };
          
          var standSelector = document.getElementById('standSelector');
          var standToggle = document.getElementById('standToggle');
          var standOptions = document.getElementById('standOptions');
          var standCurrentLabel = document.getElementById('standCurrentLabel');
          
          function isSzkloSelected() {
            var active = productTypeArea && productTypeArea.querySelector('.customify-product-type-btn.active');
            return active && active.getAttribute('data-product-type') === 'szklo';
          }
          
          function setStand(type) {
            window.CustomifyStand.type = type;
            // Aktualizuj UI
            if (standCurrentLabel) {
              standCurrentLabel.textContent =
                type === 'wood' ? 'Podstawka drewniana (+29 z≈Ç)' :
                type === 'led' ? 'Podstawka drewniana z LED (+44.90 z≈Ç)' :
                'Brak podstawki';
            }
            if (standOptions) {
              var opts = standOptions.querySelectorAll('.stand-option');
              opts.forEach(function(opt){
                opt.setAttribute('aria-selected', opt.getAttribute('data-stand') === type ? 'true' : 'false');
              });
            }
            
            // Aktualizuj ceny po zmianie podstawki
            if (window.__customify) {
              window.__customify.updateProductPrice();
              window.__customify.updateCartPrice();
            }
          }
          
          function toggleStandOptions() {
            if (!standOptions) return;
            var isOpen = standOptions.style.display !== 'none';
            standOptions.style.display = isOpen ? 'none' : 'block';
            if (standSelector) standSelector.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
          }
          
          function closeStandOptions() {
            if (standOptions) {
              standOptions.style.display = 'none';
              if (standSelector) standSelector.setAttribute('aria-expanded', 'false');
            }
          }
          
          function updateStandAvailability() {
            var enabled = isSzkloSelected();
            
            if (standSelector) {
              if (enabled) {
                standSelector.style.display = 'block';
                standSelector.classList.remove('disabled');
              } else {
                standSelector.style.display = 'none';
                standSelector.classList.add('disabled');
                closeStandOptions();
              }
            }
          }
          
          function updateSizeAvailability() {
            var isSzklo = isSzkloSelected();
            var sizeButtons = document.querySelectorAll('.customify-size-btn');
            
            sizeButtons.forEach(function(btn) {
              var size = btn.getAttribute('data-size');
              if (isSzklo) {
                // Dla szk≈Ça: tylko A5 i A4 widoczne
                if (size === 'a5' || size === 'a4') {
                  btn.style.display = 'block';
                } else {
                  btn.style.display = 'none';
                }
              } else {
                // Dla plakat/canvas: A4, A3, A2, A0, A1 widoczne (bez A5)
                if (size === 'a5') {
                  btn.style.display = 'none';
                } else {
                  btn.style.display = 'block';
                }
              }
            });
            
            // Je≈õli aktualnie wybrany rozmiar jest ukryty, wybierz pierwszy widoczny
            if (window.__customify && window.__customify.selectedSize) {
              var currentBtn = document.querySelector('.customify-size-btn[data-size="' + window.__customify.selectedSize + '"]');
              if (currentBtn && currentBtn.style.display === 'none') {
                // Wybierz pierwszy widoczny rozmiar
                var firstVisible = Array.from(sizeButtons).find(function(b) { return b.style.display !== 'none'; });
                if (firstVisible) {
                  firstVisible.click();
                }
              }
            }
          }

          // Inicjalizacja UI ramki i podstawki
          setFrame(window.CustomifyFrame.color || 'none');
          setStand(window.CustomifyStand.type || 'none');
          updateFrameAvailability();
          updateStandAvailability();
          updateSizeAvailability();
          // üö® ROLLBACK: START - Inicjalizacja UI produktu cyfrowego
          updateDigitalProductUI();
          // üö® ROLLBACK: END - Inicjalizacja UI produktu cyfrowego

          // Zdarzenia UI
          if (frameToggle) {
            frameToggle.addEventListener('click', function(e){
              if (frameSelector && frameSelector.classList.contains('disabled')) return;
              toggleOptions();
            });
          }
          if (frameOptions) {
            frameOptions.addEventListener('click', function(e){
              var target = e.target.closest('.frame-option');
              if (!target) return;
              if (frameSelector && frameSelector.classList.contains('disabled')) return;
              var color = target.getAttribute('data-frame');
              setFrame(color);
              closeOptions();
              if (window.__customify && typeof window.__customify.updateCartPrice === 'function') {
                window.__customify.updateCartPrice();
                if (typeof window.__customify.updateProductPrice === 'function') {
                  window.__customify.updateProductPrice();
                }
              }
            });
          }
          document.addEventListener('click', function(e){
            if (!frameSelector) return;
            if (!frameSelector.contains(e.target)) closeOptions();
          });
          
          // üÜï Event listenery dla podstawki (szk≈Ço)
          if (standToggle) {
            standToggle.addEventListener('click', function(e){
              if (standSelector && standSelector.classList.contains('disabled')) return;
              toggleStandOptions();
            });
          }
          if (standOptions) {
            standOptions.addEventListener('click', function(e){
              var target = e.target.closest('.stand-option');
              if (!target) return;
              if (standSelector && standSelector.classList.contains('disabled')) return;
              var type = target.getAttribute('data-stand');
              setStand(type);
              closeStandOptions();
            });
          }
          document.addEventListener('click', function(e){
            if (!standSelector) return;
            if (!standSelector.contains(e.target)) closeStandOptions();
          });

          // Nas≈Çuchiwanie na zmianƒô typu produktu (Plakat/Canvas/Szk≈Ço/Digital)
          var typeBtns = productTypeArea ? productTypeArea.querySelectorAll('.customify-product-type-btn') : [];
          typeBtns.forEach(function(btn){
            btn.addEventListener('click', function(){
              // Daj czas istniejƒÖcym handlerom na ustawienie .active
              setTimeout(function(){
                updateFrameAvailability();
                updateStandAvailability(); // üÜï Aktualizuj dostƒôpno≈õƒá podstawki
                updateSizeAvailability();  // üÜï Aktualizuj widoczno≈õƒá rozmiar√≥w
                // üö® ROLLBACK: START - Aktualizuj UI produktu cyfrowego
                updateDigitalProductUI();
                // üö® ROLLBACK: END - Aktualizuj UI produktu cyfrowego
              }, 0);
            });
          });
          
          // üÜï AUTO-INICJALIZACJA dla produkt√≥w ze szk≈Çem
          var currentUrl = window.location.pathname.toLowerCase();
          var isSzkloProduct = currentUrl.includes('karykatura-na-zamowienie-druk-na-szkle-akrylowym-ramka-z-podswietleniem') || 
                              currentUrl.includes('prezent-dla-babci-i-dziadka-portret-na-na-szkle-akrylowym-ze-zdjecia-karykatura') ||
                              currentUrl.includes('dziadkowie-krolowie-nadruk-na-szkle') ||
                              currentUrl.includes('portret-pary-personalizowany-obraz-na-szkle-akrylowym');
          
          if (isSzkloProduct) {
            console.log('üîç [SZKLO] Produkt ze szk≈Çem wykryty - automatyczne filtrowanie rozmiar√≥w');
            // Ustaw szk≈Ço jako wybrany typ
            if (window.__customify) {
              window.__customify.selectedProductType = 'szklo';
            }
            // Wywo≈Ça updateSizeAvailability() ≈ºeby pokazaƒá tylko A5 i A4
            updateStandAvailability();
            updateSizeAvailability();
            
            // üÜï AUTO-ZAZNACZ ROZMIAR A5 jako domy≈õlny dla szk≈Ça
            setTimeout(function() {
              var a5Btn = document.querySelector('.customify-size-btn[data-size="a5"]');
              var activeBtn = document.querySelector('.customify-size-btn.active');
              var activeSize = activeBtn ? activeBtn.getAttribute('data-size') : null;
              if (a5Btn && activeSize !== 'a5') {
                a5Btn.click();
                console.log('‚úÖ [SZKLO] Automatycznie zaznaczono rozmiar A5');
              }
            }, 100);
            
            console.log('‚úÖ [SZKLO] Automatycznie pokazano tylko rozmiary dla szk≈Ça (A5, A4)');
          }
        });
      </script>

    {% comment %} CUSTOMIFY CART INTEGRATION {% endcomment %}
    {% if template contains 'cart' %}
      {{ 'cart.css' | asset_url | stylesheet_tag }}
      {{ 'lightbox.css' | asset_url | stylesheet_tag }}
      <script>
        /**
         * CUSTOMIFY: Wy≈ÇƒÖcz linki do wszystkich produkt√≥w w koszyku
         * Klikniƒôcie miniaturki pokazuje powiƒôkszony obraz zamiast prowadziƒá do produktu
         * Wszystkie produkty w sklepie sƒÖ AI - nie ma potrzeby filtrowania
         */
        (function() {
          console.log('üõí [CUSTOMIFY CART] Inicjalizacja wy≈ÇƒÖczania link√≥w produkt√≥w AI');
          
          // Funkcja dodawania watermarku do obrazka
          async function addWatermarkToImage(imageUrl) {
            return new Promise((resolve, reject) => {
              const img = new Image();
              img.crossOrigin = 'anonymous';
              
              img.onload = () => {
                try {
                  const canvas = document.createElement('canvas');
                  const ctx = canvas.getContext('2d');
                  
                  canvas.width = img.width;
                  canvas.height = img.height;
                  
                  // Rysuj oryginalny obraz
                  ctx.drawImage(img, 0, 0);
                  
                  // ===== WZ√ìR DIAGONALNY - "Lumly.pl" i "PodglƒÖd" NA PRZEMIAN =====
                  ctx.save();
                  
                  // ‚úÖ ZWIƒòKSZONY FONT I OPACITY DLA LEPSZEJ WIDOCZNO≈öCI
                  const fontSize = Math.max(40, Math.min(canvas.width, canvas.height) * 0.08); // Min 40px, max 8% obrazu
                  
                  // ‚úÖ FIX: U≈ºyj systemowego fontu z fallbackami (Arial mo≈ºe nie byƒá dostƒôpny w Canvas)
                  // U≈ºyj fontu kt√≥ry ZAWSZE jest dostƒôpny w przeglƒÖdarce
                  const fontFamily = 'sans-serif'; // Systemowy font - zawsze dostƒôpny
                  ctx.font = `bold ${fontSize}px ${fontFamily}`;
                  
                  // ‚úÖ SPRAWD≈π CZY FONT JEST ZA≈ÅADOWANY (test renderowania)
                  ctx.fillStyle = 'rgba(255, 255, 255, 0.7)'; // ‚úÖ ZWIƒòKSZONA OPACITY (by≈Ço 0.5)
                  ctx.strokeStyle = 'rgba(0, 0, 0, 0.5)'; // ‚úÖ ZWIƒòKSZONA OPACITY (by≈Ço 0.35)
                  ctx.lineWidth = 2; // ‚úÖ ZWIƒòKSZONA GRUBO≈öƒÜ (by≈Ço 1.5)
                  ctx.textAlign = 'center';
                  ctx.textBaseline = 'middle';
                  
                  // ‚úÖ TEST: Sprawd≈∫ czy tekst siƒô renderuje (je≈õli nie - u≈ºyj innego fontu)
                  const testText = 'Test';
                  const testMetrics = ctx.measureText(testText);
                  if (testMetrics.width === 0) {
                    console.warn('‚ö†Ô∏è [WATERMARK] Font test failed, using fallback');
                    ctx.font = `bold ${fontSize}px monospace`; // Fallback na monospace
                  }
                  
                  // Obr√≥ƒá canvas
                  ctx.translate(canvas.width/2, canvas.height/2);
                  ctx.rotate(-30 * Math.PI / 180);
                  ctx.translate(-canvas.width/2, -canvas.height/2);
                  
                  // Rysuj watermarki w siatce - na przemian "Lumly.pl" i "PodglƒÖd"
                  const spacing = Math.max(200, Math.min(canvas.width, canvas.height) * 0.3); // ‚úÖ DYNAMICZNY SPACING
                  let textIndex = 0;
                  const texts = ['Lumly.pl', 'PodglƒÖd'];
                  
                  for(let y = -canvas.height; y < canvas.height * 2; y += spacing) {
                    for(let x = -canvas.width; x < canvas.width * 2; x += spacing * 1.5) {
                      const text = texts[textIndex % 2];
                      // ‚úÖ RYSUJ STROKE PRZED FILL (dla lepszej widoczno≈õci)
                      ctx.strokeText(text, x, y);
                      ctx.fillText(text, x, y);
                      textIndex++;
                    }
                    // Zmie≈Ñ wz√≥r co wiersz dla lepszego efektu
                    textIndex++;
                  }
                  
                  ctx.restore();
                  
                  // Zwr√≥ƒá obraz z watermarkiem jako Data URL
                  resolve(canvas.toDataURL('image/jpeg', 0.92));
                  console.log('‚úÖ [CUSTOMIFY CART] Watermark dodany do miniaturki');
                } catch (error) {
                  console.error('‚ùå [CUSTOMIFY CART] Watermark error:', error);
                  reject(error);
                }
              };
              
              img.onerror = (error) => {
                console.error('‚ùå [CUSTOMIFY CART] Image load error:', error);
                reject(error);
              };
              
              img.src = imageUrl;
            });
          }
          
          function showImageLightbox(imageUrl) {
            console.log('üîç [CUSTOMIFY CART] Pokazujƒô lightbox dla:', imageUrl);
            
            // Stw√≥rz overlay
            const overlay = document.createElement('div');
            overlay.className = 'customify-lightbox';
            
            // Dodaj powiƒôkszony obraz
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = 'Powiƒôkszony obraz AI';
            
            // Przycisk zamkniƒôcia
            const closeBtn = document.createElement('button');
            closeBtn.className = 'customify-lightbox-close';
            closeBtn.innerHTML = '√ó';
            closeBtn.setAttribute('aria-label', 'Zamknij');
            
            overlay.appendChild(img);
            overlay.appendChild(closeBtn);
            
            // Zamknij po klikniƒôciu overlay lub przycisku
            overlay.addEventListener('click', (e) => {
              if (e.target === overlay || e.target === closeBtn) {
                overlay.remove();
                console.log('üîç [CUSTOMIFY CART] Lightbox zamkniƒôty');
              }
            });
            
            // Zamknij po ESC
            const handleEsc = (e) => {
              if (e.key === 'Escape') {
                overlay.remove();
                document.removeEventListener('keydown', handleEsc);
                console.log('üîç [CUSTOMIFY CART] Lightbox zamkniƒôty (ESC)');
              }
            };
            document.addEventListener('keydown', handleEsc);
            
            document.body.appendChild(overlay);
          }
          
          function disableAIProductLinks() {
            console.log('üõí [CUSTOMIFY CART] Wy≈ÇƒÖczam linki dla wszystkich produkt√≥w w koszyku...');
            
            // Znajd≈∫ wszystkie elementy koszyka (r√≥≈ºne selektory dla r√≥≈ºnych motyw√≥w)
            const cartItems = document.querySelectorAll(
              '.cart-item, .cart-items__table-row, .cart-items__row, [data-line-item], .line-item, .cart__line-item, tr[role="row"]'
            );
            
            console.log('üõí [CUSTOMIFY CART] Znaleziono element√≥w koszyka:', cartItems.length);
            
            cartItems.forEach((item, index) => {
              // Znajd≈∫ wszystkie linki w tym elemencie (miniaturka + tytu≈Ç)
              const links = item.querySelectorAll('a[href*="/products/"]');
              console.log(`üîó [CUSTOMIFY CART] Element ${index} - znaleziono link√≥w: ${links.length}`);
              
              links.forEach(async (link, linkIndex) => {
                // Sprawd≈∫ czy ju≈º przetworzono ten link (unikaj wielokrotnego dodawania event listener√≥w)
                if (link.dataset.customifyProcessed === 'true') {
                  console.log(`‚è≠Ô∏è [CUSTOMIFY CART] Link ${linkIndex} ju≈º przetworzony - pomijam`);
                  return;
                }
                
                // Oznacz jako przetworzony
                link.dataset.customifyProcessed = 'true';
                
                // Znajd≈∫ obrazek w linku
                const img = link.querySelector('img');
                
                if (img) {
                  // To jest link z miniaturkƒÖ - sprawd≈∫ czy mamy URL z watermarkiem w cart properties
                  console.log(`üñºÔ∏è [CUSTOMIFY CART] Link ${linkIndex} ma obrazek`);
                  console.log(`   Obrazek src: ${img.src}`);
                  
                  // Znajd≈∫ cart properties dla tego produktu
                  const cartItem = link.closest('.cart-item, .cart-items__table-row, tr[role="row"]');
                  let watermarkedUrl = null;
                  
                  if (cartItem) {
                    const properties = cartItem.querySelectorAll('.cart-items__properties dd, dd[data-property]');
                    properties.forEach(prop => {
                      const dt = prop.previousElementSibling;
                      if (!dt) return;

                      const propertyName = dt.textContent.trim();
                      const normalizedName = propertyName.replace(/\s+/g, '').toLowerCase();

                      if (normalizedName.includes('ai_image_watermarked')) {
                        watermarkedUrl = prop.textContent.trim();
                        console.log('‚úÖ [CUSTOMIFY CART] Znaleziono URL z watermarkiem:', watermarkedUrl);
                      }

                      // ‚úÖ UKRYJ "Styl AI" i wszystkie ukryte properties
                      if (propertyName.startsWith('_') || 
                          normalizedName.includes('ai_image_') || 
                          normalizedName.includes('styl ai') || 
                          normalizedName === 'stylai' ||
                          propertyName === 'Styl AI' ||
                          propertyName.toLowerCase() === 'styl ai' ||
                          propertyName.includes('Styl AI') ||
                          propertyName.includes('styl ai')) {
                        dt.style.display = 'none';
                        prop.style.display = 'none';
                        console.log('üôà [CUSTOMIFY CART] Ukryto property:', propertyName);
                      }
                    });
                  }
                  
                  // ‚úÖ G≈Ç√≥wny obrazek produktu w Shopify jest ju≈º Z watermarkiem (uploadowany z watermarkedImage)
                  // ‚úÖ Miniaturka: ma≈Ça (250px) - Shopify automatycznie
                  // ‚úÖ Lightbox: DU≈ªA (1200px) - zmieniamy parametr width w URL
                  
                  let originalSrc = img.src;
                  console.log('üñºÔ∏è [CUSTOMIFY CART] Oryginalny src:', originalSrc);
                  
                  // Zmie≈Ñ URL Shopify na wiƒôkszy rozmiar dla lightbox (1200px zamiast 250px)
                  if (originalSrc.includes('cdn.shopify.com') || originalSrc.includes('lumly.pl/cdn/')) {
                    let largeImageSrc = originalSrc;
                    
                    if (largeImageSrc.includes('width=')) {
                      // Zmie≈Ñ istniejƒÖcy parametr width
                      largeImageSrc = largeImageSrc.replace(/width=\d+/, 'width=1200');
                    } else {
                      // Dodaj parametr width
                      largeImageSrc = largeImageSrc + (largeImageSrc.includes('?') ? '&' : '?') + 'width=1200';
                    }
                    
                    img.dataset.watermarkedSrc = largeImageSrc;
                    console.log('‚úÖ [CUSTOMIFY CART] Przygotowano wiƒôkszy obrazek (1200px):', largeImageSrc);
                  } else {
                    // Nie ma cdn.shopify.com - zostaw oryginalny
                    img.dataset.watermarkedSrc = originalSrc;
                    console.log('‚ö†Ô∏è [CUSTOMIFY CART] To nie jest Shopify CDN URL - u≈ºywam oryginalnego');
                  }
                  
                  link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üñºÔ∏è [CUSTOMIFY CART] Klikniƒôto miniaturkƒô - pokazujƒô lightbox');
                    
                    // U≈ºyj wiƒôkszego obrazka (1200px) przygotowanego wcze≈õniej
                    const imageToShow = img.dataset.watermarkedSrc || img.src;
                    console.log('üìè [CUSTOMIFY CART] Pokazujƒô obrazek:', imageToShow);
                    
                    showImageLightbox(imageToShow);
                  });
                  
                  // Zmie≈Ñ cursor na zoom-in
                  link.style.cursor = 'zoom-in';
                  link.title = 'Kliknij aby powiƒôkszyƒá';
                } else {
                  // To jest link z tytu≈Çem - wy≈ÇƒÖcz ca≈Çkowicie
                  console.log(`üìù [CUSTOMIFY CART] Link ${linkIndex} to tytu≈Ç - wy≈ÇƒÖczam`);
                  console.log(`   Link href: ${link.href}`);
                  console.log(`   Link text: ${link.textContent.trim()}`);
                  
                  link.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üìù [CUSTOMIFY CART] Klikniƒôto tytu≈Ç - blokujƒô');
                  });
                  
                  link.style.cursor = 'default';
                  link.style.pointerEvents = 'none';
                  link.style.textDecoration = 'none';
                }
              });
            });
            
            console.log(`‚úÖ [CUSTOMIFY CART] Wy≈ÇƒÖczono linki dla ${cartItems.length} produkt√≥w`);
          }
          
          // Uruchom po za≈Çadowaniu DOM
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', disableAIProductLinks);
          } else {
            disableAIProductLinks();
          }
          
          // Uruchom ponownie po zmianach w koszyku (Ajax Cart)
          document.addEventListener('cart:updated', () => {
            console.log('üõí [CUSTOMIFY CART] Koszyk zaktualizowany - ponowne skanowanie');
            setTimeout(disableAIProductLinks, 500);
          });
          
          // Obserwuj zmiany w DOM (dla dynamicznych aktualizacji koszyka)
          const observer = new MutationObserver((mutations) => {
            // Sprawd≈∫ czy zmiana nie jest w lightbox (ignoruj zmiany w lightbox)
            const isLightboxChange = mutations.some(mutation => {
              return Array.from(mutation.addedNodes).some(node => {
                return node.classList && node.classList.contains('customify-lightbox');
              }) || Array.from(mutation.removedNodes).some(node => {
                return node.classList && node.classList.contains('customify-lightbox');
              });
            });
            
            if (isLightboxChange) {
              console.log('üõí [CUSTOMIFY CART] Zmiana w lightbox - ignorujƒô');
              return;
            }
            
            console.log('üõí [CUSTOMIFY CART] Wykryto zmiany w DOM - ponowne skanowanie');
            disableAIProductLinks();
          });
          
          // Obserwuj zmiany tylko w kontenerze koszyka (nie w ca≈Çym body)
          const cartContainer = document.querySelector('.cart-items, .cart, [data-cart-items]') || document.body;
          observer.observe(cartContainer, {
            childList: true,
            subtree: true
          });
          
          console.log('‚úÖ [CUSTOMIFY CART] Inicjalizacja zako≈Ñczona - obserwujƒô zmiany');
        })();
      </script>
    {% endif %}

    {% comment %} CUSTOMIFY CHECKOUT INTEGRATION - Wy≈ÇƒÖcz linki produkt√≥w {% endcomment %}
    <script>
      /**
       * CUSTOMIFY: Wy≈ÇƒÖcz linki do wszystkich produkt√≥w w checkout
       * Dzia≈Ça r√≥wnie≈º w checkout (Shopify Plus) i thank you page
       * Wszystkie produkty w sklepie sƒÖ AI - nie ma potrzeby filtrowania
       */
      (function() {
        // Sprawd≈∫ czy jeste≈õmy na checkout lub thank you page
        const isCheckout = window.location.pathname.includes('/checkout') || 
                          window.location.pathname.includes('/thank_you') ||
                          window.Shopify?.Checkout;
        
        if (!isCheckout) {
          console.log('üõí [CUSTOMIFY CHECKOUT] Nie jeste≈õmy na checkout - pomijam');
          return;
        }
        
        console.log('üõí [CUSTOMIFY CHECKOUT] Inicjalizacja wy≈ÇƒÖczania link√≥w produkt√≥w AI');
        
        function showImageLightbox(imageUrl) {
          console.log('üîç [CUSTOMIFY CHECKOUT] Pokazujƒô lightbox dla:', imageUrl);
          
          // Stw√≥rz overlay
          const overlay = document.createElement('div');
          overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: zoom-out;
            animation: fadeIn 0.2s ease;
          `;
          
          // Dodaj powiƒôkszony obraz
          const img = document.createElement('img');
          img.src = imageUrl;
          img.alt = 'Powiƒôkszony obraz AI';
          img.style.cssText = `
            max-width: 90vw;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
          `;
          
          // Przycisk zamkniƒôcia
          const closeBtn = document.createElement('button');
          closeBtn.innerHTML = '√ó';
          closeBtn.setAttribute('aria-label', 'Zamknij');
          closeBtn.style.cssText = `
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
          `;
          
          overlay.appendChild(img);
          overlay.appendChild(closeBtn);
          
          // Zamknij po klikniƒôciu overlay lub przycisku
          overlay.addEventListener('click', (e) => {
            if (e.target === overlay || e.target === closeBtn) {
              overlay.remove();
              console.log('üîç [CUSTOMIFY CHECKOUT] Lightbox zamkniƒôty');
            }
          });
          
          // Zamknij po ESC
          const handleEsc = (e) => {
            if (e.key === 'Escape') {
              overlay.remove();
              document.removeEventListener('keydown', handleEsc);
              console.log('üîç [CUSTOMIFY CHECKOUT] Lightbox zamkniƒôty (ESC)');
            }
          };
          document.addEventListener('keydown', handleEsc);
          
          document.body.appendChild(overlay);
        }
        
        function disableAIProductLinks() {
          console.log('üõí [CUSTOMIFY CHECKOUT] Wy≈ÇƒÖczam linki dla wszystkich produkt√≥w w checkout...');
          
          // Znajd≈∫ wszystkie elementy checkout (r√≥≈ºne selektory dla Shopify checkout)
          const checkoutItems = document.querySelectorAll(
            '.product, .product-thumbnail, [data-product-table], .order-summary__section--product-list .product, .review-block__content .product'
          );
          
          console.log('üõí [CUSTOMIFY CHECKOUT] Znaleziono element√≥w checkout:', checkoutItems.length);
          
          checkoutItems.forEach((item, index) => {
            // Znajd≈∫ wszystkie linki w tym elemencie
            const links = item.querySelectorAll('a[href*="/products/"]');
            console.log(`üîó [CUSTOMIFY CHECKOUT] Element ${index} - znaleziono link√≥w: ${links.length}`);
            
            links.forEach((link, linkIndex) => {
              // Znajd≈∫ obrazek w linku
              const img = link.querySelector('img');
              
              if (img) {
                // To jest link z miniaturkƒÖ - wy≈ÇƒÖcz i dodaj lightbox
                console.log(`üñºÔ∏è [CUSTOMIFY CHECKOUT] Link ${linkIndex} ma obrazek - dodajƒô lightbox`);
                
                link.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                  showImageLightbox(img.src);
                });
                
                // Zmie≈Ñ cursor na zoom-in
                link.style.cursor = 'zoom-in';
                link.title = 'Kliknij aby powiƒôkszyƒá';
              } else {
                // To jest link z tytu≈Çem - wy≈ÇƒÖcz ca≈Çkowicie
                console.log(`üìù [CUSTOMIFY CHECKOUT] Link ${linkIndex} to tytu≈Ç - wy≈ÇƒÖczam`);
                
                link.addEventListener('click', (e) => {
                  e.preventDefault();
                  e.stopPropagation();
                });
                
                link.style.cursor = 'default';
                link.style.pointerEvents = 'none';
                link.style.textDecoration = 'none';
              }
            });
          });
          
          console.log(`‚úÖ [CUSTOMIFY CHECKOUT] Wy≈ÇƒÖczono linki dla ${checkoutItems.length} produkt√≥w`);
        }
        
        // Uruchom po za≈Çadowaniu DOM
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', disableAIProductLinks);
        } else {
          disableAIProductLinks();
        }
        
        // Uruchom ponownie po zmianach (Shopify checkout mo≈ºe siƒô dynamicznie aktualizowaƒá)
        setTimeout(disableAIProductLinks, 1000);
        setTimeout(disableAIProductLinks, 2000);
        
        console.log('‚úÖ [CUSTOMIFY CHECKOUT] Inicjalizacja zako≈Ñczona');
      })();
    </script>

    {% comment %} CUSTOMIFY CUSTOMER REVIEWS {% endcomment %}
    {% if template contains 'product' %}
    {{ 'reviews.css' | asset_url | stylesheet_tag }}
      <div class="reviews-header">
        <h2 class="reviews-title">
          ‚≠ê Opinie klient√≥w
          <a href="#customer-reviews" class="reviews-link">Zobacz wszystkie opinie</a>
        </h2>
        <div class="stars-rating">
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span class="star">‚òÖ</span>
          <span style="margin-left: 10px; color: #6c757d; font-weight: 600;">4.9/5 (143 opinii)</span>
        </div>
      </div>
      
      <div class="reviews-grid" id="customer-reviews">
        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Anna K.</div>
            <div class="review-date">15.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Niesamowite! Moje zdjƒôcie w stylu anime wyglƒÖda jak prawdziwe dzie≈Ço sztuki. Jako≈õƒá druku na p≈Ç√≥tnie jest doskona≈Ça, kolory sƒÖ ≈ºywe i wyra≈∫ne. Polecam ka≈ºdemu!"
          </div>
          <div class="review-style">Styl: Anime</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Marcin W.</div>
            <div class="review-date">12.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Zam√≥wi≈Çem portret w stylu Van Gogh dla ≈ºony na rocznicƒô. By≈Ça zachwycona! AI doskonale odtworzy≈Ço styl malarza. Szybka realizacja i ≈õwietna jako≈õƒá."
          </div>
          <div class="review-style">Styl: Van Gogh</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Katarzyna M.</div>
            <div class="review-date">10.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Cyberpunk style to by≈Ç strza≈Ç w dziesiƒÖtkƒô! Moje zdjƒôcie wyglƒÖda jak z filmu sci-fi. P≈Ç√≥tno jest wysokiej jako≈õci, a kolory sƒÖ niesamowicie intensywne."
          </div>
          <div class="review-style">Styl: Cyberpunk</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Piotr L.</div>
            <div class="review-date">08.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Akwarela wysz≈Ça przepiƒôknie! Delikatne kolory i miƒôkki styl idealnie pasujƒÖ do naszego salonu. ≈ªona ju≈º planuje kolejne zam√≥wienia."
          </div>
          <div class="review-style">Styl: Akwarela</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Magdalena S.</div>
            <div class="review-date">05.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Monet style to czysta magia! Moje zdjƒôcie wyglƒÖda jak impresjonistyczne dzie≈Ço sztuki. Jako≈õƒá wykonania i szybko≈õƒá realizacji na najwy≈ºszym poziomie."
          </div>
          <div class="review-style">Styl: Monet</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Tomasz K.</div>
            <div class="review-date">03.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Picasso style to prawdziwe dzie≈Ço sztuki! Abstrakcyjne formy i wyraziste kolory tworzƒÖ niesamowity efekt. Polecam ka≈ºdemu mi≈Ço≈õnikowi sztuki."
          </div>
          <div class="review-style">Styl: Picasso</div>
        </div>

        <div class="review-card">
          <div class="review-header">
            <div class="review-author">Agnieszka R.</div>
            <div class="review-date">01.01.2025</div>
          </div>
          <div class="review-stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
          </div>
          <div class="review-text">
            "Renesans to absolutnie niesamowity styl! Moje zdjƒôcie wyglƒÖda jak prawdziwy portret z epoki renesansu. Dramatyczne ≈õwiat≈Ço i szczeg√≥≈Çy sƒÖ imponujƒÖce!"
          </div>
          <div class="review-style">Styl: Renesans</div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- ACCORDION FAQ NA STRONIE KOSZYKA -->
    {% if template == 'cart' %}
    <div class="page-width" style="margin: 60px auto; max-width: 1200px;">
      <div class="product-details-accordion">
        
        <!-- 1. Gwarancja satysfakcji (NAJWA≈ªNIEJSZE - zmniejsza niepewno≈õƒá) -->
        <div class="accordion-item" data-accordion="guarantee" style="border: 2px solid #4CAF50; border-radius: 8px; margin-bottom: 12px;">
          <div class="accordion-header" style="background: #E8F5E9;">
            <div class="accordion-title">
              <span style="font-weight: 700; color: #2E7D32;">Gwarancja satysfakcji</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div style="background: #F1F8F4; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
              <p style="font-size: 18px; font-weight: 600; color: #2E7D32; margin: 0 0 8px 0;">
                100% satysfakcji lub zwrot pieniƒôdzy
              </p>
              <p style="margin: 0; color: #555;">
                Je≈õli nie jeste≈õ zadowolony z jako≈õci wydruku, zwr√≥cimy 100% koszt√≥w. Bez pyta≈Ñ, bez problem√≥w.
              </p>
            </div>
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>30 dni na zwrot</strong> - pe≈Çny zwrot koszt√≥w</li>
              <li><strong>Wsparcie na biuro@lumly.pl</strong>, zawsze pomo≈ºemy rozwiƒÖzaƒá problem</li>
              <li><strong>4.8/5 ocena klient√≥w</strong> - ponad 5000 zadowolonych klient√≥w</li>
            </ul>
          </div>
        </div>

        <!-- 2. Szczeg√≥≈Çy produktu -->
        <div class="accordion-item" data-accordion="details">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>O produkcie</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <p><strong>Obraz na p≈Ç√≥tnie</strong> - wydrukowane na grubym, premium p≈Ç√≥tnie canvas z naturalnƒÖ teksturƒÖ. NaciƒÖgniƒôte na drewnianƒÖ antyramƒô</p>
            
            <!-- Wizualizacja: Obraz na p≈Ç√≥tnie -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/obraz.png" alt="Obraz na p≈Ç√≥tnie" class="accordion-visual-image">
              </div>
            </div>
            
            <br>
            <p><strong>Plakat</strong> - wydruk na papierze fotograficznym, kt√≥ry wysy≈Çamy zwiniƒôty w eleganckiej tubie. Mo≈ºesz wybraƒá ramkƒô. W√≥wczas wydruk bƒôdzie w ramce za szk≈Çem.</p>
            
            <!-- Wizualizacja: Plakat -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/plakat.png" alt="Plakat" class="accordion-visual-image">
              </div>
            </div>
            
            <br>
            <p><strong>Nadruk na szkle akrylowym</strong> - personalizowany wydruk na szkle akrylowym (bezpieczne niet≈ÇukƒÖce siƒô). Dodaj podstawkƒô, by postawiƒá go na biurku, mo≈ºesz dodaƒá podstawkƒô z LED, kt√≥ra pod≈õwietla zdjƒôcie i zamienia je w nastrojowƒÖ lampkƒô nocnƒÖ lub dekoracjƒô pokoju.</p>
            <p>Dostƒôpna jest w 2 rozmiarach: <strong>A5</strong> - najpopularniejszym i wiƒôkszym <strong>A4</strong>.</p>
            <!-- Wizualizacja: Rozmiary ramek na szkle -->
            <div class="accordion-product-visual" style="margin: 15px 0;">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/ramki_wymiary.webp" alt="Rozmiary ramek na szkle" class="accordion-visual-image">
              </div>
            </div>
            <p>Przezroczysta pleksi nadaje zdjƒôciu elegancki po≈Çysk i g≈Çƒôbiƒô, dziƒôki czemu wyglƒÖda jak obraz za szk≈Çem. Produkt jest gotowy do wrƒôczenia jako prezent ‚Äî piƒôkny, nowoczesny i w pe≈Çni personalizowany.</p>
            
            <!-- Wizualizacja: Nadruk na szkle akrylowym -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/akryl/akryl.png" alt="Nadruk na szkle akrylowym" class="accordion-visual-image">
              </div>
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/akryl/akryl_2.png" alt="Nadruk na szkle akrylowym z LED" class="accordion-visual-image">
              </div>
            </div>
            
            <br>
            <p><strong>Produkt cyfrowy</strong> ‚Äì plik w wysokiej jako≈õci, bez znak√≥w wodnych, do natychmiastowego pobrania (bez wysy≈Çki fizycznego obrazu).</p>
            
            <ul>
              <li>Otrzymujesz plik w wysokiej rozdzielczo≈õci, bez znak√≥w wodnych.</li>
              <li>Link do pobrania wysy≈Çamy natychmiast po op≈Çaceniu zam√≥wienia ‚Äì zero czekania na kuriera.</li>
              <li>Idealny do druku w domu lub fotolabie, jako tapeta na telefon/komputer albo do udostƒôpniania w social mediach.</li>
            </ul>
            
            <p><strong>To jest produkt cyfrowy ‚Äì nie wysy≈Çamy fizycznego obrazu.</strong></p>
            
            <!-- Wizualizacja: Produkt cyfrowy -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/icon_digital.png" alt="Produkt cyfrowy" class="accordion-visual-image">
              </div>
            </div>
          </div>
        </div>

        <!-- 3. Wysy≈Çka i dostawa -->
        <div class="accordion-item" data-accordion="shipping">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>Wysy≈Çka i dostawa</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div style="background: #E3F2FD; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
              <p style="margin: 0; font-weight: 600; color: #1976D2;">
                ‚ö° <strong>Szybka realizacja: 3-5 dni roboczych</strong> od akceptacji projektu
              </p>
            </div>
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>üì¶ Bezpieczne opakowanie:</strong> Karton wzmocniony + folia bƒÖbelkowa - gwarancja bezpiecznej dostawy</li>
              <li><strong>üáµüá± Wysy≈Çka:</strong> InPost Paczkomaty, InPost Kurier</li>
              <li><strong>üìç ≈öledzenie przesy≈Çki:</strong> Numer trackingowy wysy≈Çany mailem - zawsze wiesz gdzie jest Twoja przesy≈Çka</li>
              <li><strong>üöö Darmowa dostawa:</strong> Przy zam√≥wieniach powy≈ºej 400 z≈Ç</li>
              <li><strong>‚è∞ Czas dostawy:</strong> 1-3 dni robocze (w zale≈ºno≈õci od wybranej opcji)</li>
            </ul>
          </div>
        </div>

        <!-- 4. Bezpiecze≈Ñstwo i zaufanie -->
        <div class="accordion-item" data-accordion="security">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>üîí</span>
              <span>Bezpiecze≈Ñstwo i zaufanie</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <ul style="margin: 12px 0; padding-left: 20px;">
              <li><strong>üîê Bezpieczne p≈Çatno≈õci:</strong> SSL szyfrowanie, obs≈Çuga kart, BLIK, Przelewy24</li>
              <li><strong>üõ°Ô∏è Ochrona danych:</strong> Twoje zdjƒôcia sƒÖ bezpieczne - nie udostƒôpniamy ich osobom trzecim</li>
              <li><strong>üì∏ Usuwanie zdjƒôƒá:</strong> Po realizacji zam√≥wienia mo≈ºesz poprosiƒá o usuniƒôcie swoich zdjƒôƒá</li>
              <li><strong>‚úÖ Certyfikaty:</strong> Dzia≈Çamy zgodnie z RODO i przepisami UE</li>
              <li><strong>üí≥ Bezpieczne p≈Çatno≈õci:</strong> Wszystkie transakcje chronione przez Shopify Payments</li>
            </ul>
            <div style="margin-top: 16px; padding: 12px; background: #F5F5F5; border-radius: 8px; text-align: center;">
              <p style="margin: 0; font-size: 14px; color: #666;">
                üîí <strong>Bezpieczne zakupy</strong> - Twoje dane sƒÖ chronione
              </p>
            </div>
          </div>
        </div>

        <!-- 3. Dostƒôpne rozmiary -->
        <div class="accordion-item" data-accordion="sizes">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>Dostƒôpne rozmiary</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <!-- SEKCJA 1: Plakat / Obraz na p≈Ç√≥tnie -->
            <h4 style="margin: 0 0 15px 0; font-size: 1.1rem; color: #111; border-bottom: 2px solid #1DB954; padding-bottom: 8px;">üñºÔ∏è Plakat / Obraz na p≈Ç√≥tnie</h4>
            
            <!-- Wizualizacja: Rozmiary -->
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/faq/wymiary.png" alt="Dostƒôpne rozmiary" class="accordion-visual-image">
                <div class="accordion-visual-label">üìè Dostƒôpne rozmiary</div>
              </div>
            </div>
            
            <div class="accordion-size-grid">
              <div class="accordion-size-item">
                <div class="accordion-size-name">20 √ó 30 cm</div>
                <div class="accordion-size-description">≈öwietny do ma≈Çych pokoi</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">30 √ó 45 cm</div>
                <div class="accordion-size-description">Doskona≈Çy do ≈õrednich pomieszcze≈Ñ</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">40 √ó 60 cm</div>
                <div class="accordion-size-description">Efektowny na du≈ºe ≈õciany w salonie</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">50 √ó 75 cm</div>
                <div class="accordion-size-description">Idealny do du≈ºych przestrzeni</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">60 √ó 90 cm</div>
                <div class="accordion-size-description">ImponujƒÖcy na ca≈ÇƒÖ ≈õcianƒô</div>
              </div>
            </div>
            
            <!-- SEKCJA 2: Wydruk na szkle -->
            <h4 style="margin: 30px 0 15px 0; font-size: 1.1rem; color: #111; border-bottom: 2px solid #1DB954; padding-bottom: 8px;">üî≤ Wydruk na szkle</h4>
            
            <div class="accordion-product-visual">
              <div class="accordion-visual-item">
                <img src="https://customify-s56o.vercel.app/ramki_wymiary.webp" alt="Rozmiary ramek na szkle" class="accordion-visual-image">
                <div class="accordion-visual-label">üìè Rozmiary ramek na szkle</div>
              </div>
            </div>
            
            <div class="accordion-size-grid" style="margin-top: 15px;">
              <div class="accordion-size-item">
                <div class="accordion-size-name">A5 (15 √ó 21 cm)</div>
                <div class="accordion-size-description">Najpopularniejszy rozmiar</div>
              </div>
              <div class="accordion-size-item">
                <div class="accordion-size-name">A4 (21 √ó 30 cm)</div>
                <div class="accordion-size-description">Wiƒôkszy, bardziej efektowny</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 5. Jak to dzia≈Ça -->
        <div class="accordion-item" data-accordion="howto">
          <div class="accordion-header">
            <div class="accordion-title">
              <span>üí°</span>
              <span>Jak to dzia≈Ça?</span>
            </div>
            <span class="accordion-icon">‚ñº</span>
          </div>
          <div class="accordion-content">
            <div class="accordion-step">
              <div class="accordion-step-number">1</div>
              <div class="accordion-step-content">
                <strong>Wgraj swoje zdjƒôcie</strong><br>
                JPG, PNG lub GIF do 10MB. Najlepiej w wysokiej rozdzielczo≈õci.<br>
                <em style="color: #666; font-size: 0.9em;">Nie musisz siƒô martwiƒá o jako≈õƒá - sprawdzamy ka≈ºde zdjƒôcie przed wydrukiem i poprawiamy je, aby by≈Ço idealne!</em>
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">2</div>
              <div class="accordion-step-content">
                <strong>Wybierz styl artystyczny</strong><br>
                Dostƒôpne style do wyboru w zak≈Çadce powy≈ºej.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">3</div>
              <div class="accordion-step-content">
                <strong>Wybierz rozmiar wydruku</strong><br>
                Wybierz idealny rozmiar dla Twojej przestrzeni.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">4</div>
              <div class="accordion-step-content">
                <strong>AI przekszta≈Çci Twoje zdjƒôcie</strong><br>
                Najnowocze≈õniejsza technologia sztucznej inteligencji w 30-60 sekund.
              </div>
            </div>
            <div class="accordion-step">
              <div class="accordion-step-number">5</div>
              <div class="accordion-step-content">
                <strong>Drukujemy i wysy≈Çamy</strong><br>
                Ka≈ºde zdjƒôcie jest sprawdzane i poprawiane przed wydrukiem. Wysokiej jako≈õci nadruk, bezpiecznie zapakowany.
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    
    <!-- JavaScript dla accordion na stronie koszyka -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üõí [CART] Initializing cart accordion...');
        
        // Znajd≈∫ wszystkie accordion items na stronie koszyka
        const accordionItems = document.querySelectorAll('.accordion-item');
        
        if (!accordionItems || accordionItems.length === 0) {
          console.log('‚ö†Ô∏è [CART] No accordion items found');
          return;
        }
        
        console.log('‚úÖ [CART] Found', accordionItems.length, 'accordion items');
        
        // Dodaj event listener do ka≈ºdego accordion header
        accordionItems.forEach((item, index) => {
          const header = item.querySelector('.accordion-header');
          
          if (!header) {
            console.log('‚ö†Ô∏è [CART] No header found for item', index);
            return;
          }
          
          // Event listener - toggle klasy expanded
          header.addEventListener('click', () => {
            const isExpanded = item.classList.contains('expanded');
            
            if (isExpanded) {
              // Zwi≈Ñ
              item.classList.remove('expanded');
              console.log('üîΩ [CART] Collapsed:', item.dataset.accordion);
            } else {
              // Rozwi≈Ñ
              item.classList.add('expanded');
              console.log('üîº [CART] Expanded:', item.dataset.accordion);
            }
          });
          
          console.log('‚úÖ [CART] Accordion item', index, 'setup complete');
        });
        
        console.log('‚úÖ [CART] Cart accordion setup complete!');
      });
    </script>
    {% endif %}
    <!-- KONIEC ACCORDION FAQ NA STRONIE KOSZYKA -->

    <div class="customify-footer-poradnik">
      <a href="/blogs/poradnik" class="customify-footer-poradnik__link">Poradnik</a>
    </div>
    {{ 'footer.css' | asset_url | stylesheet_tag }}

    {% sections 'footer-group' %}

    <!-- FORMULARZ KONTAKTOWY NA STRONIE CONTACT-INFORMATION -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Sprawd≈∫ czy jeste≈õmy na stronie kontakt
        if (window.location.pathname.includes('/pages/kontakt') || window.location.pathname.includes('/policies/contact-information')) {
          // Czekaj chwilƒô, ≈ºeby DOM siƒô za≈Çadowa≈Ç
          setTimeout(function() {
            // Znajd≈∫ g≈Ç√≥wnƒÖ tre≈õƒá strony - szukaj po r√≥≈ºnych selektorach
            let targetElement = null;
            
            // Pr√≥buj znale≈∫ƒá g≈Ç√≥wnƒÖ sekcjƒô z tre≈õciƒÖ
            const selectors = [
              '#MainContent',
              'main',
              '.main-content',
              '.page-content',
              '.rte',
              '.page__content',
              '.page-content-wrapper',
              '[class*="policy"]',
              '[class*="content"]',
              'article',
              '.content-for-layout',
              '[class*="page"]'
            ];
            
            for (const selector of selectors) {
              const element = document.querySelector(selector);
              if (element && element.offsetHeight > 0) {
                targetElement = element;
                break;
              }
            }
            
            // Je≈õli nie znaleziono, szukaj po nag≈Ç√≥wku h1
            if (!targetElement) {
              const h1 = document.querySelector('h1');
              if (h1) {
                // Znajd≈∫ najbli≈ºszy kontener z tre≈õciƒÖ
                targetElement = h1.closest('div, section, article, main') || h1.parentElement;
              }
            }
            
            // Ostatecznie u≈ºyj body, ale znajd≈∫ miejsce przed footerem
            if (!targetElement) {
              const footer = document.querySelector('footer, [class*="footer"]');
              if (footer) {
                targetElement = footer;
              } else {
                targetElement = document.body;
              }
            }
            
            if (targetElement) {
              // Utw√≥rz formularz kontaktowy
              const contactFormHTML = `
                <div id="contact-form-container" style="
                  max-width: 600px;
                  margin: 40px auto;
                  padding: 30px;
                  background: #fff;
                  border-radius: 8px;
                  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                ">
                  <h2 style="
                    font-size: 24px;
                    font-weight: 600;
                    margin-bottom: 20px;
                    color: #333;
                  ">Wy≈õlij wiadomo≈õƒá</h2>
                  
                  <form id="contactForm" style="display: flex; flex-direction: column; gap: 16px;">
                    <div>
                      <label for="contactName" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Imiƒô i nazwisko *
                      </label>
                      <input 
                        type="text" 
                        id="contactName" 
                        name="name" 
                        required
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactEmail" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Email *
                      </label>
                      <input 
                        type="email" 
                        id="contactEmail" 
                        name="email" 
                        required
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactSubject" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Temat
                      </label>
                      <input 
                        type="text" 
                        id="contactSubject" 
                        name="subject"
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          box-sizing: border-box;
                        "
                      >
                    </div>
                    
                    <div>
                      <label for="contactMessage" style="display: block; margin-bottom: 6px; font-weight: 500; color: #555;">
                        Wiadomo≈õƒá *
                      </label>
                      <textarea 
                        id="contactMessage" 
                        name="message" 
                        required
                        rows="6"
                        style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #ddd;
                          border-radius: 4px;
                          font-size: 16px;
                          font-family: inherit;
                          box-sizing: border-box;
                          resize: vertical;
                        "
                      ></textarea>
                    </div>
                    
                    <button 
                      type="submit"
                      style="
                        background: #000;
                        color: #fff;
                        padding: 14px 28px;
                        border: none;
                        border-radius: 4px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: background 0.2s;
                      "
                      onmouseover="this.style.background='#333'"
                      onmouseout="this.style.background='#000'"
                    >
                      Wy≈õlij wiadomo≈õƒá
                    </button>
                    
                    <div id="contactFormMessage" style="
                      margin-top: 12px;
                      padding: 12px;
                      border-radius: 4px;
                      display: none;
                    "></div>
                  </form>
                </div>
              `;
              
              // Je≈õli targetElement to footer, dodaj przed nim
              if (targetElement.tagName === 'FOOTER' || targetElement.className.includes('footer')) {
                targetElement.insertAdjacentHTML('beforebegin', contactFormHTML);
              } else {
                // W przeciwnym razie dodaj na ko≈Ñcu elementu
                targetElement.insertAdjacentHTML('beforeend', contactFormHTML);
              }
              
              // Obs≈Çuga formularza
              const form = document.getElementById('contactForm');
              const messageDiv = document.getElementById('contactFormMessage');
              
              if (form) {
                form.addEventListener('submit', async function(e) {
              e.preventDefault();
              
              const formData = {
                name: document.getElementById('contactName').value,
                email: document.getElementById('contactEmail').value,
                subject: document.getElementById('contactSubject').value || 'Kontakt ze strony',
                message: document.getElementById('contactMessage').value
              };
              
              // Wy≈ÇƒÖcz przycisk podczas wysy≈Çania
              const submitBtn = form.querySelector('button[type="submit"]');
              submitBtn.disabled = true;
              submitBtn.textContent = 'Wysy≈Çanie...';
              
              try {
                const response = await fetch('https://customify-s56o.vercel.app/api/contact-form', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                  messageDiv.style.display = 'block';
                  messageDiv.style.background = '#E8F5E9';
                  messageDiv.style.color = '#2E7D32';
                  messageDiv.textContent = '‚úÖ ' + result.message;
                  form.reset();
                } else {
                  throw new Error(result.error || 'B≈ÇƒÖd wysy≈Çania wiadomo≈õci');
                }
              } catch (error) {
                messageDiv.style.display = 'block';
                messageDiv.style.background = '#FFEBEE';
                messageDiv.style.color = '#C62828';
                messageDiv.textContent = '‚ùå B≈ÇƒÖd: ' + error.message;
              } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Wy≈õlij wiadomo≈õƒá';
              }
                }); // Zamknij addEventListener
              } // Zamknij if (form)
            } // Zamknij if (targetElement)
          }, 500); // Czekaj 500ms na za≈Çadowanie DOM
        }
      });
    </script>

  </body>
</html>{% comment %} Cache bust: 1761686705 {% endcomment %}
