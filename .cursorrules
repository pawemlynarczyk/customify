# Cursor Rules for Customify Shopify App

## NAJWAŻNIEJSZE ZASADY - ZAWSZE PRZESTRZEGAJ

### **🔥 KLUCZOWA ZASADA - PRZECZYTAJ PRZED KAŻDĄ ZMIANĄ:**
- 🚨 **Nigdy nie zmieniaj więcej niż konieczne** - zmiany tylko tam gdzie trzeba
- 🚨 **Zmieniaj tylko produkty/style których to dotyczy** - nie rób zmian globalnych
- 🚨 **Zanim coś zmienisz - SPRAWDŹ czy nie zepsujesz kluczowych funkcjonalności**
- 🚨 **Testuj WSZYSTKIE style (boho, pixar, koty, król) przed wdrożeniem**
- 🚨 **Jeśli dodajesz nowy styl - NIE ZMIENIAJ logiki dla istniejących stylów**
- 🚨 **Pytanie: "Czy ta zmiana zepsuje coś co już działa?" - jeśli TAK, NIE RÓB TEGO**

### **✅ DO:**
- ✅ **Dodawaj walidację stopniowo** (jeden plik na raz)
- ✅ **Testuj po każdej zmianie** - sprawdź czy działa
- ✅ **Zachowuj istniejącą funkcjonalność** - nie niszcz tego co działa
- ✅ **Commituj często** z jasnymi komunikatami
- ✅ **Pytaj użytkownika** w razie wątpliwości

### **❌ NIE:**
- ❌ **Nie zmieniaj wszystkiego naraz** - małe kroki
- ❌ **Nie usuwaj działającego kodu** - zachowaj funkcjonalność
- ❌ **Nie commituj bez testów** - zawsze sprawdź czy działa
- ❌ **Nie hardcoduj sekretów** - używaj zmiennych środowiskowych
- ❌ **Nie ignoruj błędów** - napraw zanim przejdziesz dalej
- ❌ **Nie zmieniaj logiki globalnie** - tylko dla konkretnych produktów/stylów

## WAŻNE: ZASADY BEZPIECZEŃSTWA SHOPIFY

### **🔐 BEZPIECZEŃSTWO:**
- ✅ **Walidacja HMAC w endpointach Shopify** - zawsze weryfikuj podpisy
- ✅ **Rate limiting dla kosztownych operacji** - ogranicz API calls
- ✅ **Moduł współdzielonych funkcji Shopify** - DRY principle dla API

### **🛡️ IMPLEMENTACJA BEZPIECZEŃSTWA:**

#### **HMAC Validation:**
```javascript
// ZAWSZE weryfikuj HMAC w webhookach i callbackach
const crypto = require('crypto');
const hmac = crypto.createHmac('sha256', process.env.SHOPIFY_WEBHOOK_SECRET);
hmac.update(body, 'utf8');
const hash = hmac.digest('base64');
if (hash !== req.headers['x-shopify-hmac-sha256']) {
  return res.status(401).json({ error: 'Invalid HMAC' });
}
```

#### **Rate Limiting:**
```javascript
// ZAIMPLEMENTOWANE: utils/vercelRateLimiter.js
const { checkRateLimit, getClientIP } = require('../utils/vercelRateLimiter');

// W każdym endpoincie:
const ip = getClientIP(req);
if (!checkRateLimit(ip, limit, windowMs)) {
  return res.status(429).json({ error: 'Rate limit exceeded' });
}

// Limity:
// - API: 100 requestów/15min (api/products.js)
// - AI: 20 requestów/15min (api/transform.js) 
// - Upload: 50 requestów/godzina (api/upload.js)
```

#### **Shopify API Module:**
```javascript
// utils/shopify-api.js - współdzielone funkcje
const shopifyRequest = async (endpoint, options = {}) => {
  // Centralna logika dla wszystkich API calls
  // Error handling, retry logic, logging
};
```

## Environment Variables Status
- All Vercel environment variables are properly configured
- SHOPIFY_ACCESS_TOKEN is set in Vercel Dashboard
- Do NOT ask about environment variables configuration
- Do NOT ask about Vercel Dashboard settings
- Do NOT ask about token values or setup
- SHOPIFY_ACCESS_TOKEN is available in environment variables - use it directly

## CRITICAL: Product Page Layout Proportions
- **NEVER CHANGE** the product page layout proportions (35% image / 65% app) without explicit user command
- These proportions are CRITICAL for the product page layout
- Always preserve the existing grid layout: `grid-template-columns: 35% 65%`
- This rule is MANDATORY and must be followed in ALL cases

## CRITICAL SECURITY RULE - NEVER COMMIT SECRETS
- **NEVER** add passwords, tokens, API keys, or any secrets to files that will be committed to GitHub
- **ALWAYS** use environment variables for sensitive data (process.env.VARIABLE_NAME)
- **ALWAYS** use placeholder text like "your_token_here" or "shpat_..." in code examples
- **NEVER** hardcode real tokens, passwords, or API keys in any file
- If a file contains secrets, it must be added to .gitignore or use environment variables
- This rule is CRITICAL and must be followed in ALL cases

## Current Project Status
- Shopify app is installed and working in customify-ok.myshopify.com
- OAuth flow is complete
- App has proper permissions in Shopify
- Vercel deployment is functional
- Vercel environment variables updated to new store
- Old store (customiffyy.myshopify.com) was preview only - DO NOT suggest using it

## Shopify Connection & Permissions
- **Store**: customify-ok.myshopify.com (redirects to lumly.pl)
- **App Permissions**: read_products, write_products, read_orders, write_orders, read_customers, read_content, read_themes, write_themes, read_script_tags
- **Access Token**: Available in Vercel environment variables (SHOPIFY_ACCESS_TOKEN)
- **Theme Management**: Can edit theme files via `/api/update-theme-simple` endpoint
- **Current Theme**: "Horizon" (ID: 186692927813)
- **What We Can Edit**: 
  - Theme files (layout/theme.liquid, sections, snippets, assets)
  - Product data and variants
  - Order management
  - Customer data
  - Script tags for theme integration

## Debugging Focus
- Focus on code issues, not environment setup
- Check function logic and implementation
- Look for runtime errors or logic problems
- Verify API calls and responses

## Key Files
- api/status.js - App status checker
- api/test.js - Environment variables test
- api/install.js - OAuth installation
- api/products.js - Product creation and cart management
- api/hide-product.js - Product hiding functionality
- api/transform.js - AI image transformation
- public/shopify-embed.html - Main UI and cart integration
- public/shopify-script.js - Shopify theme integration
- vercel.json - Vercel configuration

## Theme Files Location
- **MAIN THEME FILE**: `customify-theme/layout/theme.liquid` - główny plik motywu Shopify
- **BACKUP THEME FILE**: `theme.liquid` - kopia motywu w głównym katalogu
- **THEME DEPLOYMENT**: Używamy endpointu `/api/update-theme-simple` do wdrażania zmian

## Theme Editing Workflow
1. **Edit**: Modify `customify-theme/layout/theme.liquid` (main file)
2. **Deploy**: Use Node.js script to upload via `/api/update-theme-simple`
3. **Test**: Check changes on lumly.pl/products/custom
4. **Backup**: Keep `theme.liquid` as backup copy
- **IMPORTANT**: Always edit the main theme file, not the backup
- **DEPLOYMENT**: Use our app's API endpoint (has write_themes permission)
- **NO GIT PUSH**: Theme changes go directly to Shopify, not GitHub

## Project Goal
Customify is a Shopify app that allows customers to:
1. Upload their own photos on product pages
2. Use AI (Replicate API) to transform/modify the photos with various styles
3. Preview the AI-modified image
4. Add the customized product to cart for printing
5. Pay for the physical printed version

## Product Customization Logic
- **Original product** = only template/example image
- **Final product** = user's photo transformed by AI in selected style
- **Price depends on size** (small, medium, large, xlarge)
- **User pays for physical print** of their AI-transformed photo
- **Process**: Upload → Select style → Select size → AI transform → Create new product → Add to cart
- **For store**: Order contains AI image for printing + original user photo + style/size info

## Product Visibility Management
- **Products are created as ACTIVE** (status: 'active', published: true) - **MUSI BYĆ ACTIVE** żeby dodać do koszyka
- **🚨 CRITICAL**: Shopify zwraca **422 Unprocessable Content** dla produktów DRAFT - NIE MOŻNA ich dodać do koszyka!
- **Ukrywanie**: Produkty ukrywane przez tagi 'hidden-from-catalog', 'no-recommendations' (nie przez draft)
- **Tags**: Products tagged with 'customer-order' for easy filtering in admin panel
- **Benefits**: Produkty widoczne w admin, dostępne w koszyku, ukryte w katalogu przez tagi
- **Purpose**: Keep catalog clean while preserving order data and AI-generated images in admin

## Product Identification Strategy
- **Main Product**: "Obraz ze zdjęcia w stylu Ghibli" (URL: /products/custom) - ALWAYS VISIBLE
- **New Customify Products**: Contain word "rozmiar" in title (e.g., "Styl pixar - Rozmiar medium")
- **CSS Selectors for Hiding**:
  ```css
  /* Hide ONLY new Customify products (containing "rozmiar") */
  .product-card:has([data-product-title*="rozmiar"]) {
    display: none !important;
  }
  
  /* PROTECTION: Main product NEVER hidden */
  .product-card:has([data-product-title*="Obraz ze zdjęcia w stylu Ghibli"]) {
    display: block !important;
  }
  ```
- **Why "rozmiar" works**: New products always have size in title, main product doesn't
- **Alternative selectors**: `[href*="spersonalizowany"]` for URL-based hiding

## Communication Rules
- If you have doubts about requirements, ASK QUESTIONS before implementing
- Always clarify the exact business logic before writing code
- Focus on understanding the complete user journey before coding
- User explicitly stated: NO MORE PASSWORD SUGGESTIONS - user doesn't want password solutions, stop proposing password-related fixes
- User confirmed: NO UPGRADE OPTION in Billing - don't ask about upgrade options anymore
- User explicitly stated: NO CREATING NEW PRODUCTS - don't propose creating new products anymore, use existing product with properties

## Common Issues to Check
- Function syntax and exports
- API endpoint routing
- Error handling in functions
- Response formatting
- CORS configuration

## Recent Fixes (December 2024)
### Cart Add Functionality Fix
- **Problem**: `net::ERR_FAILED` and `TypeError: Failed to fetch` when adding products to cart
- **Root Cause**: ID mismatch between created product and cart add request + CORS issues with fetch()
- **Solution**: 
  - Added detailed logging in `api/products.js` to debug Shopify API responses
  - Changed cart add method from `fetch()` to `window.location.href` to avoid CORS
  - Added `productId` to API response for better debugging
  - Simplified cart add process to prevent network errors
- **Files Modified**: `api/products.js`, `public/shopify-embed.html`
- **Status**: ✅ Fixed and deployed

### Mobile Image Compression Fix (Status 413 - Payload Too Large)
- **Problem**: iPhone photos too large for Vercel (4.5MB limit), causing Status 413 errors
- **Root Cause**: Large HEIC/JPEG files from iPhone cameras exceed Vercel request body limits
- **Solution**: 
  - **Frontend compression** (JavaScript Canvas) for files >4MB only
  - **Backend compression** (Sharp) for all files with SDXL optimization
  - **Smart logic**: Frontend only compresses if needed, API does professional compression
  - **CORS fix**: Added `https://lumly.pl` to allowed origins
- **Files Modified**: `api/transform.js`, `shopify-theme/customify-theme/assets/customify.js`
- **Status**: ✅ Fixed and deployed

### Product Visibility Issue Fix
- **Problem**: Główny produkt "custom" nie był widoczny w katalogu mimo że był w HTML
- **Root Cause**: Style CSS w `customify.css` ukrywały produkty:
  ```css
  .product-card:has([href*="custom"]) {
    display: none !important;
  }
  ```
- **Why it was hard to find**: 
  - Produkty były w HTML (curl pokazywał je)
  - JavaScript nie ukrywał (usunęliśmy funkcje JS)
  - Problem był w CSS - `display: none !important` ukrywał wizualnie
  - Selektor `[href*="custom"]` łapał główny produkt z URL `/products/custom`
- **Solution**: Usunięto wszystkie style CSS ukrywające produkty
- **Files Modified**: `shopify-theme/customify-theme/assets/customify.css`
- **Status**: ✅ Fixed and deployed

### Cart Integration Details
- **Method**: Direct navigation to cart URL instead of fetch requests
- **URL Format**: `https://{shop}/cart/add?id={variantId}&quantity=1&properties[...]`
- **Properties**: Original Image, AI Style, Original Product, Customization Type
- **Variant ID**: Use `product.variants[0].id` from Shopify API response
- **Product ID**: Use `product.id` for reference (not for cart add)

### 🚨 CRITICAL: Cart Properties Rule - NIE ZMIENIAJ DLA WSZYSTKICH!
- **ZASADA**: Kiedy dodajesz nowy produkt/styl, **NIE ZMIENIAJ** logiki cart properties dla WSZYSTKICH produktów
- **PROBLEM**: Usunięcie `_AI_Image_Direct` dla króla (Segmind base64) zepsuło boho, pixar, koty (Replicate URLs)
- **ROZWIĄZANIE**: Dodawaj `_AI_Image_Direct` **warunkowo** - tylko dla krótkich URLs (Replicate), nie dla base64 (Segmind)
- **KOD**: 
  ```javascript
  const properties = {
    'Styl AI': this.selectedStyle,
    'Rozmiar': this.selectedSize,
    '_AI_Image_URL': result.imageUrl,
    '_Order_ID': result.orderId
  };
  
  // Dodaj _AI_Image_Direct TYLKO jeśli to NIE jest base64 (tylko dla Replicate URLs)
  if (this.transformedImage && !this.transformedImage.startsWith('data:')) {
    properties['_AI_Image_Direct'] = this.transformedImage;  // Replicate URL (krótki ~100 znaków)
  }
  // Segmind base64 data URI (~256KB) przekracza limit URL - POMIŃ!
  ```
- **DLACZEGO**: 
  - Replicate zwraca krótki URL: `https://replicate.delivery/pbxt/xyz.jpg` (~100 znaków) → OK dla URL
  - Segmind zwraca base64: `data:image/jpeg;base64,/9j/4AAQ...` (~256,000 znaków) → ZA DŁUGI dla URL (limit 2000-8000 znaków)
- **TESTUJ**: Każdy styl (boho, pixar, koty, król) osobno przed wdrożeniem
- **PAMIĘTAJ**: Co działa dla jednego stylu, NIE MOŻE zepsuć innych!

### Debugging Tips
- Check browser console for detailed logs with `[PRODUCTS.JS]` and `[SHOPIFY-EMBED.HTML]` prefixes
- Verify variant ID vs product ID usage
- Monitor network tab for failed requests
- Use direct navigation instead of fetch for cart operations

### Deployment Process
- **ALWAYS push changes to GitHub after fixes**
- Use `git add . && git commit -m "description" && git push origin main`
- Vercel automatically deploys from GitHub
- Test changes on live site after deployment
- Update cursor rules with new fixes and learnings

## 🚨 CRITICAL: SINGLE SOURCE OF TRUTH - TYLKO THEME.LIQUID!
- **GŁÓWNA ZASADA**: Używamy TYLKO `theme.liquid` - NIE MA DUPLIKACJI!
- **MAIN FILE**: `theme.liquid` - JEDYNY plik używany przez deploy-optimized-theme.js (PRIORYTET)
- **BACKUP FILES**: 
  - `shopify-theme/customify-theme/layout/theme.liquid` - kopia w katalogu theme (SYNC)
  - `shopify-theme-complete.liquid` - kopia kompletna (archive) (SYNC)
  - `public/shopify-script.js` - NIE UŻYWANY (stary system)
  - `public/shopify-embed.html` - NIE UŻYWANY (stary system)
- **SYNC RULE**: ZAWSZE edytuj `theme.liquid` - inne pliki są synchronizowane automatycznie
- **AUTOMATIC SYNC**: Przed każdym deployem wszystkie pliki są synchronizowane z `theme.liquid`
- **DEPLOYMENT**: Używaj `npm run deploy` - automatycznie synchronizuje i wdraża
- **MANUAL SYNC**: Użyj `npm run sync-theme` do ręcznej synchronizacji
- **STYLE IMAGES**: Używaj obrazków z katalogu public (screenshoty)
- **NO GRADIENTS**: Tylko obrazki, nie gradienty CSS
- **STYLE PRICING**: Style NIE wpływają na cenę - tylko rozmiary wpływają na cenę
- **PRIORITY**: NIE NISZCZ DZIAŁAJĄCYCH FUNKCJI - zachowaj wszystko co działa
- **NIGDY NIE EDYTUJ**: `shopify-embed.html`, `shopify-script.js`, plików w `shopify-theme/customify-theme/assets/`

## 🚨 CRITICAL: JAVASCRIPT MUSI BYĆ ZAWSZE WŁĄCZONY!
- **`customify.js`** - ZAWSZE WŁĄCZONY - obsługuje upload, style, cart, funkcjonalność
- **NIE USUWAJ** `customify.js` z `theme.liquid` - aplikacja przestanie działać!
- **`customify.js` to NIE DUPLIKACJA** - to jest potrzebny JavaScript
- **DUPLIKACJA to** `shopify-embed.html` (HTML) - nie `customify.js` (JavaScript)
- **ZASADA**: HTML w `theme.liquid` + JavaScript `customify.js` = działająca aplikacja
- **BŁĄD**: Usuwanie `customify.js` = aplikacja nie działa (brak funkcjonalności)

## 🎯 DYNAMIC STYLE MANAGEMENT - POKAZYWANIE I UKRYWANIE STYLÓW
- **GŁÓWNA ZASADA**: Style są zdefiniowane w HTML w `theme.liquid` (linie 206-248)
- **UKRYWANIE GLOBALNE**: Dodaj `style="display: none;"` do elementu `<div class="customify-style-card" data-style="nazwa">`
- **UKRYWANIE PER PRODUKT**: Użyj JavaScript w `theme.liquid` (po linii 38):
  ```javascript
  document.addEventListener('DOMContentLoaded', function() {
    const productHandle = window.location.pathname;
    if (productHandle.includes('nazwa-produktu')) {
      const styleElement = document.querySelector('[data-style="nazwa-stylu"]');
      if (styleElement) {
        styleElement.style.display = 'none';
      }
    }
  });
  ```
- **POKAZYWANIE STYLU**: Usuń `style="display: none;"` lub ustaw `style="display: block;"`
- **STRUKTURA STYLU**: Każdy styl ma `data-style="nazwa"` - użyj tego do selekcji
- **TESTING**: Zawsze sprawdzaj na konkretnym URL produktu
- **PRZYKŁAD**: Ukryj "Van Gogh" tylko w "Koty Królewskie" - sprawdź URL zawiera `koty-krolewskie`

## CRITICAL: Image Compression Strategy - DWUPOZIOMOWA KOMPRESJA
- **VERCEL LIMIT**: 4.5MB request body limit - pliki większe powodują Status 413
- **FRONTEND COMPRESSION** (JavaScript Canvas):
  - **Trigger**: Tylko dla plików >4MB
  - **Method**: Canvas resize do max 1024px (zachowuje proporcje)
  - **Quality**: JPEG 80%
  - **Purpose**: Zmieścić się w Vercel limit
- **BACKEND COMPRESSION** (Sharp API):
  - **Trigger**: Wszystkie pliki (bez względu na rozmiar)
  - **Method**: Sharp resize z SDXL optimization
  - **Sizes**: 1152x896 (krajobraz 4:3), 896x1152 (portret 3:4) - **NIE UŻYWAMY KWADRATÓW**
  - **Format druku**: Obrazy drukowane na format A4 - używamy tylko prostokątów zbliżonych do 3:4 i 4:3
  - **Quality**: JPEG 80%, EXIF removal
  - **Purpose**: Optymalizacja dla Replicate AI models
- **LOGIC**: Frontend kompresuje tylko jeśli trzeba, API robi profesjonalną kompresję
- **NO DOUBLE COMPRESSION**: Unikaj resize 1024px → 1024px (bez sensu)
- **CORS**: Zawsze dodawaj `https://lumly.pl` do allowed origins

## CRITICAL: Face-Swap Models (Koty, Król) - ZAWSZE PIONOWY OBRAZ
- **Model Król**: Segmind Faceswap v4 (synchroniczne API, brak pollingu)
- **Model Koty**: Nano-Banana (Replicate)
- **Output Format**: ZAWSZE pionowy obraz 3:4 (896x1152) - **NIE MA ZNACZENIA** co user wgra (poziomy/pionowy)
- **Dlaczego**: Model wycina tylko twarz z obrazu użytkownika i nakłada na miniaturkę (która jest pionowa 3:4)
- **Target Image (miniaturka)**: krol-styl-X.jpg, koty/*.png - zawsze w formacie 3:4 pionowym
- **Source Image (user)**: Zdjęcie użytkownika (dowolna orientacja) - model wykrywa i wycina twarz
- **KRYTYCZNE**: 
  - **NIE ZMIENIAJ** `aspect_ratio` dynamicznie dla kotów/króla - ZAWSZE `"3:4"`
  - **NIE DOSTOSOWUJ** do orientacji obrazu użytkownika
  - Wynik ZAWSZE pionowy, nawet jeśli user wgra poziomy obraz

### **Segmind Faceswap v4 (Król) - Konfiguracja:**
```javascript
// Style króla w theme.liquid (linie 1533-1552):
'krol-krolewski': {
  model: "segmind/faceswap-v4",
  apiType: "segmind-faceswap",
  productType: "king",
  parameters: {
    target_image: "https://customify-s56o.vercel.app/krol/krol-styl-1.jpg",
    swap_image: "USER_IMAGE"
  }
}

// API call do Segmind (transform.js):
{
  source_image: cleanSwapImage,      // Twarz użytkownika (base64)
  target_image: targetImageBase64,   // Obraz króla (base64)
  model_type: "speed",               // 8 steps
  swap_type: "head",                 // Zamień całą głowę
  style_type: "normal",
  image_format: "jpeg",
  image_quality: 90,
  hardware: "fast",
  base64: true
}
```

### **Kolejność parametrów Segmind:**
- `source_image` = twarz użytkownika (SOURCE - źródło twarzy)
- `target_image` = miniaturka króla (TARGET - na co nakładamy)
- **NIE ZAMIENIAJ** kolejności - to jest poprawna!

### **Environment Variables potrzebne:**
- `SEGMIND_API_KEY` - klucz API do Segmind (dodaj w Vercel Dashboard)
- Pobierz z: https://www.segmind.com/api-keys

## 🚨 CRITICAL: NO DUPLICATION - TYLKO THEME.LIQUID!
- **PROBLEM SOLVED**: CSS był duplikowany w wielu plikach - TERAZ TYLKO `theme.liquid`!
- **GŁÓWNE PLIKI CSS**:
  - `theme.liquid` - **JEDYNY** (używany przez deploy script) - **EDYTUJ TYLKO TEN!**
  - `shopify-theme/customify-theme/assets/customify.css` - BACKUP (synchronizowany automatycznie)
  - `shopify-theme-complete.liquid` - BACKUP (synchronizowany automatycznie)
- **KRYTYCZNE**: Zawsze edytuj CSS w `theme.liquid` - inne pliki są synchronizowane automatycznie
- **DEPLOY SCRIPT**: `deploy-optimized-theme.js` używa `theme.liquid` jako głównego pliku
- **SYNCHRONIZACJA**: `sync-theme-files.js` synchronizuje wszystkie pliki z `theme.liquid`
- **WORKFLOW**: Edytuj `theme.liquid` → `npm run deploy` → automatyczna synchronizacja
- **NIE EDYTUJ**: Plików w `shopify-theme/customify-theme/assets/` - są synchronizowane automatycznie
- **NIE UŻYWAJ**: `shopify-embed.html`, `shopify-script.js` - to są stare pliki!
- **DEBUGGING**: Jeśli zmiany nie działają, sprawdź czy edytowałeś `theme.liquid` a nie inne pliki

## CSS WORKFLOW INSTRUCTIONS - INSTRUKCJE PRACY Z CSS

### **🎯 GŁÓWNE ZASADY:**
1. **EDYTUJ TYLKO**: `theme.liquid` (główny katalog) - inne pliki są synchronizowane automatycznie
2. **DEPLOY**: Zawsze używaj `npm run deploy` - automatycznie synchronizuje + wdraża
3. **BACKUPY**: Automatyczne backupy są tworzone przed każdą zmianą
4. **TESTING**: Sprawdzaj zmiany na https://lumly.pl/products/custom
5. **NIE UŻYWAJ**: `shopify-embed.html`, `shopify-script.js` - to są stare pliki!
6. **NIE EDYTUJ**: Plików w `shopify-theme/customify-theme/assets/` - są synchronizowane automatycznie
7. **🚨 NIGDY NIE USUWAJ**: `customify.js` z `theme.liquid` - aplikacja przestanie działać!
8. **🚨 ZAWSZE MIEJ**: HTML w `theme.liquid` + JavaScript `customify.js` = działająca aplikacja

### **🔧 ROZWIĄZANIE PROBLEMU DUPLIKACJI PLIKÓW THEME:**
- **Problem**: 3 różne pliki theme (`theme.liquid`, `shopify-theme/customify-theme/layout/theme.liquid`, `shopify-theme-complete.liquid`)
- **Rozwiązanie**: Automatyczna synchronizacja - edytuj tylko `theme.liquid`
- **Skrypt**: `sync-theme-files.js` - synchronizuje wszystkie pliki z głównym
- **Integracja**: `deploy-optimized-theme.js` automatycznie synchronizuje przed wdrożeniem

### **📁 STRUKTURA PLIKÓW:**
```
theme.liquid                    ← EDYTUJ TYLKO TEN PLIK
├── shopify-theme/customify-theme/layout/theme.liquid  ← SYNC
├── shopify-theme-complete.liquid                      ← SYNC
└── public/shopify-script.js                           ← TYLKO JS
```

### **🚀 WORKFLOW CSS:**
1. **Edytuj**: `theme.liquid` (sekcja `<style>` lub linki do CSS)
2. **Deploy**: `npm run deploy` (automatycznie synchronizuje + wdraża)
3. **Test**: Sprawdź na https://lumly.pl/products/custom
4. **Commit**: `git add . && git commit -m "opis" && git push origin main`

### **⚠️ WAŻNE UWAGI:**
- **NIE EDYTUJ** plików w `shopify-theme/customify-theme/` - są synchronizowane automatycznie
- **NIE EDYTUJ** `shopify-theme-complete.liquid` - jest synchronizowany automatycznie
- **ZAWSZE UŻYWAJ** `npm run deploy` zamiast `node deploy-optimized-theme.js`
- **BACKUPY** są tworzone automatycznie przed każdą zmianą

### **🎨 CSS SPECIFIC:**
- **Style images**: Używaj obrazków z katalogu `public/` (screenshoty)
- **NO GRADIENTS**: Tylko obrazki, nie gradienty CSS
- **Style pricing**: Style NIE wpływają na cenę - tylko rozmiary
- **Responsive**: Sprawdzaj na różnych urządzeniach

### **🔍 DEBUGGING:**
- **Cache**: Shopify cache może potrzebować kilku minut na odświeżenie
- **Browser cache**: Użyj Ctrl+F5 (wymuszenie odświeżenia)
- **Console**: Sprawdzaj błędy w konsoli przeglądarki
- **Network**: Sprawdzaj czy CSS jest ładowany poprawnie

### **📝 PRZYKŁAD WORKFLOW:**
```bash
# 1. Edytuj theme.liquid
# 2. Deploy z automatyczną synchronizacją
npm run deploy

# 3. Sprawdź na żywo
# https://lumly.pl/products/custom

# 4. Commit zmiany
git add . && git commit -m "CSS: opis zmian" && git push origin main
```

## CRITICAL: CSS ARCHITECTURE & HIERARCHY - STRUKTURA CSS

### **🏗️ STRUKTURA PLIKÓW CSS:**
```
theme.liquid                           ← GŁÓWNY PLIK (EDYTUJ TYLKO TEN!)
├── <style>...</style>                 ← CSS wbudowany w theme.liquid
├── shopify-theme/customify-theme/assets/
│   ├── customify.css                  ← BACKUP (synchronizowany automatycznie)
│   ├── base.css                       ← BACKUP (synchronizowany automatycznie)
│   └── styles.css                     ← Shopify core CSS (NIE EDYTUJ!)
└── public/shopify-script.js           ← JavaScript fallback (inline styles)
```

### **📊 HIERARCHIA SPECIFICITY CSS (od najniższej do najwyższej):**
1. **`theme.liquid`** - CSS wbudowany w HTML (najniższa)
2. **`base.css`** - Ładowany przed styles.css
3. **`customify.css`** - Nasze style (średnia)
4. **`styles.css`** - Shopify core CSS (wysoka - NADPISUJE!)
5. **`shopify-script.js`** - JavaScript inline styles (najwyższa - WYGRYWA!)

### **🎯 ZASADY EDYCJI CSS:**

#### **✅ CO ROBIĆ:**
- **EDYTUJ TYLKO**: `theme.liquid` (sekcja `<style>`)
- **UŻYWAJ `!important`**: W `customify.css` i `base.css` żeby nadpisać `styles.css`
- **JAVASCRIPT FALLBACK**: Dla problemów z cache używaj `shopify-script.js`
- **MEDIA QUERIES**: Desktop `@media (min-width: 769px)`, Mobile `@media (max-width: 768px)`
- **TESTUJ ZAWSZE**: Na https://lumly.pl/products/custom po każdej zmianie

#### **❌ CZEGO NIE ROBIĆ:**
- **NIE EDYTUJ**: `shopify-theme/customify-theme/assets/customify.css` bezpośrednio
- **NIE EDYTUJ**: `shopify-theme/customify-theme/assets/base.css` bezpośrednio
- **NIE EDYTUJ**: `styles.css` (Shopify core - zostanie nadpisany)
- **NIE IGNORUJ**: Shopify cache - może blokować zmiany przez 15-30 minut

### **🔧 ROZWIĄZYWANIE PROBLEMÓW CSS:**

#### **Problem: Zmiany CSS nie są widoczne**
1. **Sprawdź czy edytowałeś `theme.liquid`** (nie inne pliki)
2. **Użyj `!important`** w `customify.css` i `base.css`
3. **Dodaj JavaScript fallback** w `shopify-script.js`
4. **Wymuś cache refresh**: `?v=timestamp` w URL
5. **Sprawdź konsolę**: Czy są błędy CSS

#### **Problem: Style są nadpisywane przez Shopify**
1. **Zwiększ specificity**: Użyj bardziej szczegółowych selektorów
2. **Dodaj `!important`**: W `customify.css` i `base.css`
3. **Użyj JavaScript**: Inline styles w `shopify-script.js` mają najwyższą priority

#### **Problem: Mobile vs Desktop styles**
1. **Sprawdź media queries**: `@media (max-width: 768px)` vs `@media (min-width: 769px)`
2. **Użyj JavaScript**: `window.innerWidth` do wykrywania rozmiaru
3. **Testuj na różnych urządzeniach**: Browser dev tools

### **📱 RESPONSIVE DESIGN RULES:**

#### **Mobile (≤768px):**
- Logo + ikony w jednej linii
- Menu poniżej logo
- Ukryj napisy "Zaloguj"/"Zarejestruj"
- Zmniejsz logo do 120px max-width

#### **Desktop (≥769px):**
- Logo po lewej stronie
- Menu w środku
- Ikony po prawej
- Pełne napisy logowania

### **🚀 DEPLOYMENT WORKFLOW:**
```bash
# 1. Edytuj theme.liquid (sekcja <style>)
# 2. Deploy z synchronizacją
npm run deploy

# 3. Sprawdź na żywo
# https://lumly.pl/products/custom?v=timestamp

# 4. Jeśli nie działa, dodaj JavaScript fallback
# Edytuj public/shopify-script.js

# 5. Commit zmiany
git add . && git commit -m "CSS: opis zmian" && git push origin main
```

### **🔍 DEBUGGING CSS:**
- **Browser DevTools**: Sprawdź computed styles
- **Console**: Sprawdź błędy CSS
- **Network**: Sprawdź czy pliki CSS się ładują
- **Cache**: Użyj Ctrl+F5 lub incognito mode
- **JavaScript**: Sprawdź czy fallback działa

### **⚠️ KRYTYCZNE UWAGI:**
- **Shopify cache** może blokować zmiany przez 15-30 minut
- **JavaScript inline styles** mają najwyższą priority
- **`!important`** jest konieczne w `customify.css` i `base.css`
- **Zawsze testuj** na https://lumly.pl/products/custom
- **Commituj zmiany** po każdym działającym fixie
